<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperParty - Portal Operatori</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 450px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            padding: 40px 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .toggle-link {
            text-align: center;
            margin-top: 20px;
            color: #7f8c8d;
            font-size: 14px;
        }

        .toggle-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .toggle-link a:hover {
            text-decoration: underline;
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        .error-message.active {
            display: block;
        }

        .success-message {
            background: #efe;
            color: #3c3;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        .success-message.active {
            display: block;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* Dashboard */
        .dashboard-container {
            width: 100%;
            max-width: 1200px;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .dashboard-header h2 {
            color: #2c3e50;
            font-size: 24px;
        }

        .logout-btn {
            padding: 10px 20px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .logout-btn:hover {
            background: #c0392b;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .number {
            color: #2c3e50;
            font-size: 32px;
            font-weight: bold;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #667eea;
            color: white;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .events-list {
            display: none;
        }

        .events-list.active {
            display: block;
        }

        .event-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .event-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .event-detail {
            color: #7f8c8d;
            font-size: 14px;
            margin: 5px 0;
        }

        .event-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-small {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-accept {
            background: #27ae60;
            color: white;
        }

        .btn-accept:hover {
            background: #229954;
        }

        .btn-refuse {
            background: #e74c3c;
            color: white;
        }

        .btn-refuse:hover {
            background: #c0392b;
        }

        .btn-allocate {
            background: #667eea;
            color: white;
        }

        .btn-allocate:hover {
            background: #5568d3;
        }

        .no-events {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            background: white;
            border-radius: 12px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .loading:after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        @media (max-width: 768px) {
            .dashboard-header {
                flex-direction: column;
                gap: 15px;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- LOGIN SCREEN -->
    <div class="container screen active" id="loginScreen">
        <div class="header">
            <h1>üé≠ SuperParty</h1>
            <p>Portal Operatori</p>
        </div>
        <div class="content">
            <div class="error-message" id="loginError"></div>
            
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required placeholder="operator@superparty.ro">
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">ParolƒÉ</label>
                    <input type="password" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                
                <button type="submit" class="btn" id="loginBtn">Autentificare</button>
            </form>
            
            <div class="toggle-link">
                Nu ai cont? <a href="#" onclick="showRegister(); return false;">√énregistreazƒÉ-te</a>
            </div>
        </div>
    </div>

    <!-- REGISTER SCREEN -->
    <div class="container screen" id="registerScreen">
        <div class="header">
            <h1>üé≠ SuperParty</h1>
            <p>Creare Cont Operator</p>
        </div>
        <div class="content">
            <div class="error-message" id="registerError"></div>
            <div class="success-message" id="registerSuccess"></div>
            
            <form id="registerForm" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label for="registerName">Nume Complet</label>
                    <input type="text" id="registerName" required placeholder="Ion Popescu">
                </div>
                
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" required placeholder="operator@superparty.ro">
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">ParolƒÉ</label>
                    <input type="password" id="registerPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6">
                </div>
                
                <div class="form-group">
                    <label for="registerCode">Cod Operator</label>
                    <input type="text" id="registerCode" required placeholder="OP001">
                </div>
                
                <button type="submit" class="btn" id="registerBtn">Creare Cont</button>
            </form>
            
            <div class="toggle-link">
                Ai deja cont? <a href="#" onclick="showLogin(); return false;">AutentificƒÉ-te</a>
            </div>
        </div>
    </div>

    <!-- DASHBOARD SCREEN -->
    <div class="screen" id="dashboardScreen">
        <div class="dashboard-container">
            <div class="dashboard-header">
                <div>
                    <h2>üëã Bun venit, <span id="userName"></span>!</h2>
                    <p style="color: #7f8c8d; margin-top: 5px;">Cod: <span id="userCode"></span></p>
                </div>
                <button class="logout-btn" onclick="handleLogout()">Deconectare</button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Evenimente Nealocate</h3>
                    <div class="number" id="statNealocate">0</div>
                </div>
                <div class="stat-card">
                    <h3>√én A»ôteptare</h3>
                    <div class="number" id="statPending">0</div>
                </div>
                <div class="stat-card">
                    <h3>Acceptate</h3>
                    <div class="number" id="statAccepted">0</div>
                </div>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="switchTab('nealocate')">üìã Nealocate</div>
                <div class="tab" onclick="switchTab('pending')">‚è≥ √én A»ôteptare</div>
                <div class="tab" onclick="switchTab('accepted')">‚úÖ Acceptate</div>
            </div>

            <div class="events-list active" id="eventsNealocate">
                <div class="loading">Se √ÆncarcƒÉ evenimente</div>
            </div>

            <div class="events-list" id="eventsPending">
                <div class="loading">Se √ÆncarcƒÉ evenimente</div>
            </div>

            <div class="events-list" id="eventsAccepted">
                <div class="loading">Se √ÆncarcƒÉ evenimente</div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // CONFIGURARE
        // ==========================================
        const API_URL = 'https://script.google.com/macros/s/AKfycbw6k3g_-ezj3q00ej2VI96-SQjQSsmKz2Sm2qOawcGgOhCNeJQWNcUju0DURfKlT0s4/exec';
        
        let currentUser = null;

        // ==========================================
        // SCREEN MANAGEMENT
        // ==========================================
        function showLogin() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('loginScreen').classList.add('active');
            document.getElementById('loginError').classList.remove('active');
        }

        function showRegister() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('registerScreen').classList.add('active');
            document.getElementById('registerError').classList.remove('active');
            document.getElementById('registerSuccess').classList.remove('active');
        }

        function showDashboard() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('dashboardScreen').classList.add('active');
            
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userCode').textContent = currentUser.code;
            
            loadDashboard();
        }

        // ==========================================
        // LOGIN
        // ==========================================
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const btn = document.getElementById('loginBtn');
            const errorDiv = document.getElementById('loginError');
            
            btn.disabled = true;
            btn.textContent = 'Se autentificƒÉ...';
            errorDiv.classList.remove('active');
            
            try {
                const response = await fetch(`${API_URL}?action=login&email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`);
                const data = await response.json();
                
                if (data.ok) {
                    currentUser = data.user;
                    showDashboard();
                } else {
                    errorDiv.textContent = data.message || 'Eroare la autentificare';
                    errorDiv.classList.add('active');
                }
            } catch (error) {
                errorDiv.textContent = 'Nu pot comunica cu serverul. VerificƒÉ conexiunea.';
                errorDiv.classList.add('active');
            }
            
            btn.disabled = false;
            btn.textContent = 'Autentificare';
        }

        // ==========================================
        // REGISTER
        // ==========================================
        async function handleRegister(event) {
            event.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const code = document.getElementById('registerCode').value;
            const btn = document.getElementById('registerBtn');
            const errorDiv = document.getElementById('registerError');
            const successDiv = document.getElementById('registerSuccess');
            
            btn.disabled = true;
            btn.textContent = 'Se creeazƒÉ contul...';
            errorDiv.classList.remove('active');
            successDiv.classList.remove('active');
            
            try {
                const response = await fetch(`${API_URL}?action=register&name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}&code=${encodeURIComponent(code)}`);
                const data = await response.json();
                
                if (data.ok) {
                    successDiv.textContent = 'Cont creat cu succes! Vei fi redirec»õionat cƒÉtre login...';
                    successDiv.classList.add('active');
                    
                    document.getElementById('registerForm').reset();
                    
                    setTimeout(() => {
                        showLogin();
                        document.getElementById('loginEmail').value = email;
                    }, 2000);
                } else {
                    errorDiv.textContent = data.message || 'Eroare la creare cont';
                    errorDiv.classList.add('active');
                }
            } catch (error) {
                errorDiv.textContent = 'Nu pot comunica cu serverul. VerificƒÉ conexiunea.';
                errorDiv.classList.add('active');
            }
            
            btn.disabled = false;
            btn.textContent = 'Creare Cont';
        }

        // ==========================================
        // LOGOUT
        // ==========================================
        function handleLogout() {
            if (confirm('Sigur vrei sƒÉ te deconectezi?')) {
                currentUser = null;
                showLogin();
            }
        }

        // ==========================================
        // DASHBOARD
        // ==========================================
        async function loadDashboard() {
            await Promise.all([
                loadEvents('nealocate'),
                loadEvents('pending'),
                loadEvents('accepted')
            ]);
            
            // Auto-refresh every 30 seconds
            setTimeout(loadDashboard, 30000);
        }

        async function loadEvents(type) {
            const container = document.getElementById(`events${type.charAt(0).toUpperCase() + type.slice(1)}`);
            
            try {
                const response = await fetch(`${API_URL}?action=getUserEvents&type=${type}&userCode=${currentUser.code}`);
                const data = await response.json();
                
                if (data.ok) {
                    const events = data.events || [];
                    
                    // Update stats
                    document.getElementById(`stat${type.charAt(0).toUpperCase() + type.slice(1)}`).textContent = events.length;
                    
                    // Render events
                    if (events.length === 0) {
                        container.innerHTML = '<div class="no-events">Nu existƒÉ evenimente √Æn aceastƒÉ categorie</div>';
                    } else {
                        container.innerHTML = events.map(event => renderEventCard(event, type)).join('');
                    }
                } else {
                    container.innerHTML = '<div class="no-events">Eroare la √ÆncƒÉrcarea evenimentelor</div>';
                }
            } catch (error) {
                container.innerHTML = '<div class="no-events">Nu pot comunica cu serverul</div>';
            }
        }

        function renderEventCard(event, type) {
            return `
                <div class="event-card">
                    <h4>üìÖ ${event.personaj || 'Eveniment'} - ${event.data || ''}</h4>
                    <div class="event-detail">üïê OrƒÉ: ${event.ora || 'N/A'}</div>
                    <div class="event-detail">‚è±Ô∏è DuratƒÉ: ${event.durata || 'N/A'}</div>
                    <div class="event-detail">üìç AdresƒÉ: ${event.adresa || 'N/A'}</div>
                    <div class="event-detail">üé≠ Personaj: ${event.personaj || 'N/A'}</div>
                    ${event.alte_detalii ? `<div class="event-detail">üìù ${event.alte_detalii}</div>` : ''}
                    <div class="event-actions">
                        ${type === 'nealocate' ? `<button class="btn-small btn-allocate" onclick="allocateEvent('${event.id}')">AlocƒÉ-mi</button>` : ''}
                        ${type === 'pending' ? `
                            <button class="btn-small btn-accept" onclick="acceptEvent('${event.id}')">AcceptƒÉ</button>
                            <button class="btn-small btn-refuse" onclick="refuseEvent('${event.id}')">RefuzƒÉ</button>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.events-list').forEach(e => e.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`events${tab.charAt(0).toUpperCase() + tab.slice(1)}`).classList.add('active');
        }

        // ==========================================
        // EVENT ACTIONS
        // ==========================================
        async function allocateEvent(eventId) {
            if (!confirm('Aloca»õi acest eveniment?')) return;
            
            try {
                const response = await fetch(`${API_URL}?action=allocateEvent&eventId=${eventId}&code=${currentUser.code}`);
                const data = await response.json();
                
                if (data.ok) {
                    alert('Eveniment alocat! Ave»õi 5 minute sƒÉ accepta»õi.');
                    loadDashboard();
                } else {
                    alert(data.message || 'Eroare la alocare');
                }
            } catch (error) {
                alert('Nu pot comunica cu serverul');
            }
        }

        async function acceptEvent(eventId) {
            if (!confirm('Accepta»õi acest eveniment?')) return;
            
            try {
                const response = await fetch(`${API_URL}?action=acceptEvent&eventId=${eventId}`);
                const data = await response.json();
                
                if (data.ok) {
                    alert('Eveniment acceptat cu succes!');
                    loadDashboard();
                } else {
                    alert(data.message || 'Eroare la acceptare');
                }
            } catch (error) {
                alert('Nu pot comunica cu serverul');
            }
        }

        async function refuseEvent(eventId) {
            if (!confirm('Refuza»õi acest eveniment? Va reveni la nealocate.')) return;
            
            try {
                const response = await fetch(`${API_URL}?action=refuseEvent&eventId=${eventId}`);
                const data = await response.json();
                
                if (data.ok) {
                    alert('Eveniment refuzat');
                    loadDashboard();
                } else {
                    alert(data.message || 'Eroare la refuzare');
                }
            } catch (error) {
                alert('Nu pot comunica cu serverul');
            }
        }

        // Check timeouts every 30 seconds
        setInterval(async () => {
            if (currentUser) {
                await fetch(`${API_URL}?action=checkTimeouts`);
            }
        }, 30000);
    </script>
</body>
</html>
