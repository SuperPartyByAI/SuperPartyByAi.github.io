<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperParty ğŸ‰ - Dashboard</title>
    
    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
        }
        
        /* Sidebar */
        .sidebar {
            width: 280px;
            background: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
        }
        
        .sidebar-header {
            padding: 35px 20px 30px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: relative;
            overflow: hidden;
            text-align: center;
        }
        
        /* Animated background particles */
        .sidebar-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: particlesMove 20s linear infinite;
        }
        
        @keyframes particlesMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }
        
        .sidebar-header h1 {
            font-size: 28px;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            font-weight: 800;
            letter-spacing: 1px;
            animation: glow 2s ease-in-out infinite;
            text-align: center;
        }
        
        @keyframes glow {
            0%, 100% { text-shadow: 0 0 10px rgba(255,255,255,0.5), 0 0 20px rgba(255,255,255,0.3); }
            50% { text-shadow: 0 0 20px rgba(255,255,255,0.8), 0 0 30px rgba(255,255,255,0.5); }
        }
        
        .sidebar-header .by-ai {
            font-size: 16px;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 700;
            letter-spacing: 2px;
            width: 100%;
        }
        
        .sidebar-header .by-ai > span:first-child {
            margin-right: 2px;
        }
        
        .sidebar-header .by-ai > span:last-child {
            margin-left: 2px;
        }
        
        .ai-badge {
            background: rgba(255,255,255,0.25);
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 800;
            animation: pulse 2s ease-in-out infinite;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.05); opacity: 1; }
        }
        
        .ai-icon {
            display: inline-block;
            animation: rotate 3s linear infinite;
            font-size: 20px;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .sparkle {
            display: inline-block;
            animation: sparkle 1.5s ease-in-out infinite;
            font-size: 20px;
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }
        
        /* Floating AI Chat Button */
        .ai-chat-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 18px 28px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            animation: floatButton 3s ease-in-out infinite;
        }
        
        .ai-chat-button:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
        }
        
        .ai-chat-button:active {
            transform: translateY(-2px) scale(1.02);
        }
        
        @keyframes floatButton {
            0%, 100% { 
                transform: translateY(0px);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            }
            50% { 
                transform: translateY(-10px);
                box-shadow: 0 15px 35px rgba(102, 126, 234, 0.5);
            }
        }
        
        .ai-chat-icon {
            font-size: 24px;
            animation: robotTalk 1s ease-in-out infinite;
        }
        
        @keyframes robotTalk {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
        }
        
        .ai-chat-pulse {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50px;
            background: rgba(102, 126, 234, 0.3);
            animation: pulseRing 2s ease-out infinite;
            z-index: -1;
        }
        
        @keyframes pulseRing {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0;
            }
        }
        
        /* Welcome Page Animations */
        @keyframes bounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .sidebar-menu {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }
        
        .menu-item {
            padding: 15px 25px;
            color: #4b5563;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 16px;
            font-weight: 500;
            border-left: 3px solid transparent;
        }
        
        .menu-item:hover {
            background: #f3f4f6;
            color: #667eea;
            border-left-color: #667eea;
        }
        
        .menu-item.active {
            background: #ede9fe;
            color: #667eea;
            border-left-color: #667eea;
        }
        
        .menu-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }
        
        /* Menu Cards Hover Effects */
        .menu-card {
            transition: all 0.3s ease;
        }
        
        .menu-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2) !important;
        }
        
        .menu-card:active {
            transform: translateY(-5px) scale(1);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 40px;
            overflow-y: auto;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Page Header */
        .page-header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .page-header h2 {
            font-size: 32px;
            color: #1f2937;
            margin-bottom: 10px;
        }
        
        .page-header p {
            color: #6b7280;
            font-size: 16px;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }
        
        .stat-number {
            font-size: 36px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #6b7280;
            font-size: 14px;
        }
        
        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }
        
        .card-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #1f2937;
        }
        
        .card-content {
            color: #6b7280;
            font-size: 15px;
            line-height: 1.6;
        }
        
        .card-content p {
            margin-bottom: 8px;
        }
        
        /* List */
        .list {
            background: white;
            border-radius: 15px;
            padding: 0;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .list-item {
            padding: 20px 25px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .list-item:last-child {
            border-bottom: none;
        }
        
        .list-item:hover {
            background: #f9fafb;
        }
        
        .list-title {
            font-weight: 600;
            color: #1f2937;
            font-size: 16px;
        }
        
        .list-subtitle {
            color: #6b7280;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-success {
            background: #d1fae5;
            color: #047857;
        }
        
        .badge-warning {
            background: #fef3c7;
            color: #b45309;
        }
        
        .badge-info {
            background: #dbeafe;
            color: #0369a1;
        }
        
        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 101;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 20px;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .mobile-menu-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
        }
        
        .mobile-menu-toggle:active {
            transform: scale(0.95);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 1001;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                padding: 20px;
                padding-top: 80px;
                transition: none;
                width: 100%;
            }
            
            /* Overlay Ã®ntunecat cÃ¢nd sidebar-ul e deschis */
            .sidebar.open::before {
                content: '';
                position: fixed;
                top: 0;
                left: 280px;
                width: calc(100vw - 280px);
                height: 100vh;
                background: rgba(0, 0, 0, 0.5);
                z-index: -1;
                animation: fadeIn 0.3s ease;
            }
            
            .page-header {
                margin-top: 0;
            }
            
            .page-header h2 {
                font-size: 24px;
            }
            
            .page-header p {
                font-size: 14px;
            }
            
            .mobile-menu-toggle {
                display: flex !important;
                transition: all 0.3s ease;
                z-index: 1002;
            }
            
            .cards-grid,
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Photo Verification Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-15px);
            }
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        }
        
        /* Password Modal pentru PaginÄƒ SecretÄƒ */
        .password-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .password-modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .password-modal h3 {
            font-size: 24px;
            color: #1f2937;
            margin-bottom: 10px;
        }

        .password-modal input {
            width: 100%;
            padding: 15px;
            margin: 20px 0;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 18px;
            text-align: center;
            letter-spacing: 5px;
        }

        .password-modal input:focus {
            outline: none;
            border-color: #667eea;
        }

        .password-modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .password-cancel {
            flex: 1;
            padding: 12px;
            background: #e5e7eb;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
        }

        .password-submit {
            flex: 1;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
        }
        
        /* Secret Page Styles */
        .secret-content {
            display: none;
        }
        
        .secret-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobileMenuBtn" onclick="toggleSidebar()">â˜°</button>
    
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1>ğŸ‰ SuperParty</h1>
            <div class="by-ai">
                <span>BY</span>
                <span class="ai-badge" id="adminTrigger" style="cursor: default; transition: transform 0.2s;" title="">
                    <span class="ai-icon">ğŸ¤–</span>
                    <span>AI</span>
                </span>
                <span class="sparkle">âœ¨</span>
            </div>
        </div>
        
        <div class="sidebar-menu" id="mainMenu">
            <!-- BUTON INTRÄ‚ ÃN CONT - ASCUNS, va apÄƒrea doar dupÄƒ login -->
            
            <!-- SUBMENIU GENERAL - Apare doar dupÄƒ login -->
            <div id="intraContSubmenu" style="display: none;">
                <!-- General Menu Items -->
                <div class="menu-item" onclick="showPage('home')">
                    <span class="menu-icon">ğŸ </span>
                    <span>AcasÄƒ</span>
                </div>
                <div class="menu-item" onclick="showPage('noteaza-eveniment')">
                    <span class="menu-icon" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 20px;">â•</span>
                    <span style="color: #10b981; font-weight: 600;">NoteazÄƒ Eveniment</span>
                </div>
                <div class="menu-item" onclick="showPage('petreceri-nealocate')">
                    <span class="menu-icon">ğŸ“‹</span>
                    <span>Petreceri Nealocate</span>
                </div>
                <div class="menu-item" onclick="showPage('ce-petreceri-am')">
                    <span class="menu-icon">ğŸŠ</span>
                    <span>Ce Petreceri Am</span>
                </div>
                <div class="menu-item" onclick="showPage('total-petreceri')">
                    <span class="menu-icon">ğŸ“ˆ</span>
                    <span>Total Petreceri</span>
                </div>
                <div class="menu-item" onclick="showPage('soferi')">
                    <span class="menu-icon">ğŸš—</span>
                    <span>Evenimente cu È˜oferi</span>
                </div>
                <div class="menu-item" onclick="showPage('cu-factura')">
                    <span class="menu-icon">ğŸ§¾</span>
                    <span>Cu FacturÄƒ</span>
                </div>
                <div class="menu-item" onclick="showPage('echipa')">
                    <span class="menu-icon">ğŸ‘¥</span>
                    <span>Echipa</span>
                </div>
                <div class="menu-item" onclick="showPage('inventar')">
                    <span class="menu-icon">ğŸ“¦</span>
                    <span>Inventar</span>
                </div>
                <div class="menu-item" onclick="showPage('piniata')">
                    <span class="menu-icon">ğŸ¯</span>
                    <span>Piniata</span>
                </div>
                <div class="menu-item" onclick="showPage('verifica-formular')">
                    <span class="menu-icon">ğŸ“¸</span>
                    <span>VerificÄƒ Formular</span>
                </div>
                <div class="menu-item" onclick="toggleCreierAI()">
                    <span class="menu-icon">ğŸ§ </span>
                    <span>Creier AI</span>
                </div>
                
                <!-- Separator -->
                <div style="border-top: 2px solid #e5e7eb; margin: 15px 20px;"></div>
                
                <!-- MOD ADMIN SECTION - Hidden by default, shown after password -->
                <div id="adminMenuSection" style="display: none;">
                    <div class="menu-item" onclick="toggleAdminMenu()" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; font-weight: 700; cursor: pointer;">
                        <span class="menu-icon">ğŸ”’</span>
                        <span>Mod Admin</span>
                        <span id="adminMenuToggle" style="margin-left: auto; font-size: 16px;">â–¼</span>
                    </div>
                    <div id="adminMenuItems" style="display: none; margin-left: 15px; border-left: 3px solid #ef4444; padding-left: 5px;">
                        <div class="menu-item" onclick="showSecretPage('bifeaza-evenimente-secret')" style="font-size: 14px; padding: 12px 20px;">
                            <span class="menu-icon">âœ…</span>
                            <span>BifeazÄƒ Evenimente</span>
                        </div>
                        <div class="menu-item" onclick="showSecretPage('vezi-statistici')" style="font-size: 14px; padding: 12px 20px;">
                            <span class="menu-icon">ğŸ“Š</span>
                            <span>Vezi Statistici</span>
                        </div>
                        <div class="menu-item" onclick="showSecretPage('total-statistici')" style="font-size: 14px; padding: 12px 20px;">
                            <span class="menu-icon">ğŸ“ˆ</span>
                            <span>Total Statistici</span>
                        </div>
                        <div class="menu-item" onclick="showSecretPage('target-traineri')" style="font-size: 14px; padding: 12px 20px;">
                            <span class="menu-icon">ğŸ’°</span>
                            <span>Target Traineri</span>
                        </div>
                        <div class="menu-item" onclick="showSecretPage('target-animatie')" style="font-size: 14px; padding: 12px 20px;">
                            <span class="menu-icon">ğŸ­</span>
                            <span>Target AnimaÈ›ie</span>
                        </div>
                        <div class="menu-item" onclick="showSecretPage('target-vanzari')" style="font-size: 14px; padding: 12px 20px;">
                            <span class="menu-icon">ğŸ’µ</span>
                            <span>Target VÃ¢nzÄƒri</span>
                        </div>
                        <div class="menu-item" onclick="showSecretPage('genereaza-coduri-secret')" style="font-size: 14px; padding: 12px 20px;">
                            <span class="menu-icon">ğŸ”‘</span>
                            <span>GenereazÄƒ Coduri</span>
                        </div>
                    </div>
                </div>
                
                <!-- MOD GM SECTION - Hidden by default, shown after password -->
                <div id="gmMenuSection" style="display: none;">
                    <div class="menu-item" onclick="toggleGMMenu()" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; font-weight: 700; cursor: pointer;">
                        <span class="menu-icon">ğŸ®</span>
                        <span>Mod GM</span>
                        <span id="gmMenuToggle" style="margin-left: auto; font-size: 16px;">â–¼</span>
                    </div>
                    <div id="gmMenuItems" style="display: none; margin-left: 15px; border-left: 3px solid #8b5cf6; padding-left: 5px;">
                        <div class="menu-item" onclick="showPage('mod-gm')" style="font-size: 14px; padding: 12px 20px;">
                            <span class="menu-icon">ğŸ‘¥</span>
                            <span>Gestionare Utilizatori</span>
                        </div>
                    </div>
                </div>
                
                <!-- Separator before logout -->
                <div style="border-top: 2px solid #e5e7eb; margin: 20px 20px 15px 20px;"></div>
                
                <!-- LOGOUT BUTTON - Always visible when logged in -->
                <div class="menu-item" onclick="logoutUser()" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; font-weight: 700; cursor: pointer; margin: 0 10px 20px 10px; border-radius: 12px;">
                    <span class="menu-icon">ğŸšª</span>
                    <span>IeÈ™i din cont</span>
                </div>
            </div>
            
            <!-- ADMIN MENU - Dezactivat
            <div id="adminMenu" style="display: none;">
                <div style="border-top: 2px solid #ef4444; margin: 15px 0; padding-top: 15px;">
                    <div style="color: #ef4444; font-weight: 700; font-size: 12px; padding: 0 20px 10px 20px; letter-spacing: 1px;">ğŸ” ADMIN MODE</div>
                </div>
                <div class="menu-item active" onclick="showPage('bifeaza-evenimente')" style="background: rgba(239, 68, 68, 0.1);">
                    <span class="menu-icon">âœ…</span>
                    <span style="color: #ef4444; font-weight: 600;">BifeazÄƒ Evenimente</span>
                </div>
                <div class="menu-item" onclick="logoutAdmin()" style="background: rgba(239, 68, 68, 0.2); margin-top: 20px;">
                    <span class="menu-icon">ğŸšª</span>
                    <span style="color: #ef4444; font-weight: 700;">IeÈ™ire Admin</span>
                </div>
            </div>
            -->
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Welcome Home Page - EMPTY -->
        <div class="page active" id="home">
            <!-- GOL - nimic aici, login doar prin AI Chat cu comanda "intra in mod logare" -->
        </div>

        <!-- Mod GM Page -->
        <div class="page" id="mod-gm">
            <div class="page-header">
                <h2>ğŸ® Mod GM - Gestionare Utilizatori</h2>
                <p>AdministreazÄƒ conturile utilizatorilor din sistem</p>
            </div>
            
            <!-- Add User Button -->
            <div style="text-align: center; margin: 30px 0; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                <button onclick="loadUsersData()" style="background: #3b82f6; color: white; border: none; padding: 20px 40px; border-radius: 15px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4); transition: all 0.3s; display: inline-flex; align-items: center; gap: 12px;">
                    <span style="font-size: 28px;">ğŸ”„</span>
                    <span>ReÃ®mprospÄƒteazÄƒ</span>
                </button>
                <button onclick="addNewUserRow()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 20px 40px; border-radius: 15px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4); transition: all 0.3s; display: inline-flex; align-items: center; gap: 12px;">
                    <span style="font-size: 28px;">â•</span>
                    <span>AdaugÄƒ Utilizator Nou</span>
                </button>
                <button onclick="showCreierAI()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; padding: 20px 40px; border-radius: 15px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4); transition: all 0.3s; display: inline-flex; align-items: center; gap: 12px;">
                    <span style="font-size: 28px;">ğŸ§ </span>
                    <span>Creier AI</span>
                </button>
            </div>
            
            <!-- Creier AI Section (hidden by default) -->
            <div id="creierAISection" style="display: none; margin: 30px 0;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <!-- Left: AI Brain -->
                    <div style="background: white; border-radius: 20px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                        <h3 style="margin: 0 0 20px 0; color: #1f2937; display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 32px;">ğŸ§ </span>
                            <span>Creier AI - Baza de CunoÈ™tinÈ›e</span>
                        </h3>
                        <p style="color: #6b7280; margin-bottom: 15px; font-size: 14px;">
                            Scrie aici tot ce AI-ul trebuie sÄƒ È™tie despre SuperParty: preÈ›uri, program, politici, rÄƒspunsuri la Ã®ntrebÄƒri frecvente, etc.
                        </p>
                        <textarea id="aiKnowledgeBase" 
                            placeholder="Exemplu:

PreÈ›uri:
- Animator: 500 RON/orÄƒ
- Animator + Bagaje: 700 RON/orÄƒ

Program:
- Luni-Vineri: 10:00-18:00
- Weekend: 09:00-20:00

Contact:
- Email: contact@superparty.ro
- Tel: 0721234567

Politici:
- Avans 50% la rezervare
- Anulare gratuitÄƒ cu 48h Ã®nainte
..."
                            style="width: 100%; min-height: 500px; padding: 15px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 15px; font-family: monospace; resize: vertical; line-height: 1.6;">
                        </textarea>
                        <button onclick="saveAIKnowledgeBase()" 
                            style="margin-top: 15px; width: 100%; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 15px; border-radius: 12px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);">
                            ğŸ’¾ SalveazÄƒ Creierul AI
                        </button>
                    </div>
                    
                    <!-- Right: Unanswered Questions -->
                    <div style="background: white; border-radius: 20px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                        <h3 style="margin: 0 0 20px 0; color: #1f2937; display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 32px;">â“</span>
                            <span>ÃntrebÄƒri Neacoperite</span>
                        </h3>
                        <p style="color: #6b7280; margin-bottom: 15px; font-size: 14px;">
                            ÃntrebÄƒri pe care utilizatorii le-au pus, dar nu aveau rÄƒspuns Ã®n Creierul AI. Click pe Ã®ntrebare pentru a o adÄƒuga Ã®n Creier.
                        </p>
                        <div id="unansweredQuestionsList" style="max-height: 500px; overflow-y: auto;">
                            <!-- Questions will be loaded here -->
                        </div>
                    </div>
                </div>
                <button onclick="hideCreierAI()" 
                    style="margin-top: 20px; background: #fee2e2; color: #dc2626; border: none; padding: 15px 30px; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer;">
                    âŒ Ãnchide
                </button>
            </div>
            
            <!-- Date Filter for Chat History -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; padding: 25px; margin: 20px 0; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                <h3 style="color: white; margin: 0 0 15px 0; font-size: 18px; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 24px;">ğŸ“…</span>
                    Filtru Istoric ConversaÈ›ii
                </h3>
                <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 200px;">
                        <label style="display: block; color: white; font-size: 14px; font-weight: 600; margin-bottom: 8px;">De la:</label>
                        <input type="date" id="chatFilterFrom" style="width: 100%; padding: 12px; border: 2px solid white; border-radius: 10px; font-size: 15px; outline: none;">
                    </div>
                    <div style="flex: 1; min-width: 200px;">
                        <label style="display: block; color: white; font-size: 14px; font-weight: 600; margin-bottom: 8px;">PÃ¢nÄƒ la:</label>
                        <input type="date" id="chatFilterTo" style="width: 100%; padding: 12px; border: 2px solid white; border-radius: 10px; font-size: 15px; outline: none;">
                    </div>
                    <button onclick="applyChatDateFilter()" style="background: white; color: #667eea; border: none; padding: 12px 30px; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer; margin-top: 20px; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        ğŸ” AplicÄƒ Filtru
                    </button>
                    <button onclick="clearChatDateFilter()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 12px 30px; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer; margin-top: 20px; transition: all 0.3s;">
                        âŒ ReseteazÄƒ
                    </button>
                </div>
            </div>
            
            <!-- Users Table - SAME AS MOD ADMIN -->
            <div style="background: white; border-radius: 20px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); overflow-x: auto;">
                <table id="usersTableGM" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <th style="padding: 15px; text-align: left; border-radius: 10px 0 0 0;">ğŸ‘¤ Nume</th>
                            <th style="padding: 15px; text-align: left;">ğŸ“§ Email</th>
                            <th style="padding: 15px; text-align: left;">ğŸ”’ ParolÄƒ</th>
                            <th style="padding: 15px; text-align: left;">ğŸ”’ RepetÄƒ ParolÄƒ</th>
                            <th style="padding: 15px; text-align: left;">ğŸ”‘ Cheie de Acces</th>
                            <th style="padding: 15px; text-align: left;">ğŸ“± Ce cod ai</th>
                            <th style="padding: 15px; text-align: left;">ğŸ­ Rol Utilizator</th>
                            <th style="padding: 15px; text-align: center;">ğŸ”“ Status</th>
                            <th style="padding: 15px; text-align: center;">ğŸ’¬ Chat</th>
                            <th style="padding: 15px; text-align: center; border-radius: 0 10px 0 0;">âš™ï¸ AcÈ›iuni</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBodyGM">
                        <!-- Rows will be added here dynamically by renderUsersTable() -->
                    </tbody>
                </table>
            </div>

            <!-- Save Button -->
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="saveUsersData(); alert('âœ… ModificÄƒri salvate!');" 
                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 20px 60px; border-radius: 15px; font-size: 20px; font-weight: 700; cursor: pointer; box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4); transition: all 0.3s; display: inline-flex; align-items: center; gap: 15px;">
                    <span style="font-size: 32px;">ğŸ’¾</span>
                    <span>SalveazÄƒ Toate ModificÄƒrile</span>
                </button>
            </div>
        </div>
        
        <!-- Page: IntrÄƒ Ã®n cont (LOGIN FORM) -->
        <div class="page" id="intra-cont">
            <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px;">
                <div style="background: white; border-radius: 24px; padding: 50px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15); max-width: 450px; width: 100%;">
                    <!-- Header -->
                    <div style="text-align: center; margin-bottom: 40px;">
                        <div style="font-size: 64px; margin-bottom: 15px;">ğŸ‘¤</div>
                        <h2 style="font-size: 32px; color: #1f2937; margin: 0 0 10px 0; font-weight: 800;">IntrÄƒ Ã®n cont</h2>
                        <p style="color: #6b7280; font-size: 15px; margin: 0;">Introdu datele tale de autentificare</p>
                    </div>
                    
                    <!-- Login Form -->
                    <form id="loginForm" onsubmit="handleLogin(event)" style="display: flex; flex-direction: column; gap: 25px;">
                        <!-- Email -->
                        <div>
                            <label style="display: block; color: #374151; font-size: 14px; font-weight: 600; margin-bottom: 10px;">
                                ğŸ“§ Email
                            </label>
                            <input 
                                type="text" 
                                id="loginUsername" 
                                placeholder="Introdu email-ul" 
                                required
                                style="width: 100%; padding: 15px 18px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; transition: all 0.3s; outline: none;"
                                onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'"
                                onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
                            >
                        </div>
                        
                        <!-- Password -->
                        <div>
                            <label style="display: block; color: #374151; font-size: 14px; font-weight: 600; margin-bottom: 10px;">
                                ğŸ”’ ParolÄƒ
                            </label>
                            <input 
                                type="password" 
                                id="loginPassword" 
                                placeholder="Introdu parola" 
                                required
                                style="width: 100%; padding: 15px 18px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; transition: all 0.3s; outline: none;"
                                onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'"
                                onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
                            >
                        </div>
                        
                        <!-- Access Key -->
                        <div>
                            <label style="display: block; color: #374151; font-size: 14px; font-weight: 600; margin-bottom: 10px;">
                                ğŸ”‘ Cheie de Acces
                            </label>
                            <input 
                                type="password" 
                                id="loginAccessKey" 
                                placeholder="Introdu cheia de acces" 
                                required
                                style="width: 100%; padding: 15px 18px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; font-family: monospace; transition: all 0.3s; outline: none;"
                                onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'"
                                onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
                            >
                        </div>
                        
                        <!-- Remember Me -->
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="rememberMe" style="width: 18px; height: 18px; cursor: pointer;">
                            <label for="rememberMe" style="color: #6b7280; font-size: 14px; cursor: pointer; user-select: none;">
                                Èšine-mÄƒ minte
                            </label>
                        </div>
                        
                        <!-- Login Button -->
                        <button 
                            type="submit"
                            style="width: 100%; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; font-size: 18px; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);"
                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(102, 126, 234, 0.5)'"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.4)'"
                        >
                            ğŸš€ IntrÄƒ Ã®n cont
                        </button>
                        
                        <!-- Register Button -->
                        <button 
                            type="button"
                            onclick="document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById('inregistreaza-te').classList.add('active');"
                            style="width: 100%; padding: 16px; background: white; color: #667eea; border: 2px solid #667eea; border-radius: 12px; font-size: 18px; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);"
                            onmouseover="this.style.background='#f0f4ff'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(102, 126, 234, 0.3)'"
                            onmouseout="this.style.background='white'; this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.2)'"
                        >
                            âœ¨ ÃnregistreazÄƒ-te
                        </button>
                    </form>
                    
                    <!-- Error Message -->
                    <div id="loginError" style="display: none; margin-top: 20px; padding: 15px; background: #fee2e2; border: 2px solid #fecaca; border-radius: 12px; color: #dc2626; font-size: 14px; font-weight: 600; text-align: center;">
                        âŒ Username sau parolÄƒ incorectÄƒ!
                    </div>
                    
                    <!-- Success Message -->
                    <div id="loginSuccess" style="display: none; margin-top: 20px; padding: 15px; background: #d1fae5; border: 2px solid #a7f3d0; border-radius: 12px; color: #059669; font-size: 14px; font-weight: 600; text-align: center;">
                        âœ… Autentificare reuÈ™itÄƒ!
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Page: ÃnregistreazÄƒ-te (REGISTRATION FORM) -->
        <div class="page" id="inregistreaza-te">
            <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px;">
                <div style="background: white; border-radius: 24px; padding: 50px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15); max-width: 450px; width: 100%;">
                    <!-- Header -->
                    <div style="text-align: center; margin-bottom: 40px;">
                        <div style="font-size: 64px; margin-bottom: 15px;">âœ¨</div>
                        <h2 style="font-size: 32px; color: #1f2937; margin: 0 0 10px 0; font-weight: 800;">ÃnregistreazÄƒ-te</h2>
                        <p style="color: #6b7280; font-size: 15px; margin: 0;">CreeazÄƒ un cont nou</p>
                    </div>
                    
                    <!-- Registration Form -->
                    <form id="registerForm" onsubmit="handleRegister(event)" style="display: flex; flex-direction: column; gap: 25px;">
                        <!-- Name -->
                        <div>
                            <label style="display: block; color: #374151; font-size: 14px; font-weight: 600; margin-bottom: 10px;">
                                ğŸ‘¤ Nume
                            </label>
                            <input 
                                type="text" 
                                id="registerName" 
                                placeholder="Introdu numele tÄƒu" 
                                required
                                style="width: 100%; padding: 15px 18px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; transition: all 0.3s; outline: none;"
                                onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'"
                                onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
                            >
                        </div>
                        
                        <!-- Email -->
                        <div>
                            <label style="display: block; color: #374151; font-size: 14px; font-weight: 600; margin-bottom: 10px;">
                                ğŸ“§ Email
                            </label>
                            <input 
                                type="email" 
                                id="registerEmail" 
                                placeholder="exemplu@email.com" 
                                required
                                style="width: 100%; padding: 15px 18px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; transition: all 0.3s; outline: none;"
                                onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'"
                                onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
                            >
                        </div>
                        
                        <!-- Password -->
                        <div>
                            <label style="display: block; color: #374151; font-size: 14px; font-weight: 600; margin-bottom: 10px;">
                                ğŸ”’ ParolÄƒ
                            </label>
                            <input 
                                type="password" 
                                id="registerPassword" 
                                placeholder="CreeazÄƒ o parolÄƒ" 
                                required
                                style="width: 100%; padding: 15px 18px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; transition: all 0.3s; outline: none;"
                                onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'"
                                onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
                            >
                        </div>
                        
                        <!-- Confirm Password -->
                        <div>
                            <label style="display: block; color: #374151; font-size: 14px; font-weight: 600; margin-bottom: 10px;">
                                ğŸ”’ RepetÄƒ parola
                            </label>
                            <input 
                                type="password" 
                                id="registerPasswordConfirm" 
                                placeholder="RepetÄƒ parola" 
                                required
                                style="width: 100%; padding: 15px 18px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; transition: all 0.3s; outline: none;"
                                onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'"
                                onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
                            >
                        </div>
                        
                        <!-- Register Button -->
                        <button 
                            type="submit"
                            style="width: 100%; padding: 16px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 12px; font-size: 18px; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);"
                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(16, 185, 129, 0.5)'"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(16, 185, 129, 0.4)'"
                        >
                            âœ¨ CreeazÄƒ cont
                        </button>
                        
                        <!-- Back to Login Button -->
                        <button 
                            type="button"
                            onclick="document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById('intra-cont').classList.add('active');"
                            style="width: 100%; padding: 16px; background: white; color: #667eea; border: 2px solid #667eea; border-radius: 12px; font-size: 18px; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);"
                            onmouseover="this.style.background='#f0f4ff'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(102, 126, 234, 0.3)'"
                            onmouseout="this.style.background='white'; this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.2)'"
                        >
                            ğŸ‘¤ Am deja cont
                        </button>
                    </form>
                    
                    <!-- Error Message -->
                    <div id="registerError" style="display: none; margin-top: 20px; padding: 15px; background: #fee2e2; border: 2px solid #fecaca; border-radius: 12px; color: #dc2626; font-size: 14px; font-weight: 600; text-align: center;">
                        âŒ Eroare la Ã®nregistrare!
                    </div>
                    
                    <!-- Success Message -->
                    <div id="registerSuccess" style="display: none; margin-top: 20px; padding: 15px; background: #d1fae5; border: 2px solid #a7f3d0; border-radius: 12px; color: #059669; font-size: 14px; font-weight: 600; text-align: center;">
                        âœ… Cont creat cu succes!
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Page: NoteazÄƒ Eveniment (FORM) -->
        <div class="page" id="noteaza-eveniment">
            <div class="page-header">
                <h2>â• NoteazÄƒ Eveniment Nou</h2>
                <p>CompleteazÄƒ formularul pentru a adÄƒuga un eveniment nou</p>
            </div>
            
            <!-- ÃnregistreazÄƒ Colaboratori Button -->
            <div style="margin-bottom: 25px;">
                <button onclick="openColaboratoriModal()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; padding: 15px 25px; border-radius: 12px; font-weight: 700; cursor: pointer; font-size: 16px; box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4); transition: all 0.3s; display: inline-flex; align-items: center; gap: 10px;">
                    <span style="font-size: 22px;">ğŸ‘¥</span>
                    <span>ÃnregistreazÄƒ Colaboratori</span>
                </button>
            </div>
            
            <!-- AI Photo Scan Section -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 25px; margin-bottom: 25px; box-shadow: 0 8px 30px rgba(102, 126, 234, 0.3);">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    <div style="font-size: 40px;">ğŸ“¸</div>
                    <div>
                        <h3 style="color: white; font-size: 20px; font-weight: 700; margin: 0 0 5px 0;">ScaneazÄƒ Formular cu AI</h3>
                        <p style="color: rgba(255,255,255,0.9); font-size: 14px; margin: 0;">ÃncarcÄƒ o pozÄƒ È™i AI va completa automat cÃ¢mpurile din formular</p>
                    </div>
                </div>
                
                <input type="file" id="aiPhotoInput" accept="image/*" capture="environment" style="display: none;" onchange="processPhotoWithAI(this)">
                
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button type="button" onclick="document.getElementById('aiPhotoInput').click()" style="flex: 1; min-width: 200px; background: white; color: #667eea; border: none; padding: 15px 20px; border-radius: 12px; font-weight: 700; cursor: pointer; font-size: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span style="font-size: 20px;">ğŸ“·</span>
                        <span>FÄƒ PozÄƒ</span>
                    </button>
                    
                    <button type="button" onclick="document.getElementById('aiPhotoInput').click()" style="flex: 1; min-width: 200px; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 15px 20px; border-radius: 12px; font-weight: 700; cursor: pointer; font-size: 15px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span style="font-size: 20px;">ğŸ–¼ï¸</span>
                        <span>ÃncarcÄƒ PozÄƒ</span>
                    </button>
                </div>
                
                <!-- Preview Area -->
                <div id="photoPreview" style="margin-top: 15px; display: none;">
                    <div style="background: rgba(255,255,255,0.2); border-radius: 12px; padding: 15px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: white; font-weight: 600;">ğŸ¤– AI ProceseazÄƒ imaginea...</span>
                            <div style="width: 20px; height: 20px; border: 3px solid white; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        </div>
                        <img id="previewImage" style="width: 100%; max-height: 300px; object-fit: contain; border-radius: 8px; background: white;">
                    </div>
                </div>
            </div>
            
            <!-- Form Container -->
            <div style="background: white; border-radius: 20px; padding: 30px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);">
                <form id="eventForm" onsubmit="handleFormSubmit(event)">
                    <!-- Data primit formular -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Pe ce data ai primit formularul</label>
                        <input type="text" name="dataFormular" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="15/11/2025" pattern="\d{2}/\d{2}/\d{4}" required>
                    </div>
                    
                    <!-- Adauga dovada primit formular -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Adauga dovada primit formular</label>
                        <input type="file" id="dovadaFormular" name="dovadaFormular" accept="image/*" style="display: none;">
                        <button type="button" onclick="document.getElementById('dovadaFormular').click()" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; background: white; text-align: left; cursor: pointer; font-size: 15px; color: #6b7280;">
                            ğŸ–¼ï¸ Add image
                        </button>
                    </div>
                    
                    <!-- Cine noteaza -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Cine noteaza eveniment</label>
                        <input type="text" name="cineNoteaza" list="trainerCodes" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="Scrie cod (ex: A1, B5, Z50)" required>
                        <p style="margin-top: 5px; font-size: 12px; color: #9ca3af; font-style: italic;">ğŸ’¡ Scrie litera È™i numÄƒrul (A1-Z50) - lista se filtreazÄƒ automat</p>
                    </div>
                    
                    <!-- Numar eveniment - COD UNIC -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 12px; font-weight: 500;">Cod unic eveniment</label>
                        <div style="display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px 30px; border-radius: 15px; font-size: 42px; font-weight: 700; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                            <span id="numarEveniment">318</span>
                        </div>
                        <p style="margin-top: 8px; font-size: 12px; color: #9ca3af; font-style: italic;">Generator automat - folosit pentru dublarea evenimentelor Ã®n funcÈ›ie de roluri</p>
                    </div>
                    
                    <!-- De pe ce a intrat -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">De pe ce a intrat clientul</label>
                        <select name="sursa" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" required>
                            <option value="">SelecteazÄƒ...</option>
                            <option>Facebook</option>
                            <option>Instagram</option>
                            <option>Google</option>
                            <option>Recomandare</option>
                            <option>WhatsApp</option>
                            <option>Altele</option>
                        </select>
                    </div>
                    
                    <!-- De unde a intrat -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">De unde a intrat clientul</label>
                        <select name="locatie" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" required>
                            <option value="">SelecteazÄƒ...</option>
                            <option>BucureÈ™ti</option>
                            <option>Ilfov</option>
                            <option>ConstanÈ›a</option>
                            <option>BraÈ™ov</option>
                            <option>Cluj</option>
                            <option>Altele</option>
                        </select>
                    </div>
                    
                    <!-- Telefon -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Numar de telefon</label>
                        <input type="tel" name="telefon" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="+40 700 000 000" required>
                    </div>
                    
                    <!-- Necesita sofer -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Necesita sofer</label>
                        <select name="necesitaSofer" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" required>
                            <option value="">SelecteazÄƒ...</option>
                            <option>Da</option>
                            <option>Nu</option>
                        </select>
                    </div>
                    
                    <!-- Titlu - INPUT TEXT pentru parsing live -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">ğŸ“ Titlu Eveniment</label>
                        <input type="text" name="titlu" id="titluInput" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="Ex: Spider-Man + Iron Man + Piniata + Tort Kinder" required oninput="parseTitluLive()">
                        <p style="margin-top: 5px; font-size: 12px; color: #9ca3af; font-style: italic;">ğŸ’¡ SeparÄƒ cu <strong>+</strong> sau <strong>si</strong> sau <strong>È™i</strong> | Include roluri + extra-uri (piniata, tort, vata, etc.)</p>
                    </div>
                    
                    <!-- Container DINAMIC pentru durate pe fiecare rol (FÄ‚RÄ‚ extra-uri) -->
                    <div id="durateRolesContainer" style="margin-bottom: 20px; display: none;">
                        <!-- CÃ¢mpurile de duratÄƒ vor fi generate automat aici -->
                    </div>
                    
                    <!-- Data si ora petrecere - UN SINGUR CAMP -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">ğŸ“… Data È™i Ora Petrecere</label>
                        <input type="datetime-local" name="dataOraPetrecere" id="dataOraPetrecere" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" required>
                        <p style="margin-top: 5px; font-size: 12px; color: #9ca3af; font-style: italic;">ğŸ’¡ SelecteazÄƒ atÃ¢t data cÃ¢t È™i ora petrecerii</p>
                    </div>
                    
                    <!-- Cate ore ai vandut -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Cate ore ai vandut in eveniment</label>
                        <select name="oreVandute" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" required>
                            <option value="">SelecteazÄƒ...</option>
                            <option>1 orÄƒ</option>
                            <option>2 ore</option>
                            <option>3 ore</option>
                            <option>4 ore</option>
                            <option>5 ore</option>
                        </select>
                    </div>
                    
                    
                    <!-- Adresa -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Adresa</label>
                        <input type="text" name="adresa" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="BucureÈ™ti, Sector 3" required>
                    </div>
                    
                    <!-- Total -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Total</label>
                        <input type="number" name="total" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="123" required>
                    </div>
                    
                    <!-- MetodÄƒ PlatÄƒ -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Cum se Ã®ncaseazÄƒ? ğŸ’³</label>
                        <select name="metodaPlata" id="metodaPlata" onchange="handleMetodaPlataChange()" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" required>
                            <option value="">SelecteazÄƒ...</option>
                            <option value="Cash la final">ğŸ’µ Cash la final de petrecere</option>
                            <option value="Prin factura">ğŸ§¾ Prin facturÄƒ</option>
                            <option value="Alta varianta">âœ… AltÄƒ variantÄƒ / A plÄƒtit</option>
                            <option value="Card partial + Cash rest">ğŸ’³ Pe card o parte + restul cash</option>
                            <option value="Cash partial + Card rest">ğŸ’µ Cash o parte + restul pe card</option>
                        </select>
                    </div>
                    
                    <!-- CÃ¢mp condiÈ›ionat: Card partial -->
                    <div id="campCardPartial" style="margin-bottom: 20px; display: none;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">ğŸ’³ CÃ¢t s-a plÄƒtit pe card?</label>
                        <input type="number" name="sumaCard" id="sumaCard" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="Ex: 150">
                        <p style="margin-top: 5px; font-size: 13px; color: #6b7280;">Restul se va plÄƒti cash</p>
                    </div>
                    
                    <!-- CÃ¢mp condiÈ›ionat: Cash partial -->
                    <div id="campCashPartial" style="margin-bottom: 20px; display: none;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">ğŸ’µ CÃ¢t s-a plÄƒtit cash?</label>
                        <input type="number" name="sumaCash" id="sumaCash" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="Ex: 100">
                        <p style="margin-top: 5px; font-size: 13px; color: #6b7280;">Restul se va plÄƒti pe card</p>
                    </div>
                    
                    <!-- Servicii dorite -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Servicii dorite</label>
                        <select name="servicii" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" required>
                            <option value="">SelecteazÄƒ...</option>
                            <option>AnimaÈ›ie</option>
                            <option>Piniata</option>
                            <option>Facepainting</option>
                            <option>Baloane</option>
                            <option>MuzicÄƒ</option>
                        </select>
                    </div>
                    
                    <!-- Are piniata -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Are piniata</label>
                        <select name="arePiniata" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" required>
                            <option value="">SelecteazÄƒ...</option>
                            <option>Da</option>
                            <option>Nu</option>
                        </select>
                    </div>
                    
                    <!-- Prenume parinte -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Prenume parinte</label>
                        <input type="text" name="prenumeParinte" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="Introdu prenumele..." required>
                    </div>
                    
                    <!-- Prenume copil -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Prenume copil</label>
                        <input type="text" name="prenumeCopil" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="Alexandru" required>
                    </div>
                    
                    <!-- Varsta copil -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Varsta copil</label>
                        <input type="number" name="varstaCopil" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="123" required>
                    </div>
                    
                    <!-- Numar copii aproximativ -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Numar copii aproximativ</label>
                        <select name="numarCopii" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" required>
                            <option value="">SelecteazÄƒ...</option>
                            <option>5-10 copii</option>
                            <option>10-15 copii</option>
                            <option>15-20 copii</option>
                            <option>20+ copii</option>
                        </select>
                    </div>
                    
                    <!-- Alte detalii -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Alte detalii</label>
                        <textarea name="alteDetalii" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px; min-height: 80px; resize: vertical;" placeholder="Detalii suplimentare..."></textarea>
                    </div>
                    
                    <!-- Cum se incaseaza -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Cum se incaseaza</label>
                        <select name="cumSeIncaseaza" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" required>
                            <option value="">SelecteazÄƒ...</option>
                            <option>Cash</option>
                            <option>Card</option>
                            <option>Transfer bancar</option>
                        </select>
                    </div>
                    
                    <!-- Situatie incasare -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Situatie incasare</label>
                        <select name="situatieIncasare" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" required>
                            <option value="">SelecteazÄƒ...</option>
                            <option>PlÄƒtit integral</option>
                            <option>Avans</option>
                            <option>NeplÄƒtit</option>
                        </select>
                    </div>
                    
                    <!-- Scrie datele de facturare -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Scrie datele de facturare</label>
                        <select name="dateleFacturare" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" required>
                            <option value="">SelecteazÄƒ...</option>
                            <option>Da - necesitÄƒ facturÄƒ</option>
                            <option>Nu - nu necesitÄƒ facturÄƒ</option>
                        </select>
                    </div>
                    
                    <!-- Dovada platii -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Dovada platii</label>
                        <input type="file" id="dovadaPlatii" name="dovadaPlatii" accept="image/*" style="display: none;">
                        <button type="button" onclick="document.getElementById('dovadaPlatii').click()" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; background: white; text-align: left; cursor: pointer; font-size: 15px; color: #6b7280;">
                            ğŸ–¼ï¸ Add image
                        </button>
                    </div>
                    
                    <!-- Dovada Factura -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Dovada Factura</label>
                        <input type="file" id="dovadaFactura" name="dovadaFactura" accept="image/*" style="display: none;">
                        <button type="button" onclick="document.getElementById('dovadaFactura').click()" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; background: white; text-align: left; cursor: pointer; font-size: 15px; color: #6b7280;">
                            ğŸ–¼ï¸ Add image
                        </button>
                    </div>
                    
                    <!-- Submit Button -->
                    <button type="submit" style="width: 100%; padding: 16px; background: #f0f0f0; color: #666; border: none; border-radius: 12px; font-size: 18px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                        Am terminat!
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Page: Petreceri Nealocate -->
        <div class="page" id="petreceri-nealocate">
            <div class="page-header">
                <h2>ğŸ“‹ Petreceri Nealocate</h2>
                <p>Lista petrecerilor care aÈ™teaptÄƒ sÄƒ fie alocate unui È™ofer</p>
            </div>
        </div>
        
        <!-- Page: Ce Petreceri Am -->
        <div class="page" id="ce-petreceri-am">
            <div class="page-header">
                <h2>ğŸŠ Ce Petreceri Am</h2>
                <p>Petrecerile pe care le-ai notat tu - bazat pe codul tÄƒu de trainer</p>
            </div>
            
            <!-- Cod Trainer Input -->
            <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.06);">
                <div style="display: flex; gap: 15px; align-items: end; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 200px;">
                        <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #6b7280; font-weight: 600;">ğŸ¯ Introdu codul tÄƒu de trainer:</label>
                        <input type="text" id="myTrainerCode" placeholder="Ex: A1, B5, Z50" style="width: 100%; padding: 12px 15px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px; text-transform: uppercase; font-weight: 600; transition: all 0.3s;" onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e5e7eb'">
                        <p style="margin-top: 8px; font-size: 13px; color: #9ca3af; font-style: italic;">ğŸ’¡ AcelaÈ™i cod pe care Ã®l foloseÈ™ti cÃ¢nd notezi evenimente</p>
                    </div>
                    <button onclick="loadMyParties()" style="padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; font-size: 15px; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); white-space: nowrap;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.4)'">
                        ğŸ” Vezi Petrecerile Mele
                    </button>
                </div>
            </div>
            
            <!-- My Parties Cards Grid -->
            <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 2px 15px rgba(0,0,0,0.08);">
                <h3 style="margin-bottom: 20px; color: #374151; font-size: 18px;" id="myPartiesTitle">ğŸ“‹ Petrecerile Mele</h3>
                <div id="myPartiesCardsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px;">
                    <!-- Cardurile vor fi generate dinamic aici -->
                    <div style="grid-column: 1 / -1; padding: 60px; text-align: center; color: #9ca3af; font-size: 16px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ¯</div>
                        <div style="font-weight: 600;">Introdu codul tÄƒu de trainer pentru a vedea petrecerile</div>
                        <div style="margin-top: 10px; font-size: 14px;">Codul este acelaÈ™i pe care Ã®l foloseÈ™ti cÃ¢nd notezi un eveniment nou</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Page: Total Petreceri -->
        <div class="page" id="total-petreceri">
            <div class="page-header">
                <h2>ğŸ“ˆ Total Petreceri</h2>
                <p>Vezi toate petrecerile salvate cu posibilitate de filtrare dupÄƒ datÄƒ</p>
            </div>
            
            <!-- Date Filter - Compact -->
            <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.06);">
                <div style="display: flex; flex-wrap: wrap; gap: 15px; align-items: end;">
                    <!-- Date Inputs -->
                    <div style="flex: 1; min-width: 180px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px; color: #6b7280; font-weight: 500;">De la:</label>
                        <input type="date" id="dateFrom" style="width: 100%; padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px; transition: all 0.3s;" onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e5e7eb'">
                    </div>
                    <div style="flex: 1; min-width: 180px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px; color: #6b7280; font-weight: 500;">PÃ¢nÄƒ la:</label>
                        <input type="date" id="dateTo" style="width: 100%; padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px; transition: all 0.3s;" onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e5e7eb'">
                    </div>
                    
                    <!-- Quick Filter Buttons -->
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <button onclick="applyQuickFilter('today')" style="padding: 10px 14px; background: white; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; color: #374151;" onmouseover="this.style.background='#f9fafb'; this.style.borderColor='#667eea'" onmouseout="this.style.background='white'; this.style.borderColor='#e5e7eb'">
                            Azi
                        </button>
                        <button onclick="applyQuickFilter('week')" style="padding: 10px 14px; background: white; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; color: #374151;" onmouseover="this.style.background='#f9fafb'; this.style.borderColor='#667eea'" onmouseout="this.style.background='white'; this.style.borderColor='#e5e7eb'">
                            SÄƒptÄƒmÃ¢na
                        </button>
                        <button onclick="applyQuickFilter('month')" style="padding: 10px 14px; background: white; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; color: #374151;" onmouseover="this.style.background='#f9fafb'; this.style.borderColor='#667eea'" onmouseout="this.style.background='white'; this.style.borderColor='#e5e7eb'">
                            Luna
                        </button>
                        <button onclick="applyQuickFilter('year')" style="padding: 10px 14px; background: white; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; color: #374151;" onmouseover="this.style.background='#f9fafb'; this.style.borderColor='#667eea'" onmouseout="this.style.background='white'; this.style.borderColor='#e5e7eb'">
                            Anul
                        </button>
                        <button onclick="applyQuickFilter('all')" style="padding: 10px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 13px; font-weight: 700; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(102, 126, 234, 0.3)'">
                            Toate
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Parties Cards Grid -->
            <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 2px 15px rgba(0,0,0,0.08);">
                <h3 style="margin-bottom: 20px; color: #374151; font-size: 18px;">ğŸ“‹ Lista Petrecerilor</h3>
                <div id="partiesCardsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px;">
                    <!-- Cardurile vor fi generate dinamic aici -->
                    <div style="grid-column: 1 / -1; padding: 60px; text-align: center; color: #9ca3af; font-size: 16px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“Š</div>
                        <div style="font-weight: 600;">SelecteazÄƒ un interval de date pentru a vedea petrecerile</div>
                        <div style="margin-top: 10px; font-size: 14px;">sau</div>
                        <div style="margin-top: 10px; font-size: 14px; font-weight: 600; color: #667eea;">Click pe "Toate" pentru a vedea toate evenimentele salvate</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Page: Evenimente cu È˜oferi -->
        <div class="page" id="soferi">
            <!-- GOL - Nimic aici -->
        </div>
        
        <!-- Page: Evenimente cu FacturÄƒ -->
        <div class="page" id="cu-factura">
            <div class="page-header">
                <h2>ğŸ§¾ Evenimente cu FacturÄƒ</h2>
                <p>Toate evenimentele plÄƒtite prin facturÄƒ</p>
            </div>
            
            <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 2px 15px rgba(0,0,0,0.08);">
                <!-- Statistici Rapide -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 12px; color: white;">
                        <div style="font-size: 32px; font-weight: 800;" id="totalFacturi">0</div>
                        <div style="opacity: 0.9; font-size: 14px;">Total Facturi</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 20px; border-radius: 12px; color: white;">
                        <div style="font-size: 32px; font-weight: 800;" id="sumaFacturi">0 RON</div>
                        <div style="opacity: 0.9; font-size: 14px;">Valoare TotalÄƒ</div>
                    </div>
                </div>
                
                <!-- Lista Evenimente -->
                <div id="listaFacturi" style="margin-top: 20px;">
                    <p style="text-align: center; color: #6b7280; padding: 40px 0;">
                        ğŸ“„ Nu existÄƒ evenimente cu facturÄƒ Ã®ncÄƒ
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Page: Echipa -->
        <div class="page" id="echipa">
            <div class="page-header">
                <h2>ğŸ‘¥ Echipa</h2>
                <p>GestioneazÄƒ membrii echipei tale</p>
            </div>
            
            <!-- Add Member Button -->
            <div style="margin-bottom: 30px;">
                <button onclick="addTeamMember()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 12px 24px; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 15px; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3); transition: all 0.3s;">
                    â• AdaugÄƒ Membru
                </button>
            </div>
            
            <!-- Team Table -->
            <div style="background: white; border-radius: 20px; padding: 30px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); overflow-x: auto;">
                <table id="teamTable" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 2px solid #e5e7eb;">
                            <th style="padding: 15px; text-align: left; color: #6b7280; font-weight: 600; font-size: 14px;">Nume</th>
                            <th style="padding: 15px; text-align: left; color: #6b7280; font-weight: 600; font-size: 14px;">Telefon</th>
                            <th style="padding: 15px; text-align: left; color: #6b7280; font-weight: 600; font-size: 14px;">Ce cod am</th>
                            <th style="padding: 15px; text-align: left; color: #6b7280; font-weight: 600; font-size: 14px;">Rol</th>
                            <th style="padding: 15px; text-align: center; color: #6b7280; font-weight: 600; font-size: 14px;">AcÈ›iuni</th>
                        </tr>
                    </thead>
                    <tbody id="teamTableBody">
                        <!-- Exemplu de rÃ¢nd -->
                        <tr style="border-bottom: 1px solid #f3f4f6;">
                            <td style="padding: 15px; color: #111827; font-weight: 500;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 16px;">
                                        A
                                    </div>
                                    <span>Andrei Popescu</span>
                                </div>
                            </td>
                            <td style="padding: 15px; color: #6b7280;">
                                <span style="color: #667eea; font-weight: 500;">ğŸ“ +40 700 123 456</span>
                            </td>
                            <td style="padding: 15px; color: #6b7280;">
                                <span style="background: #f3f4f6; padding: 6px 12px; border-radius: 8px; font-weight: 600; color: #667eea;">001</span>
                            </td>
                            <td style="padding: 15px;">
                                <span style="background: #dcfce7; color: #16a34a; padding: 6px 12px; border-radius: 8px; font-weight: 600; font-size: 13px;">Animator Principal</span>
                            </td>
                            <td style="padding: 15px; text-align: center;">
                                <button onclick="editTeamMember(this)" style="background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; margin-right: 8px; font-size: 13px;">âœï¸ EditeazÄƒ</button>
                                <button onclick="deleteTeamMember(this)" style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 13px;">ğŸ—‘ï¸ È˜terge</button>
                            </td>
                        </tr>
                        
                        <tr style="border-bottom: 1px solid #f3f4f6;">
                            <td style="padding: 15px; color: #111827; font-weight: 500;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 16px;">
                                        M
                                    </div>
                                    <span>Maria Ionescu</span>
                                </div>
                            </td>
                            <td style="padding: 15px; color: #6b7280;">
                                <span style="color: #667eea; font-weight: 500;">ğŸ“ +40 700 234 567</span>
                            </td>
                            <td style="padding: 15px; color: #6b7280;">
                                <span style="background: #f3f4f6; padding: 6px 12px; border-radius: 8px; font-weight: 600; color: #667eea;">002</span>
                            </td>
                            <td style="padding: 15px;">
                                <span style="background: #dbeafe; color: #2563eb; padding: 6px 12px; border-radius: 8px; font-weight: 600; font-size: 13px;">È˜ofer</span>
                            </td>
                            <td style="padding: 15px; text-align: center;">
                                <button onclick="editTeamMember(this)" style="background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; margin-right: 8px; font-size: 13px;">âœï¸ EditeazÄƒ</button>
                                <button onclick="deleteTeamMember(this)" style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 13px;">ğŸ—‘ï¸ È˜terge</button>
                            </td>
                        </tr>
                        
                        <tr>
                            <td style="padding: 15px; color: #111827; font-weight: 500;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #ec4899 0%, #be185d 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 16px;">
                                        I
                                    </div>
                                    <span>Ion Georgescu</span>
                                </div>
                            </td>
                            <td style="padding: 15px; color: #6b7280;">
                                <span style="color: #667eea; font-weight: 500;">ğŸ“ +40 700 345 678</span>
                            </td>
                            <td style="padding: 15px; color: #6b7280;">
                                <span style="background: #f3f4f6; padding: 6px 12px; border-radius: 8px; font-weight: 600; color: #667eea;">003</span>
                            </td>
                            <td style="padding: 15px;">
                                <span style="background: #fef3c7; color: #d97706; padding: 6px 12px; border-radius: 8px; font-weight: 600; font-size: 13px;">Asistent</span>
                            </td>
                            <td style="padding: 15px; text-align: center;">
                                <button onclick="editTeamMember(this)" style="background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; margin-right: 8px; font-size: 13px;">âœï¸ EditeazÄƒ</button>
                                <button onclick="deleteTeamMember(this)" style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 13px;">ğŸ—‘ï¸ È˜terge</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Page: Inventar (EMPTY) -->
        <div class="page" id="inventar">
            <div class="page-header">
                <h2>ğŸ“¦ Inventar</h2>
                <p>Gestionare inventar È™i materiale</p>
            </div>
            <!-- GOL - PregÄƒtit pentru viitor -->
        </div>
        
        <!-- Page: Piniata -->
        <div class="page" id="piniata">
            <div class="page-header">
                <h2>ğŸ¯ Piniata</h2>
                <p>Gestionare È™i statistici pentru piniata</p>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">156</div>
                    <div class="stat-label">Total piniate folosite</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">23</div>
                    <div class="stat-label">Ãn stoc</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">12</div>
                    <div class="stat-label">Comandate</div>
                </div>
            </div>
            
            <div class="cards-grid">
                <div class="card">
                    <div class="card-title">ğŸ¨ Tipuri de Piniate</div>
                    <div class="card-content">
                        <p><strong>Unicorn:</strong> 45 bucÄƒÈ›i (29%)</p>
                        <p><strong>Super Eroi:</strong> 38 bucÄƒÈ›i (24%)</p>
                        <p><strong>PrinÈ›/PrinÈ›esÄƒ:</strong> 32 bucÄƒÈ›i (21%)</p>
                        <p><strong>Animale:</strong> 28 bucÄƒÈ›i (18%)</p>
                        <p><strong>Personalizate:</strong> 13 bucÄƒÈ›i (8%)</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">ğŸ“Š Statistici Lunare</div>
                    <div class="card-content">
                        <p><strong>Noiembrie:</strong> 18 piniate</p>
                        <p><strong>Octombrie:</strong> 22 piniate</p>
                        <p><strong>Septembrie:</strong> 20 piniate</p>
                        <p><strong>Medie lunarÄƒ:</strong> 20 piniate</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">ğŸ’° Costuri</div>
                    <div class="card-content">
                        <p><strong>Cost mediu:</strong> 150 lei / piniata</p>
                        <p><strong>Total investit:</strong> 23,400 lei</p>
                        <p><strong>Stoc curent:</strong> 3,450 lei</p>
                        <p><strong>ComandÄƒ nouÄƒ:</strong> 1,800 lei</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Page: VerificÄƒ Formular -->
        <div class="page" id="verifica-formular">
            <div class="page-header">
                <h2>ğŸ“¸ VerificÄƒ Formular cu PozÄƒ</h2>
                <p>ÃncarcÄƒ poza cu formularul primit È™i verificÄƒ data de notare pentru puncte</p>
            </div>
            
            <!-- Points Display Card -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 30px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3); text-align: center;">
                <div style="font-size: 16px; color: rgba(255,255,255,0.9); margin-bottom: 10px; font-weight: 600;">Puncte Ã®n Sistem</div>
                <div id="systemPointsDisplay" style="font-size: 64px; font-weight: 900; color: white; text-shadow: 0 4px 15px rgba(0,0,0,0.3);">0</div>
            </div>
            
            <!-- Upload Section -->
            <div id="uploadPhotoSection" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%); border: 3px dashed #667eea; border-radius: 20px; padding: 50px 30px; text-align: center; margin-bottom: 30px; cursor: pointer; transition: all 0.3s;" onclick="document.getElementById('verificationPhotoInput').click()">
                <div style="font-size: 80px; margin-bottom: 20px;">ğŸ“·</div>
                <div style="font-size: 22px; font-weight: 700; color: #374151; margin-bottom: 10px;">Click pentru a Ã®ncÄƒrca pozÄƒ sau face pozÄƒ</div>
                <div style="font-size: 15px; color: #6b7280;">AcceptÄƒ JPG, PNG, JPEG - Maximum 10MB</div>
                <input type="file" id="verificationPhotoInput" accept="image/*" capture="environment" style="display: none;">
                
                <button onclick="event.stopPropagation(); document.getElementById('verificationPhotoInput').setAttribute('capture', 'environment'); document.getElementById('verificationPhotoInput').click();" style="margin-top: 20px; width: 100%; max-width: 300px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 18px; border-radius: 12px; font-size: 18px; font-weight: 700; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);">
                    <span>ğŸ“±</span>
                    <span>Sau Deschide Camera</span>
                </button>
            </div>
            
            <!-- Preview & Verification Section -->
            <div id="photoVerificationSection" style="display: none;">
                <!-- Photo Preview with Date Overlay -->
                <div style="position: relative; margin-bottom: 30px; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
                    <img id="verificationPhotoPreview" style="width: 100%; display: block; max-height: 500px; object-fit: contain; background: #000;">
                    <div id="photoDateOverlay" style="position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.9); color: white; padding: 15px 35px; border-radius: 12px; font-size: 20px; font-weight: 700; box-shadow: 0 8px 25px rgba(0,0,0,0.5); border: 2px solid rgba(255,255,255,0.3);"></div>
                </div>
                
                <!-- Date Input Form -->
                <div style="background: white; border-radius: 20px; padding: 35px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <h3 style="color: #111827; font-size: 22px; margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
                        <span>ğŸ“…</span>
                        <span>Introdu Data Primirii Formularului</span>
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                        <div>
                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 15px;">Data din PozÄƒ (cÃ¢nd a fost primit formularul):</label>
                            <input type="date" id="receivedFormDate" style="width: 100%; padding: 14px 16px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; transition: all 0.3s;" required onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e5e7eb'">
                        </div>
                        
                        <div>
                            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 10px; font-size: 15px;">Data CurentÄƒ (azi):</label>
                            <input type="date" id="currentFormDate" readonly style="width: 100%; padding: 14px 16px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; background: #f9fafb; color: #6b7280;">
                        </div>
                    </div>
                    
                    <button onclick="verifyFormDate()" style="width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 18px; border-radius: 12px; font-size: 18px; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <span>ğŸ”</span>
                        <span>VerificÄƒ Data È™i CalculeazÄƒ Puncte</span>
                    </button>
                </div>
            </div>
            
            <!-- Result Section -->
            <div id="verificationResult" style="display: none; padding: 40px; border-radius: 20px; margin-bottom: 30px; text-align: center; animation: slideIn 0.5s ease;">
                <div id="resultIcon" style="font-size: 96px; margin-bottom: 25px; animation: bounce 1s ease infinite;"></div>
                <div id="resultTitle" style="font-size: 36px; font-weight: 900; margin-bottom: 20px;"></div>
                <div id="resultMessage" style="font-size: 20px; font-weight: 600; margin-bottom: 25px;"></div>
                <div id="resultPoints" style="font-size: 64px; font-weight: 900; margin: 30px 0;"></div>
                
                <!-- Details Box -->
                <div style="background: rgba(255, 255, 255, 0.8); padding: 25px; border-radius: 15px; margin-top: 30px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="padding: 15px; border-bottom: 2px solid rgba(0,0,0,0.1);">
                            <div style="font-weight: 600; color: #374151; margin-bottom: 5px;">Data Primire Formular:</div>
                            <div id="detailReceivedFormDate" style="font-weight: 700; color: #1f2937; font-size: 18px;"></div>
                        </div>
                        <div style="padding: 15px; border-bottom: 2px solid rgba(0,0,0,0.1);">
                            <div style="font-weight: 600; color: #374151; margin-bottom: 5px;">Data CurentÄƒ:</div>
                            <div id="detailCurrentFormDate" style="font-weight: 700; color: #1f2937; font-size: 18px;"></div>
                        </div>
                        <div style="padding: 15px;">
                            <div style="font-weight: 600; color: #374151; margin-bottom: 5px;">DiferenÈ›Äƒ (zile):</div>
                            <div id="detailDifferenceDays" style="font-weight: 700; color: #1f2937; font-size: 18px;"></div>
                        </div>
                        <div style="padding: 15px;">
                            <div style="font-weight: 600; color: #374151; margin-bottom: 5px;">Puncte Acordate:</div>
                            <div id="detailPointsAwarded" style="font-weight: 700; color: #1f2937; font-size: 18px;"></div>
                        </div>
                    </div>
                </div>
                
                <button onclick="resetPhotoVerification()" style="margin-top: 30px; background: #6b7280; color: white; border: none; padding: 16px 40px; border-radius: 12px; font-size: 17px; font-weight: 600; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);">
                    ğŸ”„ VerificÄƒ Alt Formular
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal AdaugÄƒ Membru EchipÄƒ -->
    <div id="addMemberModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 20px; padding: 30px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0; color: #111827; font-size: 24px;">â• AdaugÄƒ Membru EchipÄƒ</h2>
                <button onclick="closeAddMemberModal()" style="background: none; border: none; font-size: 28px; cursor: pointer; color: #6b7280; line-height: 1;">Ã—</button>
            </div>
            
            <p style="color: #6b7280; margin-bottom: 25px;">CompleteazÄƒ datele noului membru din echipÄƒ</p>
            
            <!-- Form -->
            <form id="addMemberForm" onsubmit="submitNewMember(event)">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Nume complet *</label>
                    <input type="text" id="newMemberName" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="Ex: Andrei Popescu" required>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Cod trainer *</label>
                    <input type="text" id="newMemberCode" list="trainerCodes" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="Ex: A1, B5, Z50" required>
                    <p style="margin-top: 5px; font-size: 11px; color: #9ca3af; font-style: italic;">ğŸ’¡ Scrie cod (A1-Z50) - lista se filtreazÄƒ automat</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Telefon *</label>
                    <input type="tel" id="newMemberPhone" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="+40 700 123 456" required>
                </div>
                
                <div style="margin-bottom: 25px;">
                    <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Email *</label>
                    <input type="email" id="newMemberEmail" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="email@exemplu.ro" required>
                    <p style="margin-top: 5px; font-size: 11px; color: #9ca3af; font-style: italic;">ğŸ“§ Membrul va primi invitaÈ›ie pe acest email</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Rol</label>
                    <select id="newMemberRole" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;">
                        <option value="">SelecteazÄƒ rol...</option>
                        <option value="Animator Principal">Animator Principal</option>
                        <option value="Animator">Animator</option>
                        <option value="È˜ofer">È˜ofer</option>
                        <option value="Asistent">Asistent</option>
                        <option value="Fotograf">Fotograf</option>
                        <option value="Manager">Manager</option>
                    </select>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 30px;">
                    <button type="button" onclick="closeAddMemberModal()" style="flex: 1; padding: 12px; background: #f3f4f6; color: #6b7280; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 15px;">
                        AnuleazÄƒ
                    </button>
                    <button type="submit" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 15px; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);">
                        âœ… AdaugÄƒ Membru
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal Colaboratori -->
    <div id="colaboratoriModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 20px; padding: 30px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0; color: #111827; font-size: 24px;">ğŸ‘¥ ÃnregistreazÄƒ Colaboratori</h2>
                <button onclick="closeColaboratoriModal()" style="background: none; border: none; font-size: 28px; cursor: pointer; color: #6b7280; line-height: 1;">Ã—</button>
            </div>
            
            <p style="color: #6b7280; margin-bottom: 25px;">AdaugÄƒ colaboratorii È™i preÈ›urile pentru acest eveniment</p>
            
            <!-- Add Colaborator Form -->
            <div style="background: #f9fafb; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <div style="display: grid; gap: 15px;">
                    <div>
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Nume Colaborator</label>
                        <input type="text" id="colaboratorNume" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="Ex: Ion Popescu">
                    </div>
                    
                    <div>
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Telefon colaborator</label>
                        <input type="text" id="colaboratorTelefon" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="Ex: +40700123456">
                    </div>
                    
                    <div>
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Cod cine noteaza</label>
                        <input type="text" id="colaboratorCod" list="trainerCodes" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="Ex: A1, B5, Z50">
                        <p style="margin-top: 5px; font-size: 11px; color: #9ca3af; font-style: italic;">Scrie cod (A1-Z50)</p>
                    </div>
                    
                    <div>
                        <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Tip Colaborare</label>
                        <select id="colaboratorTip" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;">
                            <option value="">SelecteazÄƒ...</option>
                            <option value="Loc de joacÄƒ">Loc de joacÄƒ</option>
                        </select>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Tip PreÈ›</label>
                            <select id="colaboratorTipPret" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;">
                                <option value="eveniment">Pe Eveniment</option>
                                <option value="ora">Pe OrÄƒ</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">PreÈ› (RON)</label>
                            <input type="number" id="colaboratorPret" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="Ex: 500">
                        </div>
                        
                        <div>
                            <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 500;">PreÈ› Transport (RON)</label>
                            <input type="number" id="colaboratorPretTransport" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" placeholder="Ex: 50">
                        </div>
                    </div>
                    
                    <button onclick="addColaborator()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 12px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 15px; margin-top: 10px;">
                        â• AdaugÄƒ Colaborator
                    </button>
                </div>
            </div>
            
            <!-- Colaboratori List -->
            <div id="colaboratoriList" style="margin-top: 20px;">
                <h3 style="color: #111827; font-size: 18px; margin-bottom: 15px;">Colaboratori AdÄƒugaÈ›i:</h3>
                <div id="colaboratoriItems" style="display: flex; flex-direction: column; gap: 10px;">
                    <!-- Colaboratori items will be added here -->
                </div>
            </div>
            
            <!-- Close Button -->
            <button onclick="closeColaboratoriModal()" style="width: 100%; background: #6b7280; color: white; border: none; padding: 12px; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 15px; margin-top: 20px;">
                Ãnchide
            </button>
        </div>
    </div>

    <!-- AI Chat Modal -->
    <div id="aiChatModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 20px; width: 90%; max-width: 600px; height: 80vh; display: flex; flex-direction: column; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <!-- Header -->
            <div style="padding: 20px 25px; border-bottom: 2px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px 20px 0 0;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 32px;">ğŸ¤–</span>
                    <div>
                        <h2 style="margin: 0; color: white; font-size: 22px; font-weight: 700;">Super AI Assistant</h2>
                        <p style="margin: 0; color: rgba(255,255,255,0.9); font-size: 13px;">ÃntreabÄƒ orice despre SuperParty</p>
                    </div>
                </div>
                <button onclick="closeAIChat()" style="background: rgba(255,255,255,0.2); border: none; color: white; font-size: 28px; cursor: pointer; line-height: 1; width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; transition: all 0.3s;">Ã—</button>
            </div>
            
            <!-- Chat Messages -->
            <div id="chatMessages" style="flex: 1; padding: 20px; overflow-y: auto; background: #f9fafb;">
                <!-- Welcome message -->
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <span style="font-size: 20px;">ğŸ¤–</span>
                    </div>
                    <div style="background: white; padding: 12px 16px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); max-width: 80%;">
                        <p style="margin: 0; color: #111827; line-height: 1.5; font-weight: 600;">ğŸ‘‹ Salut! Sunt Super AI!</p>
                        <p style="margin: 8px 0 0 0; color: #6b7280; line-height: 1.5;">ÃntreabÄƒ-mÄƒ orice despre aplicaÈ›ie. RÄƒspund scurt È™i la obiect! ğŸ˜Š</p>
                    </div>
                </div>
            </div>
            
            <!-- Input Area -->
            <div style="padding: 20px; border-top: 2px solid #e5e7eb; background: white; border-radius: 0 0 20px 20px;">
                <div style="display: flex; gap: 10px;">
                    <input 
                        type="text" 
                        id="chatInput" 
                        placeholder="Scrie mesajul tÄƒu aici..." 
                        style="flex: 1; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 15px; outline: none; transition: all 0.3s;"
                        onkeypress="if(event.key === 'Enter') sendMessage()"
                        onfocus="this.style.borderColor='#667eea'"
                        onblur="this.style.borderColor='#e5e7eb'"
                    >
                    <button 
                        onclick="sendMessage()" 
                        id="sendButton"
                        style="padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; font-size: 15px; transition: all 0.3s; white-space: nowrap;"
                        onmouseover="this.style.transform='scale(1.05)'"
                        onmouseout="this.style.transform='scale(1)'"
                    >
                        ğŸ“¤ Trimite
                    </button>
                </div>
                <p style="margin: 8px 0 0 0; font-size: 11px; color: #9ca3af; text-align: center;">
                    ğŸ’¡ Powered by ChatGPT - RÄƒspunsurile sunt generate de inteligenÈ›Äƒ artificialÄƒ
                </p>
            </div>
        </div>
    </div>
    
    <!-- PAGINÄ‚ SECRETÄ‚ -->
    <div class="page" id="pagina-secreta">
        <!-- BifeazÄƒ Evenimente Secret -->
        <div class="secret-content active" id="bifeaza-evenimente-secret" style="display: block;">
            <div class="page-header">
                <h2>âœ… BifeazÄƒ Evenimente</h2>
                <p>MarcheazÄƒ evenimentele completate din sistem</p>
            </div>
            
            <div style="background: white; border-radius: 20px; padding: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-top: 20px;">
                <h4 style="color: #1f2937; font-size: 22px; margin-bottom: 20px;">ğŸ“‹ ListÄƒ Evenimente de Bifat</h4>
                
                <div style="display: grid; gap: 15px;">
                    <div style="padding: 20px; background: #f9fafb; border-radius: 12px; border-left: 4px solid #10b981; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 700; color: #1f2937; margin-bottom: 5px;">ğŸ‰ Petrecere Spider-Man - #318</div>
                            <div style="font-size: 14px; color: #6b7280;">Client: Maria Popescu | Data: 15 Nov 2024 | Trainer: A1</div>
                        </div>
                        <button style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            âœ… BifeazÄƒ
                        </button>
                    </div>
                    
                    <div style="padding: 20px; background: #f9fafb; border-radius: 12px; border-left: 4px solid #f59e0b; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 700; color: #1f2937; margin-bottom: 5px;">ğŸ‰ Petrecere Iron Man - #319</div>
                            <div style="font-size: 14px; color: #6b7280;">Client: Ion Ionescu | Data: 16 Nov 2024 | Trainer: B2</div>
                        </div>
                        <button style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            âœ… BifeazÄƒ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vezi Statistici -->
        <div class="secret-content" id="vezi-statistici" style="display: none;">
            <div class="page-header">
                <h2>ğŸ“Š Vezi Statistici</h2>
                <p>Statistici detaliate despre evenimente È™i performanÈ›Äƒ</p>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0;">
                <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 25px; border-radius: 15px; color: white; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ’° Venituri Totale</div>
                    <div style="font-size: 36px; font-weight: 900;">125,450</div>
                    <div style="font-size: 14px; opacity: 0.9; margin-top: 5px;">RON</div>
                </div>
                
                <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); padding: 25px; border-radius: 15px; color: white; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ‰ Evenimente Luna Asta</div>
                    <div style="font-size: 36px; font-weight: 900;">47</div>
                    <div style="font-size: 14px; opacity: 0.9; margin-top: 5px;">petreceri</div>
                </div>
                
                <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); padding: 25px; border-radius: 15px; color: white; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ‘¥ ClienÈ›i Noi</div>
                    <div style="font-size: 36px; font-weight: 900;">28</div>
                    <div style="font-size: 14px; opacity: 0.9; margin-top: 5px;">acest an</div>
                </div>
            </div>
        </div>

        <!-- Total Statistici -->
        <div class="secret-content" id="total-statistici" style="display: none;">
            <div class="page-header">
                <h2>ğŸ“ˆ Total Statistici</h2>
                <p>Vizualizare completÄƒ a tuturor statisticilor din sistem</p>
            </div>
            
            <div style="background: white; border-radius: 20px; padding: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-top: 20px;">
                <h4 style="color: #1f2937; font-size: 22px; margin-bottom: 25px;">ğŸ“Š Statistici Complete 2024</h4>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="padding: 20px; background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); border-radius: 12px; text-align: center;">
                        <div style="font-size: 24px; font-weight: 900; color: #1f2937;">287</div>
                        <div style="font-size: 14px; color: #6b7280; margin-top: 5px;">Total Evenimente</div>
                    </div>
                    <div style="padding: 20px; background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); border-radius: 12px; text-align: center;">
                        <div style="font-size: 24px; font-weight: 900; color: #10b981;">â‚¬450,000</div>
                        <div style="font-size: 14px; color: #6b7280; margin-top: 5px;">Venituri Anuale</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- GenereazÄƒ Coduri Secret -->
        <div class="secret-content" id="genereaza-coduri-secret" style="display: none;">
            <div class="page-header">
                <h2>ğŸ”‘ GenereazÄƒ Coduri de Acces</h2>
                <p>CreeazÄƒ coduri unice pentru noi angajaÈ›i</p>
            </div>
            
            <!-- Generate Button -->
            <div style="text-align: center; margin: 30px 0;">
                <button onclick="generateLicenseCode()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 20px 40px; border-radius: 15px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4); transition: all 0.3s; display: inline-flex; align-items: center; gap: 12px;">
                    <span style="font-size: 28px;">ğŸ”‘</span>
                    <span>GenereazÄƒ Cod Nou</span>
                </button>
            </div>
            
            <!-- Generated Code Display -->
            <div id="generatedCodeDisplay" style="display: none; background: white; border-radius: 20px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 30px;">
                <h4 style="color: #1f2937; font-size: 20px; margin-bottom: 20px; text-align: center;">âœ… Cod Generat cu Succes!</h4>
                
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 15px; text-align: center; margin-bottom: 20px;">
                    <div style="color: rgba(255,255,255,0.9); font-size: 14px; margin-bottom: 10px;">CODUL DE ACCES:</div>
                    <div id="displayedCode" style="color: white; font-size: 32px; font-weight: 900; letter-spacing: 3px; font-family: monospace;">SP-XXXX-XXXX</div>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button onclick="copyCodeToClipboard()" style="flex: 1; background: #10b981; color: white; border: none; padding: 15px; border-radius: 12px; font-weight: 700; cursor: pointer; font-size: 16px; transition: all 0.3s;">
                        ğŸ“‹ CopiazÄƒ Cod
                    </button>
                    <button onclick="closeCodeDisplay()" style="flex: 1; background: #e5e7eb; color: #6b7280; border: none; padding: 15px; border-radius: 12px; font-weight: 700; cursor: pointer; font-size: 16px; transition: all 0.3s;">
                        âœ• Ãnchide
                    </button>
                </div>
            </div>
            
            <!-- Loading Indicator -->
            <div id="codeGenerationLoading" style="display: none; text-align: center; padding: 30px;">
                <div style="display: inline-block; width: 50px; height: 50px; border: 5px solid #e5e7eb; border-top-color: #667eea; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                <p style="margin-top: 15px; color: #6b7280; font-weight: 600;">GenereazÄƒ cod...</p>
            </div>
            
            <!-- License Codes List -->
            <div style="background: white; border-radius: 20px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h4 style="color: #1f2937; font-size: 20px; font-weight: 700;">ğŸ“‹ Toate Codurile Generate</h4>
                    <button onclick="refreshCodesList()" style="background: #f3f4f6; color: #6b7280; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                        ğŸ”„ Refresh
                    </button>
                </div>
                
                <div id="codesListContainer" style="display: grid; gap: 12px; max-height: 500px; overflow-y: auto;">
                    <div style="text-align: center; padding: 40px; color: #9ca3af;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“</div>
                        <p>ApasÄƒ butonul de mai sus pentru a genera primul cod</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gestionare Utilizatori (Secret) -->
        <div class="secret-content" id="gestionare-utilizatori" style="display: none;">
            <div class="page-header">
                <h2>ğŸ‘¥ Gestionare Utilizatori</h2>
                <p>AdministreazÄƒ conturile utilizatorilor din sistem</p>
            </div>
            
            <!-- Add User Button -->
            <div style="text-align: center; margin: 30px 0; display: flex; justify-content: center; gap: 15px;">
                <button onclick="loadUsersData()" style="background: #3b82f6; color: white; border: none; padding: 20px 40px; border-radius: 15px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4); transition: all 0.3s; display: inline-flex; align-items: center; gap: 12px;">
                    <span style="font-size: 28px;">ğŸ”„</span>
                    <span>ReÃ®mprospÄƒteazÄƒ</span>
                </button>
                <button onclick="addNewUserRow()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 20px 40px; border-radius: 15px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4); transition: all 0.3s; display: inline-flex; align-items: center; gap: 12px;">
                    <span style="font-size: 28px;">â•</span>
                    <span>AdaugÄƒ Utilizator Nou</span>
                </button>
            </div>
            
            <!-- Users Table -->
            <div style="background: white; border-radius: 20px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); overflow-x: auto;">
                <table id="usersTableAdmin" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <th style="padding: 15px; text-align: left; border-radius: 10px 0 0 0;">ğŸ‘¤ Nume</th>
                            <th style="padding: 15px; text-align: left;">ğŸ“§ Email</th>
                            <th style="padding: 15px; text-align: left;">ğŸ”’ ParolÄƒ</th>
                            <th style="padding: 15px; text-align: left;">ğŸ”’ RepetÄƒ ParolÄƒ</th>
                            <th style="padding: 15px; text-align: left;">ğŸ”‘ Cheie de Acces</th>
                            <th style="padding: 15px; text-align: left;">ğŸ“± Ce cod ai</th>
                            <th style="padding: 15px; text-align: left;">ğŸ­ Rol Utilizator</th>
                            <th style="padding: 15px; text-align: center;">ğŸ”“ Status</th>
                            <th style="padding: 15px; text-align: center; border-radius: 0 10px 0 0;">âš™ï¸ AcÈ›iuni</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBodyAdmin">
                        <!-- Rows will be added here dynamically -->
                    </tbody>
                </table>
            </div>
            
            <!-- Save All Button -->
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="saveAllUsers()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 18px 50px; border-radius: 15px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4); transition: all 0.3s;">
                    ğŸ’¾ SalveazÄƒ Toate ModificÄƒrile
                </button>
            </div>
        </div>

        <!-- Target Traineri (Secret) -->
        <div class="secret-content" id="target-traineri" style="display: none;">
            <div class="page-header">
                <h2 style="color: #000; font-size: 36px; font-weight: 900;">ğŸ’° TARGET TRAINERI</h2>
                <p style="color: #6b7280; font-size: 18px;">Sistem de monetizare Nivel 1 & Nivel 2</p>
            </div>

            <!-- Month Selector -->
            <div style="display: flex; gap: 15px; align-items: center; justify-content: center; margin-bottom: 40px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                <button onclick="previousMonth()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-weight: 700; transition: all 0.3s;">
                    â—€ Luna AnterioarÄƒ
            </button>
            <div id="currentMonthDisplay" style="font-size: 24px; font-weight: 900; color: #667eea; min-width: 250px; text-align: center;">
                Noiembrie 2025
            </div>
            <button onclick="nextMonth()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-weight: 700; transition: all 0.3s;">
                Luna UrmÄƒtoare â–¶
            </button>
        </div>

        <!-- Tab Navigation for Target Traineri -->
        <div style="display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; justify-content: center;">
            <button class="target-tab active" onclick="switchTargetTab('dashboard-traineri')" style="padding: 15px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 700; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                ğŸ“Š Dashboard
            </button>
            <button class="target-tab" onclick="switchTargetTab('evenimente-traineri')" style="padding: 15px 30px; background: white; border: 2px solid #667eea; color: #667eea; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 700; transition: all 0.3s;">
                ğŸ‰ AdaugÄƒ Eveniment
            </button>
            <button class="target-tab" onclick="switchTargetTab('info-traineri')" style="padding: 15px 30px; background: white; border: 2px solid #667eea; color: #667eea; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 700; transition: all 0.3s;">
                ğŸ‘¥ Info Traineri
            </button>
            <button class="target-tab" onclick="switchTargetTab('calcule-traineri')" style="padding: 15px 30px; background: white; border: 2px solid #667eea; color: #667eea; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 700; transition: all 0.3s;">
                ğŸ§® Calcule Detaliate
            </button>
        </div>

        <!-- Dashboard Tab -->
        <div class="target-content active" id="dashboard-traineri" style="display: block;">
            <!-- Summary Cards -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin-bottom: 40px;">
                <div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ’µ Total VÃ¢nzÄƒri Luna</div>
                    <div id="totalSalesTrainers" class="stat-number" style="color: white;">0 lei</div>
                    <div style="font-size: 14px; opacity: 0.9;">100% din business</div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ¯ Nivel 1 (CompetiÈ›ie)</div>
                    <div id="level1TotalTrainers" class="stat-number" style="color: white;">0 lei</div>
                    <div style="font-size: 14px; opacity: 0.9;">1% din total vÃ¢nzÄƒri</div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white;">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">â±ï¸ Total Ore Lucrate</div>
                    <div id="totalHoursTrainers" class="stat-number" style="color: white;">0h</div>
                    <div style="font-size: 14px; opacity: 0.9;">ToÈ›i trainerii</div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white;">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ‘‘ Top Performer</div>
                    <div id="topPerformerTrainers" class="stat-number" style="color: white;">-</div>
                    <div style="font-size: 14px; opacity: 0.9;">SeteazÄƒ pragul</div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white;">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ“ˆ Prag Actual</div>
                    <div id="currentThresholdTrainers" class="stat-number" style="color: white;">0h</div>
                    <div style="font-size: 14px; opacity: 0.9;">Setat de top performer</div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white;">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ¢ Bani RÄƒmaÈ™i FirmÄƒ</div>
                    <div id="companyMoneyTrainers" class="stat-number" style="color: white;">0 lei</div>
                    <div style="font-size: 14px; opacity: 0.9;">Din Nivel 2</div>
                </div>
            </div>
            
            <!-- Trainer Rankings Table -->
            <div class="card">
                <h3 style="font-size: 24px; color: #667eea; margin-bottom: 25px; font-weight: 800;">ğŸ† Clasament Traineri</h3>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                <th style="padding: 15px; text-align: left; font-weight: 800;">PoziÈ›ie</th>
                                <th style="padding: 15px; text-align: left; font-weight: 800;">Trainer</th>
                                <th style="padding: 15px; text-align: left; font-weight: 800;">Ore Totale</th>
                                <th style="padding: 15px; text-align: left; font-weight: 800;">VÃ¢nzÄƒri EchipÄƒ</th>
                                <th style="padding: 15px; text-align: left; font-weight: 800;">Nivel 1</th>
                                <th style="padding: 15px; text-align: left; font-weight: 800;">Nivel 2</th>
                                <th style="padding: 15px; text-align: left; font-weight: 800;">Total CÃ¢È™tigat</th>
                                <th style="padding: 15px; text-align: left; font-weight: 800;">Status</th>
                            </tr>
                        </thead>
                        <tbody id="trainerRankingsTable">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 40px; color: #6b7280;">
                                    <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“Š</div>
                                    <p>Nu existÄƒ date pentru luna selectatÄƒ</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Evenimente Tab -->
        <div class="target-content" id="evenimente-traineri" style="display: none;">
            <div class="card">
                <h3 style="font-size: 24px; color: #667eea; margin-bottom: 25px; font-weight: 800;">ğŸ‰ AdaugÄƒ Eveniment Nou</h3>
                
                <div style="display: grid; gap: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; color: #667eea; font-weight: 700;">Nume Client</label>
                        <input type="text" id="clientNameTrainers" placeholder="Ex: Maria Popescu" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px;">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: #667eea; font-weight: 700;">Valoare Eveniment (lei)</label>
                            <input type="number" id="eventValueTrainers" placeholder="Ex: 1500" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: #667eea; font-weight: 700;">Data Eveniment</label>
                            <input type="date" id="eventDateTrainers" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px;">
                        </div>
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 8px; color: #667eea; font-weight: 700;">Cine Vinde (VÃ¢nzÄƒtor)</label>
                        <select id="sellerTrainers" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px;">
                            <option value="">SelecteazÄƒ vÃ¢nzÄƒtorul...</option>
                        </select>
                    </div>
                    
                    <div style="border-top: 2px solid #e5e7eb; padding-top: 20px; margin-top: 10px;">
                        <h4 style="color: #667eea; margin-bottom: 15px; font-size: 18px; font-weight: 700;">ExecutanÈ›i (Cine LucreazÄƒ)</h4>
                        <div id="executorsContainerTrainers"></div>
                        <button onclick="addExecutorRowTrainers()" style="background: #f3f4f6; color: #667eea; border: 2px dashed #667eea; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-weight: 700; margin-top: 15px; width: 100%;">
                            â• AdaugÄƒ Executant
                        </button>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button onclick="saveEventTrainers()" style="flex: 1; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 15px 35px; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);">
                            ğŸ’¾ SalveazÄƒ Eveniment
                        </button>
                        <button onclick="resetEventFormTrainers()" style="flex: 1; background: white; color: #667eea; border: 2px solid #667eea; padding: 15px 35px; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer;">
                            ğŸ”„ ReseteazÄƒ
                        </button>
                    </div>
                    
                    <div id="eventMessageTrainers"></div>
                </div>
            </div>
            
            <!-- Lista Evenimente -->
            <div class="card" style="margin-top: 30px;">
                <h3 style="font-size: 24px; color: #667eea; margin-bottom: 25px; font-weight: 800;">ğŸ“‹ Evenimente Luna CurentÄƒ</h3>
                <div id="eventsListTrainers"></div>
            </div>
        </div>

        <!-- Info Traineri Tab -->
        <div class="target-content" id="info-traineri" style="display: none;">
            <div class="card">
                <h3 style="font-size: 24px; color: #667eea; margin-bottom: 25px; font-weight: 800;">ğŸ‘¥ Structura Echipelor</h3>
                
                <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border: 2px solid #667eea; border-radius: 12px; padding: 25px; margin-bottom: 25px;">
                    <div style="font-size: 18px; font-weight: 700; color: #667eea; margin-bottom: 15px;">â„¹ï¸ Sistem Automat</div>
                    <p style="color: #1f2937; line-height: 1.8;">Trainerii (Atrainer-Ztrainer) È™i oamenii (A1-Z50) sunt deja Ã®n sistem!</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px;">
                        <h4 style="color: #667eea; margin-bottom: 15px; font-weight: 700;">ğŸ“Œ TRAINERI</h4>
                        <p style="color: #6b7280; line-height: 1.8;">
                            Atrainer, Btrainer, Ctrainer...<br>
                            pÃ¢nÄƒ la Ztrainer<br>
                            <strong style="color: #1f2937;">Total: 26 traineri</strong>
                        </p>
                    </div>
                    
                    <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px;">
                        <h4 style="color: #667eea; margin-bottom: 15px; font-weight: 700;">ğŸ‘¥ OAMENI PER ECHIPÄ‚</h4>
                        <p style="color: #6b7280; line-height: 1.8;">
                            A1-A50, B1-B50, C1-C50...<br>
                            pÃ¢nÄƒ la Z1-Z50<br>
                            <strong style="color: #1f2937;">Total: 1,300 oameni</strong>
                        </p>
                    </div>
                </div>
                
                <h3 style="font-size: 24px; color: #667eea; margin: 40px 0 25px 0; font-weight: 800;">ğŸ“‹ Regulile MonetizÄƒrii</h3>
                
                <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b; border-radius: 12px; padding: 25px; margin-bottom: 20px;">
                    <h4 style="color: #d97706; margin-bottom: 15px; font-size: 18px; font-weight: 700;">ğŸ¯ NIVEL 1 (1% din total vÃ¢nzÄƒri)</h4>
                    <ul style="color: #78350f; line-height: 2; padding-left: 20px;">
                        <li>Bazat pe <strong>orele lucrate</strong> de oamenii din echipÄƒ</li>
                        <li>Prag minim: <strong>150h</strong> pe lunÄƒ</li>
                        <li>Formula: <strong>(Ore - 150) = Puncte</strong></li>
                        <li>Se Ã®mparte Ã®ntre <strong>toÈ›i trainerii</strong> peste 150h</li>
                        <li>Top performer seteazÄƒ pragul pentru Nivel 2</li>
                    </ul>
                </div>
                
                <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border: 2px solid #667eea; border-radius: 12px; padding: 25px;">
                    <h4 style="color: #667eea; margin-bottom: 15px; font-size: 18px; font-weight: 700;">ğŸ’° NIVEL 2 (1% din vÃ¢nzÄƒri echipÄƒ)</h4>
                    <ul style="color: #1e3a8a; line-height: 2; padding-left: 20px;">
                        <li>Bazat pe <strong>cine vinde + cine executÄƒ</strong></li>
                        <li>VÃ¢nzarea se atribuie <strong>proporÈ›ional cu orele echipei</strong></li>
                        <li>Formula: <strong>Ore / Prag Top Performer</strong></li>
                        <li>DiferenÈ›a â†’ <strong>rÄƒmÃ¢ne la firmÄƒ</strong></li>
                        <li>FÄƒrÄƒ prag minim, se porneÈ™te de la 0h</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Calcule Detaliate Tab -->
        <div class="target-content" id="calcule-traineri" style="display: none;">
            <div class="card">
                <h3 style="font-size: 24px; color: #667eea; margin-bottom: 25px; font-weight: 800;">ğŸ§® Calcule Detaliate Luna CurentÄƒ</h3>
                
                <button onclick="recalculateMonthTrainers()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 35px; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); margin-bottom: 30px;">
                    ğŸ”„ RecalculeazÄƒ Luna
                </button>
                
                <div id="detailedCalculationsTrainers"></div>
            </div>
        </div>
    </div>
    <!-- END SECRET CONTENT: target-traineri -->

    <!-- Target AnimaÈ›ie (Secret) -->
    <div class="secret-content" id="target-animatie" style="display: none;">
        <div class="page-header">
            <h2 style="color: #000; font-size: 36px; font-weight: 900;">ğŸ­ TARGET ANIMAÈšIE</h2>
            <p style="color: #6b7280; font-size: 18px;">Sistem de monetizare pentru roluri de animaÈ›ie (2.5 lei/orÄƒ)</p>
        </div>

        <!-- Month Selector Animatie -->
        <div style="display: flex; gap: 15px; align-items: center; justify-content: center; margin-bottom: 40px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
            <button onclick="previousMonthAnimatie()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-weight: 700; transition: all 0.3s;">
                â—€ Luna AnterioarÄƒ
            </button>
            <div id="currentMonthDisplayAnimatie" style="font-size: 24px; font-weight: 900; color: #f59e0b; min-width: 250px; text-align: center;">
                Noiembrie 2025
            </div>
            <button onclick="nextMonthAnimatie()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-weight: 700; transition: all 0.3s;">
                Luna UrmÄƒtoare â–¶
            </button>
        </div>

        <!-- Tab Navigation for Target Animatie -->
        <div style="display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; justify-content: center;">
            <button class="target-tab-animatie active" onclick="switchTargetTabAnimatie('dashboard-animatie')" style="padding: 15px 30px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border: none; color: white; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 700; transition: all 0.3s; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);">
                ğŸ“Š Dashboard
            </button>
            <button class="target-tab-animatie" onclick="switchTargetTabAnimatie('evenimente-animatie')" style="padding: 15px 30px; background: white; border: 2px solid #f59e0b; color: #f59e0b; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 700; transition: all 0.3s;">
                ğŸ‰ AdaugÄƒ Eveniment
            </button>
            <button class="target-tab-animatie" onclick="switchTargetTabAnimatie('info-animatie')" style="padding: 15px 30px; background: white; border: 2px solid #f59e0b; color: #f59e0b; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 700; transition: all 0.3s;">
                ğŸ‘¥ Info AnimaÈ›ie
            </button>
            <button class="target-tab-animatie" onclick="switchTargetTabAnimatie('calcule-animatie')" style="padding: 15px 30px; background: white; border: 2px solid #f59e0b; color: #f59e0b; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 700; transition: all 0.3s;">
                ğŸ§® Calcule Detaliate
            </button>
        </div>

        <!-- Dashboard Tab Animatie -->
        <div class="target-content-animatie active" id="dashboard-animatie" style="display: block;">
            <!-- Summary Cards -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin-bottom: 40px;">
                <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white;">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">â±ï¸ Total Ore VÃ¢ndute</div>
                    <div id="totalHoursAnimatie" class="stat-number" style="color: white;">0h</div>
                    <div style="font-size: 14px; opacity: 0.9;">Toate rolurile (minus Training)</div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ’° Pot Total</div>
                    <div id="potTotalAnimatie" class="stat-number" style="color: white;">0 lei</div>
                    <div style="font-size: 14px; opacity: 0.9;">2.5 lei Ã— ore vÃ¢ndute</div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white;">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ‘‘ Top Performer</div>
                    <div id="topPerformerAnimatie" class="stat-number" style="color: white;">-</div>
                    <div style="font-size: 14px; opacity: 0.9;">Cele mai multe ore animaÈ›ie</div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white;">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ“ˆ Ore Top Performer</div>
                    <div id="topHoursAnimatie" class="stat-number" style="color: white;">0h</div>
                    <div style="font-size: 14px; opacity: 0.9;">Ore animaÈ›ie</div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white;">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ‘¥ ParticipanÈ›i Activi</div>
                    <div id="activeParticipantsAnimatie" class="stat-number" style="color: white;">0</div>
                    <div style="font-size: 14px; opacity: 0.9;">Peste 20h animaÈ›ie</div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); color: white;">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ“Š Total Puncte</div>
                    <div id="totalPointsAnimatie" class="stat-number" style="color: white;">0</div>
                    <div style="font-size: 14px; opacity: 0.9;">Suma (Ore - 20)</div>
                </div>
            </div>
            
            <!-- Clasament TOÈšI oamenii -->
            <div class="card">
                <h3 style="font-size: 24px; color: #f59e0b; margin-bottom: 25px; font-weight: 800;">ğŸ† Clasament AnimaÈ›ie (ToÈ›i ParticipanÈ›ii)</h3>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white;">
                                <th style="padding: 15px; text-align: left; font-weight: 800;">PoziÈ›ie</th>
                                <th style="padding: 15px; text-align: left; font-weight: 800;">Cod</th>
                                <th style="padding: 15px; text-align: left; font-weight: 800;">Ore AnimaÈ›ie</th>
                                <th style="padding: 15px; text-align: left; font-weight: 800;">Puncte</th>
                                <th style="padding: 15px; text-align: left; font-weight: 800;">CÃ¢È™tig</th>
                                <th style="padding: 15px; text-align: left; font-weight: 800;">Status</th>
                            </tr>
                        </thead>
                        <tbody id="animatieRankingsTable">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px; color: #6b7280;">
                                    <div style="font-size: 48px; margin-bottom: 15px;">ğŸ­</div>
                                    <p>Nu existÄƒ date pentru luna selectatÄƒ</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Evenimente Tab Animatie -->
        <div class="target-content-animatie" id="evenimente-animatie" style="display: none;">
            <div class="card">
                <h3 style="font-size: 24px; color: #f59e0b; margin-bottom: 25px; font-weight: 800;">ğŸ‰ AdaugÄƒ Eveniment AnimaÈ›ie</h3>
                
                <div style="display: grid; gap: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; color: #f59e0b; font-weight: 700;">Nume Client</label>
                        <input type="text" id="clientNameAnimatie" placeholder="Ex: Maria Popescu" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px;">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: #f59e0b; font-weight: 700;">Valoare Eveniment (lei)</label>
                            <input type="number" id="eventValueAnimatie" placeholder="Ex: 1500" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: #f59e0b; font-weight: 700;">Data Eveniment</label>
                            <input type="date" id="eventDateAnimatie" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px;">
                        </div>
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 8px; color: #f59e0b; font-weight: 700;">Cine NoteazÄƒ (O singurÄƒ persoanÄƒ)</label>
                        <select id="sellerAnimatie" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px;">
                            <option value="">SelecteazÄƒ...</option>
                        </select>
                    </div>
                    
                    <div style="border-top: 2px solid #e5e7eb; padding-top: 20px; margin-top: 10px;">
                        <h4 style="color: #f59e0b; margin-bottom: 15px; font-size: 18px; font-weight: 700;">ExecutanÈ›i (Cine LucreazÄƒ - Mai multe persoane)</h4>
                        <div id="executorsContainerAnimatie"></div>
                        <button onclick="addExecutorRowAnimatie()" style="background: #fef3c7; color: #f59e0b; border: 2px dashed #f59e0b; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-weight: 700; margin-top: 15px; width: 100%;">
                            â• AdaugÄƒ Executant
                        </button>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button onclick="saveEventAnimatie()" style="flex: 1; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 15px 35px; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);">
                            ğŸ’¾ SalveazÄƒ Eveniment
                        </button>
                        <button onclick="resetEventFormAnimatie()" style="flex: 1; background: white; color: #f59e0b; border: 2px solid #f59e0b; padding: 15px 35px; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer;">
                            ğŸ”„ ReseteazÄƒ
                        </button>
                    </div>
                    
                    <div id="eventMessageAnimatie"></div>
                </div>
            </div>
            
            <!-- Lista Evenimente -->
            <div class="card" style="margin-top: 30px;">
                <h3 style="font-size: 24px; color: #f59e0b; margin-bottom: 25px; font-weight: 800;">ğŸ“‹ Evenimente Luna CurentÄƒ</h3>
                <div id="eventsListAnimatie"></div>
            </div>
        </div>

        <!-- Info Animatie Tab -->
        <div class="target-content-animatie" id="info-animatie" style="display: none;">
            <div class="card">
                <h3 style="font-size: 24px; color: #f59e0b; margin-bottom: 25px; font-weight: 800;">ğŸ­ Info Target AnimaÈ›ie</h3>
                
                <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b; border-radius: 12px; padding: 25px; margin-bottom: 25px;">
                    <div style="font-size: 18px; font-weight: 700; color: #d97706; margin-bottom: 15px;">ğŸ“Œ Sistem Simplificat</div>
                    <p style="color: #78350f; line-height: 1.8; margin-bottom: 10px;">Target AnimaÈ›ie funcÈ›ioneazÄƒ diferit faÈ›Äƒ de Target Traineri:</p>
                    <ul style="color: #78350f; line-height: 2; padding-left: 20px;">
                        <li><strong>Pot fix:</strong> 2.5 lei Ã— Total ore vÃ¢ndute</li>
                        <li><strong>Doar Nivel 1</strong> (NU existÄƒ Nivel 2)</li>
                        <li><strong>Prag minim:</strong> 21h (peste 20h pentru a participa)</li>
                        <li><strong>ToÈ›i primesc bani:</strong> Traineri + Oameni (A1-Z50)</li>
                    </ul>
                </div>
                
                <h3 style="font-size: 24px; color: #f59e0b; margin: 40px 0 25px 0; font-weight: 800;">ğŸ­ Roluri AnimaÈ›ie</h3>
                
                <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; padding: 25px; margin-bottom: 20px;">
                    <h4 style="color: #f59e0b; margin-bottom: 15px; font-weight: 700;">âœ… Roluri care participÄƒ:</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; color: #1f2937; line-height: 1.8;">
                        <div>â€¢ AnimaÈ›ie</div>
                        <div>â€¢ UrÈ™itoare</div>
                        <div>â€¢ Arcade pe suport</div>
                        <div>â€¢ Arcade fÄƒrÄƒ suport</div>
                        <div>â€¢ Arcade pe suport cu cifre</div>
                        <div>â€¢ Arcade fÄƒrÄƒ suport cu cifre</div>
                        <div>â€¢ GheaÈ›Äƒ carbonicÄƒ</div>
                        <div>â€¢ VatÄƒ</div>
                        <div>â€¢ Popcorn</div>
                        <div>â€¢ VatÄƒ È™i Popcorn</div>
                        <div>â€¢ MoÈ™ CrÄƒciun</div>
                        <div>â€¢ Heliu</div>
                        <div>â€¢ Piniata personalizatÄƒ</div>
                    </div>
                </div>
                
                <div style="background: #fee2e2; border: 2px solid #ef4444; border-radius: 12px; padding: 25px;">
                    <h4 style="color: #dc2626; margin-bottom: 15px; font-weight: 700;">âŒ Rol care NU participÄƒ:</h4>
                    <div style="color: #991b1b; font-weight: 600;">â€¢ Training</div>
                </div>
                
                <h3 style="font-size: 24px; color: #f59e0b; margin: 40px 0 25px 0; font-weight: 800;">ğŸ§® Formula de Calcul</h3>
                
                <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border: 2px solid #3b82f6; border-radius: 12px; padding: 25px;">
                    <div style="font-size: 16px; color: #1e3a8a; line-height: 2;">
                        <strong>1. Pot Total:</strong> 2.5 lei Ã— Total ore vÃ¢ndute<br>
                        <strong>2. Puncte persoanÄƒ:</strong> (Ore animaÈ›ie - 20)<br>
                        <strong>3. Valoare punct:</strong> Pot / Suma tuturor punctelor<br>
                        <strong>4. CÃ¢È™tig:</strong> Puncte Ã— Valoare punct
                    </div>
                </div>
            </div>
        </div>

        <!-- Calcule Detaliate Tab Animatie -->
        <div class="target-content-animatie" id="calcule-animatie" style="display: none;">
            <div class="card">
                <h3 style="font-size: 24px; color: #f59e0b; margin-bottom: 25px; font-weight: 800;">ğŸ§® Calcule Detaliate Luna CurentÄƒ</h3>
                
                <button onclick="recalculateMonthAnimatie()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; padding: 15px 35px; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3); margin-bottom: 30px;">
                    ğŸ”„ RecalculeazÄƒ Luna
                </button>
                
                <div id="detailedCalculationsAnimatie"></div>
            </div>
        </div>
    </div>
    <!-- END SECRET CONTENT: target-animatie -->

    <!-- Target VÃ¢nzÄƒri (Secret) - PLACEHOLDER -->
    <div class="secret-content" id="target-vanzari" style="display: none;">
        <div class="page-header">
            <h2 style="color: #000; font-size: 36px; font-weight: 900;">ğŸ’µ TARGET VÃ‚NZÄ‚RI</h2>
            <p style="color: #6b7280; font-size: 18px;">Sistem de monetizare bazat pe vÃ¢nzÄƒri</p>
        </div>

        <div style="background: white; border-radius: 20px; padding: 60px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); text-align: center; margin-top: 40px;">
            <div style="font-size: 80px; margin-bottom: 30px;">ğŸ’µ</div>
            <h3 style="color: #1f2937; font-size: 32px; margin-bottom: 20px; font-weight: 800;">Target VÃ¢nzÄƒri</h3>
            <p style="color: #6b7280; font-size: 18px; line-height: 1.8; max-width: 600px; margin: 0 auto;">
                Sistemul de monetizare pentru vÃ¢nzÄƒri va fi configurat Ã®n continuare.<br>
                Spune-mi cum vrei sÄƒ funcÈ›ioneze acest target È™i Ã®l implementez!
            </p>
            <div style="margin-top: 40px; padding: 30px; background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); border-radius: 15px; max-width: 500px; margin-left: auto; margin-right: auto;">
                <div style="color: #667eea; font-weight: 700; margin-bottom: 15px; font-size: 18px;">ğŸ“‹ Ce trebuie configurat:</div>
                <ul style="color: #6b7280; text-align: left; line-height: 2;">
                    <li>Formula de calcul a potului</li>
                    <li>Prag minim de participare</li>
                    <li>Nivele (1 sau 2?)</li>
                    <li>Cine participÄƒ (traineri/toÈ›i)</li>
                    <li>Ce se ia Ã®n calcul</li>
                </ul>
            </div>
        </div>
    </div>
    <!-- END SECRET CONTENT: target-vanzari -->

    </div>
    <!-- END pagina-secreta -->
    
    <!-- ADMIN PAGES -->
    
    <!-- Page: BifeazÄƒ Evenimente -->
    <div class="page" id="bifeaza-evenimente">
        <div class="page-header" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h2 style="margin: 0 0 10px 0;">âœ… BifeazÄƒ Evenimente</h2>
                    <p style="opacity: 0.9; margin: 0;">MarcheazÄƒ evenimentele ca finalizate</p>
                </div>
                <button onclick="logoutAdmin()" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid white; padding: 12px 24px; border-radius: 12px; font-weight: 700; cursor: pointer; font-size: 15px; transition: all 0.3s; display: flex; align-items: center; gap: 10px;" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'">
                    <span style="font-size: 20px;">ğŸšª</span>
                    <span>IeÈ™ire Admin</span>
                </button>
            </div>
        </div>
        
        <div style="background: #fee2e2; border-left: 4px solid #ef4444; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
            <div style="font-weight: 700; color: #991b1b; margin-bottom: 5px;">ğŸ” MOD ADMIN ACTIV</div>
            <div style="color: #7f1d1d; font-size: 14px;">Pagina pentru bifarea evenimentelor este Ã®n construcÈ›ie</div>
        </div>
        
        <div style="background: white; border-radius: 15px; padding: 40px; box-shadow: 0 2px 15px rgba(0,0,0,0.08); text-align: center;">
            <div style="font-size: 64px; margin-bottom: 20px;">ğŸš§</div>
            <h3 style="color: #1f2937; margin-bottom: 15px;">FuncÈ›ionalitate Ã®n Dezvoltare</h3>
            <p style="color: #6b7280; font-size: 16px; max-width: 500px; margin: 0 auto;">
                Pagina pentru bifarea È™i gestionarea evenimentelor va fi adÄƒugatÄƒ Ã®n curÃ¢nd.
            </p>
        </div>
    </div>

    </div>
    <!-- End Main Content -->

    <!-- Floating AI Chat Button -->
    <button class="ai-chat-button" onclick="openAIChat()">
        <div class="ai-chat-pulse"></div>
        <span class="ai-chat-icon">ğŸ¤–</span>
        <span>ÃntreabÄƒ Super AI</span>
    </button>

    <script>
        // ============================================
        // SUPABASE CONFIGURATION
        // ============================================
        const SUPABASE_URL = 'https://bkhzilcjxuncyxpyhtbb.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJraHppbGNqeHVuY3l4cHlodGJiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5ODE5ODAsImV4cCI6MjA3ODU1Nzk4MH0._nYGKr3QqjCBhRDJ8zXrcEpG5pUA980ZZIivjC1VXS8';
        
        let supabase;
        
        // Initialize Supabase Client
        document.addEventListener('DOMContentLoaded', () => {
            try {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('âœ… Supabase connected successfully!');
                console.log('ğŸ“Š Database ready for: team_members, evenimente, colaboratori');
            } catch (error) {
                console.error('âŒ Supabase initialization error:', error);
            }
        });
        
        // ============================================
        // HELPER FUNCTIONS
        // ============================================
        
        // Generate trainer codes (A1-A50, B1-B50, ..., Z1-Z50)
        function generateTrainerCodes() {
            const codes = [];
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            
            for (let i = 0; i < letters.length; i++) {
                const letter = letters[i];
                for (let num = 1; num <= 50; num++) {
                    codes.push(letter + num);
                }
            }
            
            return codes;
        }
        
        // Create datalist with all trainer codes
        function createTrainerCodesDatalist() {
            // Remove existing datalist if any
            const existingDatalist = document.getElementById('trainerCodes');
            if (existingDatalist) {
                existingDatalist.remove();
            }
            
            // Create new datalist
            const datalist = document.createElement('datalist');
            datalist.id = 'trainerCodes';
            
            const codes = generateTrainerCodes();
            codes.forEach(code => {
                const option = document.createElement('option');
                option.value = code;
                datalist.appendChild(option);
            });
            
            document.body.appendChild(datalist);
        }
        
        // Generate event number on page load - START FROM 1 and INCREMENT
        document.addEventListener('DOMContentLoaded', function() {
            // Create trainer codes datalist
            createTrainerCodesDatalist();
            // Get last event number from localStorage, or start from 1
            let lastEventNumber = localStorage.getItem('lastEventNumber');
            let eventNumber;
            
            if (lastEventNumber) {
                eventNumber = parseInt(lastEventNumber) + 1;
            } else {
                eventNumber = 1; // Start from 1
            }
            
            // Save and display
            localStorage.setItem('lastEventNumber', eventNumber);
            const eventNumberEl = document.getElementById('numarEveniment');
            if (eventNumberEl) {
                eventNumberEl.textContent = eventNumber;
            }
            
            // Add date format validation for BOTH date inputs
            const dateInputs = document.querySelectorAll('input[type="text"][pattern*="\\\\d{2}"]');
            dateInputs.forEach(dateInput => {
                dateInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, ''); // Remove non-digits
                    
                    if (value.length >= 2) {
                        value = value.substring(0, 2) + '/' + value.substring(2);
                    }
                    if (value.length >= 5) {
                        value = value.substring(0, 5) + '/' + value.substring(5);
                    }
                    if (value.length > 10) {
                        value = value.substring(0, 10);
                    }
                    
                    e.target.value = value;
                });
                
                // Validate date format on blur
                dateInput.addEventListener('blur', function(e) {
                    const datePattern = /^(\d{2})\/(\d{2})\/(\d{4})$/;
                    const match = e.target.value.match(datePattern);
                    
                    if (match && e.target.value) {
                        const day = parseInt(match[1]);
                        const month = parseInt(match[2]);
                        const year = parseInt(match[3]);
                        
                        if (day < 1 || day > 31 || month < 1 || month > 12 || year < 2024) {
                            alert('Data invalidÄƒ! FoloseÈ™te formatul: zi/lunÄƒ/an (ex: 15/11/2025)');
                            e.target.value = '';
                        }
                    }
                });
            });
        });
        
        // Handle form submit
        
        // ============================================
        // ğŸ­ LIVE PARSING TITLU + DURATE DINAMICE (cu filtrare EXTRA-uri)
        // ============================================
        
        // Lista keywords pentru EXTRA-uri (NU sunt roluri)
        const extraKeywords = [
            "piniata", "pinata", "piÃ±ata",
            "vata", "vatÄƒ",
            "popcorn",
            "arcada",
            "decoratiuni", "decoraÈ›iuni",
            "cifre",
            "heliu",
            "bener", "banner",
            "tort",
            "baloane de sapun",
            "masina de baloane"
        ];
        
        let currentParsedRoles = []; // Store globally (doar roluri, fÄƒrÄƒ extra-uri)
        let currentExtras = []; // Store extras separately
        
        function isExtra(element) {
            const lowerElement = element.toLowerCase();
            return extraKeywords.some(keyword => lowerElement.includes(keyword));
        }
        
        function parseTitluLive() {
            const input = document.getElementById('titluInput').value.trim();
            const container = document.getElementById('durateRolesContainer');
            
            if (!input) {
                container.style.display = 'none';
                container.innerHTML = '';
                currentParsedRoles = [];
                currentExtras = [];
                return;
            }
            
            // Parse with multiple separators: +, si, È™i
            let elements = [];
            
            // Try separators in order
            if (input.includes('+')) {
                elements = input.split('+').map(r => r.trim()).filter(r => r.length > 0);
            } else if (input.toLowerCase().includes(' si ')) {
                elements = input.toLowerCase().split(' si ').map(r => r.trim()).filter(r => r.length > 0);
            } else if (input.includes(' È™i ')) {
                elements = input.split(' È™i ').map(r => r.trim()).filter(r => r.length > 0);
            } else {
                // No separator found - single element
                elements = [input];
            }
            
            // FILTER: Separate ROLES from EXTRAS
            const roles = [];
            const extras = [];
            
            elements.forEach(element => {
                if (isExtra(element)) {
                    extras.push(element);
                } else {
                    roles.push(element);
                }
            });
            
            currentParsedRoles = roles;
            currentExtras = extras;
            
            // Generate duration fields ONLY for ROLES (not extras)
            if (roles.length > 0) {
                container.style.display = 'block';
                
                const extrasInfo = extras.length > 0 
                    ? `<div style="font-size: 13px; color: #9ca3af; margin-bottom: 8px;">
                         ğŸ“¦ Extra-uri detectate: ${extras.join(', ')}
                       </div>`
                    : '';
                
                container.innerHTML = `
                    <div style="background: #f0fdf4; border: 2px solid #86efac; border-radius: 12px; padding: 15px; margin-bottom: 15px;">
                        <div style="font-size: 14px; font-weight: 700; color: #16a34a; margin-bottom: 8px;">
                            ğŸ¤– AI a detectat ${roles.length} ${roles.length === 1 ? 'rol' : 'roluri'}:
                        </div>
                        ${extrasInfo}
                        ${roles.map((role, index) => `
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; color: #6b7280; font-size: 14px; margin-bottom: 8px; font-weight: 600;">
                                    â±ï¸ Durata pentru <span style="color: #7c3aed; font-weight: 700;">${role}</span>:
                                </label>
                                <input 
                                    type="number" 
                                    name="durata_${index}" 
                                    id="durata_${index}"
                                    step="0.5" 
                                    min="0.5" 
                                    max="8" 
                                    style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px;" 
                                    placeholder="Ex: 1.5 ore"
                                    required>
                                <p style="margin-top: 5px; font-size: 11px; color: #9ca3af; font-style: italic;">
                                    ğŸ’¡ Exemple: 1 = o orÄƒ | 1.5 = o orÄƒ È™i jumÄƒtate | 2 = douÄƒ ore
                                </p>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                container.style.display = 'block';
                container.innerHTML = `
                    <div style="background: #fef3c7; border: 2px solid #fcd34d; border-radius: 12px; padding: 15px; margin-bottom: 15px;">
                        <div style="font-size: 14px; font-weight: 700; color: #d97706;">
                            âš ï¸ Nu am detectat niciun ROL, doar extra-uri: ${extras.join(', ')}
                        </div>
                        <p style="font-size: 12px; color: #9ca3af; margin-top: 8px;">
                            AdaugÄƒ cel puÈ›in un personaj/rol (ex: Spider-Man)
                        </p>
                    </div>
                `;
            }
            
            console.log('ğŸ­ Roluri detectate:', roles);
            console.log('ğŸ“¦ Extra-uri detectate:', extras);
        }
        
        // ============================================
        // END LIVE PARSING
        // ============================================
        
        // ============================================
        // ğŸ¤– AI LEARNING SYSTEM
        // ============================================
        
        // Initialize knowledge base
        function initKnowledgeBase() {
            if (!localStorage.getItem('aiKnowledgeBase')) {
                const initialKB = {
                    patterns: [],
                    errors: [],
                    stats: {
                        totalLearned: 0,
                        totalErrors: 0,
                        totalResolved: 0,
                        accuracy: 100
                    }
                };
                localStorage.setItem('aiKnowledgeBase', JSON.stringify(initialKB));
            }
        }
        
        // Parse personaje with AI
        function parsePersonajeWithAI(input, expectedCount) {
            // Check knowledge base first
            const learned = checkKnowledgeBase(input);
            if (learned) {
                console.log('ğŸ§  Found in knowledge base!');
                updatePatternUsage(learned.id);
                return {
                    success: true,
                    roles: learned.roles,
                    source: 'knowledge_base'
                };
            }
            
            // Try to parse with separator +
            const separator = '+';
            if (input.includes(separator)) {
                const roles = input.split(separator)
                    .map(r => r.trim())
                    .filter(r => r.length > 0);
                
                if (roles.length === expectedCount) {
                    console.log('âœ… Parsed successfully with +');
                    return {
                        success: true,
                        roles: roles,
                        source: 'auto_parse'
                    };
                } else {
                    console.log(`âš ï¸ Mismatch: found ${roles.length}, expected ${expectedCount}`);
                    return {
                        success: false,
                        found: roles.length,
                        expected: expectedCount,
                        roles: roles
                    };
                }
            }
            
            // No separator found - create empty roles
            console.log('âš ï¸ No separator found, creating empty roles');
            return {
                success: false,
                found: 1,
                expected: expectedCount,
                roles: []
            };
        }
        
        // Check knowledge base
        function checkKnowledgeBase(input) {
            const kb = JSON.parse(localStorage.getItem('aiKnowledgeBase') || '{}');
            if (!kb.patterns) return null;
            
            return kb.patterns.find(p => p.input.toLowerCase() === input.toLowerCase());
        }
        
        // Save pattern to knowledge base
        function savePatternToKnowledgeBase(input, roles, count) {
            const kb = JSON.parse(localStorage.getItem('aiKnowledgeBase'));
            
            // Check if pattern already exists
            const existingIndex = kb.patterns.findIndex(p => p.input.toLowerCase() === input.toLowerCase());
            
            if (existingIndex >= 0) {
                // Update existing
                kb.patterns[existingIndex].usedCount++;
                kb.patterns[existingIndex].lastUsed = new Date().toISOString();
            } else {
                // Add new pattern
                const newPattern = {
                    id: Date.now(),
                    input: input,
                    roles: roles,
                    count: count,
                    usedCount: 1,
                    learnedFrom: 'auto',
                    timestamp: new Date().toISOString(),
                    lastUsed: new Date().toISOString(),
                    confidence: 100
                };
                kb.patterns.push(newPattern);
                kb.stats.totalLearned++;
            }
            
            // Update accuracy
            const totalProcessed = kb.stats.totalLearned + kb.stats.totalErrors;
            kb.stats.accuracy = totalProcessed > 0 
                ? Math.round((kb.stats.totalLearned / totalProcessed) * 100) 
                : 100;
            
            localStorage.setItem('aiKnowledgeBase', JSON.stringify(kb));
            console.log('ğŸ’¾ Pattern saved to knowledge base');
        }
        
        // Update pattern usage
        function updatePatternUsage(patternId) {
            const kb = JSON.parse(localStorage.getItem('aiKnowledgeBase'));
            const pattern = kb.patterns.find(p => p.id === patternId);
            
            if (pattern) {
                pattern.usedCount++;
                pattern.lastUsed = new Date().toISOString();
                localStorage.setItem('aiKnowledgeBase', JSON.stringify(kb));
            }
        }
        
        // Log parse error
        function logParseError(input, expected, parseResult) {
            const kb = JSON.parse(localStorage.getItem('aiKnowledgeBase'));
            
            const error = {
                id: Date.now(),
                input: input,
                expectedCount: expected,
                foundCount: parseResult.found || 1,
                timestamp: new Date().toISOString(),
                resolved: false,
                learnedPattern: null
            };
            
            kb.errors.push(error);
            kb.stats.totalErrors++;
            
            // Update accuracy
            const totalProcessed = kb.stats.totalLearned + kb.stats.totalErrors;
            kb.stats.accuracy = Math.round((kb.stats.totalLearned / totalProcessed) * 100);
            
            localStorage.setItem('aiKnowledgeBase', JSON.stringify(kb));
            console.log('ğŸ“ Error logged for admin review');
        }
        
        // Learn from manual edit (called when user edits "Ce personaj vrei sa fi")
        function learnFromManualEdit(eventId, roles) {
            const parties = JSON.parse(localStorage.getItem('superpartyEvents') || '[]');
            const mamaEvent = parties.find(p => p.duplicateOf === eventId || p.id === eventId);
            
            if (!mamaEvent) return;
            
            const kb = JSON.parse(localStorage.getItem('aiKnowledgeBase'));
            
            // Find related error
            const errorIndex = kb.errors.findIndex(e => 
                !e.resolved && 
                e.input.toLowerCase() === mamaEvent.personaj?.toLowerCase()
            );
            
            if (errorIndex >= 0) {
                // Mark error as resolved
                kb.errors[errorIndex].resolved = true;
                kb.errors[errorIndex].resolvedAt = new Date().toISOString();
                kb.errors[errorIndex].learnedPattern = {
                    input: mamaEvent.personaj,
                    roles: roles
                };
                kb.stats.totalResolved++;
                
                // Save new pattern
                const newPattern = {
                    id: Date.now(),
                    input: mamaEvent.personaj,
                    roles: roles,
                    count: roles.length,
                    usedCount: 1,
                    learnedFrom: 'manual_correction',
                    timestamp: new Date().toISOString(),
                    lastUsed: new Date().toISOString(),
                    confidence: 100,
                    originalError: true
                };
                kb.patterns.push(newPattern);
                kb.stats.totalLearned++;
                
                // Update accuracy
                const totalProcessed = kb.stats.totalLearned + kb.stats.totalErrors;
                kb.stats.accuracy = Math.round((kb.stats.totalLearned / totalProcessed) * 100);
                
                localStorage.setItem('aiKnowledgeBase', JSON.stringify(kb));
                
                console.log('ğŸ“ AI learned from manual correction!');
                console.log('Pattern:', mamaEvent.personaj, 'â†’', roles);
            }
        }
        
        // Initialize KB on load
        initKnowledgeBase();
        
        // ============================================
        // END AI LEARNING SYSTEM
        // ============================================
        
        function handleFormSubmit(event) {
            event.preventDefault();
            
            // Get form data
            const formData = new FormData(event.target);
            const data = {};
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            // Get event code
            const eventCode = document.getElementById('numarEveniment').textContent;
            data.codEveniment = eventCode;
            
            // Add timestamp and ID
            data.id = Date.now();
            data.createdAt = new Date().toISOString();
            
            // Add status (default: pending)
            data.status = 'pending';
            
            // Process datetime-local field (dataOraPetrecere)
            if (data.dataOraPetrecere) {
                // dataOraPetrecere format: "2025-12-15T14:00"
                const datetime = new Date(data.dataOraPetrecere);
                
                // Format: "15 decembrie 2025" (ZI LUNA AN)
                data.dataPetrecere = datetime.toLocaleDateString('ro-RO', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                }); // Format: "15 decembrie 2025"
                
                data.oraPetrecere = datetime.toLocaleTimeString('ro-RO', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                }); // Format: "14:00" (24h)
                
                // For filtering (YYYY-MM-DD)
                data.dateForFilter = data.dataOraPetrecere.split('T')[0]; // "2025-12-15"
            }
            
            // Convert durata to display format (already in hours from input)
            if (data.durata) {
                const hours = parseFloat(data.durata);
                if (hours === 1) {
                    data.durataDisplay = "1 orÄƒ";
                } else if (hours < 1) {
                    data.durataDisplay = `${hours * 60} minute`;
                } else if (Number.isInteger(hours)) {
                    data.durataDisplay = `${hours} ore`;
                } else {
                    // 1.5 ore = 1 orÄƒ È™i 30 minute
                    const wholeHours = Math.floor(hours);
                    const minutes = Math.round((hours - wholeHours) * 60);
                    data.durataDisplay = `${wholeHours} ${wholeHours === 1 ? 'orÄƒ' : 'ore'} È™i ${minutes} minute`;
                }
            }
            
            // Use AI-parsed duration info if available
            if (window.currentEventDurataInfo) {
                data.durataDisplay = window.currentEventDurataInfo.durataDisplay;
                data.durataRoluri = window.currentEventDurataInfo.roleGroups; // Use roleGroups
                data.durataType = window.currentEventDurataInfo.type;
                console.log('âœ… Using AI-parsed duration:', data.durataDisplay);
                console.log('âœ… Role groups:', data.durataRoluri);
            }
            
            // Use AI-parsed price breakdown if available
            if (window.currentEventPriceBreakdown) {
                data.preturiBreakdown = window.currentEventPriceBreakdown;
                console.log('âœ… Price breakdown:', data.preturiBreakdown);
            }
            
            // Mark as MAMA (original event)
            data.isMama = true;
            data.duplicateOf = null;
            
            // USE PARSED ROLES from live parsing (already filtered, without extras)
            const titluInput = data.titlu || '';
            const roles = currentParsedRoles; // Already parsed LIVE, without extras
            const extras = currentExtras; // Store extras separately
            const numarRoluri = roles.length;
            
            console.log('ğŸ¤– Processing eveniment...');
            console.log('Titlu:', titluInput);
            console.log('Roluri detectate:', roles);
            console.log('Extra-uri detectate:', extras);
            console.log('NumÄƒr roluri:', numarRoluri);
            
            // Store for mama - use roleGroups if available
            data.parsedRoles = roles;
            data.extras = extras;
            data.parseSuccess = roles.length > 0;
            
            // Get existing parties from localStorage
            let parties = JSON.parse(localStorage.getItem('superpartyEvents') || '[]');
            
            // Add MAMA event
            parties.push(data);
            
            // USE AI-PARSED roleGroups if available, otherwise use parsed roles
            let duplicatesToCreate = [];
            
            if (data.durataRoluri && data.durataRoluri.length > 0) {
                // Use AI-parsed role groups
                console.log('ğŸ¤– Using AI-parsed role groups:', data.durataRoluri);
                duplicatesToCreate = data.durataRoluri.map(group => ({
                    roles: group.roles || [group.rol], // Handle both old and new format
                    ore: group.ore,
                    minute: group.minute,
                    isGroup: group.roles ? group.roles.length > 1 : false
                }));
            } else {
                // Fallback: use parsed roles (1 duplicate per role)
                console.log('ğŸ“‹ Using parsed roles (fallback):', roles);
                duplicatesToCreate = roles.map((rol, i) => {
                    const durataIndividuala = formData.get(`durata_${i}`);
                    const hours = parseFloat(durataIndividuala || data.durata || 1);
                    return {
                        roles: [rol],
                        ore: hours,
                        minute: hours * 60,
                        isGroup: false
                    };
                });
            }
            
            console.log('ğŸ¯ Creating duplicates for:', duplicatesToCreate);
            
            // CREATE DUPLICATES based on roleGroups
            const duplicates = [];
            for (let i = 0; i < duplicatesToCreate.length; i++) {
                const group = duplicatesToCreate[i];
                const duplicate = { ...data };
                
                // Modify duplicate
                duplicate.id = Date.now() + i + 1; // Unique ID
                duplicate.isMama = false;
                duplicate.duplicateOf = data.id; // Reference to mama
                duplicate.duplicateIndex = i + 1;
                duplicate.codEveniment = `${eventCode}-${i + 1}`;
                
                // Auto-fill "Ce personaj vrei sa fi" with role(s)
                if (group.roles && group.roles.length > 0) {
                    duplicate.cePersonajVreisaFi = group.isGroup 
                        ? group.roles.join(' È™i ') // Grouped: "VatÄƒ È™i Popcorn"
                        : group.roles[0]; // Single: "Ana"
                    duplicate.autoFilled = true;
                } else {
                    duplicate.cePersonajVreisaFi = ''; // Empty - will be filled manually
                    duplicate.autoFilled = false;
                }
                
                // Set duration for this duplicate
                duplicate.durata = group.minute || group.ore * 60;
                duplicate.durataDisplay = `${group.ore} ${group.ore === 1 ? 'orÄƒ' : 'ore'}`;
                
                // Set prices for this duplicate
                // total = TOTAL GENERAL (afiÈ™at la toÈ›i)
                // totalRol = TOTAL SPECIFIC pentru acest rol (doar pentru admin)
                duplicate.total = data.total || 0; // Keep general total for all users
                
                if (data.preturiBreakdown && group.roles && group.roles.length > 0) {
                    // For single role
                    if (!group.isGroup && group.roles.length === 1) {
                        const priceItem = data.preturiBreakdown.find(p => p.rol === group.roles[0]);
                        if (priceItem) {
                            duplicate.totalRol = priceItem.pret; // Specific price for this role (admin only)
                            console.log(`   ğŸ’° Total general: ${duplicate.total} RON, Total rol: ${duplicate.totalRol} RON`);
                        }
                    }
                    // For grouped roles - sum their prices
                    else if (group.isGroup && group.roles.length > 1) {
                        let totalPrice = 0;
                        group.roles.forEach(rol => {
                            const priceItem = data.preturiBreakdown.find(p => p.rol === rol);
                            if (priceItem) {
                                totalPrice += priceItem.pret;
                            }
                        });
                        if (totalPrice > 0) {
                            duplicate.totalRol = totalPrice; // Specific price for grouped roles (admin only)
                            console.log(`   ğŸ’° Total general: ${duplicate.total} RON, Total rol (grouped): ${duplicate.totalRol} RON`);
                        }
                    }
                }
                
                // Fallback: If no breakdown, totalRol = total
                if (!duplicate.totalRol) {
                    duplicate.totalRol = duplicate.total;
                }
                
                console.log(`âœ… Duplicate ${i+1}: "${duplicate.cePersonajVreisaFi}" = ${duplicate.durataDisplay}, Total: ${duplicate.total} RON (general), ${duplicate.totalRol} RON (rol)`);
                
                duplicates.push(duplicate);
                parties.push(duplicate);
            }
            
            // Save to localStorage
            localStorage.setItem('superpartyEvents', JSON.stringify(parties));
            
            console.log('ğŸ“ Eveniment salvat:', data);
            console.log('ğŸ“Š Duplicate create:', duplicates.length);
            console.log('ğŸ“Š Total evenimente:', parties.length);
            
            // Show success message
            const extrasMsg = extras.length > 0 ? `\nğŸ“¦ Extra-uri: ${extras.join(', ')}` : '';
            const successMsg = `âœ… Eveniment salvat cu succes!\n\nCod eveniment: ${eventCode}\nğŸ¯ ${numarRoluri} ${numarRoluri === 1 ? 'rol' : 'roluri'}\nâœ¨ Roluri: ${roles.join(', ')}${extrasMsg}\n\nVezi evenimentele Ã®n "Ce Petreceri Am"`;
            
            alert(successMsg);
            
            // Reset form
            event.target.reset();
            
            // Reset parsed data
            currentParsedRoles = [];
            currentExtras = [];
            window.currentEventDurataInfo = null; // Reset duration info
            window.currentEventPriceBreakdown = null; // Reset price breakdown
            document.getElementById('durateRolesContainer').style.display = 'none';
            document.getElementById('durateRolesContainer').innerHTML = '';
            
            // Generate NEXT sequential event number
            let lastEventNumber = localStorage.getItem('lastEventNumber');
            let newEventNumber = parseInt(lastEventNumber) + 1;
            localStorage.setItem('lastEventNumber', newEventNumber);
            document.getElementById('numarEveniment').textContent = newEventNumber;
            
            // Update parties data for filtering
            loadPartiesFromStorage();
        }
        
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active from all menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected page
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // Load data for specific pages
            if (pageId === 'cu-factura') {
                loadEvenimenteCuFactura();
            }
            
            // Load users data when opening Mod GM
            if (pageId === 'mod-gm') {
                loadUsersData();
            }
            
            // Close sidebar on mobile
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                if (sidebar) {
                    sidebar.classList.remove('open');
                }
            }
        }
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }
        
        // Toggle IntrÄƒ Ã®n cont submenu
        function toggleIntraContMenu() {
            const submenu = document.getElementById('intraContSubmenu');
            const arrow = document.getElementById('intraContArrow');
            
            if (submenu.style.display === 'none' || submenu.style.display === '') {
                submenu.style.display = 'block';
                arrow.style.transform = 'rotate(180deg)';
            } else {
                submenu.style.display = 'none';
                arrow.style.transform = 'rotate(0deg)';
            }
        }
        
        // Login Handler
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const accessKey = document.getElementById('loginAccessKey').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            const errorDiv = document.getElementById('loginError');
            const successDiv = document.getElementById('loginSuccess');
            
            // Hide previous messages
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            
            // Check against registered users first (now using email + accessKey)
            const users = JSON.parse(localStorage.getItem('superparty_users') || '[]');
            const registeredUser = users.find(u => u.email === username && u.password === password && u.accessKey === accessKey);
            
            // Hardcoded admin credentials (you can change these)
            const validUsername = 'admin';
            const validPassword = '1234';
            const validAccessKey = 'ADMIN2024';
            
            const isValidLogin = registeredUser || (username === validUsername && password === validPassword && accessKey === validAccessKey);
            
            if (isValidLogin) {
                // Success
                successDiv.style.display = 'block';
                
                // Save login state if "remember me" is checked
                if (rememberMe) {
                    localStorage.setItem('superparty_logged_in', 'true');
                    localStorage.setItem('superparty_username', username);
                } else {
                    sessionStorage.setItem('superparty_logged_in', 'true');
                    sessionStorage.setItem('superparty_username', username);
                }
                
                // Redirect to home page after 1 second and show submenu
                setTimeout(() => {
                    // Show submenu after successful login
                    const submenu = document.getElementById('intraContSubmenu');
                    submenu.style.display = 'block';
                    
                    // Go to home page
                    showPage('home');
                }, 1000);
                
            } else {
                // Error
                errorDiv.style.display = 'block';
            }
        }
        
        // Registration Handler
        function handleRegister(event) {
            event.preventDefault();
            console.log('Register button clicked!');
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            
            console.log('Form data:', { name, email, password, passwordConfirm });
            
            const errorDiv = document.getElementById('registerError');
            const successDiv = document.getElementById('registerSuccess');
            
            // Hide previous messages
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            
            // Validate passwords match
            if (password !== passwordConfirm) {
                errorDiv.textContent = 'âŒ Parolele nu se potrivesc!';
                errorDiv.style.display = 'block';
                console.error('Passwords do not match');
                return;
            }
            
            // Validate name length
            if (name.length < 3) {
                errorDiv.textContent = 'âŒ Numele trebuie sÄƒ aibÄƒ cel puÈ›in 3 caractere!';
                errorDiv.style.display = 'block';
                console.error('Name too short');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                errorDiv.textContent = 'âŒ Email invalid!';
                errorDiv.style.display = 'block';
                console.error('Invalid email');
                return;
            }
            
            // Validate password length
            if (password.length < 4) {
                errorDiv.textContent = 'âŒ Parola trebuie sÄƒ aibÄƒ cel puÈ›in 4 caractere!';
                errorDiv.style.display = 'block';
                console.error('Password too short');
                return;
            }
            
            try {
                // AUTO-GENERATE access key for user
                const accessKey = 'SP' + Math.random().toString(36).substring(2, 8).toUpperCase();
                console.log('Auto-generated access key:', accessKey);
                
                // Check if email already exists in admin table
                const adminUsers = JSON.parse(localStorage.getItem('superparty_admin_users') || '[]');
                console.log('Existing admin users:', adminUsers.length);
                
                if (adminUsers.find(u => u.email === email)) {
                    errorDiv.textContent = 'âŒ Email-ul existÄƒ deja!';
                    errorDiv.style.display = 'block';
                    console.error('Email already exists');
                    return;
                }
                
                // ONLY add to admin users table (Gestionare Utilizatori)
                adminUsers.push({
                    name: name,
                    email: email,
                    password: password,
                    passwordConfirm: passwordConfirm,
                    accessKey: accessKey, // AUTO-GENERATED
                    userCode: '', // Empty - admin fills this
                    userRole: 'Animator', // Default role
                    blocked: false, // Active by default
                    failedAttempts: 0 // No failed attempts yet
                });
                localStorage.setItem('superparty_admin_users', JSON.stringify(adminUsers));
                console.log('User saved to admin table with auto-generated access key!');
                
                // Success - show message telling user to wait for admin
                successDiv.innerHTML = `âœ… Cont creat cu succes!<br><small style="color: #6b7280; margin-top: 10px; display: block;">Administratorul Ã®È›i va trimite cheia de acces pe email.</small>`;
                successDiv.style.display = 'block';
                console.log('Success message shown');
                
                // Redirect to login page after 3 seconds
                setTimeout(() => {
                    console.log('Redirecting to login...');
                    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                    document.getElementById('home').classList.add('active');
                }, 3000);
            } catch (error) {
                console.error('Error during registration:', error);
                errorDiv.textContent = 'âŒ Eroare la Ã®nregistrare: ' + error.message;
                errorDiv.style.display = 'block';
            }
        }
        
        // Check if user is already logged in
        function checkLoginStatus() {
            const loggedIn = localStorage.getItem('superparty_logged_in') || sessionStorage.getItem('superparty_logged_in');
            const username = localStorage.getItem('superparty_username') || sessionStorage.getItem('superparty_username');
            
            if (loggedIn === 'true') {
                console.log('âœ… User already logged in - showing menu');
                
                // Hide home login form
                const homeLoginContainer = document.querySelector('#home > div');
                if (homeLoginContainer) {
                    homeLoginContainer.style.display = 'none';
                }
                
                // Show submenu
                const submenu = document.getElementById('intraContSubmenu');
                if (submenu) {
                    submenu.style.display = 'block';
                }
                
                // Show welcome message on home page
                const homePage = document.getElementById('home');
                if (homePage) {
                    homePage.innerHTML = `
                        <div style="text-align: center; padding: 60px 20px;">
                            <div style="font-size: 80px; margin-bottom: 20px;">ğŸ‰</div>
                            <h1 style="font-size: 48px; color: #1f2937; margin-bottom: 20px;">Bine ai revenit${username ? ', ' + username : ''}!</h1>
                            <p style="font-size: 20px; color: #6b7280;">SelecteazÄƒ o opÈ›iune din meniul din stÃ¢nga</p>
                        </div>
                    `;
                }
            } else {
                console.log('âŒ User not logged in - showing login form');
            }
        }
        
        // Home page login handler
        function handleHomeLogin(event) {
            event.preventDefault();
            console.log('ğŸ” Home login attempt...');
            
            const username = document.getElementById('homeLoginEmail').value;
            const password = document.getElementById('homeLoginPassword').value;
            const accessKey = document.getElementById('homeLoginAccessKey').value;
            const rememberMe = document.getElementById('homeRememberMe').checked;
            
            const errorDiv = document.getElementById('homeLoginError');
            const successDiv = document.getElementById('homeLoginSuccess');
            
            // Hide previous messages
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            
            // Check against ADMIN USERS TABLE (Gestionare Utilizatori)
            const adminUsers = JSON.parse(localStorage.getItem('superparty_admin_users') || '[]');
            
            // Find user by email first
            const userIndex = adminUsers.findIndex(u => u.email === username);
            const userAccount = userIndex >= 0 ? adminUsers[userIndex] : null;
            
            // Check if user is blocked
            if (userAccount && userAccount.blocked) {
                console.log('âŒ User is BLOCKED!');
                errorDiv.textContent = 'ğŸ”’ Cont blocat! ContacteazÄƒ administratorul pentru a fi deblocat.';
                errorDiv.style.display = 'block';
                return;
            }
            
            const registeredUser = adminUsers.find(u => 
                u.email === username && 
                u.password === password && 
                u.accessKey === accessKey && 
                u.accessKey !== '' && // Must have an access key (set by admin)
                !u.blocked // Must not be blocked
            );
            
            console.log('Checking admin users table:', adminUsers.length, 'users');
            console.log('Found match:', registeredUser ? 'YES' : 'NO');
            
            // Hardcoded admin credentials (you can change these)
            const validUsername = 'admin';
            const validPassword = '1234';
            const validAccessKey = 'ADMIN2024';
            
            const isValidLogin = registeredUser || (username === validUsername && password === validPassword && accessKey === validAccessKey);
            
            if (isValidLogin) {
                // SUCCESS - Reset failed attempts if it was a regular user
                if (userAccount) {
                    userAccount.failedAttempts = 0;
                    adminUsers[userIndex] = userAccount;
                    localStorage.setItem('superparty_admin_users', JSON.stringify(adminUsers));
                }
                // Success
                console.log('âœ… Login successful!');
                successDiv.style.display = 'block';
                
                // Save login state (always save to localStorage for persistence)
                localStorage.setItem('superparty_logged_in', 'true');
                localStorage.setItem('superparty_username', username);
                
                // Hide login form
                setTimeout(() => {
                    const homeLoginContainer = document.querySelector('#home > div');
                    if (homeLoginContainer) {
                        homeLoginContainer.style.display = 'none';
                    }
                    
                    // Show submenu
                    const submenu = document.getElementById('intraContSubmenu');
                    if (submenu) {
                        submenu.style.display = 'block';
                    }
                    
                    // Show welcome message on home page
                    const homePage = document.getElementById('home');
                    homePage.innerHTML = `
                        <div style="text-align: center; padding: 60px 20px;">
                            <div style="font-size: 80px; margin-bottom: 20px;">ğŸ‰</div>
                            <h1 style="font-size: 48px; color: #1f2937; margin-bottom: 20px;">Bine ai venit!</h1>
                            <p style="font-size: 20px; color: #6b7280;">SelecteazÄƒ o opÈ›iune din meniul din stÃ¢nga</p>
                        </div>
                    `;
                }, 1000);
                
            } else {
                // FAILED LOGIN - Increment failed attempts
                console.log('âŒ Login failed');
                
                if (userAccount) {
                    // Increment failed attempts
                    userAccount.failedAttempts = (userAccount.failedAttempts || 0) + 1;
                    
                    console.log(`Failed attempts for ${userAccount.email}: ${userAccount.failedAttempts}`);
                    
                    // Check if should be blocked (3 failed attempts)
                    if (userAccount.failedAttempts >= 3) {
                        userAccount.blocked = true;
                        adminUsers[userIndex] = userAccount;
                        localStorage.setItem('superparty_admin_users', JSON.stringify(adminUsers));
                        
                        console.log('ğŸ”’ User BLOCKED after 3 failed attempts!');
                        errorDiv.textContent = 'ğŸ”’ Cont blocat dupÄƒ 3 Ã®ncercÄƒri eÈ™uate! ContacteazÄƒ administratorul.';
                    } else {
                        adminUsers[userIndex] = userAccount;
                        localStorage.setItem('superparty_admin_users', JSON.stringify(adminUsers));
                        
                        const remaining = 3 - userAccount.failedAttempts;
                        errorDiv.textContent = `âŒ Date incorecte! Mai ai ${remaining} ${remaining === 1 ? 'Ã®ncercare' : 'Ã®ncercÄƒri'}.`;
                    }
                } else {
                    errorDiv.textContent = 'âŒ Email, parolÄƒ sau cheie incorectÄƒ!';
                }
                
                errorDiv.style.display = 'block';
            }
        }
        
        // Check login status on page load
        window.addEventListener('load', checkLoginStatus);
        
        // Ensure secret menu is hidden on page load
        window.addEventListener('load', function() {
            const secretMenu = document.getElementById('secretMenuSection');
            if (secretMenu) {
                secretMenu.style.display = 'none';
                console.log('ğŸ”’ Secret menu hidden on page load');
            }
            
            // DEBUG: Check if password modal is accidentally visible
            const modal = document.getElementById('passwordModal');
            if (modal) {
                const isVisible = window.getComputedStyle(modal).display !== 'none';
                console.log('ğŸ” Password Modal on load:', isVisible ? 'âš ï¸ VISIBLE (BUG!)' : 'âœ… Hidden (OK)');
                
                // Force hide modal if it's somehow visible
                if (isVisible) {
                    console.log('ğŸ› ï¸ Forcing modal to hide...');
                    modal.style.display = 'none';
                }
            }
        });
        
        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                const toggle = document.querySelector('.mobile-menu-toggle');
                
                if (!sidebar.contains(event.target) && !toggle.contains(event.target)) {
                    sidebar.classList.remove('open');
                }
            }
        });
        
        // Open AI Chat function
        // AI Chat Functions
        let chatHistory = [];
        
        // AI Chat Server Configuration
        const AI_SERVER_URL = 'https://super-party-by-ai-github-io.vercel.app';
        
        
        function openAIChat() {
            document.getElementById('aiChatModal').style.display = 'flex';
            // Focus pe input
            setTimeout(() => {
                document.getElementById('chatInput').focus();
            }, 100);
        }
        
        function closeAIChat() {
            document.getElementById('aiChatModal').style.display = 'none';
        }
        
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Clear input
            input.value = '';
            
            // SECRET COMMAND: "open mod andrei admin" - opens password modal and closes chat
            if (message.toLowerCase() === 'open mod andrei admin') {
                console.log('ğŸ”’ Secret command detected - opening Mod Admin password prompt');
                
                // Close chat modal
                const chatModal = document.getElementById('aiChatModal');
                if (chatModal) {
                    chatModal.style.display = 'none';
                }
                
                // Show password prompt modal for Admin
                showAdminPasswordPrompt();
                
                return; // Don't add to chat, don't send to AI
            }
            
            // SECRET COMMAND: "open mod andrei gm" - opens password modal and closes chat
            if (message.toLowerCase() === 'open mod andrei gm') {
                console.log('ğŸ® Secret command detected - opening Mod GM password prompt');
                
                // Close chat modal
                const chatModal = document.getElementById('aiChatModal');
                if (chatModal) {
                    chatModal.style.display = 'none';
                }
                
                // Show password prompt modal for GM
                showGMPasswordPrompt();
                
                return; // Don't add to chat, don't send to AI
            }
            
            // SECRET COMMAND: "intra in mod logare" - shows login page and closes chat
            if (message.toLowerCase() === 'intra in mod logare') {
                console.log('ğŸ” Secret command detected - showing login page');
                
                // Close chat modal
                const chatModal = document.getElementById('aiChatModal');
                if (chatModal) {
                    chatModal.style.display = 'none';
                }
                
                // Show home page and populate with login form
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                const homePage = document.getElementById('home');
                homePage.classList.add('active');
                
                // Create login form HTML
                homePage.innerHTML = `
                    <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px;">
                        <div style="background: white; border-radius: 24px; padding: 50px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15); max-width: 450px; width: 100%;">
                            <div style="text-align: center; margin-bottom: 40px;">
                                <div style="font-size: 64px; margin-bottom: 15px;">ğŸ‰</div>
                                <h2 style="font-size: 32px; color: #1f2937; margin: 0 0 10px 0; font-weight: 800;">SuperParty</h2>
                                <p style="color: #6b7280; font-size: 15px; margin: 0;">IntrÄƒ Ã®n contul tÄƒu</p>
                            </div>
                            
                            <form id="homeLoginForm" onsubmit="handleHomeLogin(event)" style="display: flex; flex-direction: column; gap: 25px;">
                                <div>
                                    <label style="display: block; color: #374151; font-size: 14px; font-weight: 600; margin-bottom: 10px;">ğŸ“§ Email</label>
                                    <input type="text" id="homeLoginEmail" placeholder="Introdu email-ul" required
                                        style="width: 100%; padding: 15px 18px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; transition: all 0.3s; outline: none;">
                                </div>
                                <div>
                                    <label style="display: block; color: #374151; font-size: 14px; font-weight: 600; margin-bottom: 10px;">ğŸ”’ ParolÄƒ</label>
                                    <input type="password" id="homeLoginPassword" placeholder="Introdu parola" required
                                        style="width: 100%; padding: 15px 18px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; transition: all 0.3s; outline: none;">
                                </div>
                                <div>
                                    <label style="display: block; color: #374151; font-size: 14px; font-weight: 600; margin-bottom: 10px;">ğŸ”‘ Cheie de Acces</label>
                                    <input type="password" id="homeLoginAccessKey" placeholder="Introdu cheia de acces" required
                                        style="width: 100%; padding: 15px 18px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; font-family: monospace; transition: all 0.3s; outline: none;">
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="homeRememberMe" checked style="width: 18px; height: 18px; cursor: pointer;">
                                    <label for="homeRememberMe" style="color: #6b7280; font-size: 14px; cursor: pointer;">Èšine-mÄƒ minte</label>
                                </div>
                                <button type="submit"
                                    style="width: 100%; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; font-size: 18px; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                                    ğŸš€ IntrÄƒ Ã®n cont
                                </button>
                                <button type="button" onclick="document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById('inregistreaza-te').classList.add('active');"
                                    style="width: 100%; padding: 16px; background: white; color: #667eea; border: 2px solid #667eea; border-radius: 12px; font-size: 18px; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);">
                                    âœ¨ ÃnregistreazÄƒ-te
                                </button>
                            </form>
                            
                            <div id="homeLoginError" style="display: none; margin-top: 20px; padding: 15px; background: #fee2e2; border: 2px solid #fecaca; border-radius: 12px; color: #dc2626; font-size: 14px; font-weight: 600; text-align: center;">
                                âŒ Email, parolÄƒ sau cheie incorectÄƒ!
                            </div>
                            <div id="homeLoginSuccess" style="display: none; margin-top: 20px; padding: 15px; background: #d1fae5; border: 2px solid #a7f3d0; border-radius: 12px; color: #059669; font-size: 14px; font-weight: 600; text-align: center;">
                                âœ… Autentificare reuÈ™itÄƒ!
                            </div>
                        </div>
                    </div>
                `;
                
                return; // Don't add to chat, don't send to AI
            }
            
            // Add user message to chat
            addMessageToChat(message, 'user');
            
            // Show loading indicator
            const loadingId = addLoadingMessage();
            
            // Disable send button
            const sendButton = document.getElementById('sendButton');
            sendButton.disabled = true;
            sendButton.textContent = 'â³ AÈ™teaptÄƒ...';
            
            try {
                // Load AI Knowledge Base
                const knowledgeBase = localStorage.getItem('superparty_ai_knowledge_base') || '';
                
                // Call Secure Server (NOT OpenAI directly!)
                const response = await fetch(`${AI_SERVER_URL}/api/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: message,
                        history: chatHistory.slice(-6),
                        knowledgeBase: knowledgeBase // Inject Creier AI
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Server error: ' + response.status);
                }
                
                const data = await response.json();
                
                // Remove loading
                removeLoadingMessage(loadingId);
                
                // Add AI response from server
                if (data.success) {
                    const aiMessage = data.response;
                    addMessageToChat(aiMessage, 'assistant');
                    
                    // Update history
                    chatHistory.push({ role: 'user', content: message });
                    chatHistory.push({ role: 'assistant', content: aiMessage });
                    
                    // SILENT LOGGING - Save conversation to localStorage (NO user notification)
                    saveConversationToLog(message, aiMessage);
                    
                    // Check if answer came from knowledge base or web search
                    // If response indicates it used web search (backend should flag this), log as unanswered
                    if (data.usedWebSearch) {
                        saveUnansweredQuestion(message, aiMessage);
                    }
                } else {
                    throw new Error(data.error || 'Unknown error');
                }
                
                // Keep only last 10 messages (5 pairs) to avoid token limits
                if (chatHistory.length > 10) {
                    chatHistory = chatHistory.slice(-10);
                }
                
            } catch (error) {
                console.error('AI Chat Error:', error);
                removeLoadingMessage(loadingId);
                
                // Add error message
                addMessageToChat(
                    'âŒ Oops! Am Ã®ntÃ¢mpinat o problemÄƒ. Te rog Ã®ncearcÄƒ din nou sau verificÄƒ conexiunea la internet.\n\nğŸ’¡ DacÄƒ problema persistÄƒ, verificÄƒ cÄƒ API key-ul ChatGPT este configurat corect.',
                    'assistant',
                    true
                );
            } finally {
                // Re-enable send button
                sendButton.disabled = false;
                sendButton.textContent = 'ğŸ“¤ Trimite';
                input.focus();
            }
        }
        
        function addMessageToChat(message, role, isError = false) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = 'display: flex; gap: 10px; margin-bottom: 15px; animation: fadeIn 0.3s ease;';
            
            if (role === 'user') {
                // User message (right aligned)
                messageDiv.style.justifyContent = 'flex-end';
                messageDiv.innerHTML = `
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 16px; border-radius: 12px; max-width: 80%; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);">
                        <p style="margin: 0; line-height: 1.5; white-space: pre-wrap;">${escapeHtml(message)}</p>
                    </div>
                    <div style="width: 40px; height: 40px; border-radius: 50%; background: #667eea; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <span style="font-size: 20px;">ğŸ‘¤</span>
                    </div>
                `;
            } else {
                // AI message (left aligned)
                const bgColor = isError ? '#fee2e2' : 'white';
                const textColor = isError ? '#dc2626' : '#111827';
                
                messageDiv.innerHTML = `
                    <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <span style="font-size: 20px;">ğŸ¤–</span>
                    </div>
                    <div style="background: ${bgColor}; padding: 12px 16px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); max-width: 80%;">
                        <p style="margin: 0; color: ${textColor}; line-height: 1.5; white-space: pre-wrap;">${escapeHtml(message)}</p>
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function addLoadingMessage() {
            const chatMessages = document.getElementById('chatMessages');
            const loadingDiv = document.createElement('div');
            const loadingId = 'loading-' + Date.now();
            loadingDiv.id = loadingId;
            loadingDiv.style.cssText = 'display: flex; gap: 10px; margin-bottom: 15px;';
            loadingDiv.innerHTML = `
                <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <span style="font-size: 20px;">ğŸ¤–</span>
                </div>
                <div style="background: white; padding: 12px 16px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="display: flex; gap: 4px; align-items: center;">
                        <div style="width: 8px; height: 8px; border-radius: 50%; background: #667eea; animation: bounce 1s infinite;"></div>
                        <div style="width: 8px; height: 8px; border-radius: 50%; background: #667eea; animation: bounce 1s infinite 0.2s;"></div>
                        <div style="width: 8px; height: 8px; border-radius: 50%; background: #667eea; animation: bounce 1s infinite 0.4s;"></div>
                    </div>
                </div>
            `;
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return loadingId;
        }
        
        function removeLoadingMessage(loadingId) {
            const loadingDiv = document.getElementById(loadingId);
            if (loadingDiv) {
                loadingDiv.remove();
            }
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('aiChatModal');
            if (event.target === modal) {
                closeAIChat();
            }
        });
        
        // Colaboratori Management Functions
        let colaboratoriData = [];
        
        function openColaboratoriModal() {
            document.getElementById('colaboratoriModal').style.display = 'flex';
            renderColaboratori();
        }
        
        function closeColaboratoriModal() {
            document.getElementById('colaboratoriModal').style.display = 'none';
        }
        
        function addColaborator() {
            const nume = document.getElementById('colaboratorNume').value;
            const telefon = document.getElementById('colaboratorTelefon').value;
            const cod = document.getElementById('colaboratorCod').value;
            const tip = document.getElementById('colaboratorTip').value;
            const tipPret = document.getElementById('colaboratorTipPret').value;
            const pret = document.getElementById('colaboratorPret').value;
            const pretTransport = document.getElementById('colaboratorPretTransport').value || 0;
            
            if (!nume || !tip || !pret) {
                alert('âš ï¸ Te rog completeazÄƒ toate cÃ¢mpurile obligatorii!');
                return;
            }
            
            const colaborator = {
                id: Date.now(),
                nume: nume,
                telefon: telefon,
                cod: cod,
                tip: tip,
                tipPret: tipPret,
                pret: parseFloat(pret),
                pretTransport: parseFloat(pretTransport)
            };
            
            colaboratoriData.push(colaborator);
            renderColaboratori();
            
            // Clear form
            document.getElementById('colaboratorNume').value = '';
            document.getElementById('colaboratorTelefon').value = '';
            document.getElementById('colaboratorCod').value = '';
            document.getElementById('colaboratorTip').value = '';
            document.getElementById('colaboratorPret').value = '';
            document.getElementById('colaboratorPretTransport').value = '';
            
            alert('âœ… Colaborator adÄƒugat!');
        }
        
        function deleteColaborator(id) {
            if (confirm('Sigur vrei sÄƒ È™tergi acest colaborator?')) {
                colaboratoriData = colaboratoriData.filter(c => c.id !== id);
                renderColaboratori();
                alert('âœ… Colaborator È™ters!');
            }
        }
        
        function renderColaboratori() {
            const container = document.getElementById('colaboratoriItems');
            
            if (colaboratoriData.length === 0) {
                container.innerHTML = '<p style="color: #9ca3af; text-align: center; padding: 20px;">Niciun colaborator adÄƒugat Ã®ncÄƒ</p>';
                return;
            }
            
            const tipColors = {
                'Loc de joacÄƒ': 'background: #dcfce7; color: #16a34a;'
            };
            
            let html = '';
            let totalCost = 0;
            let totalTransport = 0;
            
            colaboratoriData.forEach(col => {
                const colorStyle = tipColors[col.tip] || 'background: #f3f4f6; color: #6b7280;';
                const costTotal = col.pret + (col.pretTransport || 0);
                totalCost += col.pret;
                totalTransport += (col.pretTransport || 0);
                
                html += `
                    <div style="background: white; border: 2px solid #e5e7eb; border-radius: 12px; padding: 15px; display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: #111827; margin-bottom: 5px;">${col.nume}</div>
                            ${col.telefon ? `<div style="color: #6b7280; font-size: 13px; margin-bottom: 5px;">ğŸ“ ${col.telefon}</div>` : ''}
                            ${col.cod ? `<div style="color: #6b7280; font-size: 13px; margin-bottom: 5px;">ğŸ·ï¸ Cod: ${col.cod}</div>` : ''}
                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <span style="${colorStyle} padding: 4px 10px; border-radius: 6px; font-size: 13px; font-weight: 600;">${col.tip}</span>
                                <span style="background: #f3f4f6; color: #667eea; padding: 4px 10px; border-radius: 6px; font-size: 13px; font-weight: 600;">${col.pret} RON / ${col.tipPret === 'ora' ? 'OrÄƒ' : 'Eveniment'}</span>
                                ${col.pretTransport > 0 ? `<span style="background: #fef3c7; color: #d97706; padding: 4px 10px; border-radius: 6px; font-size: 13px; font-weight: 600;">ğŸš— Transport: ${col.pretTransport} RON</span>` : ''}
                            </div>
                        </div>
                        <button onclick="deleteColaborator(${col.id})" style="background: #fee2e2; color: #dc2626; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600;">
                            ğŸ—‘ï¸ È˜terge
                        </button>
                    </div>
                `;
            });
            
            const grandTotal = totalCost + totalTransport;
            
            html += `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px; padding: 15px; margin-top: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; opacity: 0.9; font-size: 14px;">
                        <span>Cost Servicii:</span>
                        <span style="font-weight: 600;">${totalCost} RON</span>
                    </div>
                    ${totalTransport > 0 ? `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; opacity: 0.9; font-size: 14px;">
                        <span>Cost Transport:</span>
                        <span style="font-weight: 600;">${totalTransport} RON</span>
                    </div>
                    ` : ''}
                    <div style="border-top: 2px solid rgba(255,255,255,0.3); padding-top: 10px; margin-top: 10px;">
                        <div style="text-align: center;">
                            <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px;">Cost Total</div>
                            <div style="font-size: 28px; font-weight: 800;">${grandTotal} RON</div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('colaboratoriModal');
            if (event.target === modal) {
                closeColaboratoriModal();
            }
        });
        
        // AI Photo Processing Function
        async function processPhotoWithAI(input) {
            const file = input.files[0];
            if (!file) return;
            
            // Show preview
            const preview = document.getElementById('photoPreview');
            const previewImage = document.getElementById('previewImage');
            preview.style.display = 'block';
            
            // Display image
            const reader = new FileReader();
            reader.onload = async function(e) {
                previewImage.src = e.target.result;
                
                // Convert to base64
                const base64Image = e.target.result.split(',')[1];
                
                // Call Claude AI API
                try {
                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 2000,
                            messages: [{
                                role: 'user',
                                content: [
                                    {
                                        type: 'image',
                                        source: {
                                            type: 'base64',
                                            media_type: file.type,
                                            data: base64Image
                                        }
                                    },
                                    {
                                        type: 'text',
                                        text: `AnalizeazÄƒ aceastÄƒ imagine È™i extrage TOATE informaÈ›iile pentru un formular de eveniment petrecere copii. RÄƒspunde DOAR cu un obiect JSON valid, fÄƒrÄƒ text suplimentar. CÃ¢mpurile sunt:

{
  "dataFormular": "zi/luna/an (ex: 09/11/2025)",
  "nume": "nume client",
  "prenume": "prenume client", 
  "telefon": "telefon cu +40",
  "sursa": "de unde a venit (Facebook/Instagram/Recomandare/Site/TikTok/Alte)",
  "titlu": "titlu/personaj petrecere (ex: Chase + Skye, Elsa, Vata + Popcorn, Spider-Man + Iron Man)",
  "personaj": "personaj petrecere (ex: Chase + Skye, Elsa, Vata + Popcorn)",
  "dataPetrecere": "zi/luna/an",
  "oraPetrecere": "HH:MM (24h)",
  "durata": "numar minute (ex: 180)",
  "durataText": "text exact cum scrie durata (ex: 'Pentru cate ore: 2h', 'Vata 2 ore Popcorn 1 ora', 'Chase 2h Skye 3h')",
  "varsta": "numar ani",
  "numarCopii": "numar",
  "adresa": "adresa completa",
  "detaliiAdresa": "detalii extra",
  "sofer": "DA/NU",
  "avans": "suma RON",
  "rest": "suma RON", 
  "total": "suma RON totalÄƒ",
  "preturiDetaliate": "text exact cu preÈ›uri per serviciu/rol dacÄƒ sunt specificate (ex: 'Ana 600 RON, Elsa 600 RON, Vata si Popcorn 300 RON' sau '2 ore Ana 600, 2 ore Elsa 600')",
  "observatii": "text liber"
}

IMPORTANT: 
- RÄƒspunde DOAR cu JSON-ul, fÄƒrÄƒ explicaÈ›ii sau text suplimentar. 
- Pentru "titlu" È™i "personaj" extrage numele personajelor/caracterelor din petrecere (de obicei sunt la fel).
- Pentru "durataText" extrage exact textul complet cum scrie la durata/pentru cate ore, inclusiv dacÄƒ sunt mai multe roluri cu durate diferite.
- Pentru "preturiDetaliate" cautÄƒ Ã®n toatÄƒ poza dacÄƒ sunt menÈ›ionate preÈ›uri separate pentru fiecare serviciu/personaj/rol È™i extrage textul exact.
- DacÄƒ un cÃ¢mp nu e vizibil, pune null.`
                                    }
                                ]
                            }]
                        })
                    });
                    
                    const data = await response.json();
                    let jsonText = data.content[0].text;
                    
                    // Clean JSON response
                    jsonText = jsonText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                    
                    const extractedData = JSON.parse(jsonText);
                    
                    // Fill form fields
                    fillFormFromAI(extractedData);
                    
                    // Hide preview after 2 seconds
                    setTimeout(() => {
                        preview.style.display = 'none';
                        alert('âœ… Formular completat automat cu date din pozÄƒ!');
                    }, 2000);
                    
                } catch (error) {
                    console.error('AI Processing Error:', error);
                    alert('âŒ Eroare la procesarea imaginii. ÃncearcÄƒ din nou sau completeazÄƒ manual.');
                    preview.style.display = 'none';
                }
            };
            
            reader.readAsDataURL(file);
        }
        
        function fillFormFromAI(data) {
            // Helper function to safely set value
            const setValue = (name, value) => {
                if (value && value !== null && value !== 'null') {
                    const element = document.querySelector(`[name="${name}"]`);
                    if (element) {
                        element.value = value;
                        // Trigger change event for any listeners
                        element.dispatchEvent(new Event('change', { bubbles: true }));
                    }
                }
            };
            
            // Process duration text and create durataDisplay
            if (data.durataText) {
                const durataInfo = parseDurationText(data.durataText, data.titlu || data.personaj);
                // Store the parsed duration info for later use
                window.currentEventDurataInfo = durataInfo;
                console.log('ğŸ“Š Parsed duration info:', durataInfo);
            }
            
            // Process prices text and create price breakdown
            if (data.preturiDetaliate || data.total) {
                const priceBreakdown = parsePricesText(data.preturiDetaliate, data.titlu || data.personaj, data.total);
                // Store the parsed price breakdown for later use
                window.currentEventPriceBreakdown = priceBreakdown;
                console.log('ğŸ’° Parsed price breakdown:', priceBreakdown);
            }
            
            // Combine dataPetrecere + oraPetrecere into dataOraPetrecere (datetime-local format)
            if (data.dataPetrecere && data.oraPetrecere) {
                try {
                    // Parse date: "15/12/2025" or "15 decembrie 2025"
                    let dateStr = data.dataPetrecere;
                    let year, month, day;
                    
                    // Try format: dd/mm/yyyy
                    if (dateStr.includes('/')) {
                        const parts = dateStr.split('/');
                        day = parts[0].padStart(2, '0');
                        month = parts[1].padStart(2, '0');
                        year = parts[2];
                    } 
                    // Try format: dd month yyyy (ro format)
                    else if (dateStr.match(/\d+\s+\w+\s+\d+/)) {
                        const monthNames = {
                            'ianuarie': '01', 'februarie': '02', 'martie': '03', 'aprilie': '04',
                            'mai': '05', 'iunie': '06', 'iulie': '07', 'august': '08',
                            'septembrie': '09', 'octombrie': '10', 'noiembrie': '11', 'decembrie': '12'
                        };
                        const parts = dateStr.split(' ');
                        day = parts[0].padStart(2, '0');
                        month = monthNames[parts[1].toLowerCase()] || '01';
                        year = parts[2];
                    }
                    
                    // Parse time: "14:00" or "14:30"
                    let timeStr = data.oraPetrecere;
                    if (!timeStr.includes(':')) {
                        timeStr = timeStr + ':00';
                    }
                    
                    // Format: YYYY-MM-DDTHH:MM
                    const datetimeLocal = `${year}-${month}-${day}T${timeStr}`;
                    setValue('dataOraPetrecere', datetimeLocal);
                    
                    console.log('âœ… Combined datetime:', datetimeLocal);
                } catch (error) {
                    console.error('Error combining date/time:', error);
                    // Fallback to individual fields
                    setValue('dataPetrecere', data.dataPetrecere);
                    setValue('oraPetrecere', data.oraPetrecere);
                }
            }
            
            // Fill all fields
            setValue('dataFormular', data.dataFormular);
            setValue('nume', data.nume);
            setValue('prenume', data.prenume);
            setValue('telefon', data.telefon);
            setValue('sursa', data.sursa);
            setValue('titlu', data.titlu || data.personaj); // Use titlu or fallback to personaj
            setValue('personaj', data.personaj);
            setValue('durata', data.durata);
            setValue('varsta', data.varsta);
            setValue('numarCopii', data.numarCopii);
            setValue('adresa', data.adresa);
            setValue('detaliiAdresa', data.detaliiAdresa);
            setValue('sofer', data.sofer);
            setValue('avans', data.avans);
            setValue('rest', data.rest);
            setValue('total', data.total);
            setValue('observatii', data.observatii);
            
            // Trigger live parsing for titlu if it was filled
            if (data.titlu || data.personaj) {
                if (typeof parseTitluLive === 'function') {
                    parseTitluLive();
                }
            }
            
            console.log('âœ… Form filled with AI data:', data);
        }
        
        // Parse duration text to create proper structure
        function parseDurationText(durataText, titlu) {
            if (!titlu) return null;
            
            // Search for durations in BOTH titlu and durataText
            const textToSearch = (titlu + ' ' + (durataText || '')).toLowerCase();
            const titluLower = titlu.toLowerCase();
            const roles = [];
            
            // Extract all role names from titlu field
            // Split by: +, È™i, si, ,
            const allRolesInTitlu = titlu.split(/[+,]|È™i|si/).map(r => r.trim()).filter(r => r.length > 0);
            
            console.log('ğŸ“‹ Toate rolurile din titlu:', allRolesInTitlu);
            console.log('ğŸ” Text de cÄƒutat durate:', textToSearch);
            
            // Pattern: Look for "RoleName ore/h" or "RoleName si AltRol ore/h" in TITLU
            // Examples: "Ana È™i Elsa 2 ore", "Vata 1 ora", "Chase 2h"
            const roleGroupWithDurationPattern = /([\w\sÄƒÃ¢Ã®È›È™]+?)\s+(\d+)\s*(h|ore|ora|hour|hours)/gi;
            const matches = [...titluLower.matchAll(roleGroupWithDurationPattern)];
            
            console.log('ğŸ” Durate detectate Ã®n titlu:', matches.map(m => `"${m[1].trim()}" = ${m[2]}${m[3]}`));
            
            // If we found specific durations in titlu
            if (matches.length > 0) {
                const rolesWithDuration = new Set();
                const roleGroups = [];
                
                // Process roles that HAVE explicit durations in titlu
                matches.forEach(match => {
                    const textBeforeDuration = match[1].trim();
                    const hours = parseInt(match[2]);
                    
                    console.log(`\nğŸ¯ Processing: "${textBeforeDuration}" = ${hours} ore`);
                    
                    // This text might be: "Ana È™i Elsa" or just "Ana"
                    // Split to find individual roles
                    const rolesInThisGroup = textBeforeDuration.split(/È™i|si/).map(r => r.trim()).filter(r => r.length > 0);
                    
                    console.log(`   Roluri Ã®n grup: ${rolesInThisGroup.join(', ')}`);
                    
                    // Match each detected role with roles from titlu
                    const matchedRoles = [];
                    rolesInThisGroup.forEach(detectedRole => {
                        const normalized = detectedRole.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                        
                        const matchingRole = allRolesInTitlu.find(r => {
                            const rNorm = r.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                            return rNorm.includes(normalized) || normalized.includes(rNorm);
                        });
                        
                        if (matchingRole && !rolesWithDuration.has(matchingRole)) {
                            matchedRoles.push(matchingRole);
                            rolesWithDuration.add(matchingRole);
                        }
                    });
                    
                    if (matchedRoles.length > 0) {
                        // Each matched role gets its own duplicate with this duration
                        matchedRoles.forEach(role => {
                            roleGroups.push({
                                roles: [role],
                                ore: hours,
                                minute: hours * 60,
                                isGroup: false
                            });
                            console.log(`   âœ… ${role} â†’ ${hours} ore (individual)`);
                        });
                    }
                });
                
                // Now, find roles WITHOUT explicit durations - group them together
                const rolesWithoutDuration = allRolesInTitlu.filter(r => !rolesWithDuration.has(r));
                
                console.log(`\nğŸ‘¥ Roluri fÄƒrÄƒ duratÄƒ explicitÄƒ: ${rolesWithoutDuration.join(', ')}`);
                
                if (rolesWithoutDuration.length > 0) {
                    // These roles are grouped together (same person does all)
                    // Try to find a generic duration
                    const genericDurationPattern = /(\d+)\s*(h|ore|ora|hour|hours)/i;
                    const genericMatch = (durataText || textToSearch).match(genericDurationPattern);
                    
                    let groupHours = 2; // default for grouped roles
                    if (genericMatch) {
                        groupHours = parseInt(genericMatch[1]);
                    } else if (rolesWithoutDuration.length === 2) {
                        // "VatÄƒ È™i Popcorn" without duration = assume 1h each = 2h total
                        groupHours = 2;
                    }
                    
                    roleGroups.push({
                        roles: rolesWithoutDuration,
                        ore: groupHours,
                        minute: groupHours * 60,
                        isGroup: true
                    });
                    
                    console.log(`   âœ… Grup: ${rolesWithoutDuration.join(' È™i ')} â†’ ${groupHours} ore (grupat)`);
                }
                
                // Create durataDisplay
                let durataDisplay;
                if (roleGroups.length === 1 && roleGroups[0].isGroup) {
                    // All roles grouped: "Chase + Skye pentru 2 ore"
                    durataDisplay = `${roleGroups[0].roles.join(' + ')} pentru ${roleGroups[0].ore} ${roleGroups[0].ore === 1 ? 'orÄƒ' : 'ore'}`;
                } else {
                    // Mixed or all separate: "2 ore Ana + 2 ore Elsa + VatÄƒ È™i Popcorn"
                    durataDisplay = roleGroups.map(group => {
                        if (group.isGroup) {
                            return group.roles.join(' È™i ');
                        } else {
                            return `${group.ore} ${group.ore === 1 ? 'orÄƒ' : 'ore'} ${group.roles[0]}`;
                        }
                    }).join(' + ');
                }
                
                console.log(`\nğŸ“Š Final: ${roleGroups.length} duplicate-uri`);
                console.log(`ğŸ“ Display: ${durataDisplay}`);
                
                return {
                    type: roleGroups.length > 1 || roleGroups[0].isGroup ? 'multiple' : 'single',
                    roleGroups: roleGroups,
                    durataDisplay: durataDisplay
                };
            }
            
            // Fallback: Single duration for ALL roles "Pentru cate ore: 2h" or "Durata: 2 ore"
            const singleDurationPattern = /(\d+)\s*(h|ore|ora|hour|hours)/i;
            const singleMatch = textToSearch.match(singleDurationPattern);
            
            if (singleMatch) {
                const hours = parseInt(singleMatch[1]);
                
                // All roles get same duration, each as separate duplicate
                const roleGroups = allRolesInTitlu.map(rol => ({
                    roles: [rol],
                    ore: hours,
                    minute: hours * 60,
                    isGroup: false
                }));
                
                const durataDisplay = `${allRolesInTitlu.join(' + ')} pentru ${hours} ${hours === 1 ? 'orÄƒ' : 'ore'}`;
                
                console.log(`\nğŸ“Š Fallback: ToÈ›i ${allRolesInTitlu.length} cu ${hours} ore fiecare`);
                
                return {
                    type: 'single',
                    roleGroups: roleGroups,
                    durataDisplay: durataDisplay,
                    ore: hours
                };
            }
            
            return null;
        }
        
        // Parse prices text to extract price breakdown per role/service
        function parsePricesText(preturiDetaliate, titlu, totalGeneral) {
            if (!titlu) return null;
            
            const priceBreakdown = [];
            let foundPrices = false;
            
            // Extract all role names from titlu
            const allRolesInTitlu = titlu.split(/[+,]|È™i|si/).map(r => r.trim()).filter(r => r.length > 0);
            
            console.log('ğŸ’° Parsare preÈ›uri pentru roluri:', allRolesInTitlu);
            
            if (preturiDetaliate) {
                const text = preturiDetaliate.toLowerCase();
                console.log('ğŸ’° Text preÈ›uri:', preturiDetaliate);
                
                // Pattern: "Ana 600 RON" or "Ana 600" or "2 ore Ana 600"
                const pricePattern = /([\w\sÄƒÃ¢Ã®È›È™]+?)\s*(\d+)\s*(?:ron|lei)?/gi;
                const matches = [...text.matchAll(pricePattern)];
                
                console.log('ğŸ’° Matches gÄƒsite:', matches.length);
                
                if (matches.length > 0) {
                    const rolesWithPrice = new Set();
                    
                    matches.forEach(match => {
                        const textBeforePrice = match[1].trim();
                        const price = parseInt(match[2]);
                        
                        // Remove duration text if present (e.g., "2 ore Ana" -> "Ana")
                        const cleanText = textBeforePrice.replace(/\d+\s*(ore|ora|h|hour|hours)/gi, '').trim();
                        
                        console.log(`   Checking: "${cleanText}" = ${price} RON`);
                        
                        // This might be: "Ana È™i Elsa" or just "Ana"
                        const rolesInText = cleanText.split(/È™i|si/).map(r => r.trim()).filter(r => r.length > 0);
                        
                        rolesInText.forEach(detectedRole => {
                            const normalized = detectedRole.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                            
                            const matchingRole = allRolesInTitlu.find(r => {
                                const rNorm = r.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                                return rNorm.includes(normalized) || normalized.includes(rNorm);
                            });
                            
                            if (matchingRole && !rolesWithPrice.has(matchingRole)) {
                                priceBreakdown.push({
                                    rol: matchingRole,
                                    pret: price
                                });
                                rolesWithPrice.add(matchingRole);
                                foundPrices = true;
                                console.log(`   âœ… ${matchingRole} = ${price} RON`);
                            }
                        });
                    });
                    
                    // Roles without explicit prices - distribute remaining amount equally
                    const rolesWithoutPrice = allRolesInTitlu.filter(r => !rolesWithPrice.has(r));
                    
                    if (rolesWithoutPrice.length > 0 && totalGeneral) {
                        const totalAssigned = priceBreakdown.reduce((sum, item) => sum + item.pret, 0);
                        const remaining = parseInt(totalGeneral) - totalAssigned;
                        
                        if (remaining > 0) {
                            const pricePerRole = Math.round(remaining / rolesWithoutPrice.length);
                            
                            rolesWithoutPrice.forEach(rol => {
                                priceBreakdown.push({
                                    rol: rol,
                                    pret: pricePerRole
                                });
                                console.log(`   ğŸ’¡ ${rol} = ${pricePerRole} RON (calculat)`);
                            });
                        }
                    }
                }
            }
            
            // Fallback: No prices found, distribute total equally
            if (!foundPrices && totalGeneral && allRolesInTitlu.length > 0) {
                const pricePerRole = Math.round(parseInt(totalGeneral) / allRolesInTitlu.length);
                
                allRolesInTitlu.forEach(rol => {
                    priceBreakdown.push({
                        rol: rol,
                        pret: pricePerRole
                    });
                });
                
                console.log(`ğŸ’¡ Fallback: ÃmpÄƒrÈ›it ${totalGeneral} la ${allRolesInTitlu.length} roluri = ${pricePerRole} RON/rol`);
            }
            
            return priceBreakdown.length > 0 ? priceBreakdown : null;
        }
        
        // Team Management Functions
        function addTeamMember() {
            document.getElementById('addMemberModal').style.display = 'flex';
        }
        
        function closeAddMemberModal() {
            document.getElementById('addMemberModal').style.display = 'none';
            document.getElementById('addMemberForm').reset();
        }
        
        async function submitNewMember(event) {
            event.preventDefault();
            
            const nume = document.getElementById('newMemberName').value;
            const cod = document.getElementById('newMemberCode').value;
            const telefon = document.getElementById('newMemberPhone').value;
            const email = document.getElementById('newMemberEmail').value;
            const rol = document.getElementById('newMemberRole').value || 'Membru';
            
            // Validate code format
            const codePattern = /^[A-Z]\d{1,2}$/;
            if (!codePattern.test(cod)) {
                alert('âŒ Cod invalid! FoloseÈ™te format: A1-Z50 (literÄƒ mare + numÄƒr 1-50)');
                return;
            }
            
            // Validate number range
            const letter = cod.charAt(0);
            const number = parseInt(cod.substring(1));
            if (number < 1 || number > 50) {
                alert('âŒ NumÄƒrul trebuie sÄƒ fie Ã®ntre 1 È™i 50!');
                return;
            }
            
            const colors = [
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',
                'linear-gradient(135deg, #ec4899 0%, #be185d 100%)',
                'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)'
            ];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            
            try {
                // Save to Supabase
                const { data, error } = await supabase
                    .from('team_members')
                    .insert([{
                        nume: nume,
                        cod_trainer: cod,
                        telefon: telefon,
                        email: email,
                        rol: rol,
                        status: 'invited',
                        avatar_color: randomColor
                    }])
                    .select();
                
                if (error) {
                    console.error('Supabase error:', error);
                    alert('âŒ Eroare la salvare: ' + error.message);
                    return;
                }
                
                console.log('âœ… Membru salvat Ã®n Supabase:', data);
                
                // Add to table UI
                addMemberToTable(data[0], randomColor);
                
                // Close modal and reset form
                closeAddMemberModal();
                
                // Show success message
                alert(`âœ… Membru adÄƒugat cu succes!\n\nğŸ“§ InvitaÈ›ie va fi trimisÄƒ la: ${email}\n\nMembrul este acum Ã®n baza de date!`);
                
            } catch (error) {
                console.error('Error:', error);
                alert('âŒ Eroare: ' + error.message);
            }
        }
        
        function addMemberToTable(memberData, avatarColor) {
            const tableBody = document.getElementById('teamTableBody');
            const initial = memberData.nume.charAt(0).toUpperCase();
            
            const rolColors = {
                'animator': 'background: #dcfce7; color: #16a34a;',
                'sofer': 'background: #dbeafe; color: #2563eb;',
                'asistent': 'background: #fef3c7; color: #d97706;',
                'fotograf': 'background: #fce7f3; color: #db2777;',
                'manager': 'background: #f3e8ff; color: #7c3aed;',
                'default': 'background: #f3f4f6; color: #6b7280;'
            };
            
            const rolLower = memberData.rol ? memberData.rol.toLowerCase() : '';
            let rolStyle = rolColors.default;
            if (rolLower.includes('animator')) rolStyle = rolColors.animator;
            else if (rolLower.includes('sofer') || rolLower.includes('È™ofer')) rolStyle = rolColors.sofer;
            else if (rolLower.includes('asistent')) rolStyle = rolColors.asistent;
            else if (rolLower.includes('fotograf')) rolStyle = rolColors.fotograf;
            else if (rolLower.includes('manager')) rolStyle = rolColors.manager;
            
            const newRow = document.createElement('tr');
            newRow.style.borderBottom = '1px solid #f3f4f6';
            newRow.setAttribute('data-id', memberData.id);
            newRow.setAttribute('data-email', memberData.email);
            newRow.innerHTML = `
                <td style="padding: 15px; color: #111827; font-weight: 500;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: ${avatarColor}; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 16px;">
                            ${initial}
                        </div>
                        <span>${memberData.nume}</span>
                    </div>
                </td>
                <td style="padding: 15px; color: #6b7280;">
                    <span style="color: #667eea; font-weight: 500;">ğŸ“ ${memberData.telefon}</span>
                </td>
                <td style="padding: 15px; color: #6b7280;">
                    <span style="background: #f3f4f6; padding: 6px 12px; border-radius: 8px; font-weight: 600; color: #667eea;">${memberData.cod_trainer}</span>
                </td>
                <td style="padding: 15px;">
                    <span style="${rolStyle} padding: 6px 12px; border-radius: 8px; font-weight: 600; font-size: 13px;">${memberData.rol || 'Membru'}</span>
                </td>
                <td style="padding: 15px; text-align: center;">
                    <button onclick="editTeamMember(this)" style="background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; margin-right: 8px; font-size: 13px;">âœï¸ EditeazÄƒ</button>
                    <button onclick="deleteTeamMember(this)" style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 13px;">ğŸ—‘ï¸ È˜terge</button>
                </td>
            `;
            
            tableBody.appendChild(newRow);
        }
        
        function editTeamMember(button) {
            const row = button.closest('tr');
            const cells = row.querySelectorAll('td');
            
            const numeSpan = cells[0].querySelector('span');
            const telefonSpan = cells[1].querySelector('span');
            const codSpan = cells[2].querySelector('span');
            const rolSpan = cells[3].querySelector('span');
            
            const newNume = prompt('Nume nou:', numeSpan.textContent);
            if (newNume) numeSpan.textContent = newNume;
            
            const currentTelefon = telefonSpan.textContent.replace('ğŸ“ ', '');
            const newTelefon = prompt('Telefon nou:', currentTelefon);
            if (newTelefon) telefonSpan.innerHTML = 'ğŸ“ ' + newTelefon;
            
            const newCod = prompt('Cod nou:', codSpan.textContent);
            if (newCod) codSpan.textContent = newCod;
            
            const newRol = prompt('Rol nou:', rolSpan.textContent);
            if (newRol) rolSpan.textContent = newRol;
            
            alert('âœ… Membru actualizat!');
        }
        
        function deleteTeamMember(button) {
            if (confirm('Sigur vrei sÄƒ È™tergi acest membru?')) {
                const row = button.closest('tr');
                row.remove();
                alert('âœ… Membru È™ters!');
            }
        }
        
        // FuncÈ›ie pentru Ã®ncÄƒrcarea evenimentelor cu facturÄƒ
        async function loadEvenimenteCuFactura() {
            try {
                // Interogare Supabase pentru evenimente cu metodÄƒ platÄƒ = FacturÄƒ
                const { data, error } = await supabase
                    .from('evenimente')
                    .select('*')
                    .eq('metoda_plata', 'FacturÄƒ')
                    .order('data_petrecere', { ascending: false });
                
                if (error) {
                    console.error('Eroare la Ã®ncÄƒrcarea evenimentelor cu facturÄƒ:', error);
                    return;
                }
                
                // CalculeazÄƒ statistici
                const totalFacturi = data.length;
                const sumaFacturi = data.reduce((sum, evt) => sum + (parseFloat(evt.total) || 0), 0);
                
                // ActualizeazÄƒ statisticile
                document.getElementById('totalFacturi').textContent = totalFacturi;
                document.getElementById('sumaFacturi').textContent = sumaFacturi.toFixed(2) + ' RON';
                
                // GenereazÄƒ lista evenimentelor
                const listaFacturi = document.getElementById('listaFacturi');
                
                if (data.length === 0) {
                    listaFacturi.innerHTML = `
                        <p style="text-align: center; color: #6b7280; padding: 40px 0;">
                            ğŸ“„ Nu existÄƒ evenimente cu facturÄƒ Ã®ncÄƒ
                        </p>
                    `;
                    return;
                }
                
                // CreazÄƒ HTML pentru fiecare eveniment
                let html = '<div style="display: flex; flex-direction: column; gap: 15px;">';
                
                data.forEach(eveniment => {
                    const dataFormatata = eveniment.data_petrecere ? new Date(eveniment.data_petrecere).toLocaleDateString('ro-RO') : 'N/A';
                    const oraFormatata = eveniment.ora_petrecere || 'N/A';
                    
                    html += `
                        <div style="border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; background: #f9fafb; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.borderColor='#667eea'" onmouseout="this.style.borderColor='#e5e7eb'">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                <div>
                                    <div style="font-size: 18px; font-weight: 700; color: #111827; margin-bottom: 5px;">
                                        ğŸ‰ ${eveniment.personaj || 'Eveniment'}
                                    </div>
                                    <div style="color: #6b7280; font-size: 14px;">
                                        ğŸ‘¤ ${eveniment.nume || ''} ${eveniment.prenume || ''} | ğŸ“ ${eveniment.telefon || 'N/A'}
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 16px; border-radius: 20px; font-weight: 700; font-size: 16px;">
                                        ${parseFloat(eveniment.total || 0).toFixed(2)} RON
                                    </div>
                                    <div style="margin-top: 5px;">
                                        <span style="background: #dcfce7; color: #16a34a; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                            ğŸ§¾ FacturÄƒ
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
                                <div>
                                    <span style="color: #6b7280; font-size: 13px;">ğŸ“… Data:</span>
                                    <span style="color: #111827; font-weight: 600; margin-left: 5px;">${dataFormatata}</span>
                                </div>
                                <div>
                                    <span style="color: #6b7280; font-size: 13px;">â° Ora:</span>
                                    <span style="color: #111827; font-weight: 600; margin-left: 5px;">${oraFormatata}</span>
                                </div>
                                <div>
                                    <span style="color: #6b7280; font-size: 13px;">ğŸ‘¶ VÃ¢rstÄƒ:</span>
                                    <span style="color: #111827; font-weight: 600; margin-left: 5px;">${eveniment.varsta || 'N/A'} ani</span>
                                </div>
                                <div>
                                    <span style="color: #6b7280; font-size: 13px;">ğŸ‘¥ Copii:</span>
                                    <span style="color: #111827; font-weight: 600; margin-left: 5px;">${eveniment.numar_copii || 'N/A'}</span>
                                </div>
                            </div>
                            
                            ${eveniment.adresa ? `
                                <div style="margin-top: 12px; padding: 10px; background: white; border-radius: 8px;">
                                    <span style="color: #6b7280; font-size: 13px;">ğŸ“ AdresÄƒ:</span>
                                    <span style="color: #111827; font-weight: 500; margin-left: 5px;">${eveniment.adresa}</span>
                                </div>
                            ` : ''}
                            
                            ${eveniment.observatii ? `
                                <div style="margin-top: 12px; padding: 10px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                                    <span style="color: #92400e; font-size: 13px; font-weight: 600;">ğŸ“ ObservaÈ›ii:</span>
                                    <p style="color: #78350f; margin: 5px 0 0 0; font-size: 14px;">${eveniment.observatii}</p>
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                html += '</div>';
                listaFacturi.innerHTML = html;
                
                console.log('âœ… ÃncÄƒrcate', totalFacturi, 'evenimente cu facturÄƒ');
                
            } catch (error) {
                console.error('Eroare la Ã®ncÄƒrcarea evenimentelor cu facturÄƒ:', error);
                alert('âŒ Eroare la Ã®ncÄƒrcarea datelor: ' + error.message);
            }
        }
        
        // ============================================
        // ADMIN MODE FUNCTIONS
        // ============================================
        
        let isAdminMode = false;
        const ADMIN_PASSWORD = 'Andrei209512!0728242214';
        
        // ============================================================
        // FUNCÈšII PENTRU PAGINA SECRETÄ‚
        // ============================================================
        
        function checkPasswordAndShowSecret() {
            console.log('ğŸ”’ Deschid modal parola - APELAT DE BUTON');
            const modal = document.getElementById('passwordModal');
            const input = document.getElementById('passwordInput');
            
            if (!modal) {
                console.error('âŒ Modal nu existÄƒ!');
                return;
            }
            
            modal.style.display = 'flex';
            input.value = '';
            
            // Focus pe input dupÄƒ o micÄƒ Ã®ntÃ¢rziere
            setTimeout(() => {
                input.focus();
            }, 100);
            
            // Permite Enter pentru submit
            input.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    submitPassword();
                }
            };
        }
        
        // NEW: Admin Password Prompt
        function showAdminPasswordPrompt() {
            console.log('ğŸ”’ Opening Admin password prompt');
            const modal = document.getElementById('passwordModal');
            const input = document.getElementById('passwordInput');
            
            if (!modal) {
                console.error('âŒ Modal does not exist!');
                return;
            }
            
            // Update modal content for Admin
            const modalContent = modal.querySelector('.password-modal-content');
            if (modalContent) {
                modalContent.querySelector('h3').textContent = 'ğŸ”’ Mod Admin';
                modalContent.querySelector('p').textContent = 'Introdu parola pentru a accesa Mod Admin';
                modalContent.querySelector('input').setAttribute('maxlength', '100'); // Remove 4-char limit
            }
            
            modal.style.display = 'flex';
            input.value = '';
            
            // Focus on input
            setTimeout(() => {
                input.focus();
            }, 100);
            
            // Set up Enter key submit
            input.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    submitAdminPassword();
                }
            };
            
            // Update submit button action
            const submitBtn = modal.querySelector('.password-submit');
            if (submitBtn) {
                submitBtn.onclick = submitAdminPassword;
            }
        }
        
        // NEW: GM Password Prompt
        function showGMPasswordPrompt() {
            console.log('ğŸ® Opening GM password prompt');
            const modal = document.getElementById('passwordModal');
            const input = document.getElementById('passwordInput');
            
            if (!modal) {
                console.error('âŒ Modal does not exist!');
                return;
            }
            
            // Update modal content for GM
            const modalContent = modal.querySelector('.password-modal-content');
            if (modalContent) {
                modalContent.querySelector('h3').textContent = 'ğŸ® Mod GM';
                modalContent.querySelector('p').textContent = 'Introdu parola pentru a accesa Mod GM';
                modalContent.querySelector('input').setAttribute('maxlength', '100'); // Remove 4-char limit
            }
            
            modal.style.display = 'flex';
            input.value = '';
            
            // Focus on input
            setTimeout(() => {
                input.focus();
            }, 100);
            
            // Set up Enter key submit
            input.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    submitGMPassword();
                }
            };
            
            // Update submit button action
            const submitBtn = modal.querySelector('.password-submit');
            if (submitBtn) {
                submitBtn.onclick = submitGMPassword;
            }
        }
        
        // NEW: Submit Admin Password
        function submitAdminPassword() {
            const password = document.getElementById('passwordInput').value;
            console.log('ğŸ” Checking Admin password...');
            
            if (password === 'Adminandrei209512!') {
                console.log('âœ… Admin password correct!');
                closePasswordModal();
                
                // Show Admin section in sidebar
                const adminSection = document.getElementById('adminMenuSection');
                console.log('ğŸ” adminMenuSection element:', adminSection);
                
                if (adminSection) {
                    adminSection.style.display = 'block';
                    console.log('âœ… Admin section shown!');
                } else {
                    console.error('âŒ adminMenuSection NOT FOUND!');
                }
                
                // Auto-expand Admin menu
                const adminItems = document.getElementById('adminMenuItems');
                const adminToggle = document.getElementById('adminMenuToggle');
                
                if (adminItems) {
                    adminItems.style.display = 'block';
                    console.log('âœ… Admin items expanded!');
                }
                if (adminToggle) {
                    adminToggle.textContent = 'â–²';
                }
                
                // Show Mod Admin page (pagina-secreta)
                showPage('pagina-secreta');
                
                // Activate first item in Admin menu
                showSecretPage('bifeaza-evenimente-secret');
                
                // Success message
                setTimeout(() => {
                    alert('âœ… Acces permis! Bine ai venit Ã®n Mod Admin!');
                }, 300);
            } else {
                console.log('âŒ Wrong Admin password');
                alert('âŒ ParolÄƒ greÈ™itÄƒ! ÃncearcÄƒ din nou.');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }
        
        // NEW: Submit GM Password
        function submitGMPassword() {
            const password = document.getElementById('passwordInput').value;
            console.log('ğŸ” Checking GM password...');
            
            if (password === 'Gmandrei209512!') {
                console.log('âœ… GM password correct!');
                closePasswordModal();
                
                // Show GM section in sidebar
                const gmSection = document.getElementById('gmMenuSection');
                console.log('ğŸ” gmMenuSection element:', gmSection);
                
                if (gmSection) {
                    gmSection.style.display = 'block';
                    console.log('âœ… GM section shown!');
                } else {
                    console.error('âŒ gmMenuSection NOT FOUND!');
                }
                
                // Auto-expand GM menu
                const gmItems = document.getElementById('gmMenuItems');
                const gmToggle = document.getElementById('gmMenuToggle');
                
                if (gmItems) {
                    gmItems.style.display = 'block';
                    console.log('âœ… GM items expanded!');
                }
                if (gmToggle) {
                    gmToggle.textContent = 'â–²';
                }
                
                // Show Mod GM page
                showPage('mod-gm');
                
                // Success message
                setTimeout(() => {
                    alert('âœ… Acces permis! Bine ai venit Ã®n Mod GM!');
                }, 300);
            } else {
                console.log('âŒ Wrong GM password');
                alert('âŒ ParolÄƒ greÈ™itÄƒ! ÃncearcÄƒ din nou.');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }

        function closePasswordModal() {
            console.log('âŒ Modal Ã®nchis');
            document.getElementById('passwordModal').style.display = 'none';
            document.getElementById('passwordInput').value = '';
        }

        function submitPassword() {
            const password = document.getElementById('passwordInput').value;
            console.log('ğŸ” Verific parola...');
            
            if (password === '1234') {
                // ParolÄƒ corectÄƒ
                console.log('âœ… ParolÄƒ corectÄƒ!');
                closePasswordModal();
                showPage('pagina-secreta');
                
                // AratÄƒ meniul secret Ã®n bara lateralÄƒ (OLD - replaced by new structure)
                // document.getElementById('secretMenuSection').style.display = 'block';
                
                // ActiveazÄƒ primul item din meniul secret
                showSecretPage('bifeaza-evenimente-secret');
                
                // Mesaj de succes
                setTimeout(() => {
                    alert('âœ… Acces permis! Bine ai venit Ã®n pagina secretÄƒ!');
                }, 300);
            } else {
                // ParolÄƒ greÈ™itÄƒ
                console.log('âŒ ParolÄƒ greÈ™itÄƒ:', password);
                alert('âŒ ParolÄƒ greÈ™itÄƒ! ÃncearcÄƒ din nou.');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }
        
        // Toggle Admin Menu (expand/collapse)
        function toggleAdminMenu() {
            const menuItems = document.getElementById('adminMenuItems');
            const toggleIcon = document.getElementById('adminMenuToggle');
            
            if (menuItems.style.display === 'none') {
                menuItems.style.display = 'block';
                toggleIcon.textContent = 'â–²';
            } else {
                menuItems.style.display = 'none';
                toggleIcon.textContent = 'â–¼';
            }
        }
        
        // Toggle GM Menu (expand/collapse)
        function toggleGMMenu() {
            const menuItems = document.getElementById('gmMenuItems');
            const toggleIcon = document.getElementById('gmMenuToggle');
            
            if (menuItems.style.display === 'none') {
                menuItems.style.display = 'block';
                toggleIcon.textContent = 'â–²';
            } else {
                menuItems.style.display = 'none';
                toggleIcon.textContent = 'â–¼';
            }
        }
        
        // Toggle Creier AI (show/hide in sidebar or navigate to page)
        function toggleCreierAI() {
            // Navigate to Mod GM page and show Creier AI section
            showPage('mod-gm');
            setTimeout(() => {
                showCreierAI();
            }, 100);
        }
        
        // Logout user - clear login data and reload page
        function logoutUser() {
            console.log('ğŸšª Logging out user...');
            
            // Confirm logout
            if (confirm('ğŸšª EÈ™ti sigur cÄƒ vrei sÄƒ ieÈ™i din cont?')) {
                // Clear all login data from localStorage
                localStorage.removeItem('superparty_logged_in');
                localStorage.removeItem('superparty_username');
                
                // Clear from sessionStorage as well
                sessionStorage.removeItem('superparty_logged_in');
                sessionStorage.removeItem('superparty_username');
                
                // Hide sidebar menu
                const submenu = document.getElementById('intraContSubmenu');
                if (submenu) {
                    submenu.style.display = 'none';
                }
                
                // Hide Admin/GM sections
                const adminSection = document.getElementById('adminMenuSection');
                const gmSection = document.getElementById('gmMenuSection');
                if (adminSection) adminSection.style.display = 'none';
                if (gmSection) gmSection.style.display = 'none';
                
                // Reload page to reset everything
                console.log('âœ… Logout successful - reloading page');
                setTimeout(() => {
                    location.reload();
                }, 300);
            }
        }

        function showSecretPage(pageId) {
            console.log('ğŸ”„ Schimb la secÈ›iunea:', pageId);
            
            // Ascunde toate secÈ›iunile secrete
            document.querySelectorAll('.secret-content').forEach(content => {
                content.style.display = 'none';
                content.classList.remove('active');
            });
            
            // AratÄƒ secÈ›iunea selectatÄƒ
            const selectedContent = document.getElementById(pageId);
            if (selectedContent) {
                selectedContent.style.display = 'block';
                selectedContent.classList.add('active');
            }
            
            // AUTO-LOAD users data when opening Gestionare Utilizatori
            if (pageId === 'gestionare-utilizatori') {
                console.log('ğŸ“Š Loading users data...');
                loadUsersData();
            }
            
            // ActualizeazÄƒ menu items
            document.querySelectorAll('#secretMenuSection .menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // ActiveazÄƒ menu item-ul curent
            const currentMenuItem = Array.from(document.querySelectorAll('#secretMenuSection .menu-item')).find(item => 
                item.getAttribute('onclick') && item.getAttribute('onclick').includes(pageId)
            );
            if (currentMenuItem) {
                currentMenuItem.classList.add('active');
            }
            
            // If showing generate codes page, refresh the list
            if (pageId === 'genereaza-coduri-secret') {
                refreshCodesList();
            }
        }
        
        // ============================================================
        // FUNCÈšII PENTRU ADMIN
        // ============================================================
        
        function checkAdminAccess() {
            if (isAdminMode) {
                alert('âœ… EÈ™ti deja Ã®n modul admin!');
                return;
            }
            
            const password = prompt('ğŸ” Introdu parola de admin:');
            
            if (password === null) return; // User cancelled
            
            if (password === ADMIN_PASSWORD) {
                isAdminMode = true;
                
                // ASCUNDE meniul normal
                document.getElementById('mainMenu').style.display = 'none';
                
                // ARATÄ‚ meniul admin simplificat
                document.getElementById('adminMenu').style.display = 'block';
                
                alert('âœ… Bine ai venit Ã®n modul ADMIN!\n\nAi acces complet la toate funcÈ›iile administrative.');
                
                // MarcheazÄƒ header-ul ca admin
                const header = document.querySelector('.sidebar-header');
                header.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                
                // AdaugÄƒ badge admin
                const byAi = document.querySelector('.by-ai');
                if (!document.getElementById('adminBadge')) {
                    const adminBadge = document.createElement('div');
                    adminBadge.id = 'adminBadge';
                    adminBadge.style.cssText = 'background: #fef2f2; color: #ef4444; padding: 5px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; margin-top: 10px; border: 2px solid #ef4444;';
                    adminBadge.textContent = 'ğŸ” ADMIN';
                    byAi.appendChild(adminBadge);
                }
                
                // Deschide prima paginÄƒ admin
                showPage('bifeaza-evenimente');
            } else {
                alert('âŒ ParolÄƒ incorectÄƒ!');
            }
        }
        
        function logoutAdmin() {
            if (confirm('Sigur vrei sÄƒ ieÈ™i din modul admin?')) {
                isAdminMode = false;
                
                // ASCUNDE meniul admin
                document.getElementById('adminMenu').style.display = 'none';
                
                // ARATÄ‚ meniul normal
                document.getElementById('mainMenu').style.display = 'block';
                
                // ReseteazÄƒ header-ul
                const header = document.querySelector('.sidebar-header');
                header.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                
                // È˜terge badge-ul admin
                const adminBadge = document.getElementById('adminBadge');
                if (adminBadge) adminBadge.remove();
                
                // Revino la pagina principalÄƒ
                showPage('home');
                document.querySelectorAll('.menu-item')[0].click();
                
                alert('âœ… Ai ieÈ™it din modul admin!');
            }
        }
        
        // Admin Functions
        function exportAllData() {
            alert('ğŸ“¥ Export date Ã®n curs...\n\nFuncÈ›ionalitate Ã®n dezvoltare!');
        }
        
        function backupDatabase() {
            alert('ğŸ’¾ Backup database Ã®n curs...\n\nFuncÈ›ionalitate Ã®n dezvoltare!');
        }
        
        function viewLogs() {
            alert('ğŸ“‹ Deschidere log-uri...\n\nFuncÈ›ionalitate Ã®n dezvoltare!');
        }
        
        function clearOldData() {
            if (confirm('âš ï¸ ATENÈšIE!\n\nSigur vrei sÄƒ È™tergi datele vechi?\n\nAceastÄƒ acÈ›iune NU poate fi anulatÄƒ!')) {
                alert('ğŸ—‘ï¸ È˜tergere date Ã®n curs...\n\nFuncÈ›ionalitate Ã®n dezvoltare!');
            }
        }
        
        function regenerateKeys() {
            if (confirm('âš ï¸ ATENÈšIE!\n\nRegenerarea cheilor API va invalida toate conexiunile existente!\n\nContinui?')) {
                alert('ğŸ”„ Regenerare chei Ã®n curs...\n\nFuncÈ›ionalitate Ã®n dezvoltare!');
            }
        }
        
        // FuncÈ›ie pentru gestionarea cÃ¢mpurilor condiÈ›ionale la MetodÄƒ PlatÄƒ
        function handleMetodaPlataChange() {
            const metoda = document.getElementById('metodaPlata').value;
            const campCardPartial = document.getElementById('campCardPartial');
            const campCashPartial = document.getElementById('campCashPartial');
            const sumaCard = document.getElementById('sumaCard');
            const sumaCash = document.getElementById('sumaCash');
            
            // Ascunde toate cÃ¢mpurile mai Ã®ntÃ¢i
            campCardPartial.style.display = 'none';
            campCashPartial.style.display = 'none';
            
            // EliminÄƒ required de pe cÃ¢mpuri
            sumaCard.removeAttribute('required');
            sumaCash.removeAttribute('required');
            
            // AratÄƒ cÃ¢mpul corespunzÄƒtor Ã®n funcÈ›ie de selecÈ›ie
            if (metoda === 'Card partial + Cash rest') {
                campCardPartial.style.display = 'block';
                sumaCard.setAttribute('required', 'required');
            } else if (metoda === 'Cash partial + Card rest') {
                campCashPartial.style.display = 'block';
                sumaCash.setAttribute('required', 'required');
            }
        }
        
        // AtaÈ™eazÄƒ event listener pentru butonul secret admin
        document.addEventListener('DOMContentLoaded', function() {
            // SISTEM 10 CLICKURI SECRETE pentru butonul vizibil
            
            // Event listener pentru robotul din header (backup)
            const adminTrigger = document.getElementById('adminTrigger');
            // Admin trigger dezactivat
            /*
            if (adminTrigger) {
                adminTrigger.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    checkAdminAccess();
                });
                console.log('âœ… Admin trigger activated - Version: ADMIN-v2.0');
            }
            */
            
            // Verificare versiune (pentru debug)
            console.log('ğŸ‰ SuperParty Dashboard v2.3 - Admin Access Disabled');
        });
        
        // ==========================================
        // FILTRU DE DATÄ‚ - TOTAL PETRECERI
        // ==========================================
        
        
        // Load parties from localStorage
        function loadPartiesFromStorage() {
            const stored = localStorage.getItem('superpartyEvents');
            partiesData = stored ? JSON.parse(stored) : [];
            console.log('ğŸ“¦ Loaded from storage:', partiesData.length, 'events');
        }

        // Quick filter functions
        function applyQuickFilter(type) {
            const today = new Date();
            let fromDate, toDate;
            
            switch(type) {
                case 'today':
                    fromDate = toDate = today.toISOString().split('T')[0];
                    break;
                case 'week':
                    fromDate = today.toISOString().split('T')[0];
                    const weekEnd = new Date(today);
                    weekEnd.setDate(today.getDate() + 6);
                    toDate = weekEnd.toISOString().split('T')[0];
                    break;
                case 'month':
                    const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                    const monthEnd = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    fromDate = monthStart.toISOString().split('T')[0];
                    toDate = monthEnd.toISOString().split('T')[0];
                    break;
                case 'year':
                    const yearStart = new Date(today.getFullYear(), 0, 1);
                    const yearEnd = new Date(today.getFullYear(), 11, 31);
                    fromDate = yearStart.toISOString().split('T')[0];
                    toDate = yearEnd.toISOString().split('T')[0];
                    break;
                case 'all':
                    fromDate = '';
                    toDate = '';
                    break;
            }
            
            document.getElementById('dateFrom').value = fromDate;
            document.getElementById('dateTo').value = toDate;
            
            // Auto apply filter
            applyDateFilter();
        }

        // Apply date filter
        function applyDateFilter() {
            loadPartiesFromStorage(); // Reload from storage
            
            const fromDate = document.getElementById('dateFrom').value;
            const toDate = document.getElementById('dateTo').value;
            
            let filteredParties = partiesData;
            
            // Filter by date range
            if (fromDate || toDate) {
                filteredParties = partiesData.filter(party => {
                    const partyDate = party.dateForFilter; // Use the formatted date
                    if (fromDate && toDate) {
                        return partyDate >= fromDate && partyDate <= toDate;
                    } else if (fromDate) {
                        return partyDate >= fromDate;
                    } else if (toDate) {
                        return partyDate <= toDate;
                    }
                    return true;
                });
            }
            
            // Update cards
            updatePartiesCards(filteredParties);
            
            // Show success message
            console.log(`âœ… Filtru aplicat: ${filteredParties.length} petreceri gÄƒsite`);
        }

        // Update parties cards
        function updatePartiesCards(parties) {
            const container = document.getElementById('partiesCardsContainer');
            
            // Filter ONLY MAMA events (not duplicates)
            const mamaParties = parties.filter(p => p.isMama === true);
            
            if (mamaParties.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; padding: 60px; text-align: center; color: #9ca3af; font-size: 16px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“­</div>
                        <div style="font-weight: 600;">Nu existÄƒ petreceri Ã®n intervalul selectat</div>
                        <div style="margin-top: 10px; font-size: 14px;">ÃncearcÄƒ alt interval sau adaugÄƒ evenimente noi</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = mamaParties.map((party, index) => {
                const statusBadge = party.status === 'confirmed' 
                    ? '<div style="background: #d1fae5; color: #065f46; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 700; display: inline-flex; align-items: center; gap: 6px;"><span>âœ…</span><span>Confirmat</span></div>'
                    : '<div style="background: #fef3c7; color: #92400e; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 700; display: inline-flex; align-items: center; gap: 6px;"><span>â³</span><span>Ãn AÈ™teptare</span></div>';
                
                return `
                    <div style="background: white; border: 2px solid #f3f4f6; border-radius: 15px; padding: 20px; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.borderColor='#667eea'; this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(102, 126, 234, 0.2)'" onmouseout="this.style.borderColor='#f3f4f6'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                        <!-- Header Card -->
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 16px; border-radius: 10px; font-size: 16px; font-weight: 700;">
                                #${party.codEveniment || index + 1}
                            </div>
                            ${statusBadge}
                        </div>
                        
                        <!-- Content -->
                        <div style="margin-bottom: 15px;">
                            <div style="font-size: 18px; font-weight: 700; color: #1f2937; margin-bottom: 8px;">
                                ${party.personaj || 'Petrecere'}
                            </div>
                            <div style="font-size: 14px; color: #6b7280; display: flex; align-items: center; gap: 6px; margin-bottom: 5px;">
                                <span>ğŸ“…</span>
                                <span>${party.dataPetrecere || 'N/A'}</span>
                                <span style="margin-left: 5px;">â°</span>
                                <span>${party.oraPetrecere || 'N/A'}</span>
                            </div>
                            <div style="font-size: 14px; color: #6b7280; display: flex; align-items: center; gap: 6px; margin-bottom: 5px;">
                                <span>ğŸ“</span>
                                <span>${party.adresa || party.locatie || 'N/A'}</span>
                            </div>
                            <div style="font-size: 14px; color: #6b7280; display: flex; align-items: center; gap: 6px;">
                                <span>ğŸ“</span>
                                <span>${party.telefon || 'N/A'}</span>
                            </div>
                        </div>
                        
                        <!-- Footer -->
                        <div style="border-top: 1px solid #f3f4f6; padding-top: 15px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-size: 12px; color: #9ca3af; margin-bottom: 3px;">Valoare TotalÄƒ</div>
                                <div style="font-size: 20px; font-weight: 700; color: #10b981;">${parseInt(party.total || 0).toLocaleString('ro-RO')} RON</div>
                            </div>
                            <button onclick="viewPartyDetails(${party.id})" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 14px;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                ğŸ‘ï¸ Detalii
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // View party details
        function viewPartyDetails(partyId) {
            const party = partiesData.find(p => p.id === partyId);
            if (!party) return;
            
            alert(`ğŸ“‹ Detalii Eveniment #${party.codEveniment}\n\n` +
                  `Personaj: ${party.personaj || 'N/A'}\n` +
                  `Data È™i Ora: ${party.dataPetrecere || 'N/A'} la ${party.oraPetrecere || 'N/A'}\n` +
                  `AdresÄƒ: ${party.adresa || 'N/A'}\n` +
                  `Telefon: ${party.telefon || 'N/A'}\n` +
                  `Durata: ${party.durataDisplay || party.durata + ' ore' || 'N/A'}\n` +
                  `Ore vÃ¢ndute: ${party.oreVandute || 'N/A'}\n` +
                  `Persoane necesare: ${party.persoaneNecesare || 'N/A'}\n` +
                  `Total: ${parseInt(party.total || 0).toLocaleString('ro-RO')} RON\n` +
                  `MetodÄƒ platÄƒ: ${party.metodaPlata || 'N/A'}\n` +
                  `Status: ${party.status === 'confirmed' ? 'Confirmat' : 'Ãn AÈ™teptare'}`);
        }
        
        // Load parties for specific trainer
        function loadMyParties() {
            const trainerCode = document.getElementById('myTrainerCode').value.trim().toUpperCase();
            
            if (!trainerCode) {
                alert('âŒ Te rog introdu codul tÄƒu de trainer!\n\nExemplu: A1, B5, Z50');
                return;
            }
            
            // Load from storage
            loadPartiesFromStorage();
            
            // Filter ONLY DUPLICATES (NOT mama) by trainer code
            const myParties = partiesData.filter(party => {
                return party.isMama === false && // ONLY duplicates
                       party.cineNoteaza && 
                       party.cineNoteaza.toUpperCase() === trainerCode;
            });
            
            console.log(`ğŸ¯ Trainer: ${trainerCode} - GÄƒsite ${myParties.length} petreceri (duplicate)`);
            
            // Update title
            document.getElementById('myPartiesTitle').textContent = `ğŸ“‹ Petrecerile Mele (${myParties.length})`;
            
            // Update cards
            updateMyPartiesCards(myParties, trainerCode);
        }
        
        // Update my parties cards
        function updateMyPartiesCards(parties, trainerCode) {
            const container = document.getElementById('myPartiesCardsContainer');
            
            if (parties.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; padding: 60px; text-align: center; color: #9ca3af; font-size: 16px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ˜”</div>
                        <div style="font-weight: 600;">Nu ai petreceri notate cu codul "${trainerCode}"</div>
                        <div style="margin-top: 10px; font-size: 14px;">AdaugÄƒ evenimente noi Ã®n secÈ›iunea "â• NoteazÄƒ Eveniment"</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = parties.map((party, index) => {
                const statusBadge = party.status === 'confirmed' 
                    ? '<div style="background: #d1fae5; color: #065f46; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 700; display: inline-flex; align-items: center; gap: 6px;"><span>âœ…</span><span>Confirmat</span></div>'
                    : '<div style="background: #fef3c7; color: #92400e; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 700; display: inline-flex; align-items: center; gap: 6px;"><span>â³</span><span>Ãn AÈ™teptare</span></div>';
                
                return `
                    <div style="background: white; border: 2px solid #f3f4f6; border-radius: 15px; padding: 20px; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.borderColor='#667eea'; this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(102, 126, 234, 0.2)'" onmouseout="this.style.borderColor='#f3f4f6'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                        <!-- Header Card -->
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 16px; border-radius: 10px; font-size: 16px; font-weight: 700;">
                                #${party.codEveniment || index + 1}
                            </div>
                            ${statusBadge}
                        </div>
                        
                        <!-- Content -->
                        <div style="margin-bottom: 15px;">
                            <div style="font-size: 18px; font-weight: 700; color: #1f2937; margin-bottom: 8px;">
                                ${party.personaj || 'Petrecere'}
                            </div>
                            
                            <!-- Ce personaj vrei sa fi -->
                            <div style="background: ${party.cePersonajVreisaFi ? '#f0fdf4' : '#fef3c7'}; border: 2px solid ${party.cePersonajVreisaFi ? '#86efac' : '#fcd34d'}; border-radius: 10px; padding: 12px; margin-bottom: 10px;">
                                <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px; font-weight: 600;">ğŸ­ CE PERSONAJ VREI SÄ‚ FI:</div>
                                <div style="font-size: 16px; font-weight: 700; color: ${party.cePersonajVreisaFi ? '#16a34a' : '#d97706'};">
                                    ${party.cePersonajVreisaFi || 'âš ï¸ NECOMPLETAT'}
                                    ${party.autoFilled ? ' <span style="font-size: 11px; background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 6px;">ğŸ¤– Auto</span>' : ''}
                                </div>
                            </div>
                            
                            <!-- Durata pentru acest rol -->
                            <div style="background: #eff6ff; border: 2px solid #60a5fa; border-radius: 10px; padding: 12px; margin-bottom: 10px;">
                                <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px; font-weight: 600;">â±ï¸ DURATA:</div>
                                <div style="font-size: 16px; font-weight: 700; color: #1e40af;">
                                    ${party.durataDisplay || party.durata + ' ore' || 'N/A'}
                                </div>
                            </div>
                            
                            <div style="font-size: 14px; color: #6b7280; display: flex; align-items: center; gap: 6px; margin-bottom: 5px;">
                                <span>ğŸ“…</span>
                                <span>${party.dataPetrecere || 'N/A'}</span>
                                <span style="margin-left: 5px;">â°</span>
                                <span>${party.oraPetrecere || 'N/A'}</span>
                            </div>
                            <div style="font-size: 14px; color: #6b7280; display: flex; align-items: center; gap: 6px; margin-bottom: 5px;">
                                <span>ğŸ“</span>
                                <span>${party.adresa || party.locatie || 'N/A'}</span>
                            </div>
                            <div style="font-size: 14px; color: #6b7280; display: flex; align-items: center; gap: 6px;">
                                <span>ğŸ“</span>
                                <span>${party.telefon || 'N/A'}</span>
                            </div>
                        </div>
                        
                        <!-- Footer -->
                        <div style="border-top: 1px solid #f3f4f6; padding-top: 15px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-size: 12px; color: #9ca3af; margin-bottom: 3px;">Valoare TotalÄƒ</div>
                                <div style="font-size: 20px; font-weight: 700; color: #10b981;">${parseInt(party.total || 0).toLocaleString('ro-RO')} RON</div>
                            </div>
                            <button onclick="viewPartyDetails(${party.id})" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 14px;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                ğŸ‘ï¸ Detalii
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // ============================================
        // PHOTO VERIFICATION SYSTEM
        // ============================================
        
        let systemVerificationPoints = 0;
        let currentVerificationPhotoData = null;

        // Initialize dates for verification
        function initializeVerificationDates() {
            const today = new Date();
            const todayString = today.toISOString().split('T')[0];
            const currentDateInput = document.getElementById('currentFormDate');
            if (currentDateInput) {
                currentDateInput.value = todayString;
            }
        }

        // Handle photo upload for verification
        document.addEventListener('DOMContentLoaded', function() {
            const photoInput = document.getElementById('verificationPhotoInput');
            if (photoInput) {
                photoInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        handleVerificationPhotoUpload(file);
                    }
                });
            }
            
            // Initialize dates
            initializeVerificationDates();
            
            // Auto-update current date every minute
            setInterval(initializeVerificationDates, 60000);
        });

        function handleVerificationPhotoUpload(file) {
            if (file.size > 10 * 1024 * 1024) {
                alert('âŒ FiÈ™ierul este prea mare! Maximum 10MB');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                currentVerificationPhotoData = e.target.result;
                
                // Show preview
                document.getElementById('verificationPhotoPreview').src = currentVerificationPhotoData;
                
                // Add current date overlay to photo
                const now = new Date();
                const dateString = now.toLocaleDateString('ro-RO', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                document.getElementById('photoDateOverlay').textContent = `ğŸ“… PozÄƒ fÄƒcutÄƒ la: ${dateString}`;
                
                // Hide upload section and show verification section
                document.getElementById('uploadPhotoSection').style.display = 'none';
                document.getElementById('photoVerificationSection').style.display = 'block';
                document.getElementById('verificationResult').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        function verifyFormDate() {
            const receivedDateInput = document.getElementById('receivedFormDate').value;
            const currentDateInput = document.getElementById('currentFormDate').value;
            
            if (!receivedDateInput) {
                alert('âŒ Te rog introdu data primirii formularului din pozÄƒ!');
                return;
            }
            
            const receivedDate = new Date(receivedDateInput);
            const currentDate = new Date(currentDateInput);
            
            // Reset time to midnight for accurate day comparison
            receivedDate.setHours(0, 0, 0, 0);
            currentDate.setHours(0, 0, 0, 0);
            
            // Calculate difference in days
            const diffTime = currentDate - receivedDate;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            // Format dates for display
            const receivedDateFormatted = new Date(receivedDateInput).toLocaleDateString('ro-RO', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
            const currentDateFormatted = new Date(currentDateInput).toLocaleDateString('ro-RO', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
            
            // Show result section
            const resultSection = document.getElementById('verificationResult');
            resultSection.style.display = 'block';
            
            // Populate details
            document.getElementById('detailReceivedFormDate').textContent = receivedDateFormatted;
            document.getElementById('detailCurrentFormDate').textContent = currentDateFormatted;
            document.getElementById('detailDifferenceDays').textContent = diffDays + ' zile';
            
            // Check if dates match (same day)
            if (diffDays === 0) {
                // SUCCESS - Same day
                systemVerificationPoints += 1;
                
                resultSection.style.background = 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)';
                resultSection.style.border = '3px solid #10b981';
                document.getElementById('resultIcon').textContent = 'ğŸ‰';
                document.getElementById('resultTitle').innerHTML = '<span style="color: #065f46;">FELICITÄ‚RI!</span>';
                document.getElementById('resultMessage').innerHTML = '<span style="color: #047857;">Data de notare este egalÄƒ cu ziua curentÄƒ!</span>';
                document.getElementById('resultPoints').innerHTML = '<span style="color: #059669;">+1 PUNCT</span>';
                document.getElementById('detailPointsAwarded').innerHTML = '<span style="color: #059669;">+1</span>';
                
            } else if (diffDays > 0) {
                // ERROR - Late submission
                systemVerificationPoints -= 3;
                
                resultSection.style.background = 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)';
                resultSection.style.border = '3px solid #ef4444';
                document.getElementById('resultIcon').textContent = 'âš ï¸';
                document.getElementById('resultTitle').innerHTML = '<span style="color: #991b1b;">DATA DE NOTAT DEPÄ‚È˜ITÄ‚!</span>';
                document.getElementById('resultMessage').innerHTML = '<span style="color: #dc2626;">Scad 3 puncte din sistem! Formularul a fost primit cu ' + diffDays + ' zi' + (diffDays > 1 ? 'le' : '') + ' Ã®n urmÄƒ!</span>';
                document.getElementById('resultPoints').innerHTML = '<span style="color: #ef4444;">-3 PUNCTE</span>';
                document.getElementById('detailPointsAwarded').innerHTML = '<span style="color: #ef4444;">-3</span>';
                
            } else {
                // Future date - Invalid
                resultSection.style.background = 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)';
                resultSection.style.border = '3px solid #ef4444';
                document.getElementById('resultIcon').textContent = 'âŒ';
                document.getElementById('resultTitle').innerHTML = '<span style="color: #991b1b;">DATÄ‚ INVALIDÄ‚!</span>';
                document.getElementById('resultMessage').innerHTML = '<span style="color: #dc2626;">Data primirii nu poate fi Ã®n viitor!</span>';
                document.getElementById('resultPoints').innerHTML = '<span style="color: #6b7280;">0 PUNCTE</span>';
                document.getElementById('detailPointsAwarded').innerHTML = '<span style="color: #6b7280;">0</span>';
            }
            
            // Update system points display
            updateVerificationPointsDisplay();
            
            // Scroll to result
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function updateVerificationPointsDisplay() {
            const pointsElement = document.getElementById('systemPointsDisplay');
            if (pointsElement) {
                pointsElement.textContent = systemVerificationPoints;
                
                // Animate points change
                pointsElement.style.transform = 'scale(1.2)';
                
                setTimeout(() => {
                    pointsElement.style.transform = 'scale(1)';
                }, 500);
            }
        }

        function resetPhotoVerification() {
            document.getElementById('uploadPhotoSection').style.display = 'block';
            document.getElementById('photoVerificationSection').style.display = 'none';
            document.getElementById('verificationResult').style.display = 'none';
            document.getElementById('verificationPhotoInput').value = '';
            document.getElementById('receivedFormDate').value = '';
            currentVerificationPhotoData = null;
            
            // Scroll to top of page section
            document.getElementById('verifica-formular').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // Initialize - load data on page load
        let partiesData = [];
        loadPartiesFromStorage();

        // ============================================
        // TARGET TRAINERI SYSTEM
        // ============================================
        let currentMonthTrainers = new Date();
        let eventsTrainers = [];
        let trainersData = [];
        
        // Initialize Trainers System
        function initializeTrainersSystem() {
            // Generate all trainers (Atrainer - Ztrainer)
            trainersData = [];
            for (let i = 65; i <= 90; i++) { // A-Z
                const letter = String.fromCharCode(i);
                trainersData.push({
                    code: `${letter}trainer`,
                    letter: letter,
                    totalHours: 0,
                    teamSales: 0,
                    level1Earnings: 0,
                    level2Earnings: 0
                });
            }
            
            // Load events from localStorage
            loadEventsTrainers();
            
            // Populate selectors
            populateSelectorsTrainers();
            
            // Add first executor row
            addExecutorRowTrainers();
            
            // Update displays
            updateMonthDisplayTrainers();
            calculateAndDisplayTrainers();
        }
        
        // Month Navigation
        function updateMonthDisplayTrainers() {
            const months = ['Ianuarie', 'Februarie', 'Martie', 'Aprilie', 'Mai', 'Iunie', 
                          'Iulie', 'August', 'Septembrie', 'Octombrie', 'Noiembrie', 'Decembrie'];
            const monthName = months[currentMonthTrainers.getMonth()];
            const year = currentMonthTrainers.getFullYear();
            document.getElementById('currentMonthDisplay').textContent = `${monthName} ${year}`;
        }
        
        function previousMonth() {
            currentMonthTrainers.setMonth(currentMonthTrainers.getMonth() - 1);
            updateMonthDisplayTrainers();
            calculateAndDisplayTrainers();
        }
        
        function nextMonth() {
            currentMonthTrainers.setMonth(currentMonthTrainers.getMonth() + 1);
            updateMonthDisplayTrainers();
            calculateAndDisplayTrainers();
        }
        
        // Tab Switching for Target Traineri
        function switchTargetTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.target-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Remove active from all buttons
            document.querySelectorAll('.target-tab').forEach(btn => {
                btn.style.background = 'white';
                btn.style.border = '2px solid #667eea';
                btn.style.color = '#667eea';
                btn.style.boxShadow = 'none';
            });
            
            // Show selected tab
            document.getElementById(tabName).style.display = 'block';
            
            // Add active to clicked button
            const clickedBtn = event.target;
            clickedBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            clickedBtn.style.border = 'none';
            clickedBtn.style.color = 'white';
            clickedBtn.style.boxShadow = '0 4px 15px rgba(102, 126, 234, 0.3)';
            
            // Refresh data if needed
            if (tabName === 'dashboard-traineri') {
                calculateAndDisplayTrainers();
            } else if (tabName === 'evenimente-traineri') {
                displayEventsListTrainers();
            } else if (tabName === 'calcule-traineri') {
                displayDetailedCalculationsTrainers();
            }
        }
        
        // Populate Selectors
        function populateSelectorsTrainers() {
            const sellerSelect = document.getElementById('sellerTrainers');
            
            // Clear existing options except first
            sellerSelect.innerHTML = '<option value="">SelecteazÄƒ vÃ¢nzÄƒtorul...</option>';
            
            // Add trainers
            trainersData.forEach(trainer => {
                const option = document.createElement('option');
                option.value = trainer.code;
                option.textContent = trainer.code;
                sellerSelect.appendChild(option);
            });
            
            // Add all people (A1-Z50)
            for (let i = 65; i <= 90; i++) { // A-Z
                const letter = String.fromCharCode(i);
                for (let j = 1; j <= 50; j++) {
                    const code = `${letter}${j}`;
                    const option = document.createElement('option');
                    option.value = code;
                    option.textContent = code;
                    sellerSelect.appendChild(option);
                }
            }
        }
        
        function updateExecutorSelectorsTrainers() {
            document.querySelectorAll('.executor-code-trainers').forEach(select => {
                if (select.options.length === 1) { // Only default option
                    // Add all people (A1-Z50)
                    for (let i = 65; i <= 90; i++) { // A-Z
                        const letter = String.fromCharCode(i);
                        for (let j = 1; j <= 50; j++) {
                            const code = `${letter}${j}`;
                            const option = document.createElement('option');
                            option.value = code;
                            option.textContent = code;
                            select.appendChild(option);
                        }
                    }
                }
            });
        }
        
        // Event Management
        function addExecutorRowTrainers() {
            const container = document.getElementById('executorsContainerTrainers');
            const newRow = document.createElement('div');
            newRow.style.cssText = 'display: flex; gap: 15px; margin-bottom: 15px; align-items: flex-start;';
            newRow.innerHTML = `
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 8px; color: #667eea; font-weight: 700; font-size: 14px;">Cod Executant</label>
                    <select class="executor-code-trainers" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px;">
                        <option value="">SelecteazÄƒ executant...</option>
                    </select>
                </div>
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 8px; color: #667eea; font-weight: 700; font-size: 14px;">Rol (Spider-Man, etc.)</label>
                    <input type="text" class="executor-role-trainers" placeholder="Ex: Iron Man" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px;">
                </div>
                <div style="width: 150px;">
                    <label style="display: block; margin-bottom: 8px; color: #667eea; font-weight: 700; font-size: 14px;">Ore Lucrate</label>
                    <input type="number" class="executor-hours-trainers" placeholder="Ex: 3" step="0.5" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px;">
                </div>
                <button onclick="this.parentElement.remove()" style="background: #fee2e2; color: #dc2626; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 700; margin-top: 32px;">ğŸ—‘ï¸</button>
            `;
            container.appendChild(newRow);
            updateExecutorSelectorsTrainers();
        }
        
        function saveEventTrainers() {
            const clientName = document.getElementById('clientNameTrainers').value.trim();
            const eventValue = parseFloat(document.getElementById('eventValueTrainers').value);
            const eventDate = document.getElementById('eventDateTrainers').value;
            const seller = document.getElementById('sellerTrainers').value;
            
            // Validate
            if (!clientName || !eventValue || !eventDate || !seller) {
                showMessageTrainers('âŒ Te rog completeazÄƒ toate cÃ¢mpurile obligatorii!', 'error');
                return;
            }
            
            // Get executors
            const executorRows = document.querySelectorAll('#executorsContainerTrainers > div');
            const executors = [];
            
            executorRows.forEach(row => {
                const code = row.querySelector('.executor-code-trainers').value;
                const role = row.querySelector('.executor-role-trainers').value.trim();
                const hours = parseFloat(row.querySelector('.executor-hours-trainers').value);
                
                if (code && role && hours > 0) {
                    executors.push({ code, role, hours });
                }
            });
            
            if (executors.length === 0) {
                showMessageTrainers('âŒ AdaugÄƒ cel puÈ›in un executant!', 'error');
                return;
            }
            
            // Create event object
            const event = {
                id: Date.now(),
                clientName,
                value: eventValue,
                date: eventDate,
                seller,
                executors,
                createdAt: new Date().toISOString()
            };
            
            // Save to events array
            eventsTrainers.push(event);
            saveEventsTrainers();
            
            // Show success message
            showMessageTrainers('âœ… Eveniment salvat cu succes!', 'success');
            
            // Reset form
            resetEventFormTrainers();
            
            // Recalculate
            calculateAndDisplayTrainers();
        }
        
        function resetEventFormTrainers() {
            document.getElementById('clientNameTrainers').value = '';
            document.getElementById('eventValueTrainers').value = '';
            document.getElementById('eventDateTrainers').value = '';
            document.getElementById('sellerTrainers').value = '';
            
            // Reset executors
            const container = document.getElementById('executorsContainerTrainers');
            container.innerHTML = '';
            addExecutorRowTrainers();
            
            document.getElementById('eventMessageTrainers').innerHTML = '';
        }
        
        function showMessageTrainers(message, type) {
            const msgDiv = document.getElementById('eventMessageTrainers');
            const bgColor = type === 'success' ? 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)' : 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)';
            const borderColor = type === 'success' ? '#10b981' : '#ef4444';
            const textColor = type === 'success' ? '#065f46' : '#991b1b';
            
            msgDiv.style.cssText = `background: ${bgColor}; border: 2px solid ${borderColor}; color: ${textColor}; padding: 20px; border-radius: 12px; margin-top: 20px; font-weight: 600; text-align: center;`;
            msgDiv.textContent = message;
            
            setTimeout(() => {
                msgDiv.innerHTML = '';
            }, 5000);
        }
        
        function displayEventsListTrainers() {
            const container = document.getElementById('eventsListTrainers');
            const monthEvents = getEventsForMonthTrainers();
            
            if (monthEvents.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 40px;">Nu existÄƒ evenimente pentru luna selectatÄƒ.</p>';
                return;
            }
            
            let html = '<div style="display: grid; gap: 20px;">';
            
            monthEvents.forEach(event => {
                const totalHours = event.executors.reduce((sum, ex) => sum + ex.hours, 0);
                html += `
                    <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div>
                                <h4 style="color: #667eea; margin-bottom: 5px; font-size: 18px; font-weight: 700;">${event.clientName}</h4>
                                <p style="color: #6b7280; font-size: 14px;">${new Date(event.date).toLocaleDateString('ro-RO')}</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 24px; font-weight: 900; color: #667eea;">${event.value} lei</div>
                                <div style="color: #6b7280; font-size: 14px;">${totalHours}h total</div>
                            </div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <strong style="color: #667eea;">VÃ¢nzÄƒtor:</strong> <span style="color: #1f2937; font-weight: 600;">${event.seller}</span>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <strong style="color: #667eea;">ExecutanÈ›i:</strong>
                            <div style="margin-top: 10px;">
                                ${event.executors.map(ex => `
                                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">
                                        <span style="color: #1f2937;">${ex.code} - ${ex.role}</span>
                                        <span style="color: #667eea; font-weight: 700;">${ex.hours}h</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <button onclick="deleteEventTrainers(${event.id})" style="background: #fee2e2; color: #dc2626; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-weight: 700; margin-top: 15px; width: 100%;">
                            ğŸ—‘ï¸ È˜terge Eveniment
                        </button>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function deleteEventTrainers(eventId) {
            if (!confirm('Sigur vrei sÄƒ È™tergi acest eveniment?')) return;
            
            eventsTrainers = eventsTrainers.filter(e => e.id !== eventId);
            saveEventsTrainers();
            displayEventsListTrainers();
            calculateAndDisplayTrainers();
        }
        
        // Calculations
        function calculateAndDisplayTrainers() {
            const monthEvents = getEventsForMonthTrainers();
            
            // Reset trainer stats
            trainersData.forEach(trainer => {
                trainer.totalHours = 0;
                trainer.teamSales = 0;
                trainer.level1Earnings = 0;
                trainer.level2Earnings = 0;
                trainer.positions = [];
            });
            
            // Calculate total sales
            const totalSales = monthEvents.reduce((sum, event) => sum + event.value, 0);
            
            // Calculate TEAM hours (all hours worked by each team, regardless of who sold)
            monthEvents.forEach(event => {
                event.executors.forEach(executor => {
                    const letter = executor.code.charAt(0);
                    const trainer = trainersData.find(t => t.letter === letter);
                    if (trainer) {
                        trainer.totalHours += executor.hours;
                    }
                });
            });
            
            // Calculate team sales (for LEVEL 2) - only events SOLD by team members
            monthEvents.forEach(event => {
                const sellerLetter = event.seller.charAt(0);
                const sellerTrainer = trainersData.find(t => t.letter === sellerLetter);
                
                if (sellerTrainer) {
                    sellerTrainer.teamSales += event.value;
                }
            });
            
            // Find top performer (team with most hours)
            const topPerformer = trainersData.reduce((max, trainer) => 
                trainer.totalHours > max.totalHours ? trainer : max
            , trainersData[0]);
            
            const topHours = topPerformer.totalHours;
            
            // ========================================
            // LEVEL 1 CALCULATIONS - POZIÈšII SYSTEM
            // ========================================
            const level1Pot = totalSales * 0.01;
            
            // Determine number of positions based on top performer
            const numPositions = Math.floor((topHours - 150) / 10);
            
            if (numPositions > 0 && topHours >= 150) {
                const moneyPerPosition = level1Pot / numPositions;
                
                // For each position, find who qualifies
                for (let pos = 1; pos <= numPositions; pos++) {
                    const positionMinHours = 150 + (pos - 1) * 10;
                    const positionMaxHours = 150 + pos * 10;
                    
                    // Find trainers who reached this position
                    const qualifiedTrainers = trainersData.filter(t => t.totalHours >= positionMaxHours);
                    
                    if (qualifiedTrainers.length > 0) {
                        const moneyPerTrainer = moneyPerPosition / qualifiedTrainers.length;
                        
                        qualifiedTrainers.forEach(trainer => {
                            trainer.level1Earnings += moneyPerTrainer;
                            trainer.positions.push({
                                position: pos,
                                range: `${positionMinHours}-${positionMaxHours}h`,
                                earned: moneyPerTrainer,
                                shared: qualifiedTrainers.length
                            });
                        });
                    }
                }
            }
            
            // ========================================
            // LEVEL 2 CALCULATIONS - TEAM SALES
            // ========================================
            let totalCompanyMoney = 0;
            
            trainersData.forEach(trainer => {
                if (trainer.teamSales > 0 && topHours > 0) {
                    const level2Pot = trainer.teamSales * 0.01;
                    const hourValue = level2Pot / topHours;
                    trainer.level2Earnings = trainer.totalHours * hourValue;
                    
                    const companyShare = level2Pot - trainer.level2Earnings;
                    totalCompanyMoney += companyShare;
                }
            });
            
            // Update dashboard
            document.getElementById('totalSalesTrainers').textContent = totalSales.toLocaleString('ro-RO') + ' lei';
            document.getElementById('level1TotalTrainers').textContent = level1Pot.toLocaleString('ro-RO', {maximumFractionDigits: 2}) + ' lei';
            document.getElementById('totalHoursTrainers').textContent = trainersData.reduce((sum, t) => sum + t.totalHours, 0).toFixed(1) + 'h';
            document.getElementById('topPerformerTrainers').textContent = topPerformer.code;
            document.getElementById('currentThresholdTrainers').textContent = topHours.toFixed(1) + 'h';
            document.getElementById('companyMoneyTrainers').textContent = totalCompanyMoney.toLocaleString('ro-RO', {maximumFractionDigits: 2}) + ' lei';
            
            // Update rankings table
            displayTrainerRankingsTable();
        }
        
        function displayTrainerRankingsTable() {
            const tbody = document.getElementById('trainerRankingsTable');
            
            // Sort trainers by total earnings
            const sortedTrainers = [...trainersData]
                .filter(t => t.totalHours > 0 || t.teamSales > 0)
                .sort((a, b) => {
                    const totalA = a.level1Earnings + a.level2Earnings;
                    const totalB = b.level1Earnings + b.level2Earnings;
                    return totalB - totalA;
                });
            
            if (sortedTrainers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: #6b7280;">
                            <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“Š</div>
                            <p>Nu existÄƒ date pentru luna selectatÄƒ</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            const topPerformerCode = trainersData.reduce((max, t) => 
                t.totalHours > max.totalHours ? t : max
            , trainersData[0]).code;
            
            let html = '';
            sortedTrainers.forEach((trainer, index) => {
                const isTop = trainer.code === topPerformerCode;
                const total = trainer.level1Earnings + trainer.level2Earnings;
                
                let statusBadge = '';
                let statusStyle = '';
                if (trainer.totalHours >= 150) {
                    statusBadge = 'Activ';
                    statusStyle = 'background: #d1fae5; color: #065f46; padding: 6px 12px; border-radius: 6px; font-weight: 700; font-size: 13px;';
                } else if (trainer.totalHours > 0) {
                    statusBadge = 'Sub Prag';
                    statusStyle = 'background: #fef3c7; color: #92400e; padding: 6px 12px; border-radius: 6px; font-weight: 700; font-size: 13px;';
                } else {
                    statusBadge = 'Inactiv';
                    statusStyle = 'background: #fee2e2; color: #991b1b; padding: 6px 12px; border-radius: 6px; font-weight: 700; font-size: 13px;';
                }
                
                const rowStyle = isTop ? 'background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);' : '';
                
                html += `
                    <tr style="${rowStyle}">
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;"><strong>${index + 1}${isTop ? ' ğŸ‘‘' : ''}</strong></td>
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;"><strong style="color: #667eea;">${trainer.code}</strong></td>
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">${trainer.totalHours.toFixed(1)}h</td>
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">${trainer.teamSales.toLocaleString('ro-RO', {maximumFractionDigits: 0})} lei</td>
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">${trainer.level1Earnings.toLocaleString('ro-RO', {maximumFractionDigits: 2})} lei</td>
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">${trainer.level2Earnings.toLocaleString('ro-RO', {maximumFractionDigits: 2})} lei</td>
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;"><strong style="color: #10b981;">${total.toLocaleString('ro-RO', {maximumFractionDigits: 2})} lei</strong></td>
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;"><span style="${statusStyle}">${statusBadge}</span></td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
        
        function displayDetailedCalculationsTrainers() {
            const container = document.getElementById('detailedCalculationsTrainers');
            const monthEvents = getEventsForMonthTrainers();
            
            if (monthEvents.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 40px;">Nu existÄƒ date pentru luna selectatÄƒ.</p>';
                return;
            }
            
            // Get calculations data
            const totalSales = monthEvents.reduce((sum, event) => sum + event.value, 0);
            const level1Pot = totalSales * 0.01;
            
            const topPerformer = trainersData.reduce((max, t) => 
                t.totalHours > max.totalHours ? t : max
            , trainersData[0]);
            
            const topHours = topPerformer.totalHours;
            const numPositions = Math.floor((topHours - 150) / 10);
            const moneyPerPosition = numPositions > 0 ? level1Pot / numPositions : 0;
            
            let html = `
                <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border: 2px solid #667eea; border-radius: 12px; padding: 25px; margin-bottom: 30px;">
                    <h4 style="color: #667eea; margin-bottom: 20px; font-size: 20px; font-weight: 800;">ğŸ“Š Rezumat General</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <div style="color: #6b7280; font-size: 14px; margin-bottom: 5px;">Total VÃ¢nzÄƒri</div>
                            <div style="color: #1f2937; font-size: 24px; font-weight: 700;">${totalSales.toLocaleString('ro-RO')} lei</div>
                        </div>
                        <div>
                            <div style="color: #6b7280; font-size: 14px; margin-bottom: 5px;">Pot Nivel 1 (1%)</div>
                            <div style="color: #667eea; font-size: 24px; font-weight: 700;">${level1Pot.toLocaleString('ro-RO', {maximumFractionDigits: 2})} lei</div>
                        </div>
                        <div>
                            <div style="color: #6b7280; font-size: 14px; margin-bottom: 5px;">Top Performer</div>
                            <div style="color: #1f2937; font-size: 24px; font-weight: 700;">${topPerformer.code}</div>
                        </div>
                        <div>
                            <div style="color: #6b7280; font-size: 14px; margin-bottom: 5px;">Ore Top</div>
                            <div style="color: #1f2937; font-size: 24px; font-weight: 700;">${topHours.toFixed(1)}h</div>
                        </div>
                        <div>
                            <div style="color: #6b7280; font-size: 14px; margin-bottom: 5px;">NumÄƒr PoziÈ›ii</div>
                            <div style="color: #1f2937; font-size: 24px; font-weight: 700;">${numPositions}</div>
                        </div>
                        <div>
                            <div style="color: #6b7280; font-size: 14px; margin-bottom: 5px;">Bani per PoziÈ›ie</div>
                            <div style="color: #667eea; font-size: 24px; font-weight: 700;">${moneyPerPosition.toFixed(2)} lei</div>
                        </div>
                    </div>
                </div>
                
                <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b; border-radius: 12px; padding: 25px; margin-bottom: 30px;">
                    <h4 style="color: #d97706; margin-bottom: 20px; font-size: 20px; font-weight: 800;">ğŸ† NIVEL 1 - DistribuÈ›ie pe PoziÈ›ii</h4>
                    <p style="color: #78350f; margin-bottom: 20px; font-weight: 600;">Fiecare poziÈ›ie = 10h | Bani per poziÈ›ie: ${moneyPerPosition.toFixed(2)} lei</p>
            `;
            
            // Show position breakdown
            for (let pos = 1; pos <= numPositions; pos++) {
                const positionMinHours = 150 + (pos - 1) * 10;
                const positionMaxHours = 150 + pos * 10;
                const qualifiedTrainers = trainersData.filter(t => t.totalHours >= positionMaxHours);
                
                if (qualifiedTrainers.length > 0) {
                    const moneyPerTrainer = moneyPerPosition / qualifiedTrainers.length;
                    const trainerCodes = qualifiedTrainers.map(t => t.code).join(', ');
                    
                    html += `
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #f59e0b;">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div style="flex: 1;">
                                    <strong style="color: #f59e0b; font-size: 16px;">PoziÈ›ia ${pos}</strong>
                                    <span style="color: #6b7280; font-size: 14px; margin-left: 10px;">(${positionMinHours}-${positionMaxHours}h)</span>
                                    <div style="color: #1f2937; font-size: 14px; margin-top: 5px;">
                                        ğŸ‘¥ ${qualifiedTrainers.length} traineri: ${trainerCodes}
                                    </div>
                                    <div style="color: #6b7280; font-size: 13px; margin-top: 3px;">
                                        ${moneyPerPosition.toFixed(2)} lei Ã· ${qualifiedTrainers.length} = ${moneyPerTrainer.toFixed(2)} lei fiecare
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: #f59e0b; font-size: 20px; font-weight: 700;">${moneyPerTrainer.toFixed(2)} lei</div>
                                    <div style="color: #6b7280; font-size: 12px;">per trainer</div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }
            
            // Individual trainer breakdown
            html += `
                <div style="margin-top: 30px;">
                    <h4 style="color: #d97706; margin-bottom: 15px; font-size: 18px; font-weight: 800;">ğŸ“‹ CÃ¢È™tiguri Individuale - Nivel 1</h4>
            `;
            
            const trainersWithEarnings = trainersData.filter(t => t.level1Earnings > 0).sort((a, b) => b.level1Earnings - a.level1Earnings);
            
            trainersWithEarnings.forEach(trainer => {
                const numPos = trainer.positions ? trainer.positions.length : 0;
                html += `
                    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong style="color: #1f2937; font-size: 18px;">${trainer.code}</strong>
                                <div style="color: #6b7280; font-size: 14px; margin-top: 5px;">
                                    ${trainer.totalHours.toFixed(1)}h â†’ ${numPos} poziÈ›ii atinse
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: #f59e0b; font-size: 24px; font-weight: 700;">${trainer.level1Earnings.toLocaleString('ro-RO', {maximumFractionDigits: 2})} lei</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                </div>
                </div>
                
                <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border: 2px solid #667eea; border-radius: 12px; padding: 25px;">
                    <h4 style="color: #667eea; margin-bottom: 20px; font-size: 20px; font-weight: 800;">ğŸ’° NIVEL 2 - VÃ¢nzÄƒri EchipÄƒ</h4>
                    <p style="color: #1e3a8a; margin-bottom: 20px; font-weight: 600;">Formula: Ore echipÄƒ Ã— (Pot echipÄƒ / ${topHours.toFixed(1)}h ore top)</p>
            `;
            
            trainersData.filter(t => t.teamSales > 0).forEach(trainer => {
                const level2Pot = trainer.teamSales * 0.01;
                const hourValue = level2Pot / topHours;
                const companyMoney = level2Pot - trainer.level2Earnings;
                
                html += `
                    <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div>
                                <strong style="color: #1f2937; font-size: 18px;">${trainer.code}</strong>
                                <div style="color: #6b7280; font-size: 14px; margin-top: 5px;">
                                    VÃ¢nzÄƒri echipÄƒ: ${trainer.teamSales.toLocaleString('ro-RO', {maximumFractionDigits: 0})} lei
                                </div>
                                <div style="color: #6b7280; font-size: 14px;">
                                    Pot maxim (1%): ${level2Pot.toLocaleString('ro-RO', {maximumFractionDigits: 2})} lei
                                </div>
                                <div style="color: #6b7280; font-size: 14px;">
                                    Valoare orÄƒ: ${hourValue.toFixed(2)} lei/h
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: #667eea; font-size: 28px; font-weight: 700;">${trainer.level2Earnings.toLocaleString('ro-RO', {maximumFractionDigits: 2})} lei</div>
                            </div>
                        </div>
                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px;">
                            <div style="color: #1f2937; font-size: 14px; margin-bottom: 8px; font-weight: 600;">
                                Calcul: ${trainer.totalHours.toFixed(1)}h Ã— ${hourValue.toFixed(2)} lei/h = ${trainer.level2Earnings.toLocaleString('ro-RO', {maximumFractionDigits: 2})} lei
                            </div>
                            ${companyMoney > 0 ? `
                                <div style="color: #ef4444; font-size: 14px; margin-top: 10px; font-weight: 700;">
                                    ğŸ¢ Pentru firmÄƒ: ${companyMoney.toLocaleString('ro-RO', {maximumFractionDigits: 2})} lei
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function recalculateMonthTrainers() {
            calculateAndDisplayTrainers();
            displayDetailedCalculationsTrainers();
            alert('âœ… Calcule reÃ®mprospÄƒtate!');
        }
        
        // Storage
        function saveEventsTrainers() {
            localStorage.setItem('superparty_trainers_events', JSON.stringify(eventsTrainers));
        }
        
        function loadEventsTrainers() {
            const stored = localStorage.getItem('superparty_trainers_events');
            if (stored) {
                eventsTrainers = JSON.parse(stored);
            }
        }
        
        function getEventsForMonthTrainers() {
            const month = currentMonthTrainers.getMonth();
            const year = currentMonthTrainers.getFullYear();
            
            return eventsTrainers.filter(event => {
                const eventDate = new Date(event.date);
                return eventDate.getMonth() === month && eventDate.getFullYear() === year;
            });
        }
        
        // Initialize when target-traineri page is shown
        document.addEventListener('DOMContentLoaded', function() {
            // Check if we're on target-traineri page
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    const targetPage = document.getElementById('target-traineri');
                    if (targetPage && targetPage.classList.contains('active')) {
                        initializeTrainersSystem();
                    }
                });
            });
            
            observer.observe(document.body, {
                attributes: true,
                subtree: true,
                attributeFilter: ['class']
            });
        });

        // ============================================
        // TARGET ANIMAÈšIE SYSTEM
        // ============================================
        let currentMonthAnimatie = new Date();
        let eventsAnimatie = [];
        let allPeopleAnimatie = []; // Traineri + Oameni
        
        // Roluri animaÈ›ie care participÄƒ
        const ANIMATION_ROLES = [
            'AnimaÈ›ie', 'Animatie',
            'UrÈ™itoare', 'Ursitoare',
            'Arcade pe suport', 'Arcade fÄƒrÄƒ suport', 'Arcade fara suport',
            'Arcade pe suport cu cifre', 'Arcade fÄƒrÄƒ suport cu cifre', 'Arcade fara suport cu cifre',
            'GheaÈ›Äƒ carbonicÄƒ', 'Gheata carbonica',
            'VatÄƒ', 'Vata',
            'Popcorn',
            'VatÄƒ È™i Popcorn', 'Vata si Popcorn', 'VatÄƒ si Popcorn', 'Vata È™i Popcorn',
            'MoÈ™ CrÄƒciun', 'Mos Craciun',
            'Heliu',
            'Piniata personalizatÄƒ', 'Piniata personalizata'
        ];
        
        function isAnimationRole(role) {
            return ANIMATION_ROLES.some(ar => role.toLowerCase().includes(ar.toLowerCase()));
        }
        
        // Initialize Animatie System
        function initializeAnimatieSystem() {
            // Generate all people (traineri + oameni)
            allPeopleAnimatie = [];
            
            // Add trainers
            for (let i = 65; i <= 90; i++) {
                const letter = String.fromCharCode(i);
                allPeopleAnimatie.push({
                    code: `${letter}trainer`,
                    letter: letter,
                    animationHours: 0,
                    earnings: 0,
                    isTrainer: true
                });
            }
            
            // Add all people (A1-Z50)
            for (let i = 65; i <= 90; i++) {
                const letter = String.fromCharCode(i);
                for (let j = 1; j <= 50; j++) {
                    allPeopleAnimatie.push({
                        code: `${letter}${j}`,
                        letter: letter,
                        animationHours: 0,
                        earnings: 0,
                        isTrainer: false
                    });
                }
            }
            
            // Load events
            loadEventsAnimatie();
            
            // Populate selectors
            populateSelectorsAnimatie();
            
            // Add first executor row
            addExecutorRowAnimatie();
            
            // Update displays
            updateMonthDisplayAnimatie();
            calculateAndDisplayAnimatie();
        }
        
        // Month Navigation Animatie
        function updateMonthDisplayAnimatie() {
            const months = ['Ianuarie', 'Februarie', 'Martie', 'Aprilie', 'Mai', 'Iunie', 
                          'Iulie', 'August', 'Septembrie', 'Octombrie', 'Noiembrie', 'Decembrie'];
            const monthName = months[currentMonthAnimatie.getMonth()];
            const year = currentMonthAnimatie.getFullYear();
            document.getElementById('currentMonthDisplayAnimatie').textContent = `${monthName} ${year}`;
        }
        
        function previousMonthAnimatie() {
            currentMonthAnimatie.setMonth(currentMonthAnimatie.getMonth() - 1);
            updateMonthDisplayAnimatie();
            calculateAndDisplayAnimatie();
        }
        
        function nextMonthAnimatie() {
            currentMonthAnimatie.setMonth(currentMonthAnimatie.getMonth() + 1);
            updateMonthDisplayAnimatie();
            calculateAndDisplayAnimatie();
        }
        
        // Tab Switching Animatie
        function switchTargetTabAnimatie(tabName) {
            document.querySelectorAll('.target-content-animatie').forEach(tab => {
                tab.style.display = 'none';
            });
            
            document.querySelectorAll('.target-tab-animatie').forEach(btn => {
                btn.style.background = 'white';
                btn.style.border = '2px solid #f59e0b';
                btn.style.color = '#f59e0b';
                btn.style.boxShadow = 'none';
            });
            
            document.getElementById(tabName).style.display = 'block';
            
            const clickedBtn = event.target;
            clickedBtn.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
            clickedBtn.style.border = 'none';
            clickedBtn.style.color = 'white';
            clickedBtn.style.boxShadow = '0 4px 15px rgba(245, 158, 11, 0.3)';
            
            if (tabName === 'dashboard-animatie') {
                calculateAndDisplayAnimatie();
            } else if (tabName === 'evenimente-animatie') {
                displayEventsListAnimatie();
            } else if (tabName === 'calcule-animatie') {
                displayDetailedCalculationsAnimatie();
            }
        }
        
        // Populate Selectors Animatie
        function populateSelectorsAnimatie() {
            const sellerSelect = document.getElementById('sellerAnimatie');
            sellerSelect.innerHTML = '<option value="">SelecteazÄƒ...</option>';
            
            allPeopleAnimatie.forEach(person => {
                const option = document.createElement('option');
                option.value = person.code;
                option.textContent = person.code;
                sellerSelect.appendChild(option);
            });
        }
        
        function updateExecutorSelectorsAnimatie() {
            document.querySelectorAll('.executor-code-animatie').forEach(select => {
                if (select.options.length === 1) {
                    allPeopleAnimatie.forEach(person => {
                        const option = document.createElement('option');
                        option.value = person.code;
                        option.textContent = person.code;
                        select.appendChild(option);
                    });
                }
            });
        }
        
        // Event Management Animatie
        function addExecutorRowAnimatie() {
            const container = document.getElementById('executorsContainerAnimatie');
            const newRow = document.createElement('div');
            newRow.style.cssText = 'display: flex; gap: 15px; margin-bottom: 15px; align-items: flex-start;';
            newRow.innerHTML = `
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 8px; color: #f59e0b; font-weight: 700; font-size: 14px;">Cod Executant</label>
                    <select class="executor-code-animatie" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px;">
                        <option value="">SelecteazÄƒ...</option>
                    </select>
                </div>
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 8px; color: #f59e0b; font-weight: 700; font-size: 14px;">Rol</label>
                    <select class="executor-role-animatie" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px;">
                        <option value="">SelecteazÄƒ rol...</option>
                        <option value="AnimaÈ›ie">AnimaÈ›ie</option>
                        <option value="UrÈ™itoare">UrÈ™itoare</option>
                        <option value="Arcade pe suport">Arcade pe suport</option>
                        <option value="Arcade fÄƒrÄƒ suport">Arcade fÄƒrÄƒ suport</option>
                        <option value="Arcade pe suport cu cifre">Arcade pe suport cu cifre</option>
                        <option value="Arcade fÄƒrÄƒ suport cu cifre">Arcade fÄƒrÄƒ suport cu cifre</option>
                        <option value="GheaÈ›Äƒ carbonicÄƒ">GheaÈ›Äƒ carbonicÄƒ</option>
                        <option value="VatÄƒ">VatÄƒ</option>
                        <option value="Popcorn">Popcorn</option>
                        <option value="VatÄƒ È™i Popcorn">VatÄƒ È™i Popcorn</option>
                        <option value="MoÈ™ CrÄƒciun">MoÈ™ CrÄƒciun</option>
                        <option value="Heliu">Heliu</option>
                        <option value="Piniata personalizatÄƒ">Piniata personalizatÄƒ</option>
                        <option value="Training">Training</option>
                    </select>
                </div>
                <div style="width: 150px;">
                    <label style="display: block; margin-bottom: 8px; color: #f59e0b; font-weight: 700; font-size: 14px;">Ore</label>
                    <input type="number" class="executor-hours-animatie" placeholder="Ex: 3" step="0.5" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px;">
                </div>
                <button onclick="this.parentElement.remove()" style="background: #fee2e2; color: #dc2626; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 700; margin-top: 32px;">ğŸ—‘ï¸</button>
            `;
            container.appendChild(newRow);
            updateExecutorSelectorsAnimatie();
        }
        
        function saveEventAnimatie() {
            const clientName = document.getElementById('clientNameAnimatie').value.trim();
            const eventValue = parseFloat(document.getElementById('eventValueAnimatie').value);
            const eventDate = document.getElementById('eventDateAnimatie').value;
            const seller = document.getElementById('sellerAnimatie').value;
            
            if (!clientName || !eventValue || !eventDate || !seller) {
                showMessageAnimatie('âŒ CompleteazÄƒ toate cÃ¢mpurile!', 'error');
                return;
            }
            
            const executorRows = document.querySelectorAll('#executorsContainerAnimatie > div');
            const executors = [];
            
            executorRows.forEach(row => {
                const code = row.querySelector('.executor-code-animatie').value;
                const role = row.querySelector('.executor-role-animatie').value;
                const hours = parseFloat(row.querySelector('.executor-hours-animatie').value);
                
                if (code && role && hours > 0) {
                    executors.push({ code, role, hours });
                }
            });
            
            if (executors.length === 0) {
                showMessageAnimatie('âŒ AdaugÄƒ cel puÈ›in un executant!', 'error');
                return;
            }
            
            const event = {
                id: Date.now(),
                clientName,
                value: eventValue,
                date: eventDate,
                seller,
                executors,
                createdAt: new Date().toISOString()
            };
            
            eventsAnimatie.push(event);
            saveEventsAnimatie();
            showMessageAnimatie('âœ… Eveniment salvat!', 'success');
            resetEventFormAnimatie();
            calculateAndDisplayAnimatie();
        }
        
        function resetEventFormAnimatie() {
            document.getElementById('clientNameAnimatie').value = '';
            document.getElementById('eventValueAnimatie').value = '';
            document.getElementById('eventDateAnimatie').value = '';
            document.getElementById('sellerAnimatie').value = '';
            
            const container = document.getElementById('executorsContainerAnimatie');
            container.innerHTML = '';
            addExecutorRowAnimatie();
            
            document.getElementById('eventMessageAnimatie').innerHTML = '';
        }
        
        function showMessageAnimatie(message, type) {
            const msgDiv = document.getElementById('eventMessageAnimatie');
            const bgColor = type === 'success' ? 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)' : 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)';
            const borderColor = type === 'success' ? '#10b981' : '#ef4444';
            const textColor = type === 'success' ? '#065f46' : '#991b1b';
            
            msgDiv.style.cssText = `background: ${bgColor}; border: 2px solid ${borderColor}; color: ${textColor}; padding: 20px; border-radius: 12px; margin-top: 20px; font-weight: 600; text-align: center;`;
            msgDiv.textContent = message;
            
            setTimeout(() => { msgDiv.innerHTML = ''; }, 5000);
        }
        
        function displayEventsListAnimatie() {
            const container = document.getElementById('eventsListAnimatie');
            const monthEvents = getEventsForMonthAnimatie();
            
            if (monthEvents.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 40px;">Nu existÄƒ evenimente.</p>';
                return;
            }
            
            let html = '<div style="display: grid; gap: 20px;">';
            
            monthEvents.forEach(event => {
                const totalHours = event.executors.reduce((sum, ex) => sum + ex.hours, 0);
                html += `
                    <div style="background: #fef3c7; border: 2px solid #f59e0b; border-radius: 12px; padding: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                            <div>
                                <h4 style="color: #d97706; font-weight: 700;">${event.clientName}</h4>
                                <p style="color: #78350f; font-size: 14px;">${new Date(event.date).toLocaleDateString('ro-RO')}</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 24px; font-weight: 900; color: #d97706;">${event.value} lei</div>
                                <div style="color: #78350f; font-size: 14px;">${totalHours}h total</div>
                            </div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <strong style="color: #f59e0b;">NoteazÄƒ:</strong> ${event.seller}
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <strong style="color: #f59e0b;">ExecutanÈ›i:</strong>
                            ${event.executors.map(ex => `
                                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">
                                    <span>${ex.code} - ${ex.role}</span>
                                    <span style="color: #f59e0b; font-weight: 700;">${ex.hours}h</span>
                                </div>
                            `).join('')}
                        </div>
                        <button onclick="deleteEventAnimatie(${event.id})" style="background: #fee2e2; color: #dc2626; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 700; margin-top: 15px; width: 100%;">
                            ğŸ—‘ï¸ È˜terge
                        </button>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function deleteEventAnimatie(eventId) {
            if (!confirm('È˜tergi evenimentul?')) return;
            eventsAnimatie = eventsAnimatie.filter(e => e.id !== eventId);
            saveEventsAnimatie();
            displayEventsListAnimatie();
            calculateAndDisplayAnimatie();
        }
        
        // Calculations Animatie
        function calculateAndDisplayAnimatie() {
            const monthEvents = getEventsForMonthAnimatie();
            
            // Reset
            allPeopleAnimatie.forEach(person => {
                person.animationHours = 0;
                person.earnings = 0;
            });
            
            // Calculate total hours sold (toate rolurile minus Training)
            let totalHoursSold = 0;
            
            monthEvents.forEach(event => {
                event.executors.forEach(executor => {
                    if (executor.role.toLowerCase() !== 'training') {
                        totalHoursSold += executor.hours;
                    }
                    
                    // Calculate animation hours per person (doar roluri animaÈ›ie)
                    if (isAnimationRole(executor.role)) {
                        const person = allPeopleAnimatie.find(p => p.code === executor.code);
                        if (person) {
                            person.animationHours += executor.hours;
                        }
                    }
                });
            });
            
            // Pot total
            const potTotal = totalHoursSold * 2.5;
            
            // Find top performer (cele mai multe ore animaÈ›ie)
            const topPerformer = allPeopleAnimatie.reduce((max, person) => 
                person.animationHours > max.animationHours ? person : max
            , allPeopleAnimatie[0]);
            
            // Calculate points (doar peste 20h)
            const activeParticipants = allPeopleAnimatie.filter(p => p.animationHours > 20);
            const totalPoints = activeParticipants.reduce((sum, p) => sum + (p.animationHours - 20), 0);
            
            // Calculate earnings
            if (totalPoints > 0) {
                const pointValue = potTotal / totalPoints;
                activeParticipants.forEach(person => {
                    const points = person.animationHours - 20;
                    person.earnings = points * pointValue;
                });
            }
            
            // Update dashboard
            document.getElementById('totalHoursAnimatie').textContent = totalHoursSold.toFixed(1) + 'h';
            document.getElementById('potTotalAnimatie').textContent = potTotal.toLocaleString('ro-RO', {maximumFractionDigits: 2}) + ' lei';
            document.getElementById('topPerformerAnimatie').textContent = topPerformer.code;
            document.getElementById('topHoursAnimatie').textContent = topPerformer.animationHours.toFixed(1) + 'h';
            document.getElementById('activeParticipantsAnimatie').textContent = activeParticipants.length;
            document.getElementById('totalPointsAnimatie').textContent = totalPoints.toFixed(1);
            
            // Display rankings
            displayAnimatieRankings();
        }
        
        function displayAnimatieRankings() {
            const tbody = document.getElementById('animatieRankingsTable');
            
            const sorted = [...allPeopleAnimatie]
                .filter(p => p.animationHours > 0)
                .sort((a, b) => b.earnings - a.earnings);
            
            if (sorted.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #6b7280;">
                            <div style="font-size: 48px; margin-bottom: 15px;">ğŸ­</div>
                            <p>Nu existÄƒ date</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            const topCode = allPeopleAnimatie.reduce((max, p) => 
                p.animationHours > max.animationHours ? p : max
            , allPeopleAnimatie[0]).code;
            
            let html = '';
            sorted.forEach((person, index) => {
                const isTop = person.code === topCode;
                const points = person.animationHours > 20 ? person.animationHours - 20 : 0;
                
                let status = '';
                if (person.animationHours > 20) {
                    status = '<span style="background: #d1fae5; color: #065f46; padding: 6px 12px; border-radius: 6px; font-weight: 700;">Activ</span>';
                } else {
                    status = '<span style="background: #fee2e2; color: #991b1b; padding: 6px 12px; border-radius: 6px; font-weight: 700;">Sub prag</span>';
                }
                
                const rowStyle = isTop ? 'background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);' : '';
                
                html += `
                    <tr style="${rowStyle}">
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;"><strong>${index + 1}${isTop ? ' ğŸ‘‘' : ''}</strong></td>
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;"><strong style="color: #f59e0b;">${person.code}</strong></td>
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">${person.animationHours.toFixed(1)}h</td>
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">${points.toFixed(1)}</td>
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;"><strong style="color: #10b981;">${person.earnings.toLocaleString('ro-RO', {maximumFractionDigits: 2})} lei</strong></td>
                        <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">${status}</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
        
        function displayDetailedCalculationsAnimatie() {
            const container = document.getElementById('detailedCalculationsAnimatie');
            const monthEvents = getEventsForMonthAnimatie();
            
            if (monthEvents.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 40px;">Nu existÄƒ date.</p>';
                return;
            }
            
            let totalHoursSold = 0;
            monthEvents.forEach(event => {
                event.executors.forEach(ex => {
                    if (ex.role.toLowerCase() !== 'training') {
                        totalHoursSold += ex.hours;
                    }
                });
            });
            
            const potTotal = totalHoursSold * 2.5;
            const activeParticipants = allPeopleAnimatie.filter(p => p.animationHours > 20);
            const totalPoints = activeParticipants.reduce((sum, p) => sum + (p.animationHours - 20), 0);
            const pointValue = totalPoints > 0 ? potTotal / totalPoints : 0;
            
            const topPerformer = allPeopleAnimatie.reduce((max, p) => 
                p.animationHours > max.animationHours ? p : max
            , allPeopleAnimatie[0]);
            
            let html = `
                <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b; border-radius: 12px; padding: 25px; margin-bottom: 30px;">
                    <h4 style="color: #d97706; margin-bottom: 20px; font-size: 20px; font-weight: 800;">ğŸ“Š Rezumat</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <div style="color: #78350f; font-size: 14px; margin-bottom: 5px;">Ore vÃ¢ndute</div>
                            <div style="color: #1f2937; font-size: 24px; font-weight: 700;">${totalHoursSold.toFixed(1)}h</div>
                        </div>
                        <div>
                            <div style="color: #78350f; font-size: 14px; margin-bottom: 5px;">Pot Total</div>
                            <div style="color: #f59e0b; font-size: 24px; font-weight: 700;">${potTotal.toLocaleString('ro-RO', {maximumFractionDigits: 2})} lei</div>
                        </div>
                        <div>
                            <div style="color: #78350f; font-size: 14px; margin-bottom: 5px;">Top Performer</div>
                            <div style="color: #1f2937; font-size: 24px; font-weight: 700;">${topPerformer.code}</div>
                        </div>
                        <div>
                            <div style="color: #78350f; font-size: 14px; margin-bottom: 5px;">Total Puncte</div>
                            <div style="color: #1f2937; font-size: 24px; font-weight: 700;">${totalPoints.toFixed(1)}</div>
                        </div>
                        <div>
                            <div style="color: #78350f; font-size: 14px; margin-bottom: 5px;">Valoare Punct</div>
                            <div style="color: #f59e0b; font-size: 24px; font-weight: 700;">${pointValue.toFixed(2)} lei</div>
                        </div>
                    </div>
                </div>
                
                <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border: 2px solid #3b82f6; border-radius: 12px; padding: 25px;">
                    <h4 style="color: #1e40af; margin-bottom: 20px; font-size: 20px; font-weight: 800;">ğŸ§® Calcule Detaliate</h4>
                    <p style="color: #1e3a8a; margin-bottom: 20px; font-weight: 600;">Formula: (Ore animaÈ›ie - 20) Ã— ${pointValue.toFixed(2)} lei/punct</p>
            `;
            
            activeParticipants.forEach(person => {
                const points = person.animationHours - 20;
                html += `
                    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong style="color: #1f2937; font-size: 18px;">${person.code}</strong>
                                <div style="color: #6b7280; font-size: 14px; margin-top: 5px;">
                                    ${person.animationHours.toFixed(1)}h - 20h = ${points.toFixed(1)} puncte Ã— ${pointValue.toFixed(2)} lei
                                </div>
                            </div>
                            <div style="color: #f59e0b; font-size: 24px; font-weight: 700;">
                                ${person.earnings.toLocaleString('ro-RO', {maximumFractionDigits: 2})} lei
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function recalculateMonthAnimatie() {
            calculateAndDisplayAnimatie();
            displayDetailedCalculationsAnimatie();
            alert('âœ… Recalculat!');
        }
        
        // Storage Animatie
        function saveEventsAnimatie() {
            localStorage.setItem('superparty_animatie_events', JSON.stringify(eventsAnimatie));
        }
        
        function loadEventsAnimatie() {
            const stored = localStorage.getItem('superparty_animatie_events');
            if (stored) {
                eventsAnimatie = JSON.parse(stored);
            }
        }
        
        function getEventsForMonthAnimatie() {
            const month = currentMonthAnimatie.getMonth();
            const year = currentMonthAnimatie.getFullYear();
            
            return eventsAnimatie.filter(event => {
                const eventDate = new Date(event.date);
                return eventDate.getMonth() === month && eventDate.getFullYear() === year;
            });
        }
        
        // Initialize when target-animatie is shown
        document.addEventListener('DOMContentLoaded', function() {
            const observerAnimatie = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    const targetPage = document.getElementById('target-animatie');
                    if (targetPage && targetPage.classList.contains('active')) {
                        initializeAnimatieSystem();
                    }
                });
            });
            
            observerAnimatie.observe(document.body, {
                attributes: true,
                subtree: true,
                attributeFilter: ['class']
            });
        });

        // ============================================
        // LICENSE CODE GENERATION FUNCTIONS
        // ============================================

        // Generate random license code
        function generateRandomCode() {
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const numbers = '0123456789';
            
            let code = 'SP-';
            
            // Add 4 random alphanumeric characters
            for (let i = 0; i < 4; i++) {
                const useNumber = Math.random() > 0.5;
                code += useNumber ? numbers[Math.floor(Math.random() * numbers.length)] : letters[Math.floor(Math.random() * letters.length)];
            }
            
            code += '-';
            
            // Add 4 more random alphanumeric characters
            for (let i = 0; i < 4; i++) {
                const useNumber = Math.random() > 0.5;
                code += useNumber ? numbers[Math.floor(Math.random() * numbers.length)] : letters[Math.floor(Math.random() * letters.length)];
            }
            
            return code;
        }

        // Generate and save license code
        async function generateLicenseCode() {
            const loadingDiv = document.getElementById('codeGenerationLoading');
            const displayDiv = document.getElementById('generatedCodeDisplay');
            
            // Show loading
            loadingDiv.style.display = 'block';
            displayDiv.style.display = 'none';
            
            try {
                // Generate unique code
                const newCode = generateRandomCode();
                
                // Save to Supabase
                const { data, error } = await supabase
                    .from('license_keys')
                    .insert([
                        {
                            code: newCode,
                            used: false,
                            created_at: new Date().toISOString()
                        }
                    ])
                    .select();
                
                if (error) {
                    console.error('Error generating code:', error);
                    alert('âŒ Eroare la generarea codului: ' + error.message);
                    loadingDiv.style.display = 'none';
                    return;
                }
                
                // Display the generated code
                document.getElementById('displayedCode').textContent = newCode;
                loadingDiv.style.display = 'none';
                displayDiv.style.display = 'block';
                
                // Refresh the list
                await refreshCodesList();
                
            } catch (err) {
                console.error('Error:', err);
                alert('âŒ Eroare: ' + err.message);
                loadingDiv.style.display = 'none';
            }
        }

        // Copy code to clipboard
        function copyCodeToClipboard() {
            const code = document.getElementById('displayedCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('âœ… Cod copiat: ' + code);
            }).catch(err => {
                console.error('Error copying code:', err);
                alert('âŒ Eroare la copiere');
            });
        }

        // Close code display
        function closeCodeDisplay() {
            document.getElementById('generatedCodeDisplay').style.display = 'none';
        }

        // Refresh codes list
        async function refreshCodesList() {
            const container = document.getElementById('codesListContainer');
            
            try {
                // Fetch all license codes from Supabase
                const { data: codes, error } = await supabase
                    .from('license_keys')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    console.error('Error fetching codes:', error);
                    container.innerHTML = '<div style="text-align: center; padding: 20px; color: #ef4444;">âŒ Eroare la Ã®ncÄƒrcarea codurilor</div>';
                    return;
                }
                
                if (!codes || codes.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #9ca3af;">
                            <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“</div>
                            <p>Niciun cod generat Ã®ncÄƒ</p>
                        </div>
                    `;
                    return;
                }
                
                // Display codes
                container.innerHTML = codes.map(code => {
                    const statusColor = code.used ? '#10b981' : '#f59e0b';
                    const statusText = code.used ? 'âœ… Folosit' : 'â³ Neutilizat';
                    const createdDate = new Date(code.created_at).toLocaleString('ro-RO');
                    
                    return `
                        <div style="padding: 20px; background: #f9fafb; border-radius: 12px; border-left: 4px solid ${statusColor}; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                            <div style="flex: 1; min-width: 200px;">
                                <div style="font-weight: 700; color: #1f2937; font-size: 18px; font-family: monospace; margin-bottom: 5px;">${code.code}</div>
                                <div style="font-size: 13px; color: #6b7280;">Creat: ${createdDate}</div>
                                ${code.used ? `<div style="font-size: 13px; color: #10b981; margin-top: 3px;">Folosit la: ${new Date(code.used_at).toLocaleString('ro-RO')}</div>` : ''}
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="padding: 8px 16px; background: ${code.used ? '#d1fae5' : '#fef3c7'}; color: ${code.used ? '#065f46' : '#92400e'}; border-radius: 8px; font-size: 13px; font-weight: 700;">${statusText}</span>
                                ${!code.used ? `<button onclick="copyToClipboard('${code.code}')" style="background: #667eea; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px;">ğŸ“‹ CopiazÄƒ</button>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (err) {
                console.error('Error:', err);
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #ef4444;">âŒ Eroare</div>';
            }
        }

        // Copy any code to clipboard
        function copyToClipboard(code) {
            navigator.clipboard.writeText(code).then(() => {
                alert('âœ… Cod copiat: ' + code);
            }).catch(err => {
                console.error('Error copying:', err);
                alert('âŒ Eroare la copiere');
            });
        }

        // ============================================
        // USERS MANAGEMENT FUNCTIONS
        // ============================================

        let usersData = [];

        // Generate all trainer codes (A1-A50, B1-B50, ..., Z1-Z50)
        function generateAllTrainerCodes() {
            const codes = [];
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            for (let i = 0; i < letters.length; i++) {
                for (let num = 1; num <= 50; num++) {
                    codes.push(letters[i] + num);
                }
            }
            return codes;
        }

        // Load users from localStorage
        function loadUsersData() {
            const stored = localStorage.getItem('superparty_admin_users');
            if (stored) {
                usersData = JSON.parse(stored);
                // RESET password visibility to HIDDEN for all users
                usersData.forEach(user => {
                    user.passwordVisible = false;
                });
            }
            renderUsersTable();
        }

        // Save users to localStorage
        function saveUsersData() {
            localStorage.setItem('superparty_admin_users', JSON.stringify(usersData));
        }

        // Render the users table
        function renderUsersTable() {
            const tbodyAdmin = document.getElementById('usersTableBodyAdmin');
            const tbodyGM = document.getElementById('usersTableBodyGM');
            
            // Render for MOD ADMIN (without P/R buttons)
            if (tbodyAdmin) {
                tbodyAdmin.innerHTML = '';
                if (usersData.length === 0) {
                    tbodyAdmin.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 40px; color: #9ca3af;">
                                <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“</div>
                                <p>Nu existÄƒ utilizatori. ApasÄƒ butonul "AdaugÄƒ Utilizator Nou" pentru a Ã®ncepe.</p>
                            </td>
                        </tr>
                    `;
                } else {
                    usersData.forEach((user, index) => {
                        const isBlocked = user.blocked || false;
                        const failedAttempts = user.failedAttempts || 0;
                        const statusColor = isBlocked ? '#dc2626' : '#10b981';
                        const statusText = isBlocked ? 'ğŸ”’ Blocat' : 'ğŸ”“ Activ';
                        const statusBg = isBlocked ? '#fee2e2' : '#d1fae5';
                        const passwordVisible = user.passwordVisible || false;
                        
                        const row = document.createElement('tr');
                        row.style.borderBottom = '1px solid #e5e7eb';
                        row.style.background = isBlocked ? '#fef2f2' : 'transparent';
                        row.innerHTML = `
                            <td style="padding: 15px;">
                                <input type="text" value="${user.name || ''}" onchange="updateUser(${index}, 'name', this.value)" 
                                    style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                            </td>
                            <td style="padding: 15px;">
                                <input type="email" value="${user.email || ''}" onchange="updateUser(${index}, 'email', this.value)" 
                                    style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                            </td>
                            <td style="padding: 15px;">
                                <input type="${passwordVisible ? 'text' : 'password'}" value="${user.password || ''}" onchange="updateUser(${index}, 'password', this.value)" 
                                    style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                            </td>
                            <td style="padding: 15px;">
                                <input type="${passwordVisible ? 'text' : 'password'}" value="${user.passwordConfirm || ''}" onchange="updateUser(${index}, 'passwordConfirm', this.value)" 
                                    style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                            </td>
                            <td style="padding: 15px;">
                                <input type="text" value="${user.accessKey || ''}" onchange="updateUser(${index}, 'accessKey', this.value)" 
                                    style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; font-family: monospace;">
                            </td>
                            <td style="padding: 15px;">
                                <div class="autocomplete-container">
                                    <input type="text" value="${user.userCode || ''}" 
                                        onchange="updateUser(${index}, 'userCode', this.value)"
                                        oninput="showAutocompleteSuggestions(this, ${index})"
                                        onfocus="showAutocompleteSuggestions(this, ${index})"
                                        onblur="setTimeout(() => hideAutocompleteSuggestions(${index}), 200)"
                                        id="userCode-admin-${index}"
                                        placeholder="Scrie: A1, B5, Z50..."
                                        autocomplete="off"
                                        style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; font-family: monospace; text-transform: uppercase;">
                                    <div id="suggestions-admin-${index}" class="autocomplete-suggestions" style="display: none;"></div>
                                </div>
                            </td>
                            <td style="padding: 15px;">
                                <select value="${user.userRole || 'Animator'}" onchange="updateUser(${index}, 'userRole', this.value)" 
                                    style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; cursor: pointer; background: white;">
                                    <option value="Animator" ${(user.userRole || 'Animator') === 'Animator' ? 'selected' : ''}>Animator</option>
                                    <option value="Animator + Bagaje" ${user.userRole === 'Animator + Bagaje' ? 'selected' : ''}>Animator + Bagaje</option>
                                    <option value="Animator Bagaje + Trainer" ${user.userRole === 'Animator Bagaje + Trainer' ? 'selected' : ''}>Animator Bagaje + Trainer</option>
                                </select>
                            </td>
                            <td style="padding: 15px; text-align: center;">
                                <div style="display: flex; flex-direction: column; gap: 5px; align-items: center;">
                                    <span style="padding: 8px 16px; background: ${statusBg}; color: ${statusColor}; border-radius: 8px; font-size: 13px; font-weight: 700;">${statusText}</span>
                                    ${failedAttempts > 0 ? `<span style="font-size: 11px; color: #ef4444;">âš ï¸ ${failedAttempts} Ã®ncercÄƒri</span>` : ''}
                                </div>
                            </td>
                            <td style="padding: 15px; text-align: center;">
                                <div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">
                                    <button onclick="toggleBlockUser(${index})" 
                                        style="background: ${isBlocked ? '#10b981' : '#ef4444'}; color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: 700; transition: all 0.3s; font-size: 13px;">
                                        ${isBlocked ? 'ğŸ”“ DeblocheazÄƒ' : 'ğŸ”’ BlocheazÄƒ'}
                                    </button>
                                    <button onclick="deleteUser(${index})" 
                                        style="background: #fee2e2; color: #dc2626; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: 700; transition: all 0.3s; font-size: 13px;">
                                        ğŸ—‘ï¸ È˜terge
                                    </button>
                                </div>
                            </td>
                        `;
                        tbodyAdmin.appendChild(row);
                    });
                }
            }
            
            // Render for MOD GM (with P/R buttons)
            if (tbodyGM) {
                tbodyGM.innerHTML = '';
                if (usersData.length === 0) {
                    tbodyGM.innerHTML = `
                        <tr>
                            <td colspan="10" style="text-align: center; padding: 40px; color: #9ca3af;">
                                <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“</div>
                                <p>Nu existÄƒ utilizatori. ApasÄƒ butonul "AdaugÄƒ Utilizator Nou" pentru a Ã®ncepe.</p>
                            </td>
                        </tr>
                    `;
                } else {
                    usersData.forEach((user, index) => {
                        const isBlocked = user.blocked || false;
                        const failedAttempts = user.failedAttempts || 0;
                        const statusColor = isBlocked ? '#dc2626' : '#10b981';
                        const statusText = isBlocked ? 'ğŸ”’ Blocat' : 'ğŸ”“ Activ';
                        const statusBg = isBlocked ? '#fee2e2' : '#d1fae5';
                        const passwordVisible = user.passwordVisible || false;
                        
                        const row = document.createElement('tr');
                        row.style.borderBottom = '1px solid #e5e7eb';
                        row.style.background = isBlocked ? '#fef2f2' : 'transparent';
                        row.innerHTML = `
                            <td style="padding: 15px;">
                                <input type="text" value="${user.name || ''}" onchange="updateUser(${index}, 'name', this.value)" 
                                    style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                            </td>
                            <td style="padding: 15px;">
                                <input type="email" value="${user.email || ''}" onchange="updateUser(${index}, 'email', this.value)" 
                                    style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                            </td>
                            <td style="padding: 15px;">
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <input id="pass-${index}" type="${passwordVisible ? 'text' : 'password'}" value="${user.password || ''}" onchange="updateUser(${index}, 'password', this.value)" 
                                        style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                                    <button onclick="togglePasswordView(${index})" 
                                        style="background: #8b5cf6; color: white; border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 14px; min-width: 40px;">
                                        P
                                    </button>
                                    <button onclick="resetPassword(${index})" 
                                        style="background: #ef4444; color: white; border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 14px; min-width: 40px;">
                                        R
                                    </button>
                                </div>
                            </td>
                            <td style="padding: 15px;">
                                <input id="passconf-${index}" type="${passwordVisible ? 'text' : 'password'}" value="${user.passwordConfirm || ''}" onchange="updateUser(${index}, 'passwordConfirm', this.value)" 
                                    style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                            </td>
                            <td style="padding: 15px;">
                                <input type="text" value="${user.accessKey || ''}" onchange="updateUser(${index}, 'accessKey', this.value)" 
                                    style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; font-family: monospace;">
                            </td>
                            <td style="padding: 15px;">
                                <div class="autocomplete-container">
                                    <input type="text" value="${user.userCode || ''}" 
                                        onchange="updateUser(${index}, 'userCode', this.value)"
                                        oninput="showAutocompleteSuggestions(this, ${index})"
                                        onfocus="showAutocompleteSuggestions(this, ${index})"
                                        onblur="setTimeout(() => hideAutocompleteSuggestions(${index}), 200)"
                                        id="userCode-gm-${index}"
                                        placeholder="Scrie: A1, B5, Z50..."
                                        autocomplete="off"
                                        style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; font-family: monospace; text-transform: uppercase;">
                                    <div id="suggestions-gm-${index}" class="autocomplete-suggestions" style="display: none;"></div>
                                </div>
                            </td>
                            <td style="padding: 15px;">
                                <select value="${user.userRole || 'Animator'}" onchange="updateUser(${index}, 'userRole', this.value)" 
                                    style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; cursor: pointer; background: white;">
                                    <option value="Animator" ${(user.userRole || 'Animator') === 'Animator' ? 'selected' : ''}>Animator</option>
                                    <option value="Animator + Bagaje" ${user.userRole === 'Animator + Bagaje' ? 'selected' : ''}>Animator + Bagaje</option>
                                    <option value="Animator Bagaje + Trainer" ${user.userRole === 'Animator Bagaje + Trainer' ? 'selected' : ''}>Animator Bagaje + Trainer</option>
                                </select>
                            </td>
                            <td style="padding: 15px; text-align: center;">
                                <div style="display: flex; flex-direction: column; gap: 5px; align-items: center;">
                                    <span style="padding: 8px 16px; background: ${statusBg}; color: ${statusColor}; border-radius: 8px; font-size: 13px; font-weight: 700;">${statusText}</span>
                                    ${failedAttempts > 0 ? `<span style="font-size: 11px; color: #ef4444;">âš ï¸ ${failedAttempts} Ã®ncercÄƒri</span>` : ''}
                                </div>
                            </td>
                            <td style="padding: 15px; text-align: center;">
                                <button onclick="openChatHistory('${user.email || ''}')" 
                                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: 700; transition: all 0.3s; font-size: 13px; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);">
                                    ğŸ’¬ Vezi Chat
                                </button>
                            </td>
                            <td style="padding: 15px; text-align: center;">
                                <div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">
                                    <button onclick="toggleBlockUser(${index})" 
                                        style="background: ${isBlocked ? '#10b981' : '#ef4444'}; color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: 700; transition: all 0.3s; font-size: 13px;">
                                        ${isBlocked ? 'ğŸ”“ DeblocheazÄƒ' : 'ğŸ”’ BlocheazÄƒ'}
                                    </button>
                                    <button onclick="deleteUser(${index})" 
                                        style="background: #fee2e2; color: #dc2626; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: 700; transition: all 0.3s; font-size: 13px;">
                                        ğŸ—‘ï¸ È˜terge
                                    </button>
                                </div>
                            </td>
                        `;
                        tbodyGM.appendChild(row);
                    });
                }
            }
        }

        // Add new user row
        function addNewUserRow() {
            usersData.push({
                name: '',
                email: '',
                password: '',
                passwordConfirm: '',
                accessKey: '',
                userCode: '',
                userRole: 'Animator', // Default role
                blocked: false,
                failedAttempts: 0
            });
            renderUsersTable();
        }

        // Update user field
        function updateUser(index, field, value) {
            if (usersData[index]) {
                usersData[index][field] = value;
            }
        }
        
        // Toggle password VIEW (P button) - just show/hide
        function togglePasswordView(index) {
            if (usersData[index]) {
                const currentVisibility = usersData[index].passwordVisible || false;
                usersData[index].passwordVisible = !currentVisibility;
                renderUsersTable();
            }
        }
        
        // Reset password (R button) - clear fields
        function resetPassword(index) {
            if (usersData[index]) {
                if (confirm('Sigur vrei sÄƒ resetezi parola pentru acest utilizator?')) {
                    usersData[index].password = '';
                    usersData[index].passwordConfirm = '';
                    usersData[index].passwordVisible = true; // Keep visible for editing
                    renderUsersTable();
                    saveUsersData();
                    alert('ğŸ”„ ParolÄƒ resetatÄƒ! Utilizatorul poate seta o parolÄƒ nouÄƒ.');
                }
            }
        }
        
        // Toggle block/unblock user
        function toggleBlockUser(index) {
            if (usersData[index]) {
                const currentStatus = usersData[index].blocked || false;
                usersData[index].blocked = !currentStatus;
                
                // Reset failed attempts when unblocking
                if (!usersData[index].blocked) {
                    usersData[index].failedAttempts = 0;
                }
                
                renderUsersTable();
                saveUsersData();
                
                const newStatus = usersData[index].blocked ? 'blocat' : 'deblocat';
                alert(`âœ… Utilizator ${usersData[index].name} a fost ${newStatus}!`);
            }
        }

        // Delete user
        function deleteUser(index) {
            if (confirm('Sigur vrei sÄƒ È™tergi acest utilizator?')) {
                usersData.splice(index, 1);
                renderUsersTable();
                saveUsersData();
            }
        }

        // Save all users
        function saveAllUsers() {
            // Validate data
            let hasErrors = false;
            usersData.forEach((user, index) => {
                if (!user.name || !user.email || !user.password) {
                    alert(`âŒ Utilizatorul ${index + 1}: CompleteazÄƒ Nume, Email È™i ParolÄƒ!`);
                    hasErrors = true;
                    return;
                }
                if (user.password !== user.passwordConfirm) {
                    alert(`âŒ Utilizatorul ${index + 1}: Parolele nu se potrivesc!`);
                    hasErrors = true;
                    return;
                }
            });

            if (!hasErrors) {
                saveUsersData();
                alert('âœ… ToÈ›i utilizatorii au fost salvaÈ›i cu succes!');
            }
        }

        // Initialize users table when page is shown
        document.addEventListener('DOMContentLoaded', function() {
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    const usersPage = document.getElementById('gestionare-utilizatori');
                    if (usersPage && usersPage.style.display !== 'none') {
                        loadUsersData();
                    }
                });
            });
            
            observer.observe(document.body, {
                attributes: true,
                subtree: true,
                attributeFilter: ['style']
            });
        });
        // CREIER AI FUNCTIONS
        function showCreierAI() {
            // Hide users table section
            document.querySelector('#mod-gm > div:nth-child(4)').style.display = 'none'; // Date filter
            document.querySelector('#mod-gm > div:nth-child(5)').style.display = 'none'; // Users table
            document.querySelector('#mod-gm > div:nth-child(6)').style.display = 'none'; // Save button
            
            // Show Creier AI section
            document.getElementById('creierAISection').style.display = 'block';
            
            // Load existing knowledge base
            loadAIKnowledgeBase();
            
            // Load unanswered questions
            loadUnansweredQuestions();
        }
        
        function hideCreierAI() {
            // Show users table section
            document.querySelector('#mod-gm > div:nth-child(4)').style.display = 'block'; // Date filter
            document.querySelector('#mod-gm > div:nth-child(5)').style.display = 'block'; // Users table
            document.querySelector('#mod-gm > div:nth-child(6)').style.display = 'block'; // Save button
            
            // Hide Creier AI section
            document.getElementById('creierAISection').style.display = 'none';
        }
        
        function loadAIKnowledgeBase() {
            const knowledgeBase = localStorage.getItem('superparty_ai_knowledge_base') || '';
            document.getElementById('aiKnowledgeBase').value = knowledgeBase;
        }
        
        function saveAIKnowledgeBase() {
            const knowledgeBase = document.getElementById('aiKnowledgeBase').value;
            localStorage.setItem('superparty_ai_knowledge_base', knowledgeBase);
            alert('âœ… Creierul AI a fost salvat! AI-ul va folosi aceste informaÈ›ii Ã®n conversaÈ›ii.');
        }
        
        function loadUnansweredQuestions() {
            const unanswered = JSON.parse(localStorage.getItem('superparty_unanswered_questions') || '[]');
            const listDiv = document.getElementById('unansweredQuestionsList');
            
            if (unanswered.length === 0) {
                listDiv.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #9ca3af;">
                        <div style="font-size: 48px; margin-bottom: 15px;">âœ…</div>
                        <p>Nu existÄƒ Ã®ntrebÄƒri neacoperite momentan!</p>
                    </div>
                `;
                return;
            }
            
            // Sort by date (newest first)
            unanswered.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            let html = '';
            unanswered.forEach((item, index) => {
                const date = new Date(item.timestamp);
                const dateStr = date.toLocaleDateString('ro-RO', { 
                    day: 'numeric', 
                    month: 'short', 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                html += `
                    <div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 15px; margin-bottom: 10px; border-radius: 8px; cursor: pointer; transition: all 0.3s;"
                         onclick="addQuestionToKnowledge('${escapeHtml(item.question).replace(/'/g, "\\'")}', '${escapeHtml(item.aiResponse).replace(/'/g, "\\'")}')"
                         onmouseover="this.style.background='#fde68a'"
                         onmouseout="this.style.background='#fef3c7'">
                        <div style="font-size: 11px; color: #92400e; margin-bottom: 5px; font-weight: 600;">
                            ğŸ“… ${dateStr} | ğŸ‘¤ ${item.userEmail}
                        </div>
                        <div style="font-weight: 700; color: #78350f; margin-bottom: 8px;">
                            â“ ${escapeHtml(item.question)}
                        </div>
                        <div style="font-size: 13px; color: #92400e; background: white; padding: 8px; border-radius: 6px;">
                            ğŸ¤– RÄƒspuns dat: ${escapeHtml(item.aiResponse).substring(0, 100)}${item.aiResponse.length > 100 ? '...' : ''}
                        </div>
                        <div style="margin-top: 8px; font-size: 12px; color: #b45309; font-style: italic;">
                            ğŸ’¡ Click pentru a adÄƒuga Ã®n Creier AI
                        </div>
                    </div>
                `;
            });
            
            listDiv.innerHTML = html;
        }
        
        function addQuestionToKnowledge(question, aiResponse) {
            const textarea = document.getElementById('aiKnowledgeBase');
            const template = `\n\nÃntrebare: ${question}\nRÄƒspuns: [CompleteazÄƒ aici rÄƒspunsul corect]\n(RÄƒspuns AI anterior: ${aiResponse})\n`;
            textarea.value += template;
            textarea.focus();
            textarea.scrollTop = textarea.scrollHeight;
            alert('ğŸ“ Ãntrebarea a fost adÄƒugatÄƒ Ã®n Creier AI!\n\nCompleteazÄƒ rÄƒspunsul corect È™i salveazÄƒ.');
        }

        // CHAT HISTORY FUNCTIONS
        let currentChatFilterFrom = null;
        let currentChatFilterTo = null;
        
        function openChatHistory(userEmail) {
            if (!userEmail) {
                alert('Email utilizator invalid!');
                return;
            }
            
            // Get all conversation logs
            const allLogs = JSON.parse(localStorage.getItem('superparty_conversation_logs') || '[]');
            
            // Filter by user email
            let userLogs = allLogs.filter(log => log.email === userEmail);
            
            // Apply date filter if set
            if (currentChatFilterFrom && currentChatFilterTo) {
                userLogs = userLogs.filter(log => {
                    const logDate = log.date; // YYYY-MM-DD
                    return logDate >= currentChatFilterFrom && logDate <= currentChatFilterTo;
                });
            }
            
            // Get user name
            const userData = usersData.find(u => u.email === userEmail);
            const userName = userData ? userData.name : userEmail;
            
            // Update modal title
            document.getElementById('chatHistoryUserName').textContent = `ConversaÈ›ii - ${userName}`;
            
            // Build conversation HTML
            const contentDiv = document.getElementById('chatHistoryContent');
            
            if (userLogs.length === 0) {
                contentDiv.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #9ca3af;">
                        <div style="font-size: 64px; margin-bottom: 15px;">ğŸ’¬</div>
                        <p style="font-size: 18px; margin: 0;">Nu existÄƒ conversaÈ›ii pentru acest utilizator</p>
                        ${currentChatFilterFrom && currentChatFilterTo ? '<p style="font-size: 14px; margin-top: 10px;">Ã®n intervalul de timp selectat.</p>' : ''}
                    </div>
                `;
            } else {
                // Sort by timestamp (newest first)
                userLogs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                let html = '';
                userLogs.forEach((log, index) => {
                    const date = new Date(log.timestamp);
                    const dateStr = date.toLocaleDateString('ro-RO', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric', 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    html += `
                        <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                            <div style="font-size: 12px; color: #9ca3af; margin-bottom: 10px; font-weight: 600;">
                                ğŸ“… ${dateStr}
                            </div>
                            <div style="margin-bottom: 15px;">
                                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 16px; border-radius: 12px; display: inline-block; max-width: 80%;">
                                    <strong>ğŸ‘¤ User:</strong><br>
                                    <span style="white-space: pre-wrap;">${escapeHtml(log.userMessage)}</span>
                                </div>
                            </div>
                            <div>
                                <div style="background: #f3f4f6; color: #111827; padding: 12px 16px; border-radius: 12px; display: inline-block; max-width: 80%;">
                                    <strong>ğŸ¤– AI:</strong><br>
                                    <span style="white-space: pre-wrap;">${escapeHtml(log.aiResponse)}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                contentDiv.innerHTML = html;
            }
            
            // Show modal
            document.getElementById('chatHistoryModal').style.display = 'flex';
        }
        
        function closeChatHistory() {
            document.getElementById('chatHistoryModal').style.display = 'none';
        }
        
        function applyChatDateFilter() {
            const fromInput = document.getElementById('chatFilterFrom');
            const toInput = document.getElementById('chatFilterTo');
            
            if (!fromInput.value || !toInput.value) {
                alert('Te rog selecteazÄƒ ambele date (De la È™i PÃ¢nÄƒ la)!');
                return;
            }
            
            currentChatFilterFrom = fromInput.value;
            currentChatFilterTo = toInput.value;
            
            alert(`âœ… Filtru aplicat: ${currentChatFilterFrom} â†’ ${currentChatFilterTo}\n\nApasÄƒ "ğŸ’¬ Vezi Chat" pentru a vedea conversaÈ›iile filtrate.`);
        }
        
        function clearChatDateFilter() {
            currentChatFilterFrom = null;
            currentChatFilterTo = null;
            document.getElementById('chatFilterFrom').value = '';
            document.getElementById('chatFilterTo').value = '';
            alert('âŒ Filtrul de datÄƒ a fost resetat. Vei vedea toate conversaÈ›iile.');
        }

        // SILENT CONVERSATION LOGGING - Saves all AI conversations (NO user notification)
        function saveConversationToLog(userMessage, aiResponse) {
            try {
                // Get current logged-in user email
                const currentUser = localStorage.getItem('superparty_current_user');
                if (!currentUser) return; // Only log if user is logged in
                
                const userData = JSON.parse(currentUser);
                const userEmail = userData.email || 'unknown';
                
                // Get existing conversation logs
                let conversationLogs = JSON.parse(localStorage.getItem('superparty_conversation_logs') || '[]');
                
                // Create new conversation entry
                const logEntry = {
                    email: userEmail,
                    userMessage: userMessage,
                    aiResponse: aiResponse,
                    timestamp: new Date().toISOString(),
                    date: new Date().toISOString().split('T')[0] // YYYY-MM-DD for filtering
                };
                
                // Add to logs
                conversationLogs.push(logEntry);
                
                // Save back to localStorage (SILENTLY - no console.log, no alerts)
                localStorage.setItem('superparty_conversation_logs', JSON.stringify(conversationLogs));
            } catch (error) {
                // Silent fail - don't show any errors to user
            }
        }
        
        // SILENT LOGGING for unanswered questions (when AI used web search, not knowledge base)
        function saveUnansweredQuestion(question, aiResponse) {
            try {
                const currentUser = localStorage.getItem('superparty_current_user');
                if (!currentUser) return;
                
                const userData = JSON.parse(currentUser);
                const userEmail = userData.email || 'unknown';
                
                let unanswered = JSON.parse(localStorage.getItem('superparty_unanswered_questions') || '[]');
                
                // Check if question already exists (avoid duplicates)
                const exists = unanswered.some(item => 
                    item.question.toLowerCase() === question.toLowerCase()
                );
                
                if (!exists) {
                    unanswered.push({
                        question: question,
                        aiResponse: aiResponse,
                        userEmail: userEmail,
                        timestamp: new Date().toISOString()
                    });
                    
                    localStorage.setItem('superparty_unanswered_questions', JSON.stringify(unanswered));
                }
            } catch (error) {
                // Silent fail
            }
        }

        // Custom autocomplete for trainer codes (max 3 suggestions)
        function showAutocompleteSuggestions(input, index) {
            const value = input.value.toUpperCase();
            
            // Find the suggestions div - try both admin and gm IDs
            let suggestionsDiv = document.getElementById(`suggestions-admin-${index}`);
            if (!suggestionsDiv) {
                suggestionsDiv = document.getElementById(`suggestions-gm-${index}`);
            }
            
            if (!suggestionsDiv) return;
            
            if (!value) {
                suggestionsDiv.style.display = 'none';
                return;
            }
            
            // Generate all codes and filter
            const allCodes = generateAllTrainerCodes();
            const matches = allCodes.filter(code => code.startsWith(value));
            
            // Show only first 3 matches
            const topMatches = matches.slice(0, 3);
            
            if (topMatches.length === 0) {
                suggestionsDiv.style.display = 'none';
                return;
            }
            
            // Determine if admin or gm based on input id
            const tableType = input.id.includes('admin') ? 'admin' : 'gm';
            
            // Build suggestions HTML
            suggestionsDiv.innerHTML = topMatches.map(code => 
                `<div class="autocomplete-suggestion" onclick="selectAutocompleteSuggestion(${index}, '${code}', '${tableType}')">${code}</div>`
            ).join('');
            
            suggestionsDiv.style.display = 'block';
        }
        
        function selectAutocompleteSuggestion(index, code, tableType) {
            const input = document.getElementById(`userCode-${tableType}-${index}`);
            if (input) {
                input.value = code;
                updateUser(index, 'userCode', code);
            }
            hideAutocompleteSuggestions(index, tableType);
        }
        
        function hideAutocompleteSuggestions(index, tableType) {
            // Try both if tableType not specified
            if (!tableType) {
                ['admin', 'gm'].forEach(type => {
                    const suggestionsDiv = document.getElementById(`suggestions-${type}-${index}`);
                    if (suggestionsDiv) {
                        suggestionsDiv.style.display = 'none';
                    }
                });
            } else {
                const suggestionsDiv = document.getElementById(`suggestions-${tableType}-${index}`);
                if (suggestionsDiv) {
                    suggestionsDiv.style.display = 'none';
                }
            }
        }

    </script>
    <!-- Password Modal -->
    <div class="password-modal" id="passwordModal">
        <div class="password-modal-content">
            <h3>ğŸ”’ Acces RestricÈ›ionat</h3>
            <p style="color: #6b7280; margin-bottom: 20px;">Introdu parola pentru a accesa pagina secretÄƒ</p>
            <input type="password" id="passwordInput" placeholder="â€¢â€¢â€¢â€¢" maxlength="4">
            <div class="password-modal-buttons">
                <button class="password-cancel" onclick="closePasswordModal()">âŒ AnuleazÄƒ</button>
                <button class="password-submit" onclick="submitPassword()">âœ… AcceseazÄƒ</button>
            </div>
        </div>
    </div>
    
    <!-- Chat History Modal -->
    <div id="chatHistoryModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 20px; padding: 30px; max-width: 900px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0; color: #1f2937; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 32px;">ğŸ’¬</span>
                    <span id="chatHistoryUserName">Istoric ConversaÈ›ii</span>
                </h2>
                <button onclick="closeChatHistory()" style="background: #fee2e2; color: #dc2626; border: none; padding: 10px 20px; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer;">
                    âŒ Ãnchide
                </button>
            </div>
            
            <div id="chatHistoryContent" style="background: #f9fafb; border-radius: 15px; padding: 20px; min-height: 300px;">
                <!-- ConversaÈ›iile vor fi adÄƒugate aici -->
            </div>
        </div>
    </div>

    <!-- Custom autocomplete styling -->
    <style>
        .autocomplete-container {
            position: relative;
        }
        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #667eea;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 120px; /* Shows exactly 3 items at ~40px each */
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .autocomplete-suggestion {
            padding: 10px;
            cursor: pointer;
            font-family: monospace;
            font-size: 14px;
            border-bottom: 1px solid #e5e7eb;
        }
        .autocomplete-suggestion:last-child {
            border-bottom: none;
        }
        .autocomplete-suggestion:hover {
            background: #f0f4ff;
        }
    </style>

</body>
</html>
