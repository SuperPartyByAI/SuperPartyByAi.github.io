<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>SuperParty</title>
  <style>
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #1e293b;
      --text-soft: #64748b;
      --border: #e2e8f0;
      --radius: 12px;
      --success: #10B981;
      --warning: #F59E0B;
      --error: #EF4444;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* SIDEBAR */
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      width: 260px;
      height: 100vh;
      background: var(--card);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      z-index: 100;
      transition: transform 0.3s;
      overflow-y: auto;
    }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon { font-size: 28px; }
    .logo-text { font-weight: 700; font-size: 18px; }

    .sidebar-nav {
      flex: 1;
      overflow-y: auto;
      padding: 15px 0;
    }

    .nav-section { margin-bottom: 20px; }
    
    .nav-section-title {
      padding: 8px 20px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .nav-item {
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: all 0.15s;
      color: var(--text);
    }

    .nav-item:hover { background: var(--bg); }
    .nav-item.active { background: var(--primary); color: white; }
    .nav-item .icon { font-size: 18px; width: 24px; text-align: center; }

    /* MAIN */
    .main { margin-left: 260px; min-height: 100vh; }

    .header {
      background: var(--card);
      border-bottom: 1px solid var(--border);
      padding: 15px 25px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .menu-toggle {
      display: none;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      padding: 5px;
    }

    .page-title { font-size: 20px; font-weight: 600; }

    .content { padding: 25px; max-width: 1400px; }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    .card-title {
      font-weight: 600;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .welcome-card {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      border-radius: var(--radius);
      padding: 30px;
      margin-bottom: 25px;
    }

    .welcome-card h2 { margin-bottom: 8px; }
    .welcome-card p { opacity: 0.9; }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: var(--text-soft);
    }

    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.15s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover { background: var(--primary-dark); }
    
    .btn-success { background: var(--success); color: white; }
    .btn-warning { background: var(--warning); color: white; }
    .btn-error { background: var(--error); color: white; }
    .btn-secondary { background: var(--bg); color: var(--text); }

    /* TABLE */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    .data-table th, .data-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    .data-table th {
      font-weight: 600;
      background: var(--bg);
    }

    /* TABS */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid var(--border);
    }

    .tab {
      padding: 12px 20px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
      transition: all 0.2s;
      font-weight: 500;
    }

    .tab:hover { background: var(--bg); }
    .tab.active { border-bottom-color: var(--primary); color: var(--primary); }

    /* INPUTS */
    .input, .textarea, .select {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    .input:focus, .textarea:focus, .select:focus {
      outline: none;
      border-color: var(--primary);
    }

    .textarea {
      min-height: 120px;
      resize: vertical;
    }

    /* STATS */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 20px;
      border-radius: var(--radius);
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }

    /* BADGES */
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
    }

    .badge-success { background: #D1FAE5; color: #059669; }
    .badge-warning { background: #FEF3C7; color: #D97706; }
    .badge-error { background: #FEE2E2; color: #DC2626; }
    .badge-info { background: #DBEAFE; color: #2563EB; }

    /* RESULT CARDS */
    .result-card {
      background: var(--bg);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      border: 1px solid var(--border);
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .result-actions {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }

    /* CHARACTER COUNTER */
    .char-counter {
      font-size: 12px;
      color: var(--text-soft);
      margin-top: 5px;
    }

    .char-counter.warning { color: var(--warning); }
    .char-counter.error { color: var(--error); }

    /* TOAST */
    .toast-container {
      position: fixed;
      top: 80px;
      right: 20px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .toast {
      background: white;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from { transform: translateX(400px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .toast-success { border-left: 4px solid var(--success); }
    .toast-error { border-left: 4px solid var(--error); }
    .toast-warning { border-left: 4px solid var(--warning); }
    .toast-info { border-left: 4px solid var(--primary); }

    /* LOADING */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--text-soft);
    }

    .spinner {
      border: 3px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* MOBILE */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        width: 280px;
      }
      .sidebar.open { transform: translateX(0); }
      .main { margin-left: 0; }
      .menu-toggle { display: block; }
      .content { padding: 15px; }
      .stats-grid { grid-template-columns: 1fr; }
    }

    .overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 99;
    }
    .overlay.active { display: block; }

    /* CHAT */
    .chat-toggle {
      position: fixed;
      bottom: 25px;
      right: 25px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      color: white;
      border: none;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(59,130,246,0.4);
      z-index: 200;
      transition: transform 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chat-toggle:hover { transform: scale(1.1); }

    .chat-window {
      position: fixed;
      bottom: 100px;
      right: 25px;
      width: 380px;
      height: 500px;
      background: var(--card);
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      z-index: 200;
      overflow: hidden;
    }

    .chat-window.hidden { display: none; }

    .chat-header {
      padding: 15px 20px;
      background: var(--primary);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-header h3 { font-size: 16px; }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .chat-msg {
      max-width: 85%;
      padding: 10px 14px;
      border-radius: 12px;
      font-size: 14px;
      line-height: 1.4;
    }

    .chat-msg.user {
      background: var(--primary);
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }

    .chat-msg.ai {
      background: var(--bg);
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }

    .chat-input-area {
      padding: 15px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 10px;
    }

    .chat-input {
      flex: 1;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      outline: none;
    }

    .chat-input:focus { border-color: var(--primary); }

    .chat-send {
      padding: 12px 20px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
    }

    @media (max-width: 768px) {
      .chat-window {
        width: calc(100% - 20px);
        height: 60vh;
        right: 10px;
        bottom: 90px;
      }
    }

    /* SCAN POPUP */
    .scan-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--card);
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      z-index: 300;
      width: 90%;
      max-width: 400px;
    }

    .scan-popup.active { display: block; }

    .scan-popup h3 { margin-bottom: 15px; }

    .scan-popup .close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
    }

    .upload-area {
      border: 2px dashed var(--border);
      border-radius: 12px;
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .upload-area:hover { border-color: var(--primary); background: rgba(59,130,246,0.05); }
    .upload-area .icon { font-size: 40px; margin-bottom: 10px; }
    .upload-area p { color: var(--text-soft); font-size: 14px; }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: var(--radius);
    }
    
    .fade-in {
      animation: fadeIn 0.2s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="toast-container" id="toastContainer"></div>

  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <span class="logo-icon" id="logoIcon">üéâ</span>
      <span class="logo-text" id="logoText">SuperParty</span>
    </div>
    <nav class="sidebar-nav" id="sidebarNav"></nav>
  </aside>

  <div class="overlay" id="overlay"></div>

  <main class="main">
    <header class="header">
      <button class="menu-toggle" id="menuToggle">‚ò∞</button>
      <h1 class="page-title" id="pageTitle">AcasƒÉ</h1>
      <div id="headerRight"></div>
    </header>
    <div class="content" id="content"></div>
  </main>

  <button class="chat-toggle" id="chatToggle">ü§ñ</button>

  <div class="scan-popup" id="scanPopup">
    <button class="close-btn" onclick="closeScanPopup()">‚úï</button>
    <h3 id="scanPopupTitle">üì∑ ScaneazƒÉ document</h3>
    <div class="upload-area" id="uploadArea">
      <div class="icon">üì§</div>
      <p>Click sau trage fi»ôierul</p>
      <input type="file" id="fileInput" accept="image/*,.pdf" style="display:none;">
    </div>
    <div id="scanStatus" style="display:none;text-align:center;padding:20px;"></div>
  </div>

  <div class="chat-window hidden" id="chatWindow">
    <div class="chat-header">
      <div style="display:flex;align-items:center;gap:8px;">
        <span>ü§ñ</span>
        <h3>SuperParty AI</h3>
      </div>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input-area">
      <input type="text" class="chat-input" id="chatInput" placeholder="Scrie un mesaj...">
      <button class="chat-send" id="chatSend">Trimite</button>
    </div>
  </div>

  <script>
    // ===== CONFIG - MODIFICƒÇ DOAR AICI! =====
    const BACKEND_URL = "https://script.google.com/macros/s/AKfycbyfyw63pxz5z6hW0abaQXEvu1aU1OPSykc2v8Jz23-z2RFY14rw1zU90ETUEn8TLZXd/exec";
    const GM_PASSWORD = "Gmandrei209512!";
    const ADMIN_PASSWORD = "Adminandrei209512!";

    // ===== STATE =====
    let currentMode = "standard";
    let editMode = false;
    let currentPage = null;
    let currentGMPage = null;
    let appData = { pagini: [], tabele: [], elemente: [], scanari: [], stiluri: {} };
    let currentScanType = null;
    let currentGenResults = { seo: [], ads: [] };
    
    // USER SESSION
    let currentUser = null;
    let isLoggedIn = false;
    const savedUser = localStorage.getItem('superparty_user');
    if (savedUser) { try { currentUser = JSON.parse(savedUser); isLoggedIn = true; } catch(e) {} }
    
    function saveUserSession(user) { currentUser = user; isLoggedIn = true; localStorage.setItem('superparty_user', JSON.stringify(user)); }
    function clearUserSession() { currentUser = null; isLoggedIn = false; localStorage.removeItem('superparty_user'); }

    // CACHE
    const cache = {
      tables: {},
      cunostinte: null,
      deVerificat: null,
      reguli: null,
      conversatii: null
    };

    // ===== ELEMENTS =====
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    const menuToggle = document.getElementById("menuToggle");
    const sidebarNav = document.getElementById("sidebarNav");
    const pageTitle = document.getElementById("pageTitle");
    const content = document.getElementById("content");
    const chatToggle = document.getElementById("chatToggle");
    const chatWindow = document.getElementById("chatWindow");
    const chatMessages = document.getElementById("chatMessages");
    const chatInput = document.getElementById("chatInput");
    const chatSend = document.getElementById("chatSend");
    const scanPopup = document.getElementById("scanPopup");
    const uploadArea = document.getElementById("uploadArea");
    const fileInput = document.getElementById("fileInput");
    const scanStatus = document.getElementById("scanStatus");
    const toastContainer = document.getElementById("toastContainer");

    // ===== UTILITY FUNCTIONS =====
    function showToast(message, type = 'info', duration = 4000) {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      const icons = { success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' };
      toast.innerHTML = `<span style="font-size:20px;">${icons[type]}</span><span>${message}</span>`;
      toastContainer.appendChild(toast);
      setTimeout(() => {
        toast.style.animation = 'slideIn 0.3s ease-out reverse';
        setTimeout(() => toast.remove(), 300);
      }, duration);
    }

    function formatCost(cost) {
      return '$' + parseFloat(cost).toFixed(4);
    }

    function formatQuality(quality) {
      const q = parseInt(quality);
      if (q >= 90) return `<span class="badge badge-success">${q}%</span>`;
      if (q >= 75) return `<span class="badge badge-warning">${q}%</span>`;
      return `<span class="badge badge-error">${q}%</span>`;
    }

    // ===== EVENTS =====
    menuToggle.addEventListener("click", () => {
      sidebar.classList.toggle("open");
      overlay.classList.toggle("active");
    });

    overlay.addEventListener("click", () => {
      sidebar.classList.remove("open");
      overlay.classList.remove("active");
      closeScanPopup();
    });

    chatToggle.addEventListener("click", () => chatWindow.classList.toggle("hidden"));
    chatSend.addEventListener("click", handleChatSend);
    chatInput.addEventListener("keypress", (e) => { if (e.key === "Enter") handleChatSend(); });

    // ===== LOAD APP (OPTIMIZED - INSTANT!) =====
    async function loadApp() {
      // INSTANT: Afi»ôeazƒÉ imediat pagina de bun venit
      showWelcomePage();
      renderNav(); // RendereazƒÉ nav chiar »ôi gol la √Ænceput
      
      // BACKGROUND: √éncarcƒÉ datele fƒÉrƒÉ sƒÉ blocheze UI-ul
      try {
        // Fetch √Æn paralel pentru vitezƒÉ maximƒÉ
        const [appResponse, configResponse] = await Promise.all([
          fetch(BACKEND_URL + "?action=loadApp").catch(() => null),
          fetch(BACKEND_URL + "?action=loadPageConfig").catch(() => null)
        ]);
        
        if (appResponse) {
          const data = await appResponse.json();
          if (data.ok) {
            appData = data.data;
          }
        }
        
        if (configResponse) {
          const configData = await configResponse.json();
          if (configData.ok) {
            appData.filters = configData.data.filters || [];
            appData.formulas = configData.data.formulas || [];
            appData.progressBars = configData.data.progressBars || [];
            appData.tableSorts = configData.data.tableSorts || [];
            appData.pageStyles = configData.data.pageStyles || {};
          }
        }
        
        applyStyles();
        renderNav();
        
        // NavigheazƒÉ la prima paginƒÉ doar dacƒÉ avem date
        if (appData.pagini.length > 0) {
          const firstPage = appData.pagini.find(p => p.vizibil && (p.mod === "normal" || p.mod === "all"));
          if (firstPage) navigateTo(firstPage);
        }
      } catch (e) {
        console.log("Background load error:", e);
        // Nu afi»ôa eroare - pagina de bun venit e deja vizibilƒÉ
      }
    }
    
    function showWelcomePage() {
      const userName = isLoggedIn && currentUser ? currentUser.name : '';
      content.innerHTML = `
        <div class="welcome-card fade-in" style="background:linear-gradient(135deg,#3b82f6,#8b5cf6);">
          <h2>üéâ Bine ai venit${userName ? ', ' + userName : ''}!</h2>
          <p>SuperParty - Sistemul tƒÉu de management</p>
        </div>
      `;
    }
    
    function updateLoginButton() {
      // Login doar prin chat - nu mai e buton vizibil
    }

    // ===== APPLY STYLES =====
    function applyStyles() {
      const s = appData.stiluri;
      if (s.primary?.color) {
        document.documentElement.style.setProperty('--primary', s.primary.color);
        document.documentElement.style.setProperty('--primary-dark', shadeColor(s.primary.color, -20));
      }
      if (s.sidebar?.background) document.documentElement.style.setProperty('--card', s.sidebar.background);
      if (s.text?.color) document.documentElement.style.setProperty('--text', s.text.color);
      if (s.background?.color) document.documentElement.style.setProperty('--bg', s.background.color);
      if (s.app?.font) document.body.style.fontFamily = s.app.font + ', sans-serif';
      if (s.app?.title) {
        document.getElementById("logoText").textContent = s.app.title;
        document.title = s.app.title;
      }
      if (s.app?.logo) document.getElementById("logoIcon").textContent = s.app.logo;
      if (s.chat?.button) document.getElementById("chatToggle").textContent = s.chat.button;
    }

    function shadeColor(color, percent) {
      const num = parseInt(color.replace("#", ""), 16);
      const amt = Math.round(2.55 * percent);
      const R = (num >> 16) + amt;
      const G = (num >> 8 & 0x00FF) + amt;
      const B = (num & 0x0000FF) + amt;
      return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 + (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
    }

    // ===== RENDER NAV =====
    function renderNav() {
      let html = '';
      
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // UTILIZATOR NORMAL LOGAT (mod logare / mediu)
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      if (isLoggedIn && currentMode === "standard") {
        html += '<div class="nav-section"><div class="nav-section-title">Meniu</div>';
        html += `<div class="nav-item" data-page-id="home-user"><span class="icon">üè†</span><span>AcasƒÉ</span></div>`;
        html += `<div class="nav-item" data-page-id="events-user"><span class="icon">üéâ</span><span>Evenimente</span></div>`;
        html += `<div class="nav-item" data-page-id="profile-user"><span class="icon">üë§</span><span>Profil</span></div>`;
        html += '</div>';
        
        // Buton deconectare
        html += '<div class="nav-section" style="margin-top:auto;border-top:1px solid var(--border);padding-top:15px;">';
        html += `<div class="nav-item" onclick="logoutUser()" style="color:#ef4444;"><span class="icon">üö™</span><span>Deconectare</span></div>`;
        html += '</div>';
        
        sidebarNav.innerHTML = html;
        attachNavListeners();
        return;
      }
      
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // MOD STANDARD (nelogat) - doar paginile normale din appData
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      if (currentMode === "standard") {
        const normalPages = appData.pagini.filter(p => p.vizibil && (p.mod === "normal" || p.mod === "all"));
        if (normalPages.length > 0) {
          html += '<div class="nav-section"><div class="nav-section-title">Meniu</div>';
          normalPages.forEach(p => {
            html += `<div class="nav-item" data-page-id="${p.id}"><span class="icon">${p.icon || 'üìÑ'}</span><span>${p.nume}</span></div>`;
          });
          html += '</div>';
        }
        sidebarNav.innerHTML = html;
        attachNavListeners();
        return;
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // MOD ADMIN - vede Admin + Utilizatori
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      if (currentMode === "admin") {
        // Meniu normal
        const normalPages = appData.pagini.filter(p => p.vizibil && (p.mod === "normal" || p.mod === "all"));
        if (normalPages.length > 0) {
          html += '<div class="nav-section"><div class="nav-section-title">Meniu</div>';
          normalPages.forEach(p => {
            html += `<div class="nav-item" data-page-id="${p.id}"><span class="icon">${p.icon || 'üìÑ'}</span><span>${p.nume}</span></div>`;
          });
          html += '</div>';
        }
        
        // Admin pages
        const adminPages = appData.pagini.filter(p => p.vizibil && p.mod === "admin");
        if (adminPages.length > 0) {
          html += '<div class="nav-section"><div class="nav-section-title" style="color:#ef4444;">üîí Mod Admin</div>';
          adminPages.forEach(p => {
            html += `<div class="nav-item" data-page-id="${p.id}"><span class="icon">${p.icon || 'üìÑ'}</span><span>${p.nume}</span></div>`;
          });
          html += '</div>';
        }
        
        // Utilizatori - √Æn mod Admin
        html += '<div class="nav-section"><div class="nav-section-title">Utilizatori</div>';
        html += `<div class="nav-item" data-page-id="users-admin"><span class="icon">üë•</span><span>Gestionare Utilizatori</span></div>`;
        html += '</div>';
        
        sidebarNav.innerHTML = html;
        attachNavListeners();
        return;
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // MOD GM - vede GM + Utilizatori (NU Admin!)
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      if (currentMode === "gm") {
        // Meniu normal
        const normalPages = appData.pagini.filter(p => p.vizibil && (p.mod === "normal" || p.mod === "all"));
        if (normalPages.length > 0) {
          html += '<div class="nav-section"><div class="nav-section-title">Meniu</div>';
          normalPages.forEach(p => {
            html += `<div class="nav-item" data-page-id="${p.id}"><span class="icon">${p.icon || 'üìÑ'}</span><span>${p.nume}</span></div>`;
          });
          html += '</div>';
        }
        
        // GM Core
        const gmPages = appData.pagini.filter(p => p.vizibil && p.mod === "gm");
        html += '<div class="nav-section"><div class="nav-section-title" style="color:#8b5cf6;">üéÆ GM Core</div>';
        gmPages.forEach(p => {
          html += `<div class="nav-item" data-page-id="${p.id}"><span class="icon">${p.icon || 'üìÑ'}</span><span>${p.nume}</span></div>`;
        });
        html += `<div class="nav-item" data-page-id="creier-ai"><span class="icon">üß†</span><span>Creier AI</span></div>`;
        html += `<div class="nav-item" data-page-id="de-verificat"><span class="icon">‚úÖ</span><span>De verificat</span></div>`;
        html += `<div class="nav-item" data-page-id="reguli-fundamentale"><span class="icon">üîí</span><span>Reguli Fundamentale</span></div>`;
        html += `<div class="nav-item" data-page-id="conversatii"><span class="icon">üí¨</span><span>Conversa»õii</span></div>`;
        html += '</div>';
        
        // SEO & ADS
        html += '<div class="nav-section"><div class="nav-section-title">SEO & ADS</div>';
        html += `<div class="nav-item" data-page-id="seo-generator"><span class="icon">üé®</span><span>Generator SEO/Ads</span></div>`;
        html += `<div class="nav-item" data-page-id="seo-learning"><span class="icon">üìö</span><span>√énva»õƒÉ AI</span></div>`;
        html += `<div class="nav-item" data-page-id="seo-dashboard"><span class="icon">üìä</span><span>Dashboard</span></div>`;
        html += `<div class="nav-item" data-page-id="seo-coaching"><span class="icon">ü§ñ</span><span>AI Coaching</span></div>`;
        html += '</div>';
        
        // Utilizatori - √Æn mod GM
        html += '<div class="nav-section"><div class="nav-section-title">Utilizatori</div>';
        html += `<div class="nav-item" data-page-id="users-gm"><span class="icon">üë•</span><span>Gestionare Utilizatori</span></div>`;
        html += '</div>';
        
        sidebarNav.innerHTML = html;
        attachNavListeners();
        return;
      }
    }
    
    function attachNavListeners() {
      document.querySelectorAll(".nav-item").forEach(item => {
        item.addEventListener("click", () => {
          const pageId = item.dataset.pageId;
          
          // User pages (mod logare)
          if (pageId === "home-user") showUserHome();
          else if (pageId === "events-user") showUserEvents();
          else if (pageId === "profile-user") showUserProfile();
          // GM pages
          else if (pageId === "creier-ai") showCreierAI();
          else if (pageId === "de-verificat") showDeVerificat();
          else if (pageId === "reguli-fundamentale") showReguliFundamentale();
          else if (pageId === "conversatii") showConversatii();
          else if (pageId === "seo-generator") showSEOGenerator();
          else if (pageId === "seo-learning") showSEOLearning();
          else if (pageId === "seo-dashboard") showSEODashboard();
          else if (pageId === "seo-coaching") showAICoaching();
          else if (pageId === "users-admin") showUsersAdmin();
          else if (pageId === "users-gm") showUsersGM();
          else {
            const page = appData.pagini.find(p => String(p.id) === pageId);
            if (page) navigateTo(page);
          }
          
          document.querySelectorAll(".nav-item").forEach(i => i.classList.remove("active"));
          item.classList.add("active");
          sidebar.classList.remove("open");
          overlay.classList.remove("active");
        });
      });
    }
    
    // ===== USER PAGES (MOD LOGARE) =====
    function showUserHome() {
      currentGMPage = "home-user"; currentPage = null;
      pageTitle.textContent = "AcasƒÉ";
      content.innerHTML = `
        <div class="welcome-card fade-in" style="background:linear-gradient(135deg,#3b82f6,#8b5cf6);">
          <h2>üéâ Bine ai venit, ${currentUser?.name || 'User'}!</h2>
          <p>SuperParty - Sistemul tƒÉu de management</p>
        </div>
        <div class="card fade-in">
          <div class="card-title">üìä Statistici rapide</div>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:15px;margin-top:15px;">
            <div style="background:#f0fdf4;padding:20px;border-radius:12px;text-align:center;">
              <div style="font-size:28px;font-weight:700;color:#22c55e;">12</div>
              <div style="font-size:12px;color:#6b7280;">Evenimente</div>
            </div>
            <div style="background:#eff6ff;padding:20px;border-radius:12px;text-align:center;">
              <div style="font-size:28px;font-weight:700;color:#3b82f6;">5</div>
              <div style="font-size:12px;color:#6b7280;">Luna aceasta</div>
            </div>
          </div>
        </div>
      `;
    }
    
    function showUserEvents() {
      currentGMPage = "events-user"; currentPage = null;
      pageTitle.textContent = "Evenimente";
      content.innerHTML = `
        <div class="card fade-in">
          <div class="card-title">üéâ Evenimentele tale</div>
          <p style="color:var(--text-soft);">Aici vor apƒÉrea evenimentele la care e»ôti alocat.</p>
          <div class="empty-state" style="margin-top:20px;">
            <div style="font-size:48px;margin-bottom:10px;">üìÖ</div>
            <div>Nu ai evenimente momentan</div>
          </div>
        </div>
      `;
    }
    
    function showUserProfile() {
      currentGMPage = "profile-user"; currentPage = null;
      pageTitle.textContent = "Profil";
      content.innerHTML = `
        <div class="card fade-in">
          <div class="card-title">üë§ Profilul tƒÉu</div>
          <div style="margin-top:20px;">
            <div style="display:flex;align-items:center;gap:20px;margin-bottom:20px;">
              <div style="width:80px;height:80px;background:linear-gradient(135deg,#3b82f6,#8b5cf6);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:32px;color:white;">
                ${(currentUser?.name || 'U')[0].toUpperCase()}
              </div>
              <div>
                <h3 style="margin:0;font-size:20px;">${currentUser?.name || 'User'}</h3>
                <p style="margin:5px 0 0;color:var(--text-soft);">${currentUser?.email || ''}</p>
                <span style="display:inline-block;margin-top:8px;padding:4px 12px;background:#ede9fe;color:#8b5cf6;border-radius:20px;font-size:12px;font-weight:600;">${currentUser?.role || 'Utilizator'}</span>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // ===== NAVIGATE (PƒÇSTRAT EXACT) =====
    function navigateTo(page) {
      currentPage = page;
      currentGMPage = null;
      pageTitle.textContent = page.nume;
      
      const pageTables = appData.tabele.filter(t => t.paginaId === page.id && t.vizibil !== false);
      const pageElements = (appData.elemente || []).filter(e => e.paginaId === page.id);
      const pageFilters = (appData.filters || []).filter(f => f.pageName === page.nume);
      const pageStyles = (appData.pageStyles || {})[page.nume] || {};
      
      let pageStyleCSS = '';
      if (pageStyles.background) pageStyleCSS += `background:${pageStyles.background};`;
      if (pageStyles.darkMode === 'true') pageStyleCSS += 'background:#1f2937;color:#f9fafb;';
      
      let html = `<div class="welcome-card fade-in" style="${pageStyleCSS}"><h2>${page.icon || ''} ${page.nume}</h2></div>`;
      
      if (pageFilters.length > 0) {
        html += '<div class="card fade-in"><div class="card-title">üîç Filtre</div><div style="display:flex;flex-wrap:wrap;gap:10px;">';
        pageFilters.forEach(filter => {
          const options = filter.options ? filter.options.split(',') : [];
          html += `<div style="flex:1;min-width:150px;">
            <label style="font-size:12px;color:var(--text-soft);">${filter.filterName}</label>
            <select class="chat-input" style="width:100%;padding:8px;margin-top:4px;" onchange="applyFilter('${filter.filterBy}', this.value)">
              <option value="">Toate</option>
              ${options.map(opt => `<option value="${opt.trim()}">${opt.trim()}</option>`).join('')}
            </select>
          </div>`;
        });
        html += '</div></div>';
      }
      
      if (pageElements.length > 0) {
        html += '<div class="card fade-in"><div class="card-title">Ac»õiuni</div><div>';
        pageElements.forEach(el => { html += renderElement(el); });
        html += '</div></div>';
      }
      
      if (pageTables.length === 0 && pageElements.length === 0) {
        html += '<div class="card fade-in"><div class="empty-state">PaginƒÉ goalƒÉ</div></div>';
      } else {
        pageTables.forEach(table => {
          const cachedData = cache.tables[table.numeTabel];
          if (cachedData) {
            html += `<div class="card fade-in" style="${pageStyleCSS}"><div class="card-title">${table.numeTabel}</div><div id="table-${table.numeTabel}">${renderAdvancedTable(cachedData, page.nume)}</div></div>`;
          } else {
            html += `<div class="card fade-in" style="${pageStyleCSS}"><div class="card-title">${table.numeTabel}</div><div id="table-${table.numeTabel}"><div class="skeleton" style="height:100px;"></div></div></div>`;
          }
        });
      }
      
      content.innerHTML = html;
      
      pageTables.forEach(table => loadTableData(table));
    }
    
    function renderAdvancedTable(data, pageName) {
      if (!data || !data.rows || data.rows.length === 0) {
        return '<div class="empty-state">Nicio √Ænregistrare</div>';
      }
      
      const progressBars = (appData.progressBars || []).filter(p => p.pageName === pageName);
      const formulas = (appData.formulas || []).filter(f => f.pageName === pageName);
      const sortConfig = (appData.tableSorts || []).find(s => s.pageName === pageName);
      
      let rows = [...data.rows];
      if (sortConfig) {
        const sortIndex = data.headers.indexOf(sortConfig.sortBy);
        if (sortIndex >= 0) {
          rows.sort((a, b) => {
            const valA = parseFloat(a[sortIndex]) || 0;
            const valB = parseFloat(b[sortIndex]) || 0;
            return sortConfig.order === 'asc' ? valA - valB : valB - valA;
          });
        }
      }
      
      let html = '<table class="data-table"><thead><tr>';
      data.headers.forEach(h => { html += `<th>${h}</th>`; });
      html += '</tr></thead><tbody>';
      
      rows.forEach((row, rowIndex) => {
        html += '<tr>';
        row.forEach((cell, colIndex) => {
          const colName = data.headers[colIndex];
          
          const progressConfig = progressBars.find(p => p.column === colName);
          if (progressConfig) {
            const maxColIndex = data.headers.indexOf(progressConfig.maxColumn);
            const maxVal = maxColIndex >= 0 ? parseFloat(row[maxColIndex]) || 100 : 100;
            const percent = Math.min(100, Math.round((parseFloat(cell) || 0) / maxVal * 100));
            html += `<td>
              <div style="display:flex;align-items:center;gap:8px;">
                <div style="flex:1;height:8px;background:#e5e7eb;border-radius:4px;overflow:hidden;">
                  <div style="width:${percent}%;height:100%;background:${progressConfig.color || '#22c55e'};transition:width 0.3s;"></div>
                </div>
                <span style="font-size:12px;font-weight:600;">${percent}%</span>
              </div>
            </td>`;
          }
          else if (colName === 'Pozitie' || colName === 'Pozi»õie') {
            const pos = parseInt(cell) || (rowIndex + 1);
            const medal = pos === 1 ? 'ü•á' : pos === 2 ? 'ü•à' : pos === 3 ? 'ü•â' : pos;
            html += `<td style="font-size:${pos <= 3 ? '20px' : '14px'};">${medal}</td>`;
          }
          else if (colName === 'Total' || colName === 'Venit' || colName === 'Pret' || colName === 'BaniGenerati') {
            const val = parseFloat(cell) || 0;
            html += `<td style="font-weight:600;color:#059669;">${val.toLocaleString('ro-RO')} lei</td>`;
          }
          else if (colName === 'Status') {
            const statusColors = {
              'confirmat': '#22c55e',
              '√Æn a»ôteptare': '#f59e0b',
              'anulat': '#ef4444'
            };
            const color = statusColors[cell?.toLowerCase()] || '#6b7280';
            html += `<td><span style="padding:4px 8px;border-radius:4px;background:${color}20;color:${color};font-size:12px;font-weight:600;">${cell || ''}</span></td>`;
          }
          else {
            html += `<td>${cell || ''}</td>`;
          }
        });
        html += '</tr>';
      });
      
      if (data.headers.includes('Total')) {
        const totalIndex = data.headers.indexOf('Total');
        const sum = rows.reduce((acc, row) => acc + (parseFloat(row[totalIndex]) || 0), 0);
        html += `<tr style="background:#f0fdf4;font-weight:bold;">
          <td colspan="${totalIndex}">TOTAL</td>
          <td style="color:#059669;">${sum.toLocaleString('ro-RO')} lei</td>
          ${totalIndex < data.headers.length - 1 ? `<td colspan="${data.headers.length - totalIndex - 1}"></td>` : ''}
        </tr>`;
      }
      
      html += '</tbody></table>';
      return html;
    }
    
    function renderTableHTML(data) {
      return renderAdvancedTable(data, '');
    }
    
    let activeFilters = {};
    
    function applyFilter(filterBy, value) {
      if (value) {
        activeFilters[filterBy] = value;
      } else {
        delete activeFilters[filterBy];
      }
      if (currentPage) {
        const pageTables = appData.tabele.filter(t => t.paginaId === currentPage.id);
        pageTables.forEach(table => loadTableData(table, activeFilters));
      }
    }

    function renderElement(el) {
      switch(el.tip) {
        case 'buton': return `<button class="btn btn-primary" style="margin:5px;">${el.nume}</button>`;
        case 'dropdown':
          const opts = el.optiuni ? el.optiuni.split(',').map(o => `<option>${o.trim()}</option>`).join('') : '';
          return `<div style="margin:10px 0;"><label style="display:block;margin-bottom:5px;">${el.nume}</label><select class="chat-input" style="width:200px;">${opts}</select></div>`;
        case 'checkbox': return `<label style="display:flex;align-items:center;gap:8px;margin:10px 0;cursor:pointer;"><input type="checkbox"><span>${el.nume}</span></label>`;
        default: return `<div style="margin:10px 0;"><label style="display:block;margin-bottom:5px;">${el.nume}</label><input type="text" class="chat-input" style="width:100%;"></div>`;
      }
    }

    async function loadTableData(table) {
      try {
        const response = await fetch(BACKEND_URL + "?action=loadTable&table=" + table.numeTabel);
        const data = await response.json();
        const container = document.getElementById("table-" + table.numeTabel);
        
        if (data.ok) {
          cache.tables[table.numeTabel] = data.data;
          
          if (container) {
            container.innerHTML = renderTableHTML(data.data);
          }
        }
      } catch (e) {
        const container = document.getElementById("table-" + table.numeTabel);
        if (container) container.innerHTML = '<div class="empty-state">Eroare</div>';
      }
    }

    // ===== GM PAGES (PƒÇSTRAT EXACT) =====
    async function showCreierAI() {
      currentGMPage = "creier-ai";
      currentPage = null;
      pageTitle.textContent = "Creier AI";

      if (cache.cunostinte) {
        renderCreierAI(cache.cunostinte);
        return;
      }

      content.innerHTML = '<div class="card"><div class="empty-state">Se √ÆncarcƒÉ Creierul AI...</div></div>';

      try {
        const resp = await fetch(BACKEND_URL + "?action=loadCunostinte");
        const data = await resp.json();

        if (data.ok) {
          cache.cunostinte = data.data || [];
          renderCreierAI(cache.cunostinte);
        } else {
          content.innerHTML = '<div class="card"><div class="empty-state">Nu s-au putut √ÆncƒÉrca datele pentru Creier AI.</div></div>';
        }
      } catch (e) {
        console.error(e);
        content.innerHTML = '<div class="card"><div class="empty-state">Eroare la √ÆncƒÉrcare Creier AI.</div></div>';
      }
    }
    
    function renderCreierAI(data) {
      let html = '<div class="welcome-card fade-in" style="background:linear-gradient(135deg,#8b5cf6,#7c3aed);"><h2>üß† Creier AI</h2><p>Tot ce »ôtie AI-ul</p></div>';
      
      if (data && data.length > 0) {
        const grouped = {};
        data.forEach(c => {
          const cat = c.categorie || 'general';
          if (!grouped[cat]) grouped[cat] = [];
          grouped[cat].push(c);
        });
        
        for (const cat in grouped) {
          html += `<div class="card fade-in"><div class="card-title">${cat.toUpperCase()}</div>`;
          grouped[cat].forEach(c => {
            html += `<div style="padding:8px 0;border-bottom:1px solid var(--border);">‚Ä¢ ${c.informatie}</div>`;
          });
          html += '</div>';
        }
      } else {
        html += '<div class="card fade-in"><div class="empty-state">AI-ul nu »ôtie nimic √ÆncƒÉ.<br><br>√énva»õƒÉ-l din chat: <code>√Ænva»õƒÉ: [informa»õie]</code></div></div>';
      }
      
      content.innerHTML = html;
    }

    async function showDeVerificat() {
      currentGMPage = "de-verificat";
      currentPage = null;
      pageTitle.textContent = "De verificat";

      if (cache.deVerificat) {
        renderDeVerificat(cache.deVerificat);
        return;
      }

      content.innerHTML = '<div class="card"><div class="empty-state">Se √ÆncarcƒÉ lista De verificat...</div></div>';

      try {
        const verResp = await fetch(BACKEND_URL + "?action=loadDeVerificat");
        const verData = await verResp.json();

        if (verData.ok) {
          cache.deVerificat = verData.data || [];
          renderDeVerificat(cache.deVerificat);
        } else {
          content.innerHTML = '<div class="card"><div class="empty-state">Nu s-au putut √ÆncƒÉrca datele De verificat.</div></div>';
        }
      } catch (e) {
        console.error(e);
        content.innerHTML = '<div class="card"><div class="empty-state">Eroare la √ÆncƒÉrcare pentru De verificat.</div></div>';
      }
    }
    
    function renderDeVerificat(data) {
      let html = '<div class="welcome-card fade-in" style="background:linear-gradient(135deg,#f59e0b,#d97706);"><h2>‚úÖ De verificat</h2><p>Cuno»ôtin»õe de la utilizatori</p></div>';
      
      if (data && data.length > 0) {
        data.forEach(item => {
          html += `<div class="card fade-in">
            <div style="margin-bottom:10px;"><strong>Sursa:</strong> ${item.sursa}</div>
            <div style="margin-bottom:15px;">${item.informatie}</div>
            <div style="display:flex;gap:10px;">
              <button class="btn btn-primary" onclick="verificaCunostinta('${item.id}', 'aproba')">‚úÖ AprobƒÉ</button>
              <button class="btn" style="background:#ef4444;color:white;" onclick="verificaCunostinta('${item.id}', 'respinge')">‚ùå Respinge</button>
            </div>
          </div>`;
        });
      } else {
        html += '<div class="card fade-in"><div class="empty-state">Nimic de verificat! üéâ</div></div>';
      }
      
      content.innerHTML = html;
    }

    async function verificaCunostinta(id, actiune) {
      try {
        const url = BACKEND_URL + "?action=verificaCunostinta&id=" + encodeURIComponent(id) + "&actiune=" + encodeURIComponent(actiune);
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.ok) {
          const verResp = await fetch(BACKEND_URL + "?action=loadDeVerificat");
          const verData = await verResp.json();
          if (verData.ok) {
            cache.deVerificat = verData.data;
            renderDeVerificat(cache.deVerificat);
          }
        } else {
          alert("‚ö†Ô∏è Eroare: " + (data.error || "Nu s-a putut verifica"));
        }
      } catch (e) { 
        console.error(e);
        alert("‚ö†Ô∏è Eroare conexiune");
      }
    }

    async function showReguliFundamentale() {
      currentGMPage = "reguli";
      currentPage = null;
      pageTitle.textContent = "Reguli Fundamentale";

      if (cache.reguli) {
        renderReguliFundamentale(cache.reguli);
        return;
      }

      content.innerHTML = '<div class="card"><div class="empty-state">Se √ÆncarcƒÉ regulile fundamentale...</div></div>';

      try {
        const regResp = await fetch(BACKEND_URL + "?action=loadReguli");
        const regData = await regResp.json();

        if (regData.ok) {
          cache.reguli = regData.data || [];
          renderReguliFundamentale(cache.reguli);
        } else {
          content.innerHTML = '<div class="card"><div class="empty-state">Nu s-au putut √ÆncƒÉrca regulile fundamentale.</div></div>';
        }
      } catch (e) {
        console.error(e);
        content.innerHTML = '<div class="card"><div class="empty-state">Eroare la √ÆncƒÉrcare pentru regulile fundamentale.</div></div>';
      }
    }
    
    function renderReguliFundamentale(data) {
      let html = '<div class="welcome-card fade-in" style="background:linear-gradient(135deg,#ef4444,#dc2626);"><h2>üîí Reguli Fundamentale</h2><p>Reguli pe care AI-ul le respectƒÉ MEREU</p></div>';
      
      html += '<div class="card fade-in"><div class="card-title">AdaugƒÉ RegulƒÉ NouƒÉ</div>';
      html += '<div style="display:flex;gap:10px;"><input type="text" id="regulaNoua" class="chat-input" style="flex:1;" placeholder="Ex: √éntotdeauna salutƒÉ clientul cu BunƒÉ ziua!">';
      html += '<button class="btn btn-primary" onclick="adaugaRegula()">+ AdaugƒÉ</button></div></div>';
      
      // SeparƒÉ reguli active »ôi inactive
      const reguliActive = data ? data.filter(r => r.activ === true) : [];
      const reguliInactive = data ? data.filter(r => r.activ === false) : [];
      
      // Reguli ACTIVE
      html += '<div class="card fade-in"><div class="card-title" style="color:#22c55e;">‚úÖ Reguli Active (' + reguliActive.length + ')</div>';
      
      if (reguliActive.length > 0) {
        reguliActive.forEach((r, idx) => {
          const regulaText = r.regula || '';
          const shortText = regulaText.length > 150 ? regulaText.substring(0, 150) + '...' : regulaText;
          html += `<div style="padding:12px;border-bottom:1px solid var(--border);background:#f0fdf4;">
            <div style="display:flex;justify-content:space-between;align-items:flex-start;">
              <div style="flex:1;">
                <strong style="color:#22c55e;">#${r.numar || idx + 1}</strong> 
                <span style="font-size:13px;">${shortText}</span>
              </div>
              <div style="display:flex;gap:5px;margin-left:10px;">
                <button class="btn" style="padding:3px 8px;font-size:11px;" onclick="toggleRegula('${r.id}', false)" title="DezactiveazƒÉ">‚è∏Ô∏è</button>
                <button class="btn" style="padding:3px 8px;font-size:11px;" onclick="veziRegulaCompleta('${r.id}')" title="Vezi complet">üëÅÔ∏è</button>
                <button class="btn" style="padding:3px 8px;font-size:11px;background:#ef4444;color:white;" onclick="stergeRegula('${r.id}')" title="»òterge">üóëÔ∏è</button>
              </div>
            </div>
          </div>`;
        });
      } else {
        html += '<div class="empty-state">Nicio regulƒÉ activƒÉ.</div>';
      }
      html += '</div>';
      
      // Reguli INACTIVE
      if (reguliInactive.length > 0) {
        html += '<div class="card fade-in"><div class="card-title" style="color:#6b7280;">‚è∏Ô∏è Reguli Inactive (' + reguliInactive.length + ')</div>';
        reguliInactive.forEach((r, idx) => {
          const regulaText = r.regula || '';
          const shortText = regulaText.length > 100 ? regulaText.substring(0, 100) + '...' : regulaText;
          html += `<div style="padding:10px;border-bottom:1px solid var(--border);background:#f9fafb;opacity:0.7;">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div style="flex:1;">
                <strong style="color:#9ca3af;">#${r.numar || idx + 1}</strong> 
                <span style="font-size:12px;color:#6b7280;">${shortText}</span>
              </div>
              <div style="display:flex;gap:5px;margin-left:10px;">
                <button class="btn" style="padding:3px 8px;font-size:11px;background:#22c55e;color:white;" onclick="toggleRegula('${r.id}', true)" title="ActiveazƒÉ">‚ñ∂Ô∏è</button>
                <button class="btn" style="padding:3px 8px;font-size:11px;background:#ef4444;color:white;" onclick="stergeRegula('${r.id}')" title="»òterge">üóëÔ∏è</button>
              </div>
            </div>
          </div>`;
        });
        html += '</div>';
      }
      
      content.innerHTML = html;
    }
    
    // Func»õie pentru a vedea regula completƒÉ
    function veziRegulaCompleta(id) {
      const regula = cache.reguli?.find(r => r.id === id);
      if (regula) {
        const modal = document.createElement('div');
        modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:9999;padding:20px;';
        modal.innerHTML = `
          <div style="background:white;border-radius:16px;max-width:800px;max-height:80vh;overflow-y:auto;padding:25px;width:100%;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
              <h3 style="margin:0;">RegulƒÉ #${regula.numar}</h3>
              <button onclick="this.closest('div').parentElement.remove()" style="background:none;border:none;font-size:24px;cursor:pointer;">‚úï</button>
            </div>
            <div style="white-space:pre-wrap;font-size:14px;line-height:1.6;background:#f8fafc;padding:15px;border-radius:8px;">${regula.regula}</div>
            <div style="margin-top:15px;text-align:right;">
              <span style="padding:4px 12px;background:${regula.activ ? '#dcfce7' : '#f3f4f6'};color:${regula.activ ? '#22c55e' : '#6b7280'};border-radius:20px;font-size:12px;">${regula.activ ? '‚úÖ ActivƒÉ' : '‚è∏Ô∏è InactivƒÉ'}</span>
            </div>
          </div>
        `;
        modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
        document.body.appendChild(modal);
      }
    }
    
    // Func»õie pentru toggle activ/inactiv
    async function toggleRegula(id, newState) {
      try {
        const url = BACKEND_URL + "?action=toggleRegula&id=" + encodeURIComponent(id) + "&activ=" + newState;
        const response = await fetch(url);
        const data = await response.json();
        if (data.ok) {
          cache.reguli = null;
          showReguliFundamentale();
        } else {
          alert("‚ö†Ô∏è Eroare: " + (data.error || "Nu s-a putut modifica"));
        }
      } catch (e) {
        alert("‚ö†Ô∏è Eroare conexiune");
      }
    }

    async function adaugaRegula() {
      const input = document.getElementById("regulaNoua");
      const regula = input ? input.value.trim() : "";
      if (!regula) return alert("Scrie o regulƒÉ!");
      
      try {
        const url = BACKEND_URL + "?action=adaugaRegula&regula=" + encodeURIComponent(regula);
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.ok) {
          const regResp = await fetch(BACKEND_URL + "?action=loadReguli");
          const regData = await regResp.json();
          if (regData.ok) {
            cache.reguli = regData.data;
            if (input) input.value = "";
            renderReguliFundamentale(cache.reguli);
          }
        } else {
          alert("‚ö†Ô∏è Eroare: " + (data.error || "Nu s-a putut adƒÉuga"));
        }
      } catch (e) { 
        console.error(e);
        alert("‚ö†Ô∏è Eroare conexiune");
      }
    }

    async function editeazaRegula(id, regulaVeche) {
      const regulaNoua = prompt("EditeazƒÉ regula:", regulaVeche);
      if (!regulaNoua || regulaNoua === regulaVeche) return;
      
      try {
        const url = BACKEND_URL + "?action=editeazaRegula&id=" + encodeURIComponent(id) + "&regula=" + encodeURIComponent(regulaNoua);
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.ok) {
          const regResp = await fetch(BACKEND_URL + "?action=loadReguli");
          const regData = await regResp.json();
          if (regData.ok) {
            cache.reguli = regData.data;
            renderReguliFundamentale(cache.reguli);
          }
        } else {
          alert("‚ö†Ô∏è Eroare: " + (data.error || "Nu s-a putut edita"));
        }
      } catch (e) { 
        console.error(e);
        alert("‚ö†Ô∏è Eroare conexiune");
      }
    }

    async function stergeRegula(id) {
      if (!confirm("Sigur »ôtergi aceastƒÉ regulƒÉ?")) return;
      
      try {
        const url = BACKEND_URL + "?action=stergeRegula&id=" + encodeURIComponent(id);
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.ok) {
          const regResp = await fetch(BACKEND_URL + "?action=loadReguli");
          const regData = await regResp.json();
          if (regData.ok) {
            cache.reguli = regData.data;
            renderReguliFundamentale(cache.reguli);
          }
        } else {
          alert("‚ö†Ô∏è Eroare: " + (data.error || "Nu s-a putut »ôterge"));
        }
      } catch (e) { 
        console.error(e);
        alert("‚ö†Ô∏è Eroare conexiune");
      }
    }

    async function showConversatii() {
      currentGMPage = "conversatii";
      currentPage = null;
      pageTitle.textContent = "Conversa»õii";

      if (cache.conversatii) {
        renderConversatii(cache.conversatii);
        return;
      }

      content.innerHTML = '<div class="card"><div class="empty-state">Se √ÆncarcƒÉ conversa»õiile...</div></div>';

      try {
        const convResp = await fetch(BACKEND_URL + "?action=loadConversatii");
        const convData = await convResp.json();

        if (convData.ok) {
          cache.conversatii = convData.data || [];
          renderConversatii(cache.conversatii);
        } else {
          content.innerHTML = '<div class="card"><div class="empty-state">Nu s-au putut √ÆncƒÉrca conversa»õiile.</div></div>';
        }
      } catch (e) {
        console.error(e);
        content.innerHTML = '<div class="card"><div class="empty-state">Eroare la √ÆncƒÉrcare pentru conversa»õii.</div></div>';
      }
    }
    
    function renderConversatii(data) {
      let html = '<div class="welcome-card fade-in" style="background:linear-gradient(135deg,#3b82f6,#2563eb);"><h2>üí¨ Conversa»õii</h2><p>Tot ce a √Æntrebat oricine</p></div>';
      
      if (data && data.length > 0) {
        data.forEach((c, idx) => {
          const timestamp = new Date(c.timestamp).toLocaleString('ro-RO');
          const statusIcon = c.status === 'ok' ? '‚úÖ' : c.status === 'corectat' ? 'üìù' : '‚è≥';
          const statusClass = c.status === 'ok' ? 'background:#d1fae5;' : c.status === 'corectat' ? 'background:#dbeafe;' : '';
          
          let corectiiHtml = '';
          if (c.corectii && c.corectii.length > 0) {
            corectiiHtml = '<div style="margin-top:12px;padding-top:12px;border-top:1px dashed var(--border);">';
            corectiiHtml += '<div style="font-size:12px;font-weight:600;color:var(--text-soft);margin-bottom:8px;">üìú Istoric modificƒÉri:</div>';
            c.corectii.forEach((cor, corIdx) => {
              const corTime = new Date(cor.timestamp).toLocaleString('ro-RO');
              corectiiHtml += `<div style="padding:8px;background:rgba(0,0,0,0.03);border-radius:6px;margin-bottom:6px;font-size:13px;">
                <span style="color:var(--text-soft);">#${corIdx + 1} ‚Ä¢ ${corTime}</span><br>
                <span style="color:#059669;">‚Üí "${cor.corectie}"</span>
              </div>`;
            });
            corectiiHtml += '</div>';
          }
          
          html += `<div class="card fade-in" style="${statusClass}">
            <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
              <strong>#${idx + 1}</strong>
              <span style="color:var(--text-soft);font-size:12px;">${statusIcon} ${timestamp} | ${c.user} (${c.mod})</span>
            </div>
            <div style="margin-bottom:8px;"><strong>User:</strong> "${c.mesaj}"</div>
            <div style="margin-bottom:12px;color:var(--text-soft);"><strong>AI:</strong> "${c.raspuns ? c.raspuns.substring(0, 200) : ''}${c.raspuns && c.raspuns.length > 200 ? '...' : ''}"</div>
            ${corectiiHtml}
            <div style="display:flex;gap:10px;margin-top:12px;">
              ${c.status !== 'ok' ? `<button class="btn btn-primary" style="padding:6px 12px;font-size:12px;" onclick="marcheazaOK('${c.id}')">‚úÖ OK</button>` : ''}
              <button class="btn" style="padding:6px 12px;font-size:12px;background:#f59e0b;color:white;" onclick="corecteazaConversatie('${c.id}', '${c.mesaj.replace(/'/g, "\\'")}')">‚úèÔ∏è ${c.corectii && c.corectii.length > 0 ? 'CorecteazƒÉ din nou' : 'CorecteazƒÉ'}</button>
            </div>
          </div>`;
        });
      } else {
        html += '<div class="card fade-in"><div class="empty-state">Nicio conversa»õie √ÆncƒÉ.</div></div>';
      }
      
      content.innerHTML = html;
    }

    async function marcheazaOK(id) {
      try {
        const url = BACKEND_URL + "?action=marcheazaOK&id=" + encodeURIComponent(id);
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.ok) {
          const convResp = await fetch(BACKEND_URL + "?action=loadConversatii");
          const convData = await convResp.json();
          if (convData.ok) {
            cache.conversatii = convData.data;
            renderConversatii(cache.conversatii);
          }
        } else {
          alert("‚ö†Ô∏è Eroare: " + (data.error || "Nu s-a putut marca"));
        }
      } catch (e) { 
        console.error(e);
        alert("‚ö†Ô∏è Eroare conexiune");
      }
    }

    async function corecteazaConversatie(id, mesajOriginal) {
      const corectie = prompt("Cum trebuia sƒÉ rƒÉspundƒÉ AI-ul la:\n\"" + mesajOriginal + "\"");
      if (!corectie) return;
      
      try {
        const url = BACKEND_URL + "?action=corecteazaConversatie&id=" + encodeURIComponent(id) + "&corectie=" + encodeURIComponent(corectie);
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.ok) {
          alert("‚úÖ AI-ul a √ÆnvƒÉ»õat din corec»õie!");
          const convResp = await fetch(BACKEND_URL + "?action=loadConversatii");
          const convData = await convResp.json();
          if (convData.ok) {
            cache.conversatii = convData.data;
            renderConversatii(cache.conversatii);
          }
        } else {
          alert("‚ö†Ô∏è Eroare: " + (data.error || "Nu s-a putut corecta"));
        }
      } catch (e) { 
        console.error(e);
        alert("‚ö†Ô∏è Eroare conexiune");
      }
    }

    // ===== SEO/ADS PAGES (NOU!) =====
    async function showSEOGenerator() {
      currentGMPage = "seo-generator";
      currentPage = null;
      pageTitle.textContent = "üé® Generator SEO/Ads";
      sidebar.classList.remove("open");
      overlay.classList.remove("active");
      
      content.innerHTML = `
        <div class="card">
          <div class="card-title"><span>Generator SEO/Ads</span></div>
          
          <div class="tabs">
            <div class="tab active" onclick="switchGenTab('seo')">üìÑ SEO Pages</div>
            <div class="tab" onclick="switchGenTab('ads')">üì¢ Google Ads</div>
          </div>
          
          <div id="gen-seo-tab">
            <div style="margin-bottom:20px;">
              <label style="display:block;margin-bottom:8px;font-weight:500;">üìù Brief SEO:</label>
              <textarea id="seo-brief" class="textarea" placeholder="Exemplu: GenereazƒÉ paginƒÉ SEO pentru animatori petreceri copii Bucure»ôti..."></textarea>
            </div>
            
            <div style="display:flex;gap:15px;margin-bottom:20px;">
              <div style="flex:1;">
                <label style="display:block;margin-bottom:8px;font-weight:500;">NumƒÉr pagini:</label>
                <select id="seo-num" class="select">
                  <option value="1">1 paginƒÉ</option>
                  <option value="2">2 pagini</option>
                  <option value="3" selected>3 pagini</option>
                </select>
              </div>
              <div style="flex:1;">
                <label style="display:block;margin-bottom:8px;font-weight:500;">Estimated:</label>
                <div style="padding:12px;background:var(--bg);border-radius:8px;">‚è±Ô∏è ~15s | üí∞ ~$0.06</div>
              </div>
            </div>
            
            <button class="btn btn-primary" onclick="generateSEO()" style="width:100%;">‚ú® GenereazƒÉ SEO Pages</button>
            <div id="seo-results" style="margin-top:30px;"></div>
          </div>
          
          <div id="gen-ads-tab" style="display:none;">
            <div style="margin-bottom:20px;">
              <label style="display:block;margin-bottom:8px;font-weight:500;">üìù Brief Ads:</label>
              <textarea id="ads-brief" class="textarea" placeholder="Exemplu: CreeazƒÉ 5 anun»õuri Google Ads pentru baloane cu heliu Bucure»ôti..."></textarea>
            </div>
            
            <div style="display:flex;gap:15px;margin-bottom:20px;">
              <div style="flex:1;">
                <label style="display:block;margin-bottom:8px;font-weight:500;">NumƒÉr ads:</label>
                <select id="ads-num" class="select">
                  <option value="3">3 ads</option>
                  <option value="5" selected>5 ads</option>
                  <option value="10">10 ads</option>
                </select>
              </div>
              <div style="flex:1;">
                <label style="display:block;margin-bottom:8px;font-weight:500;">Estimated:</label>
                <div style="padding:12px;background:var(--bg);border-radius:8px;">‚è±Ô∏è ~3s | üí∞ ~$0.002</div>
              </div>
            </div>
            
            <button class="btn btn-primary" onclick="generateAds()" style="width:100%;">üöÄ GenereazƒÉ Google Ads</button>
            <div id="ads-results" style="margin-top:30px;"></div>
          </div>
        </div>
      `;
    }

    function switchGenTab(tab) {
      document.querySelectorAll('.tabs .tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById('gen-seo-tab').style.display = tab === 'seo' ? 'block' : 'none';
      document.getElementById('gen-ads-tab').style.display = tab === 'ads' ? 'block' : 'none';
    }

    async function generateSEO() {
      const brief = document.getElementById('seo-brief').value.trim();
      const numPages = parseInt(document.getElementById('seo-num').value);
      
      if (!brief || brief.split(' ').length < 5) {
        showToast('Brief-ul e prea scurt! Minim 5 cuvinte.', 'warning');
        return;
      }
      
      const resultsDiv = document.getElementById('seo-results');
      resultsDiv.innerHTML = `<div class="loading"><div class="spinner"></div><div>‚è≥ Generez ${numPages} pagini SEO...</div></div>`;
      
      try {
        const response = await fetch(BACKEND_URL, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ action: 'generateSEO', brief: brief, numPages: numPages })
        });
        
        const data = await response.json();
        
        if (data.success) {
          currentGenResults.seo = data.pages;
          showToast(`‚úÖ ${data.pages.length} SEO pages generated!`, 'success');
          displaySEOResults(data.pages);
        } else {
          showToast('‚ùå Error: ' + data.error, 'error');
          resultsDiv.innerHTML = `<div class="empty-state"><div class="empty-state-icon">‚ùå</div><div>Generation failed: ${data.error}</div></div>`;
        }
      } catch (error) {
        showToast('‚ùå Error: ' + error, 'error');
        resultsDiv.innerHTML = `<div class="empty-state"><div class="empty-state-icon">‚ùå</div><div>Error: ${error}</div></div>`;
      }
    }

    function displaySEOResults(pages) {
      const resultsDiv = document.getElementById('seo-results');
      let html = '<h3 style="margin-bottom:15px;">‚úÖ Rezultate SEO:</h3>';
      
      pages.forEach((page, idx) => {
        const titleLen = page.metaTitle.length;
        const titleClass = titleLen < 30 || titleLen > 60 ? 'error' : titleLen > 55 ? 'warning' : '';
        const descLen = page.metaDescription.length;
        const descClass = descLen < 120 || descLen > 160 ? 'error' : descLen > 155 ? 'warning' : '';
        
        html += `
          <div class="result-card">
            <div class="result-header"><strong>üìÑ PaginƒÉ #${idx + 1}: ${page.pageTitle}</strong></div>
            <div style="margin:10px 0;">
              <strong>Meta Title:</strong> ${page.metaTitle}
              <div class="char-counter ${titleClass}">${titleLen} chars (30-60)</div>
            </div>
            <div style="margin:10px 0;">
              <strong>Meta Description:</strong> ${page.metaDescription}
              <div class="char-counter ${descClass}">${descLen} chars (120-160)</div>
            </div>
            <div style="margin:10px 0;"><strong>Slug:</strong> <code>${page.slug}</code></div>
            <div style="margin:10px 0;">
              <strong>Content:</strong> ${page.content.substring(0, 200)}...
            </div>
            <div class="result-actions">
              <button class="btn btn-success">‚úÖ AprobƒÉ</button>
              <button class="btn btn-secondary">üí¨ Feedback AI</button>
            </div>
          </div>
        `;
      });
      
      resultsDiv.innerHTML = html;
    }

    async function generateAds() {
      const brief = document.getElementById('ads-brief').value.trim();
      const numAds = parseInt(document.getElementById('ads-num').value);
      
      if (!brief || brief.split(' ').length < 5) {
        showToast('Brief-ul e prea scurt! Minim 5 cuvinte.', 'warning');
        return;
      }
      
      const resultsDiv = document.getElementById('ads-results');
      resultsDiv.innerHTML = `<div class="loading"><div class="spinner"></div><div>‚è≥ Generez ${numAds} Google Ads...</div></div>`;
      
      try {
        const response = await fetch(BACKEND_URL, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ action: 'generateAds', brief: brief, numAds: numAds })
        });
        
        const data = await response.json();
        
        if (data.success) {
          currentGenResults.ads = data.ads;
          showToast(`‚úÖ ${data.ads.length} ads generated!`, 'success');
          displayAdsResults(data.ads);
        } else {
          showToast('‚ùå Error: ' + data.error, 'error');
          resultsDiv.innerHTML = `<div class="empty-state"><div class="empty-state-icon">‚ùå</div><div>Generation failed</div></div>`;
        }
      } catch (error) {
        showToast('‚ùå Error: ' + error, 'error');
        resultsDiv.innerHTML = `<div class="empty-state"><div class="empty-state-icon">‚ùå</div><div>Error: ${error}</div></div>`;
      }
    }

    function displayAdsResults(ads) {
      const resultsDiv = document.getElementById('ads-results');
      let html = '<h3 style="margin-bottom:15px;">‚úÖ Rezultate Ads:</h3>';
      
      const angleColors = {
        emotional: '#EF4444',
        practic: '#3B82F6',
        urgenta: '#F59E0B',
        oferta: '#10B981'
      };
      
      ads.forEach((ad, idx) => {
        const h1Len = ad.headline1.length;
        const h2Len = ad.headline2.length;
        const d1Len = ad.description1.length;
        const d2Len = ad.description2.length;
        
        html += `
          <div class="result-card">
            <div class="result-header">
              <strong>üì¢ Ad #${idx + 1}: ${ad.campaign}</strong>
              <span class="badge" style="background:${angleColors[ad.angle]}20;color:${angleColors[ad.angle]};">${ad.angle}</span>
            </div>
            <div style="margin:10px 0;">
              <strong>Headline 1:</strong> ${ad.headline1}
              <div class="char-counter ${h1Len > 30 ? 'error' : h1Len > 28 ? 'warning' : ''}">${h1Len}/30 chars</div>
            </div>
            <div style="margin:10px 0;">
              <strong>Headline 2:</strong> ${ad.headline2}
              <div class="char-counter ${h2Len > 30 ? 'error' : h2Len > 28 ? 'warning' : ''}">${h2Len}/30 chars</div>
            </div>
            <div style="margin:10px 0;">
              <strong>Description 1:</strong> ${ad.description1}
              <div class="char-counter ${d1Len > 90 ? 'error' : d1Len > 85 ? 'warning' : ''}">${d1Len}/90 chars</div>
            </div>
            <div style="margin:10px 0;">
              <strong>Description 2:</strong> ${ad.description2}
              <div class="char-counter ${d2Len > 90 ? 'error' : d2Len > 85 ? 'warning' : ''}">${d2Len}/90 chars</div>
            </div>
            <div class="result-actions">
              <button class="btn btn-success">‚úÖ AprobƒÉ</button>
              <button class="btn btn-secondary">üí¨ Feedback AI</button>
            </div>
          </div>
        `;
      });
      
      resultsDiv.innerHTML = html;
    }

    async function showSEOLearning() {
      currentGMPage = "seo-learning";
      currentPage = null;
      pageTitle.textContent = "üìö √énva»õƒÉ SEO/Ads";
      sidebar.classList.remove("open");
      overlay.classList.remove("active");
      
      content.innerHTML = `
        <div class="card">
          <div class="card-title"><span>√énva»õƒÉ AI-ul Reguli »ôi Exemple</span></div>
          <div class="tabs">
            <div class="tab active" onclick="switchLearningTab('seo')">üìÑ Reguli SEO</div>
            <div class="tab" onclick="switchLearningTab('ads')">üì¢ Reguli Ads</div>
            <div class="tab" onclick="switchLearningTab('good')">‚úÖ Exemple BUNE</div>
            <div class="tab" onclick="switchLearningTab('bad')">‚ùå Exemple RELE</div>
          </div>
          <div id="learning-content" style="margin-top:20px;">
            <div id="tab-seo">
              <h3 style="margin-bottom:15px;">Reguli SEO Active (6)</h3>
              <div style="margin-bottom:30px;">
                <input type="text" id="seo-rule-input" class="input" placeholder="AdaugƒÉ regulƒÉ nouƒÉ..." style="margin-bottom:10px;">
                <button class="btn btn-primary" onclick="addSEORule()">‚ûï AdaugƒÉ RegulƒÉ</button>
              </div>
              <div class="result-card">
                <div class="result-header">
                  <strong>#1 - Meta Title</strong>
                  <div><button class="btn btn-secondary" style="padding:6px 12px;">‚úèÔ∏è</button></div>
                </div>
                <div style="margin-top:10px;">Meta title trebuie sƒÉ fie √Æntre 30-60 caractere</div>
              </div>
              <div class="result-card">
                <div class="result-header">
                  <strong>#2 - Slug</strong>
                  <div><button class="btn btn-secondary" style="padding:6px 12px;">‚úèÔ∏è</button></div>
                </div>
                <div style="margin-top:10px;">Slug √Æncepe cu / »ôi con»õine doar lowercase »ôi -</div>
              </div>
              <div class="result-card">
                <div class="result-header">
                  <strong>#3 - Meta Description</strong>
                  <div><button class="btn btn-secondary" style="padding:6px 12px;">‚úèÔ∏è</button></div>
                </div>
                <div style="margin-top:10px;">Meta description trebuie sƒÉ fie √Æntre 120-160 caractere</div>
              </div>
              <div class="result-card">
                <div class="result-header">
                  <strong>#4 - Content</strong>
                  <div><button class="btn btn-secondary" style="padding:6px 12px;">‚úèÔ∏è</button></div>
                </div>
                <div style="margin-top:10px;">Con»õinutul trebuie sƒÉ aibƒÉ minim 300 cuvinte »ôi 3 headings H2</div>
              </div>
              <div class="result-card">
                <div class="result-header">
                  <strong>#5 - Location</strong>
                  <div><button class="btn btn-secondary" style="padding:6px 12px;">‚úèÔ∏è</button></div>
                </div>
                <div style="margin-top:10px;">Include "Bucure»ôti" sau "Ilfov" √Æn meta title sau description</div>
              </div>
              <div class="result-card">
                <div class="result-header">
                  <strong>#6 - Brand</strong>
                  <div><button class="btn btn-secondary" style="padding:6px 12px;">‚úèÔ∏è</button></div>
                </div>
                <div style="margin-top:10px;">Men»õioneazƒÉ "SuperPartyByAi" √Æn con»õinut</div>
              </div>
            </div>
            <div id="tab-ads" style="display:none;">
              <h3 style="margin-bottom:15px;">Reguli Ads Active (5)</h3>
              <div style="margin-bottom:30px;">
                <input type="text" id="ads-rule-input" class="input" placeholder="AdaugƒÉ regulƒÉ nouƒÉ..." style="margin-bottom:10px;">
                <button class="btn btn-primary" onclick="addAdsRule()">‚ûï AdaugƒÉ RegulƒÉ</button>
              </div>
              <div class="result-card">
                <div class="result-header">
                  <strong>#1 - Headline Length</strong>
                  <div><button class="btn btn-secondary" style="padding:6px 12px;">‚úèÔ∏è</button></div>
                </div>
                <div style="margin-top:10px;">Headline 1 »ôi 2 maxim 30 caractere fiecare</div>
              </div>
              <div class="result-card">
                <div class="result-header">
                  <strong>#2 - Description Length</strong>
                  <div><button class="btn btn-secondary" style="padding:6px 12px;">‚úèÔ∏è</button></div>
                </div>
                <div style="margin-top:10px;">Description 1 »ôi 2 maxim 90 caractere fiecare</div>
              </div>
              <div class="result-card">
                <div class="result-header">
                  <strong>#3 - Location Required</strong>
                  <div><button class="btn btn-secondary" style="padding:6px 12px;">‚úèÔ∏è</button></div>
                </div>
                <div style="margin-top:10px;">Headline 1 sau Description 1 trebuie sƒÉ con»õinƒÉ "Bucure»ôti" sau "Ilfov"</div>
              </div>
              <div class="result-card">
                <div class="result-header">
                  <strong>#4 - CTA</strong>
                  <div><button class="btn btn-secondary" style="padding:6px 12px;">‚úèÔ∏è</button></div>
                </div>
                <div style="margin-top:10px;">Include Call-to-Action clar: "SunƒÉ acum", "RezervƒÉ", "ComandƒÉ"</div>
              </div>
              <div class="result-card">
                <div class="result-header">
                  <strong>#5 - Angle</strong>
                  <div><button class="btn btn-secondary" style="padding:6px 12px;">‚úèÔ∏è</button></div>
                </div>
                <div style="margin-top:10px;">Fiecare ad trebuie sƒÉ aibƒÉ un angle: emotional/practic/urgenta/oferta</div>
              </div>
            </div>
            <div id="tab-good" style="display:none;">
              <h3 style="margin-bottom:15px;">‚úÖ Exemple BUNE de SEO/Ads</h3>
              <div style="margin-bottom:30px;">
                <textarea id="good-example-input" class="input" placeholder="Paste un exemplu bun aici..." style="min-height:100px;margin-bottom:10px;"></textarea>
                <button class="btn btn-success" onclick="addGoodExample()">‚ûï AdaugƒÉ Exemplu BUN</button>
              </div>
              <div class="result-card" style="border-left:4px solid #10B981;">
                <div class="result-header"><strong>Exemplu SEO #1</strong></div>
                <div style="margin-top:10px;">
                  <strong>Meta Title:</strong> Animatori Petreceri Copii Bucure»ôti | SuperPartyByAi (52 chars) ‚úÖ<br>
                  <strong>Meta Desc:</strong> RezervƒÉ acum animatori profesioni»ôti pentru petreceri copii √Æn Bucure»ôti »ôi Ilfov. Personaje Disney, jocuri interactive, experien»õƒÉ 10+ ani. (142 chars) ‚úÖ
                </div>
              </div>
              <div class="result-card" style="border-left:4px solid #10B981;">
                <div class="result-header"><strong>Exemplu Ad #1</strong></div>
                <div style="margin-top:10px;">
                  <strong>H1:</strong> Animatori Petreceri Bucure»ôti (29/30) ‚úÖ<br>
                  <strong>H2:</strong> RezervƒÉ Acum - Disponibil! (25/30) ‚úÖ<br>
                  <strong>D1:</strong> Animatori profesioni»ôti pentru petreceri copii √Æn Bucure»ôti. Personaje Disney »ôi Marvel. (88/90) ‚úÖ
                </div>
              </div>
            </div>
            <div id="tab-bad" style="display:none;">
              <h3 style="margin-bottom:15px;">‚ùå Exemple RELE de SEO/Ads</h3>
              <div style="margin-bottom:30px;">
                <textarea id="bad-example-input" class="input" placeholder="Paste un exemplu rƒÉu aici..." style="min-height:100px;margin-bottom:10px;"></textarea>
                <button class="btn btn-error" onclick="addBadExample()">‚ûï AdaugƒÉ Exemplu RƒÇU</button>
              </div>
              <div class="result-card" style="border-left:4px solid #EF4444;">
                <div class="result-header"><strong>Exemplu SEO RƒÇU #1</strong></div>
                <div style="margin-top:10px;">
                  <strong>Meta Title:</strong> Animatori (9 chars) ‚ùå - Prea scurt!<br>
                  <strong>ProblemƒÉ:</strong> Nu con»õine loca»õia, nu are brand, sub 30 caractere
                </div>
              </div>
              <div class="result-card" style="border-left:4px solid #EF4444;">
                <div class="result-header"><strong>Exemplu Ad RƒÇU #1</strong></div>
                <div style="margin-top:10px;">
                  <strong>H1:</strong> Cei mai buni animatori pentru petrecerile copiilor dumneavoastrƒÉ (65/30) ‚ùå<br>
                  <strong>ProblemƒÉ:</strong> Headline depƒÉ»ôe»ôte 30 caractere, nu include loca»õia
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    function switchLearningTab(tab) {
      // Hide all tabs content
      document.getElementById('tab-seo').style.display = 'none';
      document.getElementById('tab-ads').style.display = 'none';
      document.getElementById('tab-good').style.display = 'none';
      document.getElementById('tab-bad').style.display = 'none';
      
      // Remove active from all tabs
      document.querySelectorAll('.tabs .tab').forEach(t => t.classList.remove('active'));
      
      // Show selected tab and mark as active
      document.getElementById('tab-' + tab).style.display = 'block';
      event.target.classList.add('active');
    }
    
    function addSEORule() {
      const input = document.getElementById('seo-rule-input');
      if (input.value.trim()) {
        showToast('‚úÖ RegulƒÉ SEO adƒÉugatƒÉ!', 'success');
        input.value = '';
      }
    }
    
    function addAdsRule() {
      const input = document.getElementById('ads-rule-input');
      if (input.value.trim()) {
        showToast('‚úÖ RegulƒÉ Ads adƒÉugatƒÉ!', 'success');
        input.value = '';
      }
    }
    
    function addGoodExample() {
      const input = document.getElementById('good-example-input');
      if (input.value.trim()) {
        showToast('‚úÖ Exemplu BUN adƒÉugat!', 'success');
        input.value = '';
      }
    }
    
    function addBadExample() {
      const input = document.getElementById('bad-example-input');
      if (input.value.trim()) {
        showToast('‚úÖ Exemplu RƒÇU adƒÉugat!', 'success');
        input.value = '';
      }
    }

    async function showSEODashboard() {
      currentGMPage = "seo-dashboard";
      currentPage = null;
      pageTitle.textContent = "üìä Dashboard SEO/Ads";
      sidebar.classList.remove("open");
      overlay.classList.remove("active");
      
      content.innerHTML = '<div class="loading"><div class="spinner"></div><div>Loading dashboard...</div></div>';
      
      try {
        const response = await fetch(BACKEND_URL + "?action=loadSEODashboard");
        const data = await response.json();
        
        if (data.ok) {
          displayDashboard(data.data);
        } else {
          content.innerHTML = '<div class="empty-state"><div style="font-size:48px;margin-bottom:15px;opacity:0.5;">‚ùå</div><div>Failed to load dashboard</div></div>';
        }
      } catch (error) {
        content.innerHTML = '<div class="empty-state"><div style="font-size:48px;margin-bottom:15px;opacity:0.5;">‚ùå</div><div>Error: ' + error + '</div></div>';
      }
    }

    function displayDashboard(data) {
      content.innerHTML = `
        <div class="stats-grid">
          <div class="stat-card" style="background:linear-gradient(135deg,#10B981,#059669);">
            <div class="stat-value">${data.seoCount || 0}</div>
            <div class="stat-label">üìÑ SEO Pages</div>
          </div>
          <div class="stat-card" style="background:linear-gradient(135deg,#3B82F6,#2563EB);">
            <div class="stat-value">${data.adsCount || 0}</div>
            <div class="stat-label">üì¢ Google Ads</div>
          </div>
          <div class="stat-card" style="background:linear-gradient(135deg,#8B5CF6,#7C3AED);">
            <div class="stat-value">${data.seoQuality || 0}%</div>
            <div class="stat-label">‚úÖ SEO Quality</div>
          </div>
          <div class="stat-card" style="background:linear-gradient(135deg,#F59E0B,#D97706);">
            <div class="stat-value">${data.adsQuality || 0}%</div>
            <div class="stat-label">‚úÖ Ads Quality</div>
          </div>
        </div>
        
        <div class="card">
          <div class="card-title"><span>Ultimele GenerƒÉri SEO</span></div>
          ${data.recentSEO && data.recentSEO.length > 0 ? 
            data.recentSEO.map(seo => `
              <div class="result-card">
                <div class="result-header">
                  <strong>${seo.title}</strong>
                  ${formatQuality(seo.quality)}
                </div>
                <div style="font-size:12px;color:var(--text-soft);margin-top:5px;">
                  ${new Date(seo.timestamp).toLocaleString('ro-RO')} | Tokens: ${seo.tokens} | Cost: ${formatCost(seo.cost)}
                </div>
              </div>
            `).join('') :
            '<div class="empty-state"><div style="font-size:48px;margin-bottom:10px;opacity:0.5;">üìÑ</div><div>No SEO pages yet</div></div>'
          }
        </div>
      `;
    }

    async function showAICoaching() {
      currentGMPage = "ai-coaching";
      currentPage = null;
      pageTitle.textContent = "ü§ñ AI Self-Coaching";
      sidebar.classList.remove("open");
      overlay.classList.remove("active");
      
      content.innerHTML = `
        <div class="card">
          <div class="card-title"><span>AI Self-Coaching System</span></div>
          <div class="tabs">
            <div class="tab active" onclick="switchCoachingTab('analiza')">üîç Auto-AnalizƒÉ</div>
            <div class="tab" onclick="switchCoachingTab('nevoie')">üìã Ce Am Nevoie</div>
            <div class="tab" onclick="switchCoachingTab('recomandari')">üí° RecomandƒÉri</div>
          </div>
          <div id="coaching-content" style="margin-top:20px;">
            <div id="coach-analiza">
              <div class="welcome-card" style="background:linear-gradient(135deg,#8B5CF6,#7C3AED);">
                <h2>üîç Auto-AnalizƒÉ AI</h2>
                <p>Ultima analizƒÉ: AstƒÉzi, 02:00 AM</p>
              </div>
              <div class="result-card">
                <div class="result-header"><strong>üìä Calitate GenerƒÉri</strong></div>
                <div style="margin-top:10px;">
                  <div style="margin-bottom:8px;">SEO Pages: <strong style="color:#10B981;">85% medie</strong></div>
                  <div style="margin-bottom:8px;">Google Ads: <strong style="color:#3B82F6;">92% medie</strong></div>
                  <div>Trend: <strong style="color:#10B981;">‚Üë +3% fa»õƒÉ de sƒÉptƒÉm√¢na trecutƒÉ</strong></div>
                </div>
              </div>
              <div class="result-card">
                <div class="result-header"><strong>‚ö†Ô∏è Probleme Detectate</strong></div>
                <div style="margin-top:10px;">
                  <div style="padding:8px;background:#FEF3C7;border-radius:6px;margin-bottom:8px;">
                    ‚Ä¢ 15% din meta titles sunt prea scurte (&lt;30 chars)
                  </div>
                  <div style="padding:8px;background:#FEF3C7;border-radius:6px;">
                    ‚Ä¢ 8% din ads nu au loca»õie √Æn headline
                  </div>
                </div>
              </div>
            </div>
            <div id="coach-nevoie" style="display:none;">
              <div class="welcome-card" style="background:linear-gradient(135deg,#F59E0B,#D97706);">
                <h2>üìã Ce Am Nevoie</h2>
                <p>Pentru a √ÆmbunƒÉtƒÉ»õi calitatea</p>
              </div>
              <div class="result-card">
                <div class="result-header"><strong>üìù Mai Multe Exemple</strong></div>
                <div style="margin-top:10px;">
                  <div style="padding:10px;background:#DBEAFE;border-radius:6px;margin-bottom:8px;">
                    <strong>SEO:</strong> Am nevoie de 5+ exemple de meta titles BUNE pentru "baloane heliu"
                  </div>
                  <div style="padding:10px;background:#DBEAFE;border-radius:6px;">
                    <strong>Ads:</strong> Am nevoie de 3+ exemple de headlines cu loca»õie pentru "arcade"
                  </div>
                </div>
              </div>
              <div class="result-card">
                <div class="result-header"><strong>üìö Reguli Noi Sugerate</strong></div>
                <div style="margin-top:10px;">
                  <div style="padding:10px;background:#D1FAE5;border-radius:6px;margin-bottom:8px;">
                    Sugestie: AdaugƒÉ regulƒÉ pentru CTA √Æn primele 50 caractere
                  </div>
                </div>
              </div>
            </div>
            <div id="coach-recomandari" style="display:none;">
              <div class="welcome-card" style="background:linear-gradient(135deg,#10B981,#059669);">
                <h2>üí° RecomandƒÉri AI</h2>
                <p>Ac»õiuni sugerate pentru √ÆmbunƒÉtƒÉ»õire</p>
              </div>
              <div class="result-card">
                <div class="result-header"><strong>üéØ Top 3 Ac»õiuni Prioritare</strong></div>
                <div style="margin-top:10px;">
                  <div style="padding:12px;background:#F0FDF4;border-radius:6px;margin-bottom:10px;border-left:4px solid #10B981;">
                    <strong>1. AdaugƒÉ exemple de meta titles lungi</strong><br>
                    <span style="color:var(--text-soft);">Impact estimat: +5% calitate SEO</span>
                  </div>
                  <div style="padding:12px;background:#F0FDF4;border-radius:6px;margin-bottom:10px;border-left:4px solid #10B981;">
                    <strong>2. CreeazƒÉ regulƒÉ pentru headlines cu loca»õie</strong><br>
                    <span style="color:var(--text-soft);">Impact estimat: +8% calitate Ads</span>
                  </div>
                  <div style="padding:12px;background:#F0FDF4;border-radius:6px;border-left:4px solid #10B981;">
                    <strong>3. AdaugƒÉ 10 exemple de ads "emotional"</strong><br>
                    <span style="color:var(--text-soft);">Impact estimat: +3% diversitate angle</span>
                  </div>
                </div>
              </div>
              <div class="result-card">
                <div class="result-header"><strong>üìÖ Programare AnalizƒÉ</strong></div>
                <div style="margin-top:10px;">
                  UrmƒÉtoarea analizƒÉ automatƒÉ: <strong>M√¢ine, 02:00 AM</strong>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    function switchCoachingTab(tab) {
      // Hide all tabs content
      document.getElementById('coach-analiza').style.display = 'none';
      document.getElementById('coach-nevoie').style.display = 'none';
      document.getElementById('coach-recomandari').style.display = 'none';
      
      // Remove active from all tabs
      document.querySelectorAll('.tabs .tab').forEach(t => t.classList.remove('active'));
      
      // Show selected tab and mark as active
      document.getElementById('coach-' + tab).style.display = 'block';
      event.target.classList.add('active');
    }

    // ===== USER MANAGEMENT =====
    async function showUsersAdmin() {
      currentGMPage = "users-admin"; currentPage = null;
      pageTitle.textContent = "Gestionare Utilizatori";
      content.innerHTML = '<div class="card"><div style="text-align:center;padding:30px;">‚è≥ Se √ÆncarcƒÉ...</div></div>';
      try {
        const r = await fetch(BACKEND_URL + '?action=getAllUsers');
        const d = await r.json();
        if (d.ok) {
          let html = '<div class="card fade-in"><div class="card-title">üë• Gestionare Utilizatori</div>';
          html += '<p style="color:var(--text-soft);margin-bottom:20px;">AprobƒÉ, blocheazƒÉ »ôi gestioneazƒÉ utilizatorii.</p>';
          html += '<table class="data-table"><thead><tr><th>Nume</th><th>Email</th><th>Rol</th><th>Status</th><th>Ac»õiuni</th></tr></thead><tbody>';
          (d.users || []).forEach(u => {
            const st = u.blocked ? 'üîí Blocat' : (u.approved ? '‚úÖ Activ' : '‚è≥ √én a»ôteptare');
            const cl = u.blocked ? '#ef4444' : (u.approved ? '#22c55e' : '#f59e0b');
            html += `<tr><td>${u.name||''}</td><td>${u.email||''}</td><td>${u.role||''}</td>`;
            html += `<td style="color:${cl};font-weight:600;">${st}</td><td>`;
            if (!u.approved && !u.blocked) html += `<button onclick="approveUser('${u.email}')" style="background:#22c55e;color:white;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;margin-right:5px;">‚úÖ AprobƒÉ</button>`;
            if (u.approved && !u.blocked) html += `<button onclick="blockUser('${u.email}')" style="background:#ef4444;color:white;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;">üîí BlocheazƒÉ</button>`;
            if (u.blocked) html += `<button onclick="unblockUser('${u.email}')" style="background:#3b82f6;color:white;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;">‚úÖ DeblocheazƒÉ</button>`;
            html += '</td></tr>';
          });
          html += '</tbody></table></div>';
          content.innerHTML = html;
        }
      } catch(e) { content.innerHTML = '<div class="card"><div class="empty-state">‚ùå Eroare</div></div>'; }
    }
    
    async function showUsersGM() {
      currentGMPage = "users-gm"; currentPage = null;
      pageTitle.textContent = "Utilizatori (Full)";
      content.innerHTML = '<div class="card"><div style="text-align:center;padding:30px;">‚è≥ Se √ÆncarcƒÉ...</div></div>';
      try {
        const r = await fetch(BACKEND_URL + '?action=getAllUsers');
        const d = await r.json();
        if (d.ok) {
          let html = '<div class="card fade-in"><div class="card-title">üë• Utilizatori (Full)</div>';
          html += '<p style="color:var(--text-soft);margin-bottom:20px;">Control complet + conversa»õii.</p>';
          html += '<table class="data-table"><thead><tr><th>Nume</th><th>Email</th><th>Rol</th><th>Status</th><th>Chat</th><th>Ac»õiuni</th></tr></thead><tbody>';
          (d.users || []).forEach(u => {
            const st = u.blocked ? 'üîí Blocat' : (u.approved ? '‚úÖ Activ' : '‚è≥ √én a»ôteptare');
            const cl = u.blocked ? '#ef4444' : (u.approved ? '#22c55e' : '#f59e0b');
            html += `<tr><td>${u.name||''}</td><td>${u.email||''}</td><td>${u.role||''}</td>`;
            html += `<td style="color:${cl};font-weight:600;">${st}</td>`;
            html += `<td><button onclick="viewUserChat('${u.email}')" style="background:#8b5cf6;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;">üí¨</button></td><td>`;
            if (!u.approved && !u.blocked) html += `<button onclick="approveUser('${u.email}')" style="background:#22c55e;color:white;border:none;padding:4px 8px;border-radius:4px;cursor:pointer;margin-right:3px;">‚úÖ</button>`;
            if (u.approved && !u.blocked) html += `<button onclick="blockUser('${u.email}')" style="background:#ef4444;color:white;border:none;padding:4px 8px;border-radius:4px;cursor:pointer;margin-right:3px;">üîí</button>`;
            if (u.blocked) html += `<button onclick="unblockUser('${u.email}')" style="background:#3b82f6;color:white;border:none;padding:4px 8px;border-radius:4px;cursor:pointer;margin-right:3px;">‚úÖ</button>`;
            html += `<button onclick="deleteUser('${u.email}')" style="background:#dc2626;color:white;border:none;padding:4px 8px;border-radius:4px;cursor:pointer;">üóëÔ∏è</button></td></tr>`;
          });
          html += '</tbody></table></div>';
          content.innerHTML = html;
        }
      } catch(e) { content.innerHTML = '<div class="card"><div class="empty-state">‚ùå Eroare</div></div>'; }
    }
    
    async function approveUser(email) {
      if (!confirm('Aprobi utilizatorul?')) return;
      await fetch(BACKEND_URL + '?action=approveUser&email=' + encodeURIComponent(email));
      if (currentGMPage === 'users-admin') showUsersAdmin(); else showUsersGM();
    }
    
    async function blockUser(email) {
      if (!confirm('Blochezi utilizatorul?')) return;
      await fetch(BACKEND_URL + '?action=blockUser&email=' + encodeURIComponent(email));
      if (currentGMPage === 'users-admin') showUsersAdmin(); else showUsersGM();
    }
    
    async function unblockUser(email) {
      if (!confirm('Deblochezi utilizatorul?')) return;
      await fetch(BACKEND_URL + '?action=unblockUser&email=' + encodeURIComponent(email));
      if (currentGMPage === 'users-admin') showUsersAdmin(); else showUsersGM();
    }
    
    async function deleteUser(email) {
      if (!confirm('‚ö†Ô∏è »òtergi definitiv utilizatorul?')) return;
      await fetch(BACKEND_URL + '?action=deleteUser&email=' + encodeURIComponent(email));
      showUsersGM();
    }
    
    async function viewUserChat(email) {
      const r = await fetch(BACKEND_URL + '?action=getUserConversations&identifier=' + encodeURIComponent(email));
      const d = await r.json();
      let ch = '<div style="max-height:400px;overflow-y:auto;">';
      if (d.ok && d.conversations?.length > 0) {
        d.conversations.forEach(c => {
          ch += `<div style="margin-bottom:15px;"><div style="background:#ede9fe;padding:10px;border-radius:8px;margin-bottom:5px;"><b>üë§:</b> ${c.userMessage}</div><div style="background:#f3f4f6;padding:10px;border-radius:8px;"><b>ü§ñ:</b> ${c.aiResponse}</div><div style="font-size:11px;color:#6b7280;margin-top:5px;">${c.timestamp}</div></div>`;
        });
      } else { ch += '<p style="color:#6b7280;">Nicio conversa»õie.</p>'; }
      ch += '</div>';
      document.body.insertAdjacentHTML('beforeend', `<div id="chatModal" style="position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:9999;display:flex;align-items:center;justify-content:center;"><div style="background:white;padding:25px;border-radius:16px;width:90%;max-width:600px;"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;"><h3>üí¨ ${email}</h3><button onclick="document.getElementById('chatModal').remove()" style="background:none;border:none;font-size:24px;cursor:pointer;">‚úï</button></div>${ch}</div></div>`);
    }

    // ===== MODE UI =====
    function updateModeUI() { renderNav(); }

    // ===== MODE COMMANDS (PƒÇSTRAT EXACT) =====
    function handleModeCommands(text) {
      const lower = text.toLowerCase().trim();

      if (lower === "open mod andrei admin") {
        const pass = prompt("üîê Parola Admin:");
        if (pass === ADMIN_PASSWORD) {
          currentMode = "admin";
          editMode = false;
          updateModeUI();
          pushMessage("ai", "‚úÖ Mod <b>Admin</b> activat!<br><br>Po»õi face ac»õiuni directe (fƒÉrƒÉ dovezi).<br><br>Pentru a edita structura: <code>deschide mod editare</code>");
        } else {
          pushMessage("ai", "‚ùå ParolƒÉ gre»ôitƒÉ!");
        }
        return true;
      }

      if (lower === "open mod andrei gm") {
        const pass = prompt("üîê Parola GM:");
        if (pass === GM_PASSWORD) {
          currentMode = "gm";
          editMode = false;
          updateModeUI();
          pushMessage("ai", "‚úÖ Mod <b>GM</b> activat!<br><br>Vezi √Æn sidebar: Creier AI, De verificat, Reguli Fundamentale, Conversa»õii »ôi SEO & ADS!<br><br>Pentru a edita: <code>deschide mod editare</code>");
        } else {
          pushMessage("ai", "‚ùå ParolƒÉ gre»ôitƒÉ!");
        }
        return true;
      }

      if (lower === "deschide mod editare" || lower === "editare") {
        if (currentMode === "admin" || currentMode === "gm") {
          editMode = true;
          pushMessage("ai", "‚úèÔ∏è <b>Mod editare activ!</b><br><br>" +
            "<b>√énva»õƒÉ:</b> <code>√Ænva»õƒÉ: Elsa costƒÉ 800 lei</code><br>" +
            "<b>Pagini:</b> <code>adaugƒÉ paginƒÉ X √Æn normal/admin/gm</code><br>" +
            "<b>Tabele:</b> <code>adaugƒÉ tabel X cu Col1, Col2</code><br>" +
            "<b>ScanƒÉri:</b> <code>adaugƒÉ scanare X cu Nume, Tel, Data</code><br>" +
            "<b>Stiluri:</b> <code>culoare primarƒÉ rosu</code><br><br>" +
            "C√¢nd termini: <code>inchide mod editare</code>");
        } else {
          pushMessage("ai", "‚ö†Ô∏è Trebuie sƒÉ fii √Æn mod Admin sau GM.");
        }
        return true;
      }

      if (lower === "inchide mod editare" || lower === "gata") {
        editMode = false;
        pushMessage("ai", "‚úÖ Mod editare √Ænchis. Vorbim normal!");
        return true;
      }

      if (lower === "exit" || lower === "iesi") {
        currentMode = "standard";
        editMode = false;
        updateModeUI();
        pushMessage("ai", "üëã Ai ie»ôit din mod special.");
        return true;
      }
      
      // Login command
      if (lower === "intra in mod logare" || lower === "intrƒÉ √Æn mod logare") {
        chatWindow.classList.add('hidden');
        showLoginForm();
        return true;
      }

      return false;
    }
    
    // ===== LOGIN SYSTEM =====
    function showLoginForm() {
      document.body.insertAdjacentHTML('beforeend', `
        <div id="loginOverlay" style="position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:9999;display:flex;align-items:center;justify-content:center;">
          <div style="background:white;padding:30px;border-radius:16px;width:90%;max-width:400px;">
            <div id="loginBox">
              <h2 style="text-align:center;margin-bottom:20px;">üîê Autentificare</h2>
              <input type="email" id="loginEmail" placeholder="üìß Email" style="width:100%;padding:12px;border:2px solid #e5e7eb;border-radius:8px;margin-bottom:10px;font-size:16px;">
              <input type="password" id="loginPass" placeholder="üîí ParolƒÉ" style="width:100%;padding:12px;border:2px solid #e5e7eb;border-radius:8px;margin-bottom:15px;font-size:16px;">
              <button onclick="doLogin()" style="width:100%;padding:14px;background:linear-gradient(135deg,#3b82f6,#2563eb);color:white;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;margin-bottom:10px;">üöÄ IntrƒÉ √Æn cont</button>
              <button onclick="showRegBox()" style="width:100%;padding:14px;background:#f3f4f6;color:#374151;border:none;border-radius:8px;font-size:16px;cursor:pointer;">‚ú® √énregistreazƒÉ-te</button>
              <button onclick="closeLogin()" style="width:100%;padding:10px;background:none;color:#6b7280;border:none;cursor:pointer;margin-top:10px;">‚úï √énchide</button>
            </div>
            <div id="regBox" style="display:none;">
              <h2 style="text-align:center;margin-bottom:20px;">‚ú® √énregistreazƒÉ-te</h2>
              <input type="text" id="regName" placeholder="üë§ Nume" style="width:100%;padding:12px;border:2px solid #e5e7eb;border-radius:8px;margin-bottom:10px;font-size:16px;">
              <input type="email" id="regEmail" placeholder="üìß Email" style="width:100%;padding:12px;border:2px solid #e5e7eb;border-radius:8px;margin-bottom:10px;font-size:16px;">
              <input type="password" id="regPass" placeholder="üîí ParolƒÉ" style="width:100%;padding:12px;border:2px solid #e5e7eb;border-radius:8px;margin-bottom:10px;font-size:16px;">
              <input type="password" id="regPass2" placeholder="üîí RepetƒÉ parola" style="width:100%;padding:12px;border:2px solid #e5e7eb;border-radius:8px;margin-bottom:10px;font-size:16px;">
              <select id="regRole" style="width:100%;padding:12px;border:2px solid #e5e7eb;border-radius:8px;margin-bottom:15px;font-size:16px;">
                <option value="Animator">Animator</option><option value="»òofer">»òofer</option><option value="Trainer">Trainer</option><option value="Altul">Altul</option>
              </select>
              <button onclick="doRegister()" style="width:100%;padding:14px;background:linear-gradient(135deg,#22c55e,#16a34a);color:white;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;margin-bottom:10px;">‚ú® CreeazƒÉ cont</button>
              <button onclick="showLoginBox()" style="width:100%;padding:14px;background:#f3f4f6;color:#374151;border:none;border-radius:8px;font-size:16px;cursor:pointer;">üë§ Am deja cont</button>
            </div>
          </div>
        </div>
      `);
    }
    
    function showRegBox() { document.getElementById('loginBox').style.display='none'; document.getElementById('regBox').style.display='block'; }
    function showLoginBox() { document.getElementById('loginBox').style.display='block'; document.getElementById('regBox').style.display='none'; }
    function closeLogin() { document.getElementById('loginOverlay')?.remove(); }
    
    function logoutUser() {
      if (confirm('Sigur vrei sƒÉ ie»ôi din cont?')) {
        clearUserSession();
        alert('üëã Te-ai delogat!');
        location.reload();
      }
    }
    
    async function doLogin() {
      const email = document.getElementById('loginEmail').value.trim();
      const pass = document.getElementById('loginPass').value;
      if (!email || !pass) { alert('‚ö†Ô∏è CompleteazƒÉ email »ôi parola!'); return; }
      try {
        const r = await fetch(BACKEND_URL + '?action=login&email=' + encodeURIComponent(email) + '&password=' + encodeURIComponent(pass));
        const d = await r.json();
        if (d.ok && d.user) {
          if (!d.user.approved) { alert('‚è≥ Contul tƒÉu a»ôteaptƒÉ aprobarea administratorului.'); return; }
          if (d.user.blocked) { alert('üîí Contul tƒÉu este blocat.'); return; }
          saveUserSession(d.user);
          closeLogin();
          alert('‚úÖ Bine ai venit, ' + d.user.name + '!');
          currentMode = "standard"; // RƒÉm√¢ne √Æn mod standard dar logat
          renderNav();
          showUserHome(); // Afi»ôeazƒÉ pagina de home pentru user
        } else { alert('‚ùå Email sau parolƒÉ incorectƒÉ!'); }
      } catch(e) { alert('‚ùå Eroare: ' + e.message); }
    }
    
    async function doRegister() {
      const name = document.getElementById('regName').value.trim();
      const email = document.getElementById('regEmail').value.trim();
      const pass = document.getElementById('regPass').value;
      const pass2 = document.getElementById('regPass2').value;
      const role = document.getElementById('regRole').value;
      if (!name || !email || !pass) { alert('‚ö†Ô∏è CompleteazƒÉ toate c√¢mpurile!'); return; }
      if (pass !== pass2) { alert('‚ö†Ô∏è Parolele nu coincid!'); return; }
      try {
        const r = await fetch(BACKEND_URL + '?action=register&name=' + encodeURIComponent(name) + '&email=' + encodeURIComponent(email) + '&password=' + encodeURIComponent(pass) + '&role=' + encodeURIComponent(role));
        const d = await r.json();
        if (d.ok) { alert('‚úÖ Cont creat!\\n\\n‚è≥ Contul a»ôteaptƒÉ aprobarea administratorului.'); showLoginBox(); }
        else { alert('‚ùå ' + (d.error || 'Eroare')); }
      } catch(e) { alert('‚ùå Eroare: ' + e.message); }
    }

    // ===== CHAT (PƒÇSTRAT EXACT) =====
    function pushMessage(type, html) {
      const div = document.createElement("div");
      div.className = "chat-msg " + type;
      div.innerHTML = html;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    async function handleChatSend() {
      const text = chatInput.value.trim();
      if (!text) return;

      chatInput.value = "";
      pushMessage("user", text);

      if (handleModeCommands(text)) return;

      const scanRequest = detectScanRequest(text);
      if (scanRequest && currentMode === "standard") {
        openScanPopup(scanRequest.nume, "ScaneazƒÉ " + scanRequest.nume);
        pushMessage("ai", "üì∑ √éncarcƒÉ documentul pentru a continua.");
        return;
      }

      const lower = text.toLowerCase();
      const isEditCmd = lower.includes("adaugƒÉ") || lower.includes("adauga") || lower.includes("»ôterge") || lower.includes("culoare") || lower.includes("titlu");
      
      if (isEditCmd && (currentMode === "admin" || currentMode === "gm") && !editMode) {
        pushMessage("ai", "‚ö†Ô∏è Pentru a modifica, activeazƒÉ mai √Ænt√¢i:<br><code>deschide mod editare</code>");
        return;
      }

      pushMessage("ai", "‚è≥ Procesez...");

      try {
        let url = BACKEND_URL + "?action=chat&message=" + encodeURIComponent(text);
        
        if (currentMode === "gm") {
          url += "&mode=gm&password=" + encodeURIComponent(GM_PASSWORD) + "&editMode=" + editMode;
        } else if (currentMode === "admin") {
          url += "&mode=admin&password=" + encodeURIComponent(ADMIN_PASSWORD);
        }

        const response = await fetch(url);
        const data = await response.json();

        const msgs = chatMessages.querySelectorAll(".chat-msg.ai");
        const last = msgs[msgs.length - 1];
        if (last?.textContent.includes("Procesez")) last.remove();

        if (data.ok && data.reply) {
          let reply = data.reply
            .replace(/\*\*(.+?)\*\*/g, '<b>$1</b>')
            .replace(/`([^`]+)`/g, '<code>$1</code>')
            .replace(/\n/g, '<br>');
          pushMessage("ai", reply);
          
          if (data.reload) setTimeout(() => loadApp(), 500);
          if (data.requestUpload) openScanPopup(data.scanType, "√éncarcƒÉ document");
        } else {
          pushMessage("ai", "‚ö†Ô∏è " + (data.error || "Eroare"));
        }
      } catch (e) {
        const msgs = chatMessages.querySelectorAll(".chat-msg.ai");
        const last = msgs[msgs.length - 1];
        if (last?.textContent.includes("Procesez")) last.remove();
        pushMessage("ai", "‚ö†Ô∏è Eroare conexiune");
      }
    }

    function detectScanRequest(text) {
      const lower = text.toLowerCase();
      if (lower.includes("scanez") || lower.includes("notez") || lower.includes("√ÆncarcƒÉ") || lower.includes("vreau sƒÉ")) {
        const scans = appData.scanari || [];
        for (const s of scans) {
          if (lower.includes(s.nume.toLowerCase())) return s;
        }
        if (lower.includes("petrecere") || lower.includes("rezerv")) {
          return { nume: "Petreceri", campuri: "Nume,Telefon,Data,Ora,Locatie" };
        }
      }
      return null;
    }

    // ===== SCAN POPUP (PƒÇSTRAT EXACT) =====
    function openScanPopup(scanType, title) {
      currentScanType = scanType;
      document.getElementById("scanPopupTitle").textContent = "üì∑ " + title;
      scanPopup.classList.add("active");
      overlay.classList.add("active");
      uploadArea.style.display = "block";
      scanStatus.style.display = "none";
    }

    function closeScanPopup() {
      scanPopup.classList.remove("active");
      overlay.classList.remove("active");
    }

    uploadArea.addEventListener("click", () => fileInput.click());
    fileInput.addEventListener("change", (e) => { if (e.target.files[0]) handleFileUpload(e.target.files[0]); });

    async function handleFileUpload(file) {
      uploadArea.style.display = "none";
      scanStatus.style.display = "block";
      scanStatus.innerHTML = "‚è≥ Se scaneazƒÉ...";

      try {
        const base64 = await new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result.split(",")[1]);
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });

        const response = await fetch(BACKEND_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action: "scanDocument", scanType: currentScanType, image: base64, fileName: file.name, mode: currentMode })
        });

        const data = await response.json();

        if (data.ok) {
          closeScanPopup();
          pushMessage("ai", "‚úÖ <b>Scanat »ôi salvat!</b><br><br>" + data.message.replace(/\n/g, '<br>').replace(/\*\*(.+?)\*\*/g, '<b>$1</b>'));
          setTimeout(() => loadApp(), 500);
        } else {
          scanStatus.innerHTML = "‚ùå " + (data.error || "Eroare");
        }
      } catch (e) {
        scanStatus.innerHTML = "‚ùå Eroare la √ÆncƒÉrcare";
      }
    }

    // ===== INIT =====
    loadApp();
    pushMessage("ai", "Salut! üëã Sunt AI-ul SuperParty. Cu ce te pot ajuta?");
  </script>
</body>
</html>
